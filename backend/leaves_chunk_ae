 },
        },
      }),
      this.prisma.leaveRequest.count({ where }),
    ]);

    return {
      data: requests,
      pagination: {
        page,
        limit,
        total,
        totalPages: Math.ceil(total / limit),
      },
    };
  }

  async approveLeaveRequest(id: string, approverId: string, notes?: string) {
    const leaveRequest = await this.prisma.leaveRequest.findUnique({
      where: { id },
      include: { user: true },
    });

    if (!leaveRequest) {
      throw new NotFoundException('طلب الإجازة غير موجود');
    }

    if (leaveRequest.status !== 'PENDING') {
      throw new BadRequestException('هذا الطلب تم البت فيه مسبقاً');
    }

    // حساب عدد أيام الإجازة
    const startDate = new Date(leaveRequest.startDate);
    const endDate = new Date(leaveRequest.endDate);
    const leaveDays = Math.ceil((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24)) + 1;

    // خصم من رصيد الإجازات
    await this.prisma.user.update({
      where: { id: leaveRequest.userId },
      data: {
        usedLeaveDays: { increment: leaveDays },
        remainingLeaveDays: { decrement: leaveDays },
      },
    });

    const updated = await this.prisma.leaveRequest.update({
      where: { id },
      data: {
        status: 'APPROVED',
        approverId,
        approverNotes: notes,
        approvedAt: new Date(),
      },
    });

    // Create attendance records for leave days
