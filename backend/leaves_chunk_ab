user.remainingLeaveDays} يوم`);
    }

    // Check for overlapping leaves
    const existingLeave = await this.prisma.leaveRequest.findFirst({
      where: {
        userId,
        status: { in: ['PENDING', 'APPROVED'] },
        OR: [
          { startDate: { lte: end }, endDate: { gte: start } },
        ],
      },
    });

    if (existingLeave) {
      throw new BadRequestException('يوجد طلب إجازة متداخل مع هذه الفترة');
    }

    const leaveRequest = await this.prisma.leaveRequest.create({
      data: {
        userId,
        type,
        startDate: start,
        endDate: end,
        requestedDays,
        notes: leaveNotes,
        reason: leaveNotes,
      },
      include: {
        user: {
          select: { firstName: true, lastName: true, managerId: true },
        },
      },
    });

    // Notify manager
    if (leaveRequest.user.managerId) {
      await this.notificationsService.sendNotification(
        leaveRequest.user.managerId,
        NotificationType.GENERAL,
        'طلب إجازة جديد',
        `${leaveRequest.user.firstName} ${leaveRequest.user.lastName} طلب ${this.getLeaveTypeName(type)}`,
        { leaveRequestId: leaveRequest.id },
      );
    }

    return leaveRequest;
  }

  async getMyLeaveRequests(userId: string, query: LeaveQueryDto) {
    const { status, type, page = 1, limit = 20 } = query;

    const where: any = { userId };
    if (status) where.status = status;
    if (type) where.type