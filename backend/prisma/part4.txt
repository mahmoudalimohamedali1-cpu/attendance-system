model CustodyAssignment {
  id                   String                  @id @default(uuid())
  companyId            String                  @map("company_id")
  itemId               String                  @map("item_id")
  employeeId           String                  @map("employee_id")
  assignerId           String                  @map("assigner_id")
  assignedAt           DateTime                @default(now()) @map("assigned_at")
  expectedReturnDate   DateTime?               @map("expected_return_date")
  actualReturnDate     DateTime?               @map("actual_return_date")
  status               CustodyAssignmentStatus @default(ACTIVE)
  conditionAtAssign    CustodyCondition        @map("condition_at_assign")
  notes                String?
  attachmentUrl        String?                 @map("attachment_url")
  approverId           String?                 @map("approver_id")
  approvedAt           DateTime?               @map("approved_at")
  createdAt            DateTime                @default(now()) @map("created_at")
  updatedAt            DateTime                @updatedAt @map("updated_at")
  approver             User?                   @relation("CustodyApprover", fields: [approverId], references: [id])
  assigner             User                    @relation("CustodyAssigner", fields: [assignerId], references: [id])
  company              Company                 @relation(fields: [companyId], references: [id])
  employee             User                    @relation("EmployeeCustody", fields: [employeeId], references: [id])
  item                 CustodyItem             @relation(fields: [itemId], references: [id])

  @@index([employeeId, status])
  @@index([itemId])
  @@map("custody_assignments")
}

model CustodyReturn {
  id                 String              @id @default(uuid())
  itemId             String              @map("item_id")
  employeeId         String              @map("employee_id")
  returnerId         String              @map("returner_id")
  reviewerId         String?             @map("reviewer_id")
  returnedAt         DateTime            @default(now()) @map("returned_at")
  actualCondition    CustodyCondition    @map("actual_condition")
  status             CustodyReturnStatus @default(PENDING)
  notes              String?
  reviewNotes        String?             @map("review_notes")
  attachmentUrl      String?             @map("attachment_url")
  createdAt          DateTime            @default(now()) @map("created_at")
  companyId          String?             @map("company_id")
  company            Company?            @relation(fields: [companyId], references: [id])
  employee           User                @relation("CustodyReturner", fields: [employeeId], references: [id])
  item               CustodyItem         @relation(fields: [itemId], references: [id])
  reviewer           User?               @relation("CustodyReturnReviewer", fields: [reviewerId], references: [id])

  @@index([itemId])
  @@map("custody_returns")
}

model CustodyTransfer {
  id                   String                  @id @default(uuid())
  itemId               String                  @map("item_id")
  fromEmployeeId       String                  @map("from_employee_id")
  toEmployeeId         String                  @map("to_employee_id")
  initiatorId          String                  @map("initiator_id")
  approverId           String?                 @map("approver_id")
  transferredAt        DateTime?               @map("transferred_at")
  status               CustodyTransferStatus @default(PENDING)
  notes                String?
  createdAt            DateTime                @default(now()) @map("created_at")
  companyId            String?                 @map("company_id")
  approver             User?                   @relation("CustodyTransferApprover", fields: [approverId], references: [id])
  company              Company?                @relation(fields: [companyId], references: [id])
  fromEmployee         User                    @relation("CustodyTransferFrom", fields: [fromEmployeeId], references: [id])
  initiator            User                    @relation("CustodyTransferInitiator", fields: [initiatorId], references: [id])
  item                 CustodyItem             @relation(fields: [itemId], references: [id])
  toEmployee           User                    @relation("CustodyTransferTo", fields: [toEmployeeId], references: [id])

  @@index([itemId])
  @@map("custody_transfers")
}

model CustodyMaintenance {
  id                 String                   @id @default(uuid())
  itemId             String                   @map("item_id")
  reporterId         String                   @map("reporter_id")
  maintenanceType    MaintenanceType          @map("maintenance_type")
  description        String
  cost               Decimal?                 @db.Decimal(10, 2)
  startDate          DateTime?                @map("start_date")
  completionDate     DateTime?                @map("completion_date")
  status             CustodyMaintenanceStatus @default(PENDING)
  provider           String?
  notes              String?
  createdAt          DateTime                 @default(now()) @map("created_at")
  companyId          String?                  @map("company_id")
  company            Company?                 @relation(fields: [companyId], references: [id])
  item               CustodyItem              @relation(fields: [itemId], references: [id])
  reporter           User                     @relation("MaintenanceReporter", fields: [reporterId], references: [id])

  @@index([itemId])
  @@map("custody_maintenances")
}

model EmployeeDocument {
  id             String       @id @default(uuid())
  userId         String       @map("user_id")
  documentType   DocumentType @map("document_type")
  fileUrl        String       @map("file_url")
  fileName       String       @map("file_name")
  documentNumber String?      @map("document_number")
  issueDate      DateTime?    @map("issue_date")
  expiryDate     DateTime?    @map("expiry_date")
  isVerified     Boolean      @default(false) @map("is_verified")
  notes          String?
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, documentType])
  @@map("employee_documents")
}

model PayrollLedger {
  id                String   @id @default(uuid())
  companyId         String   @map("company_id")
  periodId          String   @map("period_id")
  runId             String   @map("run_id")
  totalEarnings     Decimal  @map("total_earnings") @db.Decimal(12, 2)
  totalDeductions   Decimal  @map("total_deductions") @db.Decimal(12, 2)
  totalEmployerCost Decimal  @map("total_employer_cost") @db.Decimal(12, 2)
  totalNetSalary    Decimal  @map("total_net_salary") @db.Decimal(12, 2)
  isPosted          Boolean  @default(false) @map("is_posted")
  postedAt          DateTime? @map("posted_at")
  createdAt         DateTime @default(now()) @map("created_at")

  @@unique([runId])
  @@map("payroll_ledgers")
}

model JournalEntry {
  id              String   @id @default(uuid())
  companyId       String   @map("company_id")
  ledgerId        String   @map("ledger_id")
  accountCode     String   @map("account_code")
  accountName     String   @map("account_name")
  debit           Decimal? @db.Decimal(12, 2)
  credit          Decimal? @db.Decimal(12, 2)
  costCenterId    String?  @map("cost_center_id")
  description     String?
  createdAt       DateTime @default(now()) @map("created_at")

  @@index([ledgerId])
  @@map("journal_entries")
}

model EmployeeLocationLog {
  id              String   @id @default(uuid())
  userId          String   @map("user_id")
  companyId       String   @map("company_id")
  latitude        Decimal  @db.Decimal(10, 8)
  longitude       Decimal  @db.Decimal(11, 8)
  accuracy        Float?
  altitude        Float?
  speed           Float?
  heading         Float?
  activityType    String?  @map("activity_type")
  batteryLevel    Float?   @map("battery_level")
  isMock          Boolean  @default(false) @map("is_mock")
  timestamp       DateTime @default(now())
  createdAt       DateTime @default(now()) @map("created_at")
  company         Company  @relation(fields: [companyId], references: [id])
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, timestamp])
  @@index([companyId, timestamp])
  @@map("employee_location_logs")
}

model GeofenceExitEvent {
  id              String     @id @default(uuid())
  userId          String     @map("user_id")
  companyId       String     @map("company_id")
  attendanceId    String?    @map("attendance_id")
  latitude        Decimal    @db.Decimal(10, 8)
  longitude       Decimal    @db.Decimal(11, 8)
  distanceFromBound Float      @map("distance_from_bound")
  timestamp       DateTime   @default(now())
  isInsideNow     Boolean    @default(false) @map("is_inside_now")
  notes           String?
  createdAt       DateTime   @default(now()) @map("created_at")
  attendance      Attendance? @relation(fields: [attendanceId], references: [id])
  company         Company    @relation(fields: [companyId], references: [id])
  user            User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, timestamp])
  @@map("geofence_exit_events")
}

model OnboardingTemplate {
  id              String                  @id @default(uuid())
  companyId       String                  @map("company_id")
  name            String
  description     String?
  type            OnboardingType          @default(NEW_HIRE)
  isActive        Boolean                 @default(true) @map("is_active")
  createdAt       DateTime                @default(now()) @map("created_at")
  updatedAt       DateTime                @updatedAt @map("updated_at")
  company         Company                 @relation(fields: [companyId], references: [id])
  processes       OnboardingProcess[]
  tasks           OnboardingTemplateTask[]

  @@unique([companyId, name])
  @@map("onboarding_templates")
}

model OnboardingTemplateTask {
  id              String          @id @default(uuid())
  templateId      String          @map("template_id")
  title           String
  description     String?
  assigneeType    AssigneeType    @default(EMPLOYEE) @map("assignee_type")
  assigneeRoleId  String?         @map("assignee_role_id")
  dueDaysAfter    Int             @default(0) @map("due_days_after")
  isMandatory     Boolean         @default(true) @map("is_mandatory")
  sortOrder       Int             @default(0) @map("sort_order")
  createdAt       DateTime        @default(now()) @map("created_at")
  template        OnboardingTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@map("onboarding_template_tasks")
}

model OnboardingProcess {
  id              String                  @id @default(uuid())
  companyId       String                  @map("company_id")
  templateId      String?                 @map("template_id")
  employeeId      String                  @map("employee_id")
  startDate       DateTime                @map("start_date")
  dueDate         DateTime                @map("due_date")
  status          OnboardingProcessStatus @default(IN_PROGRESS)
  progress        Float                   @default(0)
  createdAt       DateTime                @default(now()) @map("created_at")
  updatedAt       DateTime                @updatedAt @map("updated_at")
  company         Company                 @relation(fields: [companyId], references: [id])
  employee        User                    @relation(fields: [employeeId], references: [id])
  template        OnboardingTemplate?     @relation(fields: [templateId], references: [id])
  tasks           OnboardingTask[]

  @@index([employeeId, status])
  @@map("onboarding_processes")
}

model OnboardingTask {
  id             String               @id @default(uuid())
  processId      String               @map("process_id")
  title          String
  description    String?
  assigneeId     String               @map("assignee_id")
  dueDate        DateTime             @map("due_date")
  completedAt    DateTime?            @map("completed_at")
  status         OnboardingTaskStatus @default(PENDING)
  notes          String?
  attachmentUrl  String?              @map("attachment_url")
  createdAt      DateTime             @default(now()) @map("created_at")
  updatedAt      DateTime             @updatedAt @map("updated_at")
  process        OnboardingProcess    @relation(fields: [processId], references: [id], onDelete: Cascade)

  @@index([assigneeId, status])
  @@map("onboarding_tasks")
}

model AbsencePrediction {
  id              String   @id @default(uuid())
  userId          String   @map("user_id")
  predictionDate  DateTime @map("prediction_date") @db.Date
  probability     Float
  patternId       String?  @map("pattern_id")
  riskLevel       RiskLevel @default(LOW) @map("risk_level")
  keyFactors      Json?    @map("key_factors")
  createdAt       DateTime @default(now()) @map("created_at")

  @@index([userId, predictionDate])
  @@map("absence_predictions")
}

model PredictionAccuracy {
  id              String   @id @default(uuid())
  companyId       String   @map("company_id")
  modelType       String   @map("model_type")
  accuracy        Float
  mape            Float?
  sampleSize      Int      @map("sample_size")
  calculatedAt    DateTime @default(now()) @map("calculated_at")
  company         Company  @relation(fields: [companyId], references: [id])

  @@index([companyId, modelType])
  @@map("prediction_accuracies")
}

model AbsencePattern {
  id              String   @id @default(uuid())
  userId          String   @map("user_id")
  patternType     String   @map("pattern_type")
  frequency       Int
  description     String?
  lastDetectedAt  DateTime @map("last_detected_at")
  createdAt       DateTime @default(now()) @map("created_at")

  @@index([userId])
  @@map("absence_patterns")
}
