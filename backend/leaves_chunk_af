    await this.createLeaveAttendanceRecords(leaveRequest);

    // Notify employee
    await this.notificationsService.sendNotification(
      leaveRequest.userId,
      NotificationType.LEAVE_APPROVED,
      'تمت الموافقة على طلب الإجازة',
      `تمت الموافقة على طلبك ${this.getLeaveTypeName(leaveRequest.type)} (${leaveDays} يوم)`,
      { leaveRequestId: id },
    );

    return updated;
  }

  async rejectLeaveRequest(id: string, approverId: string, notes?: string) {
    const leaveRequest = await this.prisma.leaveRequest.findUnique({
      where: { id },
    });

    if (!leaveRequest) {
      throw new NotFoundException('طلب الإجازة غير موجود');
    }

    if (leaveRequest.status !== 'PENDING') {
      throw new BadRequestException('هذا الطلب تم البت فيه مسبقاً');
    }

    const updated = await this.prisma.leaveRequest.update({
      where: { id },
      data: {
        status: 'REJECTED',
        approverId,
        approverNotes: notes,
        approvedAt: new Date(),
      },
    });

    // Notify employee
    await this.notificationsService.sendNotification(
      leaveRequest.userId,
      NotificationType.LEAVE_REJECTED,
      'تم رفض طلب الإجازة',
      `تم رفض طلبك ${this.getLeaveTypeName(leaveRequest.type)}${notes ? ': ' + notes : ''}`,
      { leaveRequestId: id },
    );

    return updated;
  }

  async getAllLeaveRequests(query: LeaveQueryDto) {
 