generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id                           String                        @id @default(uuid())
  name                         String                        @unique
  nameEn                       String?                       @map("name_en")
  crNumber                     String?                       @unique @map("cr_number")
  taxId                        String?                       @unique @map("tax_id")
  logo                         String?
  address                      String?
  phone                        String?
  email                        String?
  website                      String?
  createdAt                    DateTime                      @default(now()) @map("created_at")
  updatedAt                    DateTime                      @updatedAt @map("updated_at")
  advanceRequests              AdvanceRequest[]
  aiConversations              AiConversation[]
  approvalChainConfigs         ApprovalChainConfig[]
  approvalLogs                 ApprovalLog[]
  attendances                  Attendance[]
  auditLogs                    AuditLog[]
  branches                     Branch[]
  careerPaths                  CareerPath[]
  companyBankAccounts          CompanyBankAccount[]
  companyConfig                CompanyConfig?
  disciplinaryPolicy           CompanyDisciplinaryPolicy?
  competencyFrameworks         CompetencyFramework[]
  coreValues                   CoreValue[]
  costCenterAllocations        CostCenterAllocation[]
  costCenterBudgets            CostCenterBudget[]
  costCenters                  CostCenter[]
  custodyAssignments           CustodyAssignment[]
  custodyCategories            CustodyCategory[]
  custodyItems                 CustodyItem[]
  custodyMaintenances          CustodyMaintenance[]
  custodyReturns               CustodyReturn[]
  custodyTransfers             CustodyTransfer[]
  departments                  Department[]
  developmentPlans             DevelopmentPlan[]
  disciplinaryCases            DisciplinaryCase[]
  employeeLocationLogs         EmployeeLocationLog[]
  employeeSurveys              EmployeeSurvey[]
  feedbackQuestionSets         FeedbackQuestionSet[]
  geofenceExitEvents           GeofenceExitEvent[]
  goals                        Goal[]
  gosiConfigs                  GosiConfig[]
  holidays                     Holiday[]
  jobFamilies                  JobFamily[]
  jobTitles                    JobTitle[]
  knowledgeBaseArticles        KnowledgeBaseArticle[]
  kpiDefinitions               KPIDefinition[]
  leaveBalances                LeaveBalance[]
  leaveRequests                LeaveRequest[]
  leaveTypeConfigs             LeaveTypeConfig[]
  letterRequests               LetterRequest[]
  mudadSubmissions             MudadSubmission[]
  notifications                Notification[]
  onboardingProcesses          OnboardingProcess[]
  onboardingTemplates          OnboardingTemplate[]
  payrollAdjustments           PayrollAdjustment[]
  payrollPeriods               PayrollPeriod[]
  payrollRuns                  PayrollRun[]
  payrollSettings              PayrollSettings?
  payslips                     Payslip[]
  performanceCompetencyModels  PerformanceCompetencyModel[]
  performanceReviewCycles      PerformanceReviewCycle[]
  permissionAuditLogs          PermissionAuditLog[]
  policies                     Policy[]
  programs                     Program[]
  projectTemplates             ProjectTemplate[]
  projects                     Project[]
  raiseRequests                RaiseRequest[]
  recognitions                 Recognition[]
  retroPays                    RetroPay[]
  salaryComponents             SalaryComponent[]
  salaryStructures             SalaryStructure[]
  saudizationConfig            SaudizationConfig?
  shiftOptimizationRuns        ShiftOptimizationRun[]
  shiftRules                   ShiftRule[]
  shiftSchedules               ShiftSchedule[]
  shiftTemplates               ShiftTemplate[]
  shifts                       Shift[]
  smartPolicies                SmartPolicy[]
  smartPolicyAnalytics         SmartPolicyAnalytics[]
  smartPolicyExceptions        SmartPolicyException[]
  smartPolicyRetroApplications SmartPolicyRetroApplication[]
  sprints                      Sprint[]
  submissionStatusLogs         SubmissionStatusLog[]
  successionPlans              SuccessionPlan[]
  suspiciousAttempts           SuspiciousAttempt[]
  systemSettings               SystemSetting[]
  taskAutomations              TaskAutomation[]
  taskCategories               TaskCategory[]
  taskTemplates                TaskTemplate[]
  tasks                        Task[]
  teamCalendarEvents           TeamCalendarEvent[]
  userPermissions              UserPermission[]
  users                        User[]
  workFromHomes                WorkFromHome[]
  workSchedules                WorkSchedule[]
  wpsSubmissions               WpsSubmission[]
  employeeDebts                EmployeeDebtLedger[]

  @@map("companies")
}

model PayrollSettings {
  id                             String                    @id @default(uuid())
  companyId                      String                    @unique @map("company_id")
  payrollClosingDay              Int                       @default(25) @map("payroll_closing_day")
  hireTerminationCalcBase        WorkDayCalculationBase    @default(CALENDAR_DAYS) @map("hire_termination_calc_base")
  hireTerminationMethod          HireTerminationMethod     @default(EXCLUDE_WEEKENDS) @map("hire_termination_method")
  unpaidLeaveCalcBase            WorkDayCalculationBase    @default(ACTUAL_WORKING_DAYS) @map("unpaid_leave_calc_base")
  unpaidLeaveMethod              UnpaidLeaveMethod         @default(BASED_ON_SHIFTS) @map("unpaid_leave_method")
  splitUnpaidByClosingDate       Boolean                   @default(false) @map("split_unpaid_by_closing_date")
  overtimeCalcBase               WorkDayCalculationBase    @default(ACTUAL_WORKING_DAYS) @map("overtime_calc_base")
  overtimeMethod                 OvertimeCalculationMethod @default(BASED_ON_SHIFTS) @map("overtime_method")
  leaveAllowanceCalcBase         WorkDayCalculationBase    @default(CALENDAR_DAYS) @map("leave_allowance_calc_base")
  leaveAllowanceMethod           LeaveAllowanceMethod      @default(BASIC_PLUS_HOUSING) @map("leave_allowance_method")
  showCompanyContributions       Boolean                   @default(true) @map("show_company_contributions")
  showClosingDateOnPayslip       Boolean                   @default(true) @map("show_closing_date_on_payslip")
  deductAbsenceFromBasic         Boolean                   @default(true) @map("deduct_absence_from_basic")
  showActualAbsenceDays          Boolean                   @default(false) @map("show_actual_absence_days")
  enableNegativeBalanceCarryover Boolean                   @default(false) @map("enable_negative_balance_carryover")
  settleNegativeAsTransaction    Boolean                   @default(false) @map("settle_negative_as_transaction")
  roundSalaryToNearest           Int                       @default(0) @map("round_salary_to_nearest")
  defaultWorkingDaysPerMonth     Int                       @default(30) @map("default_working_days_per_month")
  createdAt                      DateTime                  @default(now()) @map("created_at")
  updatedAt                      DateTime                  @updatedAt @map("updated_at")
  leaveDailyRateDivisor          Int                       @default(30) @map("leave_daily_rate_divisor")

  // === New Features (1-10) ===
  // 1. معامل الوقت الإضافي العادي (1.5 = 150%)
  overtimeMultiplier         Float   @default(1.5) @map("overtime_multiplier")
  // 2. فترة السماح للتأخير (بالدقائق)
  gracePeriodMinutes         Int     @default(15) @map("grace_period_minutes")
  // 3. معدل إضافي لعطلة نهاية الأسبوع
  weekendOvertimeMultiplier  Float   @default(2.0) @map("weekend_overtime_multiplier")
  // 4. معدل إضافي للأعياد والعطل الرسمية
  holidayOvertimeMultiplier  Float   @default(2.0) @map("holiday_overtime_multiplier")
  // 5. بدل المناوبة الليلية (نسبة مئوية من الراتب الأساسي)
  nightShiftAllowancePercent Float   @default(0) @map("night_shift_allowance_percent")
  // 6. الحد الأقصى للخصومات (50% حسب نظام العمل السعودي)
  maxDeductionPercent        Float   @default(50) @map("max_deduction_percent")
  // 7. الحد الأدنى للراتب الصافي
  minNetSalary               Float   @default(0) @map("min_net_salary")
  // 8. يوم القفل التلقائي للرواتب (0 = معطل)
  autoLockDay                Int     @default(0) @map("auto_lock_day")
  // 9. العملة الافتراضية
  defaultCurrency            String  @default("SAR") @map("default_currency")
  // 10. تفعيل العملات المتعددة
  enableMultiCurrency        Boolean @default(false) @map("enable_multi_currency")

  // === New Features (11-20) ===
  // 11. تفعيل تتبع المكافآت
  enableBonusTracking       Boolean @default(true) @map("enable_bonus_tracking")
  // 12. طريقة حساب المكافأة (FIXED, PERCENTAGE, PERFORMANCE_BASED)
  bonusCalculationMethod    String  @default("FIXED") @map("bonus_calculation_method")
  // 13. تفعيل العمولات
  enableCommission          Boolean @default(false) @map("enable_commission")
  // 14. أساس حساب العمولة (SALES, PROFIT, CUSTOM)
  commissionCalculationBase String  @default("SALES") @map("commission_calculation_base")
  // 15. تفعيل فئات البدلات المتعددة
  enableAllowanceCategories Boolean @default(true) @map("enable_allowance_categories")
  // 16. الحد الأقصى للبدلات كنسبة من الراتب الأساسي
  maxAllowancePercent       Float   @default(100) @map("max_allowance_percent")
  // 17. تفعيل حساب الضرائب
  enableTaxCalculation      Boolean @default(false) @map("enable_tax_calculation")
  // 18. طريقة حساب الضرائب (FLAT_RATE, PROGRESSIVE, EXEMPT)
  taxCalculationMethod      String  @default("EXEMPT") @map("tax_calculation_method")
  // 19. تفعيل السلفة على الراتب
  enableSalaryAdvance       Boolean @default(true) @map("enable_salary_advance")
  // 20. الحد الأقصى للسلفة كنسبة من الراتب
  maxAdvancePercent         Float   @default(50) @map("max_advance_percent")

  // === New Features (21-30) ===
  // 21. تفعيل خصم القروض من الراتب
  enableLoanDeduction     Boolean @default(true) @map("enable_loan_deduction")
  // 22. الحد الأقصى لخصم القرض كنسبة من الراتب
  maxLoanDeductionPercent Float   @default(30) @map("max_loan_deduction_percent")
  // 23. تفعيل سير عمل الموافقة على الرواتب
  enableApprovalWorkflow  Boolean @default(false) @map("enable_approval_workflow")
  // 24. عدد مستويات الموافقة المطلوبة
  approvalLevels          Int     @default(1) @map("approval_levels")
  // 25. تفعيل التحويل البنكي
  enableBankTransfer      Boolean @default(true) @map("enable_bank_transfer")
  // 26. رمز البنك الافتراضي
  defaultBankCode         String  @default("") @map("default_bank_code")
  // 27. تفعيل الدفع بأثر رجعي
  enableRetroactivePay    Boolean @default(true) @map("enable_retroactive_pay")
  // 28. الحد الأقصى للأشهر للدفع بأثر رجعي
  retroactiveMonthsLimit  Int     @default(3) @map("retroactive_months_limit")
  // 29. تفعيل حساب مكافأة نهاية الخدمة
  enableEosCalculation    Boolean @default(true) @map("enable_eos_calculation")
  // 30. طريقة حساب نهاية الخدمة (SAUDI_LABOR_LAW, CUSTOM, CONTRACTUAL)
  eosCalculationMethod    String  @default("SAUDI_LABOR_LAW") @map("eos_calculation_method")

  // === New Features (31-40) ===
  // 31. تفعيل حساب التأمينات الاجتماعية (GOSI)
  enableGosiCalculation          Boolean @default(true) @map("enable_gosi_calculation")
  // 32. نسبة التأمينات على الموظف
  gosiEmployeePercent            Float   @default(9.75) @map("gosi_employee_percent")
  // 33. نسبة التأمينات على صاحب العمل
  gosiEmployerPercent            Float   @default(11.75) @map("gosi_employer_percent")
  // 34. تفعيل صرف رصيد الإجازات
  enableVacationEncashment       Boolean @default(true) @map("enable_vacation_encashment")
  // 35. طريقة صرف الإجازات (ON_TERMINATION, ON_REQUEST, ANNUAL)
  vacationEncashmentMethod       String  @default("ON_TERMINATION") @map("vacation_encashment_method")
  // 36. تفعيل عقوبات الحضور (التأخير والغياب)
  enableAttendancePenalty        Boolean @default(true) @map("enable_attendance_penalty")
  // 37. طريقة خصم التأخير (PER_MINUTE, PER_HOUR, DAILY_RATE)
  lateDeductionMethod            String  @default("PER_MINUTE") @map("late_deduction_method")
  // 37.1 حد دقائق التأخير لخصم يوم كامل (عند اختيار DAILY_RATE)
  lateThresholdMinutes           Int     @default(120) @map("late_threshold_minutes")
  // 38. طريقة خصم الغياب (DAILY_RATE, HALF_DAY, PROGRESSIVE)
  absenceDeductionMethod         String  @default("DAILY_RATE") @map("absence_deduction_method")
  // 38.1 معدل الخصم التصاعدي للغياب (عند اختيار PROGRESSIVE)
  absenceProgressiveRate         Float   @default(1.0) @map("absence_progressive_rate")
  // 38.2 تفعيل خصم الانصراف المبكر
  enableEarlyDeparturePenalty    Boolean @default(false) @map("enable_early_departure_penalty")
  // 38.3 طريقة خصم الانصراف المبكر (PER_MINUTE, PER_HOUR, DAILY_RATE)
  earlyDepartureDeductionMethod  String  @default("PER_MINUTE") @map("early_departure_deduction_method")
  // 38.4 حد دقائق الانصراف المبكر لخصم يوم كامل
  earlyDepartureThresholdMinutes Int     @default(120) @map("early_departure_threshold_minutes")
  // 38.5 تفعيل الخصم التراكمي للتأخير (كل X مرة = يوم)
  enableCumulativeLateDeduction  Boolean @default(false) @map("enable_cumulative_late_deduction")
  // 38.6 عدد مرات التأخير لخصم يوم كامل
  lateCountForDayDeduction       Int     @default(3) @map("late_count_for_day_deduction")
  // 38.7 الحد الأقصى للراتب الخاضع للتأمينات (GOSI)
  gosiMaxSalary                  Float   @default(45000) @map("gosi_max_salary")
  // 38.8 تفعيل حساب ساند
  enableSanedCalculation         Boolean @default(true) @map("enable_saned_calculation")
  // 38.9 نسبة ساند على الموظف
  sanedEmployeePercent           Float   @default(0.75) @map("saned_employee_percent")
  // 38.10 نسبة ساند على صاحب العمل
  sanedEmployerPercent           Float   @default(0.75) @map("saned_employer_percent")
  // 38.11 نسبة الأخطار المهنية
  hazardRatePercent              Float   @default(2.0) @map("hazard_rate_percent")
  // 39. تفعيل إرسال قسيمة الراتب بالبريد الإلكتروني
  enablePayslipEmail             Boolean @default(true) @map("enable_payslip_email")
  // 40. لغة قسيمة الراتب (AR, EN, BOTH)
  payslipLanguage                String  @default("AR") @map("payslip_language")

  // === New Features (41-50) ===
  // 41. تفعيل الحد الأقصى للوقت الإضافي
  enableOvertimeCap           Boolean @default(false) @map("enable_overtime_cap")
  // 42. الحد الأقصى لساعات الوقت الإضافي شهرياً
  maxOvertimeHoursPerMonth    Int     @default(50) @map("max_overtime_hours_per_month")
  // 43. تفعيل توليد الرواتب التلقائي
  enableAutoPayrollGeneration Boolean @default(false) @map("enable_auto_payroll_generation")
  // 44. يوم توليد الرواتب التلقائي
  autoPayrollGenerationDay    Int     @default(25) @map("auto_payroll_generation_day")
  // 45. تفعيل سجل تدقيق الرواتب
  enablePayrollAuditTrail     Boolean @default(true) @map("enable_payroll_audit_trail")
  // 46. تفعيل تقريب الراتب
  enableSalaryRounding        Boolean @default(false) @map("enable_salary_rounding")
  // 47. طريقة تقريب الراتب (UP, DOWN, NEAREST)
  salaryRoundingMethod        String  @default("NEAREST") @map("salary_rounding_method")
  // 48. تفعيل ميزانية القسم
  enableDepartmentBudget      Boolean @default(false) @map("enable_department_budget")
  // 49. تفعيل تتبع مركز التكلفة
  enableCostCenterTracking    Boolean @default(false) @map("enable_cost_center_tracking")
  // 50. صيغة تصدير الرواتب الافتراضية (PDF, EXCEL, CSV, WPS)
  defaultPayrollExportFormat  String  @default("EXCEL") @map("default_payroll_export_format")

  // === Sick Leave Settings (51-55) ===
  // 51. تفعيل خصم الإجازة المرضية
  enableSickLeaveDeduction   Boolean @default(true) @map("enable_sick_leave_deduction")
  // 52. نسبة الراتب للإجازة المرضية بأجر جزئي (الأيام 31-90)
  sickLeavePartialPayPercent Float   @default(75) @map("sick_leave_partial_pay_percent")
  // 53. عدد أيام الإجازة المرضية بأجر كامل
  sickLeaveFullPayDays       Int     @default(30) @map("sick_leave_full_pay_days")
  // 54. عدد أيام الإجازة المرضية بأجر جزئي (بعد أيام الأجر الكامل)
  sickLeavePartialPayDays    Int     @default(60) @map("sick_leave_partial_pay_days")
  // 55. عدد أيام الإجازة المرضية بدون أجر (بعد أيام الأجر الجزئي)
  sickLeaveUnpaidDays        Int     @default(30) @map("sick_leave_unpaid_days")

  // === Calculation Method Settings (56-58) ===
  // 56. طريقة حساب الأيام (CALENDAR_30, ACTUAL_DAYS, WORKING_DAYS)
  calculationMethod  String @default("CALENDAR_30") @map("calculation_method")
  // 57. عدد ساعات العمل اليومية
  dailyWorkingHours  Float  @default(8) @map("daily_working_hours")
  // 58. أيام العمل في الأسبوع
  workingDaysPerWeek Int    @default(5) @map("working_days_per_week")

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("payroll_settings")
}

model User {
  id                        String                       @id @default(uuid())
  email                     String                       @unique
  phone                     String?                      @unique
  password                  String
  firstName                 String                       @map("first_name")
  lastName                  String                       @map("last_name")
  avatar                    String?
  employeeCode              String?                      @map("employee_code")
  jobTitle                  String?                      @map("job_title")
  role                      Role                         @default(EMPLOYEE)
  status                    UserStatus                   @default(ACTIVE)
  salary                    Decimal?                     @db.Decimal(10, 2)
  hireDate                  DateTime?                    @map("hire_date")
  fcmToken                  String?                      @map("fcm_token")
  branchId                  String?                      @map("branch_id")
  departmentId              String?                      @map("department_id")
  managerId                 String?                      @map("manager_id")
  createdAt                 DateTime                     @default(now()) @map("created_at")
  updatedAt                 DateTime                     @updatedAt @map("updated_at")
  faceRegistered            Boolean                      @default(false) @map("face_registered")
  annualLeaveDays           Int                          @default(21) @map("annual_leave_days")
  usedLeaveDays             Int                          @default(0) @map("used_leave_days")
  remainingLeaveDays        Int                          @default(21) @map("remaining_leave_days")
  isSuperAdmin              Boolean                      @default(false) @map("is_super_admin")
  jobTitleId                String?                      @map("job_title_id")
  costCenterId              String?                      @map("cost_center_id")
  isSaudi                   Boolean                      @default(true) @map("is_saudi")
  nationality               String?                      @map("nationality")
  nationalId                String?                      @unique @map("national_id")
  companyId                 String?                      @map("company_id")
  borderNumber              String?                      @map("border_number")
  iqamaExpiryDate           DateTime?                    @map("iqama_expiry_date") @db.Date
  iqamaNumber               String?                      @map("iqama_number")
  passportExpiryDate        DateTime?                    @map("passport_expiry_date") @db.Date
  passportNumber            String?                      @map("passport_number")
  profession                String?                      @map("profession")
  professionCode            String?                      @map("profession_code")
  dateOfBirth               DateTime?                    @map("date_of_birth") @db.Date
  gender                    String?
  gosiNumber                String?                      @unique @map("gosi_number")
  maritalStatus             String?                      @map("marital_status")
  jobFamilyId               String?
  roleLevelId               String?
  ceoApprovedAdvances       AdvanceRequest[]             @relation("CEOApproverAdvanceRequests")
  financeApprovedAdvances   AdvanceRequest[]             @relation("FinanceApproverAdvanceRequests")
  hrApprovedAdvances        AdvanceRequest[]             @relation("HRApproverAdvanceRequests")
  managerApprovedAdvances   AdvanceRequest[]             @relation("ManagerApproverAdvanceRequests")
  advanceRequests           AdvanceRequest[]             @relation("EmployeeAdvanceRequests")
  aiConversations           AiConversation[]
  approvalLogs              ApprovalLog[]
  articleFeedback           ArticleFeedback[]            @relation("ArticleFeedback")
  attendances               Attendance[]
  auditLogs                 AuditLog[]
  commentReactions          CommentReaction[]            @relation("CommentReactions")
  contracts                 Contract[]
  custodyApproved           CustodyAssignment[]          @relation("CustodyApprover")
  custodyAssignedBy         CustodyAssignment[]          @relation("CustodyAssigner")
  custodyAssignments        CustodyAssignment[]          @relation("EmployeeCustody")
  custodyMaintenanceReports CustodyMaintenance[]         @relation("MaintenanceReporter")
  custodyReturns            CustodyReturn[]              @relation("CustodyReturner")
  custodyReturnReviews      CustodyReturn[]              @relation("CustodyReturnReviewer")
  custodyTransferApproved   CustodyTransfer[]            @relation("CustodyTransferApprover")
  custodyTransfersFrom      CustodyTransfer[]            @relation("CustodyTransferFrom")
  custodyTransferInitiated  CustodyTransfer[]            @relation("CustodyTransferInitiator")
  custodyTransfersTo        CustodyTransfer[]            @relation("CustodyTransferTo")
  disciplinaryCases         DisciplinaryCase[]           @relation("EmployeeDisciplinaryCases")
  createdDisciplinaryCases  DisciplinaryCase[]           @relation("ManagerCreatedCases")
  emergencyContacts         EmergencyContact[]           @relation("EmergencyContacts")
  bankAccounts              EmployeeBankAccount[]
  disciplinaryRecords       EmployeeDisciplinaryRecord[]
  employeeDocuments         EmployeeDocument[]
  locationLogs              EmployeeLocationLog[]
  salaryAssignments         EmployeeSalaryAssignment[]   @relation("EmployeeSalaryAssignments")
  faceData                  FaceData?
  geofenceExitEvents        GeofenceExitEvent[]
  kpiAssignments            KPIAssignment[]              @relation("KPIAssignmentEmployee")
  leaveBalances             LeaveBalance[]
  approvedLeaves            LeaveRequest[]               @relation("ApproverLeaveRequests")
  hrApprovedLeaves          LeaveRequest[]               @relation("HRApproverLeaveRequests")
  managerApprovedLeaves     LeaveRequest[]               @relation("ManagerApproverLeaveRequests")
  leaveRequests             LeaveRequest[]               @relation("EmployeeLeaveRequests")
  approvedLetters           LetterRequest[]              @relation("ApproverLetterRequests")
  hrApprovedLetters         LetterRequest[]              @relation("HRApproverLetterRequests")
  managerApprovedLetters    LetterRequest[]              @relation("ManagerApproverLetterRequests")
  letterRequests            LetterRequest[]              @relation("EmployeeLetterRequests")
  locationProofs            LocationProof[]              @relation("LocationProofs")
  notifications             Notification[]
  offlineSyncQueue          OfflineSyncQueue[]           @relation("OfflineSyncQueue")
  onboardingProcesses       OnboardingProcess[]
  payrollAdjustments        PayrollAdjustment[]
  payslips                  Payslip[]
  policyTargets             Policy[]                     @relation("PolicyTargetEmployee")
  policyPredictions         PolicyViolationPrediction[]  @relation("PolicyPredictionUser")
  profileUpdateReviews      ProfileUpdateRequest[]       @relation("ProfileUpdateReviewer")
  profileUpdateRequests     ProfileUpdateRequest[]       @relation("ProfileUpdateRequests")
  createdPrograms           Program[]                    @relation("ProgramCreator")
  managedPrograms           Program[]                    @relation("ProgramManager")
  ownedPrograms             Program[]                    @relation("ProgramOwner")
  projectActivities         ProjectActivity[]            @relation("ProjectActivityUser")
  approvedBudgets           ProjectBudget[]              @relation("BudgetApprover")
  createdBudgets            ProjectBudget[]              @relation("BudgetCreator")
  projectMemberships        ProjectMember[]              @relation("ProjectMembers")
  ownedMilestones           ProjectMilestone[]           @relation("MilestoneOwner")
  createdRisks              ProjectRisk[]                @relation("RiskCreator")
  ownedRisks                ProjectRisk[]                @relation("RiskOwner")
  createdProjects           Project[]                    @relation("ProjectCreator")
  managedProjects           Project[]                    @relation("ProjectManager")
  ownedProjects             Project[]                    @relation("ProjectOwner")
  sponsoredProjects         Project[]                    @relation("ProjectSponsor")
  ceoApprovedRaises         RaiseRequest[]               @relation("CEOApproverRaiseRequests")
  financeApprovedRaises     RaiseRequest[]               @relation("FinanceApproverRaiseRequests")
  hrApprovedRaises          RaiseRequest[]               @relation("HRApproverRaiseRequests")
  managerApprovedRaises     RaiseRequest[]               @relation("ManagerApproverRaiseRequests")
  raiseRequests             RaiseRequest[]               @relation("EmployeeRaiseRequests")
  refreshTokens             RefreshToken[]
  registeredDevices         RegisteredDevice[]
  retroPays                 RetroPay[]
  shiftBids                 ShiftBid[]                   @relation("ShiftBidUser")
  shiftSwapManaged          ShiftSwapRequest[]           @relation("ShiftSwapManager")
  shiftSwapRequests         ShiftSwapRequest[]           @relation("ShiftSwapRequester")
  shiftSwapTargets          ShiftSwapRequest[]           @relation("ShiftSwapTarget")
  assignedShifts            Shift[]                      @relation("UserShifts")
  sprintsCreated            Sprint[]                     @relation("SprintCreator")
  surveyResponses           SurveyResponse[]             @relation("SurveyResponses")
  suspiciousAttempts        SuspiciousAttempt[]
  taskActivities            TaskActivityLog[]            @relation("TaskActivityLogs")
  taskApprovals             TaskApproval[]               @relation("TaskApprovalBy")
  taskAssignments           TaskAssignment[]             @relation("TaskAssignments")
  taskAttachments           TaskAttachment[]             @relation("TaskAttachmentUploader")
  createdAutomations        TaskAutomation[]             @relation("TaskAutomationCreator")
  taskComments              TaskComment[]                @relation("TaskCommentAuthor")
  taskEvidencesSubmitted    TaskEvidence[]               @relation("TaskEvidenceSubmitter")
  taskEvidencesVerified     TaskEvidence[]               @relation("TaskEvidenceVerifier")
  taskTimeLogs              TaskTimeLog[]                @relation("TaskTimeLogs")
  taskWatching              TaskWatcher[]                @relation("TaskWatchers")
  approvingTasks            Task[]                       @relation("TaskApprover")
  assignedTasks             Task[]                       @relation("TaskAssignee")
  createdTasks              Task[]                       @relation("TaskCreator")
  reviewingTasks            Task[]                       @relation("TaskReviewer")
  teamCalendarEvents        TeamCalendarEvent[]          @relation("TeamCalendarEvents")
  costCenterAuditLogs       CostCenterAuditLog[]         @relation("CostCenterAuditLogs")
  trainingRequests          TrainingRequest[]            @relation("TrainingRequests")
  customFields              UserCustomField[]
  notificationPreferences   UserNotificationPreferences? @relation("NotificationPreferences")
  userPermissions           UserPermission[]
  branch                    Branch?                      @relation(fields: [branchId], references: [id])
  company                   Company?                     @relation(fields: [companyId], references: [id])
  costCenter                CostCenter?                  @relation(fields: [costCenterId], references: [id])
  department                Department?                  @relation(fields: [departmentId], references: [id])
  JobFamily                 JobFamily?                   @relation(fields: [jobFamilyId], references: [id])
  jobTitleRef               JobTitle?                    @relation(fields: [jobTitleId], references: [id])
  manager                   User?                        @relation("ManagerEmployees", fields: [managerId], references: [id])
  employees                 User[]                       @relation("ManagerEmployees")
  RoleLevel                 RoleLevel?                   @relation(fields: [roleLevelId], references: [id])
  workFromHome              WorkFromHome[]
  debts                     EmployeeDebtLedger[]         @relation("EmployeeDebts")
  employeeSkills            EmployeeSkill[]              @relation("EmployeeSkills")

  @@unique([companyId, employeeCode])
  @@index([companyId, status])
  @@map("users")
}

model UserCustomField {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  fieldName    String   @map("field_name")
  fieldValue   String   @map("field_value")
  fieldType    String   @default("text") @map("field_type")
  sourceHeader String?  @map("source_header")
  importedAt   DateTime @default(now()) @map("imported_at")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, fieldName])
  @@index([userId])
  @@index([fieldName])
  @@map("user_custom_fields")
}

model JobTitle {
  id                 String               @id @default(uuid())
  name               String
  nameEn             String?              @map("name_en")
  isDirectManager    Boolean              @default(false) @map("is_direct_manager")
  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  level              Role                 @default(EMPLOYEE)
  companyId          String?              @map("company_id")
  isActive           Boolean              @default(true) @map("is_active")
  defaultPermissions JobTitlePermission[]
  company            Company?             @relation(fields: [companyId], references: [id])
  policies           Policy[]
  users              User[]

  @@unique([companyId, name])
  @@index([companyId, isActive])
  @@map("job_titles")
}

model RegisteredDevice {
  id                String            @id @default(uuid())
  userId            String            @map("user_id")
  deviceId          String            @map("device_id")
  deviceFingerprint String?           @map("device_fingerprint")
  deviceName        String?           @map("device_name")
  deviceModel       String?           @map("device_model")
  deviceBrand       String?           @map("device_brand")
  platform          DevicePlatform    @default(UNKNOWN)
  osVersion         String?           @map("os_version")
  appVersion        String?           @map("app_version")
  status            DeviceStatus      @default(PENDING)
  isMainDevice      Boolean           @default(false) @map("is_main_device")
  approvedBy        String?           @map("approved_by")
  approvedAt        DateTime?         @map("approved_at")
  blockedReason     String?           @map("blocked_reason")
  lastUsedAt        DateTime?         @map("last_used_at")
  usageCount        Int               @default(0) @map("usage_count")
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  deviceLogs        DeviceAccessLog[]
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, deviceId])
  @@index([deviceId])
  @@index([userId, status])
  @@map("registered_devices")
}

model DeviceAccessLog {
  id                String            @id @default(uuid())
  deviceId          String?           @map("device_id")
  userId            String            @map("user_id")
  attemptedDeviceId String            @map("attempted_device_id")
  actionType        String            @map("action_type")
  isSuccess         Boolean           @map("is_success")
  isKnownDevice     Boolean           @map("is_known_device")
  deviceInfo        String?           @map("device_info")
  ipAddress         String?           @map("ip_address")
  location          String?
  failureReason     String?           @map("failure_reason")
  createdAt         DateTime          @default(now()) @map("created_at")
  device            RegisteredDevice? @relation(fields: [deviceId], references: [id])

  @@index([userId, createdAt])
  @@index([attemptedDeviceId])
  @@map("device_access_logs")
}

model DataUpdateRequest {
  id                   String              @id @default(uuid())
  userId               String              @map("user_id")
  requestType          UpdateRequestType   @map("request_type")
  status               UpdateRequestStatus @default(PENDING)
  reason               String?
  newFaceEmbedding     String?             @map("new_face_embedding")
  newFaceImage         String?             @map("new_face_image")
  faceImageQuality     Float?              @map("face_image_quality")
  newDeviceId          String?             @map("new_device_id")
  newDeviceFingerprint String?             @map("new_device_fingerprint")
  newDeviceName        String?             @map("new_device_name")
  newDeviceModel       String?             @map("new_device_model")
  newDeviceBrand       String?             @map("new_device_brand")
  newDevicePlatform    DevicePlatform?     @map("new_device_platform")
  newDeviceOsVersion   String?             @map("new_device_os_version")
  newDeviceAppVersion  String?             @map("new_device_app_version")
  reviewedBy           String?             @map("reviewed_by")
  reviewedAt           DateTime?           @map("reviewed_at")
  reviewNote           String?             @map("review_note")
  rejectionReason      String?             @map("rejection_reason")
  oldDeviceId          String?             @map("old_device_id")
  createdAt            DateTime            @default(now()) @map("created_at")
  updatedAt            DateTime            @updatedAt @map("updated_at")
  newData              Json?               @map("new_data")

  @@index([userId, status])
  @@index([status, createdAt])
  @@map("data_update_requests")
}

model FaceData {
  id                String    @id @default(uuid())
  userId            String    @unique @map("user_id")
  faceEmbedding     String    @map("face_embedding")
  faceImage         String?   @map("face_image")
  registeredAt      DateTime  @default(now()) @map("registered_at")
  lastVerifiedAt    DateTime? @map("last_verified_at")
  verificationCount Int       @default(0) @map("verification_count")
  imageQuality      Float?    @map("image_quality")
  confidence        Float?
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("face_data")
}

model RefreshToken {
  id         String   @id @default(uuid())
  token      String   @unique
  userId     String   @map("user_id")
  deviceInfo String?  @map("device_info")
  ipAddress  String?  @map("ip_address")
  expiresAt  DateTime @map("expires_at")
  createdAt  DateTime @default(now()) @map("created_at")
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("refresh_tokens")
}

model Branch {
  id                  String          @id @default(uuid())
  name                String
  nameEn              String?         @map("name_en")
  address             String?
  latitude            Decimal         @db.Decimal(10, 8)
  longitude           Decimal         @db.Decimal(11, 8)
  geofenceRadius      Int             @default(100) @map("geofence_radius")
  timezone            String          @default("Asia/Riyadh")
  isActive            Boolean         @default(true) @map("is_active")
  workStartTime       String          @default("09:00") @map("work_start_time")
  workEndTime         String          @default("17:00") @map("work_end_time")
  lateGracePeriod     Int             @default(10) @map("late_grace_period")
  earlyCheckInPeriod  Int             @default(15) @map("early_check_in_period")
  earlyCheckOutPeriod Int             @default(0) @map("early_check_out_period")
  workingDays         String          @default("1,2,3,4,5") @map("working_days")
  createdAt           DateTime        @default(now()) @map("created_at")
  updatedAt           DateTime        @updatedAt @map("updated_at")
  companyId           String?         @map("company_id")
  attendances         Attendance[]
  company             Company?        @relation(fields: [companyId], references: [id])
  custodyItems        CustodyItem[]
  departments         Department[]
  policies            Policy[]
  shiftSchedules      ShiftSchedule[]
  users               User[]
  schedules           WorkSchedule[]

  @@unique([companyId, name])
  @@map("branches")
}

model Department {
  id                    String                  @id @default(uuid())
  name                  String
  nameEn                String?                 @map("name_en")
  branchId              String                  @map("branch_id")
  workStartTime         String?                 @map("work_start_time")
  workEndTime           String?                 @map("work_end_time")
  createdAt             DateTime                @default(now()) @map("created_at")
  updatedAt             DateTime                @updatedAt @map("updated_at")
  companyId             String?                 @map("company_id")
  departmentSaudization DepartmentSaudization[]
  branch                Branch                  @relation(fields: [branchId], references: [id])
  company               Company?                @relation(fields: [companyId], references: [id])
  policies              Policy[]
  shiftSchedules        ShiftSchedule[]
  users                 User[]
  costCenters           CostCenter[]

  @@unique([companyId, name])
  @@map("departments")
}

model WorkSchedule {
  id            String   @id @default(uuid())
  branchId      String   @map("branch_id")
  dayOfWeek     Int      @map("day_of_week")
  workStartTime String   @map("work_start_time")
  workEndTime   String   @map("work_end_time")
  isWorkingDay  Boolean  @default(true) @map("is_working_day")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  companyId     String?  @map("company_id")
  branch        Branch   @relation(fields: [branchId], references: [id])
  company       Company? @relation(fields: [companyId], references: [id])

  @@unique([branchId, dayOfWeek])
  @@map("work_schedules")
}

model Attendance {
  id                     String              @id @default(uuid())
  userId                 String              @map("user_id")
  branchId               String              @map("branch_id")
  date                   DateTime            @db.Date
  checkInTime            DateTime?           @map("check_in_time")
  checkOutTime           DateTime?           @map("check_out_time")
  checkInLatitude        Decimal?            @map("check_in_latitude") @db.Decimal(10, 8)
  checkInLongitude       Decimal?            @map("check_in_longitude") @db.Decimal(11, 8)
  checkInDistance        Int?                @map("check_in_distance")
  checkOutLatitude       Decimal?            @map("check_out_latitude") @db.Decimal(10, 8)
  checkOutLongitude      Decimal?            @map("check_out_longitude") @db.Decimal(11, 8)
  checkOutDistance       Int?                @map("check_out_distance")
  status                 AttendanceStatus    @default(ABSENT)
  lateMinutes            Int                 @default(0) @map("late_minutes")
  earlyLeaveMinutes      Int                 @default(0) @map("early_leave_minutes")
  workingMinutes         Int                 @default(0) @map("working_minutes")
  overtimeMinutes        Int                 @default(0) @map("overtime_minutes")
  notes                  String?
  isWorkFromHome         Boolean             @default(false) @map("is_work_from_home")
  isMockLocation         Boolean             @default(false) @map("is_mock_location")
  deviceInfo             String?             @map("device_info")
  createdAt              DateTime            @default(now()) @map("created_at")
  updatedAt              DateTime            @updatedAt @map("updated_at")
  checkInFaceConfidence  Float?              @map("check_in_face_confidence")
  checkInFaceVerified    Boolean             @default(false) @map("check_in_face_verified")
  checkOutFaceConfidence Float?              @map("check_out_face_confidence")
  checkOutFaceVerified   Boolean             @default(false) @map("check_out_face_verified")
  companyId              String?             @map("company_id")
  branch                 Branch              @relation(fields: [branchId], references: [id])
  company                Company?            @relation(fields: [companyId], references: [id])
  user                   User                @relation(fields: [userId], references: [id])
  geofenceExitEvents     GeofenceExitEvent[]

  @@unique([userId, date])
  @@index([companyId, date])
  @@index([userId, date])
  @@index([branchId, date])
  @@map("attendances")
}

model FaceVerificationLog {
  id               String   @id @default(uuid())
  userId           String   @map("user_id")
  verificationType String   @map("verification_type")
  isSuccess        Boolean  @map("is_success")
  confidence       Float?
  threshold        Float?
  deviceInfo       String?  @map("device_info")
  ipAddress        String?  @map("ip_address")
  attemptImage     String?  @map("attempt_image")
  errorMessage     String?  @map("error_message")
  createdAt        DateTime @default(now()) @map("created_at")

  @@index([userId, createdAt])
  @@map("face_verification_logs")
}

model SuspiciousAttempt {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  attemptType String   @map("attempt_type")
  latitude    Decimal? @db.Decimal(10, 8)
  longitude   Decimal? @db.Decimal(11, 8)
  distance    Int?
  deviceInfo  String?  @map("device_info")
  ipAddress   String?  @map("ip_address")
  notes       String?
  createdAt   DateTime @default(now()) @map("created_at")
  companyId   String?  @map("company_id")
  company     Company? @relation(fields: [companyId], references: [id])
  user        User     @relation(fields: [userId], references: [id])

  @@map("suspicious_attempts")
}

model LeaveTypeConfig {
  id                          String                 @id @default(uuid())
  companyId                   String?                @map("company_id")
  code                        String
  nameAr                      String                 @map("name_ar")
  nameEn                      String?                @map("name_en")
  description                 String?
  category                    LeaveCategory          @default(BALANCED)
  isEntitlementBased          Boolean                @default(true) @map("is_entitlement_based")
  defaultEntitlement          Int                    @default(0) @map("default_entitlement")
  maxBalanceCap               Int?                   @map("max_balance_cap")
  allowCarryForward           Boolean                @default(true) @map("allow_carry_forward")
  maxCarryForwardDays         Int?                   @map("max_carry_forward_days")
  carryForwardExpiryMonths    Int?                   @map("carry_forward_expiry_months")
  isPaid                      Boolean                @default(true) @map("is_paid")
  paymentPercentage           Int                    @default(100) @map("payment_percentage")
  requiresAttachment          Boolean                @default(false) @map("requires_attachment")
  attachmentRequiredAfterDays Int?                   @map("attachment_required_after_days")
  minNoticeDays               Int                    @default(0) @map("min_notice_days")
  minRequestDays              Int                    @default(1) @map("min_request_days")
  maxRequestDays              Int?                   @map("max_request_days")
  allowNegativeBalance        Boolean                @default(false) @map("allow_negative_balance")
  deductFromAnnual            Boolean                @default(false) @map("deduct_from_annual")
  isOneTimeOnly               Boolean                @default(false) @map("is_one_time_only")
  isActive                    Boolean                @default(true) @map("is_active")
  sortOrder                   Int                    @default(0) @map("sort_order")
  createdAt                   DateTime               @default(now()) @map("created_at")
  updatedAt                   DateTime               @updatedAt @map("updated_at")
  leaveBalances               LeaveBalance[]
  entitlementTiers            LeaveEntitlementTier[]
  leaveRequests               LeaveRequest[]         @relation("LeaveTypeConfigRequests")
  company                     Company?               @relation(fields: [companyId], references: [id])
  sickPayTiers                SickPayTier[]

  @@unique([companyId, code])
  @@index([companyId, isActive])
  @@map("leave_type_configs")
}

model LeaveEntitlementTier {
  id              String          @id @default(uuid())
  leaveTypeId     String          @map("leave_type_id")
  minServiceYears Int             @map("min_service_years")
  maxServiceYears Int             @map("max_service_years")
  entitlementDays Int             @map("entitlement_days")
  createdAt       DateTime        @default(now()) @map("created_at")
  leaveType       LeaveTypeConfig @relation(fields: [leaveTypeId], references: [id], onDelete: Cascade)

  @@unique([leaveTypeId, minServiceYears])
  @@index([leaveTypeId])
  @@map("leave_entitlement_tiers")
}

model SickPayTier {
  id             String          @id @default(uuid())
  leaveTypeId    String          @map("leave_type_id")
  fromDay        Int             @map("from_day")
  toDay          Int             @map("to_day")
  paymentPercent Int             @map("payment_percent")
  createdAt      DateTime        @default(now()) @map("created_at")
  leaveType      LeaveTypeConfig @relation(fields: [leaveTypeId], references: [id], onDelete: Cascade)

  @@unique([leaveTypeId, fromDay])
  @@index([leaveTypeId])
  @@map("sick_pay_tiers")
}

model LeaveBalance {
  id                    String          @id @default(uuid())
  companyId             String?         @map("company_id")
  userId                String          @map("user_id")
  leaveTypeId           String          @map("leave_type_id")
  year                  Int
  entitled              Decimal         @default(0) @db.Decimal(5, 2)
  carriedForward        Decimal         @default(0) @map("carried_forward") @db.Decimal(5, 2)
  used                  Decimal         @default(0) @db.Decimal(5, 2)
  pending               Decimal         @default(0) @db.Decimal(5, 2)
  timesUsed             Int             @default(0) @map("times_used")
  carryForwardExpiresAt DateTime?       @map("carry_forward_expires_at")
  createdAt             DateTime        @default(now()) @map("created_at")
  updatedAt             DateTime        @updatedAt @map("updated_at")
  company               Company?        @relation(fields: [companyId], references: [id])
  leaveType             LeaveTypeConfig @relation(fields: [leaveTypeId], references: [id])
  user                  User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, leaveTypeId, year])
  @@index([userId, year])
  @@index([leaveTypeId])
  @@index([companyId])
  @@map("leave_balances")
}

model LeaveRequest {
  id                 String           @id @default(uuid())
  userId             String           @map("user_id")
  type               LeaveType
  startDate          DateTime         @map("start_date") @db.Date
  endDate            DateTime         @map("end_date") @db.Date
  reason             String
  status             LeaveStatus      @default(PENDING)
  approverId         String?          @map("approver_id")
  approverNotes      String?          @map("approver_notes")
  approvedAt         DateTime?        @map("approved_at")
  createdAt          DateTime         @default(now()) @map("created_at")
  updatedAt          DateTime         @updatedAt @map("updated_at")
  requestedDays      Int              @default(1) @map("requested_days")
  approvedDays       Int?             @map("approved_days")
  attachments        Json?
  notes              String?          @db.VarChar(500)
  currentStep        ApprovalStep     @default(MANAGER) @map("current_step")
  managerApproverId  String?          @map("manager_approver_id")
  managerDecision    ApprovalDecision @default(PENDING) @map("manager_decision")
  managerDecisionAt  DateTime?        @map("manager_decision_at")
  managerNotes       String?          @map("manager_notes") @db.VarChar(500)
  hrApproverId       String?          @map("hr_approver_id")
  hrDecision         ApprovalDecision @default(PENDING) @map("hr_decision")
  hrDecisionAt       DateTime?        @map("hr_decision_at")
  hrDecisionNotes    String?          @map("hr_decision_notes") @db.VarChar(500)
  managerAttachments Json?            @map("manager_attachments")
  hrAttachments      Json?            @map("hr_attachments")
  companyId          String?          @map("company_id")
  fullPayDays        Int?             @map("full_pay_days")
  leaveTypeConfigId  String?          @map("leave_type_config_id")
  noticeDaysProvided Int?             @map("notice_days_provided")
  partialPayDays     Int?             @map("partial_pay_days")
  salaryImpact       Decimal?         @map("salary_impact") @db.Decimal(10, 2)
  unpaidDays         Int?             @map("unpaid_days")
  approver           User?            @relation("ApproverLeaveRequests", fields: [approverId], references: [id])
  company            Company?         @relation(fields: [companyId], references: [id])
  hrApprover         User?            @relation("HRApproverLeaveRequests", fields: [hrApproverId], references: [id])
  leaveTypeConfig    LeaveTypeConfig? @relation("LeaveTypeConfigRequests", fields: [leaveTypeConfigId], references: [id])
  managerApprover    User?            @relation("ManagerApproverLeaveRequests", fields: [managerApproverId], references: [id])
  user               User             @relation("EmployeeLeaveRequests", fields: [userId], references: [id])

  @@index([companyId, status])
  @@index([userId, status])
  @@index([leaveTypeConfigId])
  @@map("leave_requests")
}

model LetterRequest {
  id                 String           @id @default(uuid())
  userId             String           @map("user_id")
  type               LetterType
  notes              String?          @db.VarChar(200)
  attachments        Json?
  status             LetterStatus     @default(PENDING)
  approverId         String?          @map("approver_id")
  approverNotes      String?          @map("approver_notes")
  approvedAt         DateTime?        @map("approved_at")
  createdAt          DateTime         @default(now()) @map("created_at")
  updatedAt          DateTime         @updatedAt @map("updated_at")
  currentStep        ApprovalStep     @default(MANAGER) @map("current_step")
  managerApproverId  String?          @map("manager_approver_id")
  managerDecision    ApprovalDecision @default(PENDING) @map("manager_decision")
  managerDecisionAt  DateTime?        @map("manager_decision_at")
  managerNotes       String?          @map("manager_notes") @db.VarChar(500)
  managerAttachments Json?            @map("manager_attachments")
  hrApproverId       String?          @map("hr_approver_id")
  hrDecision         ApprovalDecision @default(PENDING) @map("hr_decision")
  hrDecisionAt       DateTime?        @map("hr_decision_at")
  hrDecisionNotes    String?          @map("hr_decision_notes") @db.VarChar(500)
  hrAttachments      Json?            @map("hr_attachments")
  companyId          String?          @map("company_id")
  approver           User?            @relation("ApproverLetterRequests", fields: [approverId], references: [id])
  company            Company?         @relation(fields: [companyId], references: [id])
  hrApprover         User?            @relation("HRApproverLetterRequests", fields: [hrApproverId], references: [id])
  managerApprover    User?            @relation("ManagerApproverLetterRequests", fields: [managerApproverId], references: [id])
  user               User             @relation("EmployeeLetterRequests", fields: [userId], references: [id])

  @@index([companyId, status])
  @@map("letter_requests")
}

model WorkFromHome {
  id         String   @id @default(uuid())
  userId     String   @map("user_id")
  date       DateTime @db.Date
  reason     String?
  approvedBy String?  @map("approved_by")
  createdAt  DateTime @default(now()) @map("created_at")
  companyId  String?  @map("company_id")
  company    Company? @relation(fields: [companyId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@unique([userId, date])
  @@map("work_from_home")
}

model Notification {
  id         String           @id @default(uuid())
  userId     String           @map("user_id")
  type       NotificationType
  title      String
  titleEn    String?          @map("title_en")
  body       String
  bodyEn     String?          @map("body_en")
  data       Json?
  isRead     Boolean          @default(false) @map("is_read")
  readAt     DateTime?        @map("read_at")
  createdAt  DateTime         @default(now()) @map("created_at")
  companyId  String?          @map("company_id")
  entityId   String?          @map("entity_id")
  entityType String?          @map("entity_type")
  company    Company?         @relation(fields: [companyId], references: [id])
  user       User             @relation(fields: [userId], references: [id])

  @@index([companyId])
  @@index([userId, isRead])
  @@index([userId, isRead, createdAt])
  @@map("notifications")
}

model AuditLog {
  id          String      @id @default(uuid())
  userId      String?     @map("user_id")
  action      AuditAction
  entity      String
  entityId    String?     @map("entity_id")
  oldValue    Json?       @map("old_value")
  newValue    Json?       @map("new_value")
  description String?
  ipAddress   String?     @map("ip_address")
  userAgent   String?     @map("user_agent")
  createdAt   DateTime    @default(now()) @map("created_at")
  companyId   String?     @map("company_id")
  company     Company?    @relation(fields: [companyId], references: [id])
  user        User?       @relation(fields: [userId], references: [id])

  @@index([companyId, createdAt])
  @@index([userId])
  @@index([entity, entityId])
  @@index([createdAt])
  @@map("audit_logs")
}

model Holiday {
  id                 String                 @id @default(uuid())
  name               String
  nameEn             String?                @map("name_en")
  date               DateTime               @db.Date
  isRecurring        Boolean                @default(false) @map("is_recurring")
  createdAt          DateTime               @default(now()) @map("created_at")
  updatedAt          DateTime               @updatedAt @map("updated_at")
  companyId          String?                @map("company_id")
  isPaid             Boolean                @default(true) @map("is_paid")
  applicationType    HolidayApplicationType @default(ALL) @map("application_type")
  countAsWorkDay     Boolean                @default(false) @map("count_as_work_day")
  overtimeMultiplier Decimal                @default(2.0) @map("overtime_multiplier") @db.Decimal(3, 2)
  notes              String?
  assignments        HolidayAssignment[]
  company            Company?               @relation(fields: [companyId], references: [id])

  @@index([companyId, date])
  @@index([date])
  @@map("holidays")
}

model HolidayAssignment {
  id             String   @id @default(uuid())
  holidayId      String   @map("holiday_id")
  assignmentType String   @map("assignment_type")
  branchId       String?  @map("branch_id")
  departmentId   String?  @map("department_id")
  employeeId     String?  @map("employee_id")
  createdAt      DateTime @default(now()) @map("created_at")
  holiday        Holiday  @relation(fields: [holidayId], references: [id], onDelete: Cascade)

  @@unique([holidayId, assignmentType, branchId, departmentId, employeeId])
  @@index([holidayId])
  @@index([branchId])
  @@index([departmentId])
  @@index([employeeId])
  @@map("holiday_assignments")
}

model SystemSetting {
  id          String   @id @default(uuid())
  key         String
  value       String
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  companyId   String?  @map("company_id")
  company     Company? @relation(fields: [companyId], references: [id])

  @@unique([key, companyId])
  @@map("system_settings")
}

model Permission {
  id                  String               @id @default(uuid())
  code                String               @unique
  name                String
  nameEn              String?              @map("name_en")
  category            String
  description         String?
  requiresPermission  String?              @map("requires_permission")
  isActive            Boolean              @default(true) @map("is_active")
  sortOrder           Int                  @default(0) @map("sort_order")
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  jobTitlePermissions JobTitlePermission[]
  userPermissions     UserPermission[]

  @@index([category])
  @@index([code])
  @@map("permissions")
}

model UserPermission {
  id                String                   @id @default(uuid())
  userId            String                   @map("user_id")
  permissionId      String                   @map("permission_id")
  scope             PermissionScope          @default(SELF)
  branchId          String?                  @map("branch_id")
  departmentId      String?                  @map("department_id")
  createdAt         DateTime                 @default(now()) @map("created_at")
  companyId         String?                  @map("company_id")
  assignedEmployees UserPermissionEmployee[]
  company           Company?                 @relation(fields: [companyId], references: [id])
  permission        Permission               @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  user              User                     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, permissionId, scope, branchId, departmentId])
  @@index([userId])
  @@index([permissionId])
  @@index([userId, permissionId])
  @@index([scope, branchId])
  @@index([scope, departmentId])
  @@index([companyId])
  @@map("user_permissions")
}

model UserPermissionEmployee {
  id               String         @id @default(uuid())
  userPermissionId String         @map("user_permission_id")
  employeeId       String         @map("employee_id")
  createdAt        DateTime       @default(now()) @map("created_at")
  userPermission   UserPermission @relation(fields: [userPermissionId], references: [id], onDelete: Cascade)

  @@unique([userPermissionId, employeeId])
  @@index([userPermissionId])
  @@index([employeeId])
  @@map("user_permission_employees")
}

model JobTitlePermission {
  id           String          @id @default(uuid())
  jobTitleId   String          @map("job_title_id")
  permissionId String          @map("permission_id")
  createdAt    DateTime        @default(now()) @map("created_at")
  scope        PermissionScope @default(TEAM)
  jobTitle     JobTitle        @relation(fields: [jobTitleId], references: [id], onDelete: Cascade)
  permission   Permission      @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([jobTitleId, permissionId])
  @@index([jobTitleId])
  @@index([permissionId])
  @@map("job_title_permissions")
}

model PermissionAuditLog {
  id             String                @id @default(uuid())
  performedById  String                @map("performed_by_id")
  targetUserId   String                @map("target_user_id")
  targetUserName String                @map("target_user_name")
  action         PermissionAuditAction
  permissionCode String                @map("permission_code")
  permissionName String                @map("permission_name")
  scopeDetails   String?               @map("scope_details")
  ipAddress      String?               @map("ip_address")
  userAgent      String?               @map("user_agent")
  createdAt      DateTime              @default(now()) @map("created_at")
  scope          PermissionScope?
  companyId      String?               @map("company_id")
  company        Company?              @relation(fields: [companyId], references: [id])

  @@index([performedById])
  @@index([targetUserId])
  @@index([createdAt])
  @@index([permissionCode])
  @@map("permission_audit_logs")
}

model ApprovalLog {
  id          String   @id @default(uuid())
  requestType String   @map("request_type")
  requestId   String   @map("request_id")
  step        String
  decision    String
  notes       String?  @db.VarChar(500)
  byUserId    String   @map("by_user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  companyId   String?  @map("company_id")
  byUser      User     @relation(fields: [byUserId], references: [id])
  company     Company? @relation(fields: [companyId], references: [id])

  @@index([requestType, requestId])
  @@index([byUserId])
  @@map("approval_logs")
}

model RaiseRequest {
  id                   String           @id @default(uuid())
  userId               String           @map("user_id")
  type                 RaiseType
  amount               Decimal          @db.Decimal(10, 2)
  effectiveMonth       DateTime         @map("effective_month") @db.Date
  notes                String?          @db.VarChar(200)
  attachments          Json?
  status               RaiseStatus      @default(PENDING)
  currentStep          ApprovalStep     @default(MANAGER) @map("current_step")
  managerApproverId    String?          @map("manager_approver_id")
  managerDecision      ApprovalDecision @default(PENDING) @map("manager_decision")
  managerDecisionAt    DateTime?        @map("manager_decision_at")
  managerNotes         String?          @map("manager_notes") @db.VarChar(500)
  managerAttachments   Json?            @map("manager_attachments")
  hrApproverId         String?          @map("hr_approver_id")
  hrDecision           ApprovalDecision @default(PENDING) @map("hr_decision")
  hrDecisionAt         DateTime?        @map("hr_decision_at")
  hrDecisionNotes      String?          @map("hr_decision_notes") @db.VarChar(500)
  hrAttachments        Json?            @map("hr_attachments")
  createdAt            DateTime         @default(now()) @map("created_at")
  updatedAt            DateTime         @updatedAt @map("updated_at")
  companyId            String?          @map("company_id")
  appliedToSalary      Boolean          @default(false) @map("applied_to_salary")
  approvalChain        Json?            @map("approval_chain")
  ceoApproverId        String?          @map("ceo_approver_id")
  ceoDecision          ApprovalDecision @default(PENDING) @map("ceo_decision")
  ceoDecisionAt        DateTime?        @map("ceo_decision_at")
  ceoDecisionNotes     String?          @map("ceo_decision_notes") @db.VarChar(500)
  financeApproverId    String?          @map("finance_approver_id")
  financeDecision      ApprovalDecision @default(PENDING) @map("finance_decision")
  financeDecisionAt    DateTime?        @map("finance_decision_at")
  financeDecisionNotes String?          @map("finance_decision_notes") @db.VarChar(500)
  ceoApprover          User?            @relation("CEOApproverRaiseRequests", fields: [ceoApproverId], references: [id])
  company              Company?         @relation(fields: [companyId], references: [id])
  financeApprover      User?            @relation("FinanceApproverRaiseRequests", fields: [financeApproverId], references: [id])
  hrApprover           User?            @relation("HRApproverRaiseRequests", fields: [hrApproverId], references: [id])
  managerApprover      User?            @relation("ManagerApproverRaiseRequests", fields: [managerApproverId], references: [id])
  user                 User             @relation("EmployeeRaiseRequests", fields: [userId], references: [id])

  @@index([userId, status])
  @@index([status, createdAt])
  @@map("raise_requests")
}

model AdvanceRequest {
  id                       String           @id @default(uuid())
  userId                   String           @map("user_id")
  type                     AdvanceType
  amount                   Decimal          @db.Decimal(10, 2)
  startDate                DateTime         @map("start_date") @db.Date
  endDate                  DateTime         @map("end_date") @db.Date
  periodMonths             Int              @map("period_months")
  monthlyDeduction         Decimal          @map("monthly_deduction") @db.Decimal(10, 2)
  notes                    String?          @db.VarChar(500)
  attachments              Json?
  status                   String           @default("PENDING")
  currentStep              ApprovalStep     @default(MANAGER) @map("current_step")
  managerApproverId        String?          @map("manager_approver_id")
  managerDecision          ApprovalDecision @default(PENDING) @map("manager_decision")
  managerDecisionAt        DateTime?        @map("manager_decision_at")
  managerNotes             String?          @map("manager_notes") @db.VarChar(500)
  hrApproverId             String?          @map("hr_approver_id")
  hrDecision               ApprovalDecision @default(PENDING) @map("hr_decision")
  hrDecisionAt             DateTime?        @map("hr_decision_at")
  hrDecisionNotes          String?          @map("hr_decision_notes") @db.VarChar(500)
  approvedAmount           Decimal?         @map("approved_amount") @db.Decimal(10, 2)
  approvedMonthlyDeduction Decimal?         @map("approved_monthly_deduction") @db.Decimal(10, 2)
  createdAt                DateTime         @default(now()) @map("created_at")
  updatedAt                DateTime         @updatedAt @map("updated_at")
  companyId                String?          @map("company_id")
  approvalChain            Json?            @map("approval_chain")
  ceoApproverId            String?          @map("ceo_approver_id")
  ceoDecision              ApprovalDecision @default(PENDING) @map("ceo_decision")
  ceoDecisionAt            DateTime?        @map("ceo_decision_at")
  ceoDecisionNotes         String?          @map("ceo_decision_notes") @db.VarChar(500)
  financeApproverId        String?          @map("finance_approver_id")
  financeDecision          ApprovalDecision @default(PENDING) @map("finance_decision")
  financeDecisionAt        DateTime?        @map("finance_decision_at")
  financeDecisionNotes     String?          @map("finance_decision_notes") @db.VarChar(500)
  ceoApprover              User?            @relation("CEOApproverAdvanceRequests", fields: [ceoApproverId], references: [id])
  company                  Company?         @relation(fields: [companyId], references: [id])
  financeApprover          User?            @relation("FinanceApproverAdvanceRequests", fields: [financeApproverId], references: [id])
  hrApprover               User?            @relation("HRApproverAdvanceRequests", fields: [hrApproverId], references: [id])
  managerApprover          User?            @relation("ManagerApproverAdvanceRequests", fields: [managerApproverId], references: [id])
  user                     User             @relation("EmployeeAdvanceRequests", fields: [userId], references: [id])
  payments                 LoanPayment[]

  @@index([userId, status])
  @@index([status, createdAt])
  @@map("advance_requests")
}

model LoanPayment {
  id           String         @id @default(uuid())
  advanceId    String         @map("advance_id")
  amount       Decimal        @db.Decimal(10, 2)
  paymentDate  DateTime       @map("payment_date") @db.Date
  paymentType  String         @default("SALARY_DEDUCTION") @map("payment_type")
  payrollRunId String?        @map("payroll_run_id")
  payslipId    String?        @map("payslip_id")
  notes        String?        @db.VarChar(500)
  createdById  String?        @map("created_by_id")
  createdAt    DateTime       @default(now()) @map("created_at")
  advance      AdvanceRequest @relation(fields: [advanceId], references: [id], onDelete: Cascade)

  @@index([advanceId])
  @@index([paymentDate])
  @@map("loan_payments")
}

model EmployeeBankAccount {
  id                String    @id @default(uuid())
  userId            String    @map("user_id")
  iban              String
  bankName          String    @map("bank_name")
  bankCode          String?   @map("bank_code")
  isPrimary         Boolean   @default(false) @map("is_primary")
  verifiedAt        DateTime? @map("verified_at")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  accountHolderName String?   @map("account_holder_name")
  isVerified        Boolean   @default(false) @map("is_verified")
  swiftCode         String?   @map("swift_code")
  verifiedBy        String?   @map("verified_by")
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, iban])
  @@index([userId, isPrimary])
  @@map("employee_bank_accounts")
}

model CompanyBankAccount {
  id             String   @id @default(uuid())
  companyId      String   @map("company_id")
  bankName       String   @map("bank_name")
  bankCode       String   @map("bank_code")
  iban           String
  accountName    String   @map("account_name")
  swiftCode      String?  @map("swift_code")
  isPrimary      Boolean  @default(false) @map("is_primary")
  isActive       Boolean  @default(true) @map("is_active")
  molId          String?  @map("mol_id")
  wpsParticipant String?  @map("wps_participant")
  accountType    String   @default("CURRENT") @map("account_type")
  currency       String   @default("SAR")
  notes          String?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  company        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, iban])
  @@index([companyId, isPrimary])
  @@index([companyId, isActive])
  @@map("company_bank_accounts")
}

model Contract {
  id                  String           @id @default(uuid())
  userId              String           @map("user_id")
  startDate           DateTime         @map("start_date") @db.Date
  endDate             DateTime?        @map("end_date") @db.Date
  createdAt           DateTime         @default(now()) @map("created_at")
  updatedAt           DateTime         @updatedAt @map("updated_at")
  contractNumber      String?          @unique @map("contract_number")
  documentUrl         String?          @map("document_url")
  previousContractId  String?          @map("previous_contract_id")
  probationEndDate    DateTime?        @map("probation_end_date") @db.Date
  renewalCount        Int              @default(0) @map("renewal_count")
  terminatedAt        DateTime?        @map("terminated_at")
  terminatedBy        String?          @map("terminated_by")
  terminationReason   String?          @map("termination_reason")
  type                ContractType     @default(PERMANENT)
  status              ContractStatus   @default(DRAFT)
  additionalTerms     String?          @map("additional_terms")
  annualLeaveDays     Int              @default(21) @map("annual_leave_days")
  basicSalary         Decimal?         @map("basic_salary") @db.Decimal(10, 2)
  contractJobTitle    String?          @map("contract_job_title")
  employeeSignature   Boolean          @default(false) @map("employee_signature")
  employeeSignedAt    DateTime?        @map("employee_signed_at")
  employerSignature   Boolean          @default(false) @map("employer_signature")
  employerSignedAt    DateTime?        @map("employer_signed_at")
  housingAllowance    Decimal?         @map("housing_allowance") @db.Decimal(10, 2)
  notes               String?          @map("notes")
  noticePeriodDays    Int              @default(30) @map("notice_period_days")
  otherAllowances     Decimal?         @map("other_allowances") @db.Decimal(10, 2)
  qiwaAuthDate        DateTime?        @map("qiwa_auth_date")
  qiwaContractId      String?          @unique @map("qiwa_contract_id")
  qiwaLastSync        DateTime?        @map("qiwa_last_sync")
  qiwaRejectReason    String?          @map("qiwa_reject_reason")
  qiwaStatus          QiwaAuthStatus   @default(NOT_SUBMITTED) @map("qiwa_status")
  signedByUserId      String?          @map("signed_by_user_id")
  totalSalary         Decimal?         @map("total_salary") @db.Decimal(10, 2)
  transportAllowance  Decimal?         @map("transport_allowance") @db.Decimal(10, 2)
  workLocation        String?          @map("work_location")
  workingHoursPerWeek Int              @default(48) @map("working_hours_per_week")
  salaryCycle         PayrollFrequency @default(MONTHLY) @map("salary_cycle")
  user                User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([endDate])
  @@index([qiwaStatus])
  @@map("contracts")
}

model CostCenter {
  id                   String                 @id @default(uuid())
  code                 String
  description          String?
  createdAt            DateTime               @default(now()) @map("created_at")
  updatedAt            DateTime               @updatedAt @map("updated_at")
  companyId            String?                @map("company_id")
  effectiveFrom        DateTime               @default(now()) @map("effective_from")
  effectiveTo          DateTime?              @map("effective_to")
  isAllowOverbudget    Boolean                @default(false) @map("is_allow_overbudget")
  level                Int                    @default(1)
  managerId            String?                @map("manager_id")
  nameAr               String                 @map("name_ar")
  nameEn               String?                @map("name_en")
  parentId             String?                @map("parent_id")
  path                 String?
  status               String                 @default("ACTIVE")
  type                 String                 @default("OPERATING")
  version              Int                    @default(1)
  departmentId         String?                @map("department_id")
  maxHeadcount         Int?                   @map("max_headcount")
  budgetAlertThreshold Decimal?               @default(80) @map("budget_alert_threshold") @db.Decimal(5, 2)
  allocations          CostCenterAllocation[] @relation("AllocationCostCenter")
  employeeAllocations  CostCenterAllocation[] @relation("PrimaryCostCenter")
  budgets              CostCenterBudget[]
  auditLogs            CostCenterAuditLog[]
  company              Company?               @relation(fields: [companyId], references: [id])
  department           Department?            @relation(fields: [departmentId], references: [id])
  parent               CostCenter?            @relation("CostCenterHierarchy", fields: [parentId], references: [id])
  children             CostCenter[]           @relation("CostCenterHierarchy")
  payslipLines         PayslipLine[]
  users                User[]

  @@unique([companyId, code, version])
  @@index([companyId, status])
  @@index([parentId])
  @@index([effectiveFrom, effectiveTo])
  @@map("cost_centers")
}

model CostCenterAllocation {
  id                  String      @id @default(uuid())
  companyId           String?     @map("company_id")
  userId              String      @map("user_id")
  costCenterId        String      @map("cost_center_id")
  primaryCostCenterId String?     @map("primary_cost_center_id")
  percentage          Decimal     @db.Decimal(5, 2)
  effectiveFrom       DateTime    @default(now()) @map("effective_from")
  effectiveTo         DateTime?   @map("effective_to")
  allocationType      String      @default("POSITION") @map("allocation_type")
  reason              String?
  isActive            Boolean     @default(true) @map("is_active")
  createdAt           DateTime    @default(now()) @map("created_at")
  updatedAt           DateTime    @updatedAt @map("updated_at")
  company             Company?    @relation(fields: [companyId], references: [id])
  costCenter          CostCenter  @relation("AllocationCostCenter", fields: [costCenterId], references: [id])
  primaryCostCenter   CostCenter? @relation("PrimaryCostCenter", fields: [primaryCostCenterId], references: [id])

  @@unique([userId, costCenterId, effectiveFrom])
  @@index([userId, isActive])
  @@index([costCenterId])
  @@index([effectiveFrom, effectiveTo])
  @@map("cost_center_allocations")
}

model CostCenterBudget {
  id           String     @id @default(uuid())
  companyId    String?    @map("company_id")
  costCenterId String     @map("cost_center_id")
  year         Int
  month        Int?
  quarter      Int?
  budgetAmount Decimal    @map("budget_amount") @db.Decimal(12, 2)
  actualAmount Decimal    @default(0) @map("actual_amount") @db.Decimal(12, 2)
  variance     Decimal    @default(0) @db.Decimal(12, 2)
  notes        String?
  isLocked     Boolean    @default(false) @map("is_locked")
  lockedAt     DateTime?  @map("locked_at")
  lockedBy     String?    @map("locked_by")
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  company      Company?   @relation(fields: [companyId], references: [id])
  costCenter   CostCenter @relation(fields: [costCenterId], references: [id])

  @@unique([costCenterId, year, month])
  @@index([costCenterId, year])
  @@map("cost_center_budgets")
}

model CostCenterAuditLog {
  id           String   @id @default(uuid())
  costCenterId String   @map("cost_center_id")
  userId       String   @map("user_id")
  action       String // CREATE, UPDATE, ARCHIVE, ALLOCATE, DEALLOCATE, BUDGET_CREATE, BUDGET_UPDATE
  entityType   String   @default("COST_CENTER") @map("entity_type") // COST_CENTER, ALLOCATION, BUDGET
  entityId     String?  @map("entity_id")
  oldValue     Json?    @map("old_value")
  newValue     Json?    @map("new_value")
  description  String?
  ipAddress    String?  @map("ip_address")
  createdAt    DateTime @default(now()) @map("created_at")

  costCenter CostCenter @relation(fields: [costCenterId], references: [id])
  user       User       @relation("CostCenterAuditLogs", fields: [userId], references: [id])

  @@index([costCenterId])
  @@index([userId])
  @@index([createdAt])
  @@index([action])
  @@map("cost_center_audit_logs")
}

model SalaryComponent {
  id             String                @id @default(uuid())
  code           String
  nameAr         String                @map("name_ar")
  nameEn         String?               @map("name_en")
  type           SalaryComponentType
  nature         SalaryComponentNature @default(FIXED)
  description    String?
  gosiEligible   Boolean               @default(false) @map("gosi_eligible")
  otEligible     Boolean               @default(false) @map("ot_eligible")
  formula        String?
  createdAt      DateTime              @default(now()) @map("created_at")
  updatedAt      DateTime              @updatedAt @map("updated_at")
  companyId      String?               @map("company_id")
  decimals       Int                   @default(2)
  effectiveDate  DateTime              @default(now()) @map("effective_date")
  endDate        DateTime?             @map("end_date")
  isActive       Boolean               @default(true) @map("is_active")
  priority       Int                   @default(100)
  roundingMode   String                @default("ROUND") @map("rounding_mode")
  taxable        Boolean               @default(false)
  version        Int                   @default(1)
  eosEligible    Boolean               @default(false) @map("eos_eligible")
  isProrated     Boolean               @default(true) @map("is_prorated")
  PayslipLine    PayslipLine[]
  policyRules    PolicyRule[]          @relation("PolicyOutputComponent")
  company        Company?              @relation(fields: [companyId], references: [id])
  structureLines SalaryStructureLine[]

  @@unique([companyId, type, code, version])
  @@index([companyId, isActive])
  @@index([effectiveDate, endDate])
  @@map("salary_components")
}

model SalaryStructure {
  id            String                     @id @default(uuid())
  name          String
  description   String?
  isActive      Boolean                    @default(true) @map("is_active")
  createdAt     DateTime                   @default(now()) @map("created_at")
  updatedAt     DateTime                   @updatedAt @map("updated_at")
  companyId     String?                    @map("company_id")
  effectiveDate DateTime                   @default(now()) @map("effective_date")
  endDate       DateTime?                  @map("end_date")
  version       Int                        @default(1)
  assignments   EmployeeSalaryAssignment[]
  lines         SalaryStructureLine[]
  company       Company?                   @relation(fields: [companyId], references: [id])

  @@unique([companyId, name, version])
  @@index([companyId, isActive])
  @@index([effectiveDate, endDate])
  @@map("salary_structures")
}

model SalaryStructureLine {
  id          String          @id @default(uuid())
  structureId String          @map("structure_id")
  componentId String          @map("component_id")
  amount      Decimal         @default(0) @db.Decimal(10, 2)
  percentage  Decimal?        @db.Decimal(5, 2)
  priority    Int             @default(0)
  component   SalaryComponent @relation(fields: [componentId], references: [id])
  structure   SalaryStructure @relation(fields: [structureId], references: [id], onDelete: Cascade)

  @@map("salary_structure_lines")
}

model EmployeeSalaryAssignment {
  id            String          @id @default(uuid())
  employeeId    String          @map("employee_id")
  structureId   String          @map("structure_id")
  baseSalary    Decimal         @map("base_salary") @db.Decimal(10, 2)
  effectiveDate DateTime        @map("effective_date") @db.Date
  endDate       DateTime?       @map("end_date") @db.Date
  isActive      Boolean         @default(true) @map("is_active")
  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")
  employee      User            @relation("EmployeeSalaryAssignments", fields: [employeeId], references: [id])
  structure     SalaryStructure @relation(fields: [structureId], references: [id])

  @@map("employee_salary_assignments")
}

model PayslipLine {
  id            String            @id @default(uuid())
  payslipId     String            @map("payslip_id")
  componentId   String            @map("component_id")
  amount        Decimal           @db.Decimal(10, 2)
  createdAt     DateTime          @default(now()) @map("created_at")
  descriptionAr String?           @map("description_ar")
  rate          Decimal?          @db.Decimal(10, 4)
  sign          String            @default("EARNING")
  sourceRef     String?           @map("source_ref")
  sourceType    PayslipLineSource @default(STRUCTURE) @map("source_type")
  units         Decimal?          @db.Decimal(10, 2)
  costCenterId  String?           @map("cost_center_id")
  component     SalaryComponent   @relation(fields: [componentId], references: [id])
  costCenter    CostCenter?       @relation(fields: [costCenterId], references: [id])
  payslip       Payslip           @relation(fields: [payslipId], references: [id], onDelete: Cascade)

  @@index([payslipId, sourceType])
  @@index([payslipId, componentId])
  @@index([costCenterId])
  @@map("payslip_lines")
}

model PayrollPeriod {
  id                 String              @id @default(uuid())
  month              Int
  year               Int
  startDate          DateTime            @map("start_date") @db.Date
  endDate            DateTime            @map("end_date") @db.Date
  status             PayrollStatus       @default(DRAFT)
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  companyId          String?             @map("company_id")
  cutOffDate         DateTime?           @map("cut_off_date") @db.Date
  inputsLockedAt     DateTime?           @map("inputs_locked_at")
  lockedAt           DateTime?           @map("locked_at")
  lockedBy           String?             @map("locked_by")
  frequency          PayrollFrequency    @default(MONTHLY)
  disciplinaryCases  DisciplinaryCase[]
  payrollAdjustments PayrollAdjustment[]
  company            Company?            @relation(fields: [companyId], references: [id])
  runs               PayrollRun[]
  payslips           Payslip[]
  employeeDebts      EmployeeDebtLedger[]

  @@index([companyId, status])
  @@index([companyId, startDate, endDate])
  @@map("payroll_periods")
}

model PayrollRun {
  id                String            @id @default(uuid())
  periodId          String            @map("period_id")
  runDate           DateTime          @default(now()) @map("run_date")
  status            PayrollStatus     @default(DRAFT)
  processedBy       String?           @map("processed_by")
  companyId         String?           @map("company_id")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  createdAt         DateTime          @default(now()) @map("created_at")
  calculatedAt      DateTime?         @map("calculated_at")
  calculatedBy      String?           @map("calculated_by")
  financeApprovedAt DateTime?         @map("finance_approved_at")
  financeApprovedBy String?           @map("finance_approved_by")
  hrApprovedAt      DateTime?         @map("hr_approved_at")
  hrApprovedBy      String?           @map("hr_approved_by")
  lockedAt          DateTime?         @map("locked_at")
  lockedBy          String?           @map("locked_by")
  paidAt            DateTime?         @map("paid_at")
  adjustmentReason  String?           @map("adjustment_reason")
  isAdjustment      Boolean           @default(false) @map("is_adjustment")
  originalRunId     String?           @map("original_run_id")
  mudadSubmissions  MudadSubmission[]
  ledger            PayrollLedger?
  company           Company?          @relation(fields: [companyId], references: [id])
  originalRun       PayrollRun?       @relation("AdjustmentRuns", fields: [originalRunId], references: [id])
  adjustmentRuns    PayrollRun[]      @relation("AdjustmentRuns")
  period            PayrollPeriod     @relation(fields: [periodId], references: [id])
  payslips          Payslip[]
  wpsSubmissions    WpsSubmission[]

  @@index([companyId, status])
  @@index([periodId])
  @@index([originalRunId])
  @@map("payroll_runs")
}

model Payslip {
  id               String        @id @default(uuid())
  employeeId       String        @map("employee_id")
  periodId         String        @map("period_id")
  runId            String?       @map("run_id")
  baseSalary       Decimal       @map("base_salary") @db.Decimal(10, 2)
  grossSalary      Decimal       @map("gross_salary") @db.Decimal(10, 2)
  totalDeductions  Decimal       @map("total_deductions") @db.Decimal(10, 2)
  netSalary        Decimal       @map("net_salary") @db.Decimal(10, 2)
  status           PayrollStatus @default(DRAFT)
  createdAt        DateTime      @default(now()) @map("created_at")
  updatedAt        DateTime      @updatedAt @map("updated_at")
  calculationTrace Json?         @map("calculation_trace")
  companyId        String?       @map("company_id")
  lines            PayslipLine[]
  company          Company?      @relation(fields: [companyId], references: [id])
  employee         User          @relation(fields: [employeeId], references: [id])
  period           PayrollPeriod @relation(fields: [periodId], references: [id])
  run              PayrollRun?   @relation(fields: [runId], references: [id])

  // ✅ منع تكرار كشف الراتب لنفس الموظف في نفس الفترة والتشغيل
  @@unique([employeeId, periodId, runId], name: "unique_employee_period_run")
  // ✅ فهارس لتحسين الأداء
  @@index([companyId, employeeId, periodId])
  @@index([companyId, status])
  @@index([periodId])
  @@index([runId])
  @@index([employeeId, status])
  @@map("payslips")
}

model GosiConfig {
  id                String    @id @default(uuid())
  employeeRate      Decimal   @map("employee_rate") @db.Decimal(5, 2)
  employerRate      Decimal   @map("employer_rate") @db.Decimal(5, 2)
  sanedRate         Decimal   @map("saned_rate") @db.Decimal(5, 2)
  hazardRate        Decimal   @map("hazard_rate") @db.Decimal(5, 2)
  maxCapAmount      Decimal   @default(45000) @map("max_cap_amount") @db.Decimal(10, 2)
  isSaudiOnly       Boolean   @default(true) @map("is_saudi_only")
  isActive          Boolean   @default(true) @map("is_active")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  companyId         String?   @map("company_id")
  effectiveDate     DateTime  @default(now()) @map("effective_date") @db.Date
  endDate           DateTime? @map("end_date") @db.Date
  includeAllowances Boolean   @default(false) @map("include_allowances")
  minBaseSalary     Decimal   @default(0) @map("min_base_salary") @db.Decimal(10, 2)
  notes             String?
  version           Int       @default(1)
  company           Company?  @relation(fields: [companyId], references: [id])

  @@unique([companyId, version])
  @@index([companyId, isActive])
  @@index([effectiveDate, endDate])
  @@map("gosi_configs")
}

model RetroPay {
  id            String         @id @default(uuid())
  employeeId    String         @map("employee_id")
  reason        String
  effectiveFrom DateTime       @map("effective_from")
  effectiveTo   DateTime       @map("effective_to")
  oldAmount     Decimal        @map("old_amount") @db.Decimal(10, 2)
  newAmount     Decimal        @map("new_amount") @db.Decimal(10, 2)
  difference    Decimal        @db.Decimal(10, 2)
  monthsCount   Int            @map("months_count")
  totalAmount   Decimal        @map("total_amount") @db.Decimal(10, 2)
  status        RetroPayStatus @default(PENDING)
  notes         String?
  createdById   String?        @map("created_by_id")
  approvedById  String?        @map("approved_by_id")
  approvedAt    DateTime?      @map("approved_at")
  paidAt        DateTime?      @map("paid_at")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  companyId     String?        @map("company_id")
  company       Company?       @relation(fields: [companyId], references: [id])
  employee      User           @relation(fields: [employeeId], references: [id])

  @@map("retro_pays")
}

model Policy {
  id             String       @id @default(uuid())
  code           String
  nameAr         String       @map("name_ar")
  nameEn         String?      @map("name_en")
  description    String?
  type           PolicyType
  scope          PolicyScope  @default(COMPANY)
  effectiveFrom  DateTime     @map("effective_from")
  effectiveTo    DateTime?    @map("effective_to")
  branchId       String?      @map("branch_id")
  departmentId   String?      @map("department_id")
  jobTitleId     String?      @map("job_title_id")
  employeeId     String?      @map("employee_id")
  settings       Json         @default("{}")
  isActive       Boolean      @default(true) @map("is_active")
  priority       Int          @default(0)
  createdById    String?      @map("created_by_id")
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  companyId      String?      @map("company_id")
  scopeRank      Int          @default(1) @map("scope_rank")
  branch         Branch?      @relation(fields: [branchId], references: [id])
  company        Company?     @relation(fields: [companyId], references: [id])
  department     Department?  @relation(fields: [departmentId], references: [id])
  targetEmployee User?        @relation("PolicyTargetEmployee", fields: [employeeId], references: [id])
  jobTitle       JobTitle?    @relation(fields: [jobTitleId], references: [id])
  rules          PolicyRule[]

  @@unique([companyId, code])
  @@index([companyId, type, scope, effectiveFrom])
  @@index([type, scope, isActive])
  @@index([effectiveFrom, effectiveTo])
  @@index([branchId])
  @@index([departmentId])
  @@index([jobTitleId])
  @@index([employeeId])
  @@map("policies")
}

model PolicyRule {
  id                String           @id @default(uuid())
  policyId          String           @map("policy_id")
  code              String
  nameAr            String           @map("name_ar")
  conditions        Json             @default("{}")
  valueType         String           @map("value_type")
  value             String
  isActive          Boolean          @default(true) @map("is_active")
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")
  outputComponentId String?          @map("output_component_id")
  outputSign        OutputSign       @default(EARNING) @map("output_sign")
  ruleOrder         Int              @default(0) @map("rule_order")
  outputComponent   SalaryComponent? @relation("PolicyOutputComponent", fields: [outputComponentId], references: [id])
  policy            Policy           @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@unique([policyId, code])
  @@index([policyId, isActive, ruleOrder])
  @@index([outputComponentId])
  @@map("policy_rules")
}

model SmartPolicy {
  id                  String                         @id @default(uuid())
  companyId           String                         @map("company_id")
  originalText        String                         @map("original_text")
  name                String?
  description         String?
  triggerEvent        SmartPolicyTrigger             @map("trigger_event")
  triggerSubEvent     String?                        @map("trigger_sub_event")
  parsedRule          Json                           @map("parsed_rule")
  conditions          Json                           @default("[]")
  actions             Json                           @default("[]")
  scopeType           String                         @default("ALL") @map("scope_type")
  scopeId             String?                        @map("scope_id")
  scopeName           String?                        @map("scope_name")
  status              SmartPolicyStatus              @default(DRAFT)
  isActive            Boolean                        @default(false) @map("is_active")
  priority            Int                            @default(0)
  effectiveFrom       DateTime?                      @map("effective_from")
  effectiveTo         DateTime?                      @map("effective_to")
  aiExplanation       String?                        @map("ai_explanation")
  clarificationNeeded String?                        @map("clarification_needed")
  executionCount      Int                            @default(0) @map("execution_count")
  lastExecutedAt      DateTime?                      @map("last_executed_at")
  totalAmountPaid     Decimal                        @default(0) @map("total_amount_paid") @db.Decimal(12, 2)
  totalAmountDeduct   Decimal                        @default(0) @map("total_amount_deduct") @db.Decimal(12, 2)
  createdById         String?                        @map("created_by_id")
  approvedById        String?                        @map("approved_by_id")
  approvedAt          DateTime?                      @map("approved_at")
  createdAt           DateTime                       @default(now()) @map("created_at")
  updatedAt           DateTime                       @updatedAt @map("updated_at")
  currentVersion      Int                            @default(1) @map("current_version")
  requiresApproval    Boolean                        @default(true) @map("requires_approval")
  blockLowerPriority  Boolean                        @default(false) @map("block_lower_priority")
  dependsOnPolicies   String[]                       @map("depends_on_policies")
  executionGroup      String?                        @map("execution_group")
  executionOrder      Int                            @default(100) @map("execution_order")
  conditionLogic      String                         @default("ALL") @map("condition_logic")
  lookbackMonths      Int?                           @map("lookback_months")
  simulations         PolicySimulationRun[]
  company             Company                        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  analytics           SmartPolicyAnalytics[]
  approvals           SmartPolicyApproval[]
  exceptions          SmartPolicyException[]
  executions          SmartPolicyExecution[]
  occurrences         SmartPolicyOccurrenceTracker[]
  retroApplications   SmartPolicyRetroApplication[]
  versions            SmartPolicyVersion[]

  @@index([companyId, status, isActive])
  @@index([companyId, triggerEvent])
  @@index([status, isActive])
  @@map("smart_policies")
}

model SmartPolicyExecution {
  id              String      @id @default(uuid())
  policyId        String      @map("policy_id")
  employeeId      String      @map("employee_id")
  employeeName    String      @map("employee_name")
  triggerEvent    String      @map("trigger_event")
  triggerSubEvent String?     @map("trigger_sub_event")
  triggerData     Json?       @map("trigger_data")
  conditionsMet   Boolean     @map("conditions_met")
  conditionsLog   Json?       @map("conditions_log")
  actionType      String?     @map("action_type")
  actionValue     Decimal?    @map("action_value") @db.Decimal(10, 2)
  actionResult    Json?       @map("action_result")
  isSuccess       Boolean     @map("is_success")
  errorMessage    String?     @map("error_message")
  payrollPeriod   String?     @map("payroll_period")
  executedAt      DateTime    @default(now()) @map("executed_at")
  policy          SmartPolicy @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@index([policyId, executedAt])
  @@index([employeeId, executedAt])
  @@index([triggerEvent])
  @@map("smart_policy_executions")
}

model SmartPolicyVersion {
  id            String      @id @default(uuid())
  policyId      String      @map("policy_id")
  version       Int
  originalText  String      @map("original_text")
  parsedRule    Json        @map("parsed_rule")
  conditions    Json        @default("[]")
  actions       Json        @default("[]")
  changeReason  String?     @map("change_reason")
  changedBy     String      @map("changed_by")
  changedByName String      @map("changed_by_name")
  createdAt     DateTime    @default(now()) @map("created_at")
  policy        SmartPolicy @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@unique([policyId, version])
  @@index([policyId])
  @@map("smart_policy_versions")
}

model SmartPolicyApproval {
  id              String               @id @default(uuid())
  policyId        String               @map("policy_id")
  submittedBy     String               @map("submitted_by")
  submittedByName String               @map("submitted_by_name")
  submittedAt     DateTime             @default(now()) @map("submitted_at")
  requiredLevel   String               @default("HR") @map("required_level")
  action          PolicyApprovalAction @default(SUBMITTED)
  actionBy        String?              @map("action_by")
  actionByName    String?              @map("action_by_name")
  actionAt        DateTime?            @map("action_at")
  actionNotes     String?              @map("action_notes")
  rejectionReason String?              @map("rejection_reason")
  policyVersion   Int                  @map("policy_version")
  createdAt       DateTime             @default(now()) @map("created_at")
  policy          SmartPolicy          @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@index([policyId, action])
  @@index([action, submittedAt])
  @@map("smart_policy_approvals")
}

model PolicySimulationRun {
  id                     String      @id @default(uuid())
  policyId               String      @map("policy_id")
  simulatedBy            String      @map("simulated_by")
  simulatedByName        String      @map("simulated_by_name")
  simulationPeriod       String      @map("simulation_period")
  totalEmployeesAffected Int         @map("total_employees_affected")
  totalAdditions         Decimal     @default(0) @map("total_additions") @db.Decimal(12, 2)
  totalDeductions        Decimal     @default(0) @map("total_deductions") @db.Decimal(12, 2)
  results                Json        @default("[]")
  executionTimeMs        Int?        @map("execution_time_ms")
  warningsCount          Int         @default(0) @map("warnings_count")
  warnings               Json?       @default("[]")
  createdAt              DateTime    @default(now()) @map("created_at")
  policy                 SmartPolicy @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@index([policyId, createdAt])
  @@map("policy_simulation_runs")
}

model SmartPolicyException {
  id            String      @id @default(uuid())
  policyId      String      @map("policy_id")
  companyId     String      @map("company_id")
  exceptionType String      @map("exception_type")
  targetId      String      @map("target_id")
  targetName    String      @map("target_name")
  reason        String?
  exceptionFrom DateTime?   @map("exception_from")
  exceptionTo   DateTime?   @map("exception_to")
  isActive      Boolean     @default(true) @map("is_active")
  createdBy     String      @map("created_by")
  createdByName String      @map("created_by_name")
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")
  company       Company     @relation(fields: [companyId], references: [id])
  policy        SmartPolicy @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@unique([policyId, exceptionType, targetId])
  @@index([policyId, isActive])
  @@index([companyId])
  @@map("smart_policy_exceptions")
}

model SmartPolicyOccurrenceTracker {
  id             String                @id @default(uuid())
  policyId       String                @map("policy_id")
  employeeId     String                @map("employee_id")
  occurrenceType String                @map("occurrence_type")
  count          Int                   @default(0)
  resetPeriod    OccurrenceResetPeriod @default(MONTHLY) @map("reset_period")
  lastResetAt    DateTime              @default(now()) @map("last_reset_at")
  lastOccurredAt DateTime?             @map("last_occurred_at")
  lastEventData  Json?                 @map("last_event_data")
  createdAt      DateTime              @default(now()) @map("created_at")
  updatedAt      DateTime              @updatedAt @map("updated_at")
  policy         SmartPolicy           @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@unique([policyId, employeeId, occurrenceType])
  @@index([policyId])
  @@index([employeeId])
  @@map("smart_policy_occurrence_trackers")
}

model SmartPolicyRetroApplication {
  id                     String                 @id @default(uuid())
  policyId               String                 @map("policy_id")
  companyId              String                 @map("company_id")
  startPeriod            String                 @map("start_period")
  endPeriod              String                 @map("end_period")
  periods                String[]
  totalEmployeesAffected Int                    @default(0) @map("total_employees_affected")
  totalAdditions         Decimal                @default(0) @map("total_additions") @db.Decimal(12, 2)
  totalDeductions        Decimal                @default(0) @map("total_deductions") @db.Decimal(12, 2)
  netAmount              Decimal                @default(0) @map("net_amount") @db.Decimal(12, 2)
  results                Json                   @default("[]")
  status                 RetroApplicationStatus @default(PENDING)
  requestedBy            String                 @map("requested_by")
  requestedByName        String                 @map("requested_by_name")
  requestedAt            DateTime               @default(now()) @map("requested_at")
  reviewedBy             String?                @map("reviewed_by")
  reviewedByName         String?                @map("reviewed_by_name")
  reviewedAt             DateTime?              @map("reviewed_at")
  approvedBy             String?                @map("approved_by")
  approvedByName         String?                @map("approved_by_name")
  approvedAt             DateTime?              @map("approved_at")
  appliedAt              DateTime?              @map("applied_at")
  appliedToPayrollPeriod String?                @map("applied_to_payroll_period")
  notes                  String?
  createdAt              DateTime               @default(now()) @map("created_at")
  updatedAt              DateTime               @updatedAt @map("updated_at")
  company                Company                @relation(fields: [companyId], references: [id])
  policy                 SmartPolicy            @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@index([policyId, status])
  @@index([companyId, status])
  @@map("smart_policy_retro_applications")
}

model SmartPolicyAnalytics {
  id                   String      @id @default(uuid())
  policyId             String      @map("policy_id")
  companyId            String      @map("company_id")
  period               String
  employeesAffected    Int         @map("employees_affected")
  totalAdditions       Decimal     @map("total_additions") @db.Decimal(12, 2)
  totalDeductions      Decimal     @map("total_deductions") @db.Decimal(12, 2)
  avgAmountPerEmployee Decimal     @map("avg_amount_per_employee") @db.Decimal(12, 2)
  executionCount       Int         @map("execution_count")
  byDepartment         Json        @default("{}") @map("by_department")
  byBranch             Json        @default("{}") @map("by_branch")
  byJobTitle           Json        @default("{}") @map("by_job_title")
  previousPeriodChange Decimal?    @map("previous_period_change") @db.Decimal(5, 2)
  calculatedAt         DateTime    @default(now()) @map("calculated_at")
  company              Company     @relation(fields: [companyId], references: [id])
  policy               SmartPolicy @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@unique([policyId, period])
  @@index([companyId, period])
  @@map("smart_policy_analytics")
}

model SmartPolicyTemplate {
  id               String   @id @default(uuid())
  category         String
  name             String
  nameEn           String?  @map("name_en")
  description      String
  originalText     String   @map("original_text")
  parsedRule       Json     @map("parsed_rule")
  legalCompliance  Json     @default("{}") @map("legal_compliance")
  laborLawArticles String[] @map("labor_law_articles")
  usageCount       Int      @default(0) @map("usage_count")
  rating           Decimal? @db.Decimal(2, 1)
  ratingCount      Int      @default(0) @map("rating_count")
  isPublic         Boolean  @default(true) @map("is_public")
  isSystemTemplate Boolean  @default(false) @map("is_system_template")
  createdBy        String?  @map("created_by")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  @@index([category, isPublic])
  @@map("smart_policy_templates")
}

model MudadSubmission {
  id               String      @id @default(uuid())
  companyId        String      @map("company_id")
  payrollRunId     String      @map("payroll_run_id")
  period           String
  submissionType   String      @default("SALARY") @map("submission_type")
  status           MudadStatus @default(PENDING)
  wpsFileUrl       String?     @map("wps_file_url")
  mudadRef         String?     @map("mudad_ref")
  totalAmount      Decimal     @map("total_amount") @db.Decimal(12, 2)
  employeeCount    Int         @map("employee_count")
  preparedAt       DateTime?   @map("prepared_at")
  preparedBy       String?     @map("prepared_by")
  submittedAt      DateTime?   @map("submitted_at")
  submittedBy      String?     @map("submitted_by")
  acceptedAt       DateTime?   @map("accepted_at")
  rejectedAt       DateTime?   @map("rejected_at")
  rejectionNote    String?     @map("rejection_note")
  fileHashSha256   String?     @map("file_hash_sha256") @db.VarChar(64)
  fileSize         Int?        @map("file_size")
  generatorVersion String?     @map("generator_version")
  notes            String?
  createdAt        DateTime    @default(now()) @map("created_at")
  updatedAt        DateTime    @updatedAt @map("updated_at")
  company          Company     @relation(fields: [companyId], references: [id])
  payrollRun       PayrollRun  @relation(fields: [payrollRunId], references: [id])

  @@unique([payrollRunId, submissionType])
  @@index([companyId, period])
  @@index([status])
  @@map("mudad_submissions")
}

model WpsSubmission {
  id               String     @id @default(uuid())
  companyId        String     @map("company_id")
  payrollRunId     String     @map("payroll_run_id")
  filename         String
  fileFormat       String     @default("WPS") @map("file_format")
  fileUrl          String?    @map("file_url")
  totalAmount      Decimal    @map("total_amount") @db.Decimal(12, 2)
  employeeCount    Int        @map("employee_count")
  status           WpsStatus  @default(GENERATED)
  bankName         String?    @map("bank_name")
  bankRef          String?    @map("bank_ref")
  generatedAt      DateTime   @default(now()) @map("generated_at")
  generatedBy      String?    @map("generated_by")
  downloadedAt     DateTime?  @map("downloaded_at")
  submittedAt      DateTime?  @map("submitted_at")
  processedAt      DateTime?  @map("processed_at")
  fileHashSha256   String?    @map("file_hash_sha256") @db.VarChar(64)
  generatorVersion String?    @map("generator_version")
  notes            String?
  errors           Json?
  createdAt        DateTime   @default(now()) @map("created_at")
  updatedAt        DateTime   @updatedAt @map("updated_at")
  attachmentUrl    String?    @map("attachment_url")
  downloadedBy     String?    @map("downloaded_by")
  submittedBy      String?    @map("submitted_by")
  company          Company    @relation(fields: [companyId], references: [id])
  payrollRun       PayrollRun @relation(fields: [payrollRunId], references: [id])

  @@index([companyId, status])
  @@index([payrollRunId])
  @@map("wps_submissions")
}

model CompanyDisciplinaryPolicy {
  id                           String              @id @default(uuid())
  companyId                    String              @unique @map("company_id")
  incidentMaxAgeDays           Int                 @default(30) @map("incident_max_age_days")
  decisionDeadlineDays         Int                 @default(30) @map("decision_deadline_days")
  objectionWindowDays          Int                 @default(15) @map("objection_window_days")
  allowRetrospectiveIncidents  Boolean             @default(false) @map("allow_retrospective_incidents")
  autoApplyToOpenPayrollPeriod Boolean             @default(true) @map("auto_apply_to_open_payroll_period")
  deductionBasePolicy          DeductionBasePolicy @default(BASIC_FIXED) @map("deduction_base_policy")
  createdAt                    DateTime            @default(now()) @map("created_at")
  updatedAt                    DateTime            @updatedAt @map("updated_at")
  company                      Company             @relation(fields: [companyId], references: [id])

  @@map("company_disciplinary_policies")
}

model DisciplinaryCase {
  id                            String                       @id @default(uuid())
  companyId                     String                       @map("company_id")
  caseCode                      String                       @map("case_code")
  employeeId                    String                       @map("employee_id")
  managerId                     String                       @map("manager_id")
  title                         String
  incidentDate                  DateTime                     @map("incident_date")
  incidentLocation              String                       @map("incident_location")
  involvedParties               Json?                        @map("involved_parties")
  description                   String
  status                        DisciplinaryStatus           @default(SUBMITTED_TO_HR)
  stage                         DisciplinaryStage            @default(MANAGER_REQUEST)
  incidentMaxAgeDaysSnapshot    Int                          @map("incident_max_age_days_snapshot")
  decisionDeadlineDaysSnapshot  Int                          @map("decision_deadline_days_snapshot")
  objectionWindowDaysSnapshot   Int                          @map("objection_window_days_snapshot")
  allowRetrospectiveSnapshot    Boolean                      @map("allow_retrospective_snapshot")
  deductionBasePolicySnapshot   DeductionBasePolicy          @map("deduction_base_policy_snapshot")
  isRetrospective               Boolean                      @default(false) @map("is_retrospective")
  retrospectiveReason           String?                      @map("retrospective_reason")
  hrInitialAction               String?                      @map("hr_initial_action")
  hrInitialReason               String?                      @map("hr_initial_reason")
  officialInvestigationOpenedAt DateTime?                    @map("official_investigation_opened_at")
  hearingDatetime               DateTime?                    @map("hearing_datetime")
  hearingLocation               String?                      @map("hearing_location")
  decisionType                  DecisionType?                @map("decision_type")
  decisionReason                String?                      @map("decision_reason")
  decisionCreatedAt             DateTime?                    @map("decision_created_at")
  penaltyUnit                   AdjustmentUnit?              @map("penalty_unit")
  penaltyValue                  Decimal?                     @map("penalty_value") @db.Decimal(10, 2)
  penaltyEffectiveDate          DateTime?                    @map("penalty_effective_date") @db.Date
  payrollPeriodId               String?                      @map("payroll_period_id")
  employeeAckStatus             String?                      @map("employee_ack_status")
  employeeAckAt                 DateTime?                    @map("employee_ack_at")
  objectionText                 String?                      @map("objection_text")
  objectionSubmittedAt          DateTime?                    @map("objection_submitted_at")
  hrAfterObjectionAction        String?                      @map("hr_after_objection_action")
  hrAfterObjectionReason        String?                      @map("hr_after_objection_reason")
  finalizedAt                   DateTime?                    @map("finalized_at")
  legalHold                     Boolean                      @default(false) @map("legal_hold")
  createdAt                     DateTime                     @default(now()) @map("created_at")
  updatedAt                     DateTime                     @updatedAt @map("updated_at")
  violationType                 String?                      @map("violation_type")
  attachments                   CaseAttachment[]
  events                        CaseEvent[]
  minutes                       CaseMinute[]
  company                       Company                      @relation(fields: [companyId], references: [id])
  employee                      User                         @relation("EmployeeDisciplinaryCases", fields: [employeeId], references: [id])
  manager                       User                         @relation("ManagerCreatedCases", fields: [managerId], references: [id])
  payrollPeriod                 PayrollPeriod?               @relation(fields: [payrollPeriodId], references: [id])
  records                       EmployeeDisciplinaryRecord[]
  adjustments                   PayrollAdjustment[]

  @@unique([companyId, caseCode])
  @@index([companyId, status])
  @@index([employeeId])
  @@index([companyId, employeeId])
  @@map("disciplinary_cases")
}

model CaseEvent {
  id          String           @id @default(uuid())
  caseId      String           @map("case_id")
  actorUserId String?          @map("actor_user_id")
  eventType   CaseEventType    @map("event_type")
  message     String?
  metadata    Json?
  createdAt   DateTime         @default(now()) @map("created_at")
  case        DisciplinaryCase @relation(fields: [caseId], references: [id])

  @@index([caseId, createdAt])
  @@map("case_events")
}

model CaseAttachment {
  id             String           @id @default(uuid())
  caseId         String           @map("case_id")
  uploaderUserId String           @map("uploader_user_id")
  fileUrl        String           @map("file_url")
  fileName       String           @map("file_name")
  fileType       String           @map("file_type")
  createdAt      DateTime         @default(now()) @map("created_at")
  case           DisciplinaryCase @relation(fields: [caseId], references: [id])

  @@map("case_attachments")
}

model CaseMinute {
  id             String           @id @default(uuid())
  caseId         String           @map("case_id")
  sessionNo      Int              @map("session_no")
  minutesText    String?          @map("minutes_text")
  minutesFileUrl String?          @map("minutes_file_url")
  createdByHrId  String           @map("created_by_hr_id")
  createdAt      DateTime         @default(now()) @map("created_at")
  case           DisciplinaryCase @relation(fields: [caseId], references: [id])

  @@map("case_minutes")
}

model EmployeeDisciplinaryRecord {
  id              String           @id @default(uuid())
  employeeId      String           @map("employee_id")
  caseId          String           @map("case_id")
  decisionType    DecisionType     @map("decision_type")
  reason          String?
  effectiveDate   DateTime         @map("effective_date")
  penaltyMetadata Json?            @map("penalty_metadata")
  createdAt       DateTime         @default(now()) @map("created_at")
  case            DisciplinaryCase @relation(fields: [caseId], references: [id])
  employee        User             @relation(fields: [employeeId], references: [id])

  @@map("employee_disciplinary_records")
}

model PayrollAdjustment {
  id              String                  @id @default(uuid())
  companyId       String                  @map("company_id")
  employeeId      String                  @map("employee_id")
  caseId          String                  @map("case_id")
  payrollPeriodId String                  @map("payroll_period_id")
  adjustmentType  String                  @map("adjustment_type")
  unit            AdjustmentUnit
  value           Decimal                 @db.Decimal(10, 2)
  amount          Decimal?                @db.Decimal(10, 2)
  status          PayrollAdjustmentStatus @default(PENDING)
  description     String?
  effectiveDate   DateTime?               @map("effective_date") @db.Date
  postedAt        DateTime?               @map("posted_at")
  reversedAt      DateTime?               @map("reversed_at")
  createdAt       DateTime                @default(now()) @map("created_at")
  updatedAt       DateTime                @updatedAt @map("updated_at")
  case            DisciplinaryCase        @relation(fields: [caseId], references: [id])
  company         Company                 @relation(fields: [companyId], references: [id])
  employee        User                    @relation(fields: [employeeId], references: [id])
  payrollPeriod   PayrollPeriod           @relation(fields: [payrollPeriodId], references: [id])

  @@unique([companyId, caseId])
  @@index([companyId, employeeId, payrollPeriodId, status])
  @@index([employeeId, payrollPeriodId])
  @@index([payrollPeriodId, status])
  @@map("payroll_adjustments")
}

model SubmissionStatusLog {
  id              String               @id @default(uuid())
  companyId       String               @map("company_id")
  entityType      SubmissionEntityType @map("entity_type")
  entityId        String               @map("entity_id")
  fromStatus      String?              @map("from_status")
  toStatus        String               @map("to_status")
  changedByUserId String               @map("changed_by_user_id")
  changedAt       DateTime             @default(now()) @map("changed_at")
  reason          String?
  externalRef     String?              @map("external_ref")
  meta            Json?
  createdAt       DateTime             @default(now()) @map("created_at")
  company         Company              @relation(fields: [companyId], references: [id])

  @@index([companyId, entityType, entityId])
  @@index([changedAt])
  @@map("submission_status_logs")
}

model ApprovalChainConfig {
  id          String              @id @default(uuid())
  companyId   String              @map("company_id")
  requestType ApprovalRequestType @map("request_type")
  minAmount   Decimal?            @map("min_amount") @db.Decimal(12, 2)
  maxAmount   Decimal?            @map("max_amount") @db.Decimal(12, 2)
  minDays     Int?                @map("min_days")
  maxDays     Int?                @map("max_days")
  chain       Json
  name        String              @db.VarChar(100)
  description String?             @db.VarChar(500)
  priority    Int                 @default(0)
  isActive    Boolean             @default(true) @map("is_active")
  createdAt   DateTime            @default(now()) @map("created_at")
  updatedAt   DateTime            @updatedAt @map("updated_at")
  company     Company             @relation(fields: [companyId], references: [id])

  @@index([companyId, requestType, isActive])
  @@map("approval_chain_configs")
}

model CustodyCategory {
  id                   String        @id @default(uuid())
  companyId            String        @map("company_id")
  name                 String
  nameEn               String?       @map("name_en")
  description          String?
  icon                 String?
  requiresApproval     Boolean       @default(true) @map("requires_approval")
  requiresSerialNumber Boolean       @default(true) @map("requires_serial_number")
  depreciationYears    Int?          @map("depreciation_years")
  isActive             Boolean       @default(true) @map("is_active")
  createdAt            DateTime      @default(now()) @map("created_at")
  updatedAt            DateTime      @updatedAt @map("updated_at")
  company              Company       @relation(fields: [companyId], references: [id])
  items                CustodyItem[]

  @@unique([companyId, name])
  @@map("custody_categories")
}

model CustodyItem {
  id                String               @id @default(uuid())
  companyId         String               @map("company_id")
  categoryId        String               @map("category_id")
  code              String
  name              String
  nameEn            String?              @map("name_en")
  description       String?
  serialNumber      String?              @map("serial_number")
  model             String?
  brand             String?
  barcode           String?
  qrCode            String?              @map("qr_code")
  purchaseDate      DateTime?            @map("purchase_date")
  purchasePrice     Decimal?             @map("purchase_price") @db.Decimal(12, 2)
  warrantyExpiry    DateTime?            @map("warranty_expiry")
  vendor            String?
  invoiceNumber     String?              @map("invoice_number")
  status            CustodyItemStatus    @default(AVAILABLE)
  condition         CustodyCondition     @default(NEW)
  currentLocation   String?              @map("current_location")
  notes             String?
  imageUrl          String?              @map("image_url")
  attachments       Json?                @default("[]")
  branchId          String?              @map("branch_id")
  currentAssigneeId String?              @map("current_assignee_id")
  createdAt         DateTime             @default(now()) @map("created_at")
  updatedAt         DateTime             @updatedAt @map("updated_at")
  assignments       CustodyAssignment[]
  branch            Branch?              @relation(fields: [branchId], references: [id])
  category          CustodyCategory      @relation(fields: [categoryId], references: [id])
  company           Company              @relation(fields: [companyId], references: [id])
  maintenances      CustodyMaintenance[]
  returns           CustodyReturn[]
  transfers         CustodyTransfer[]

  @@unique([companyId, code])
  @@index([companyId, status])
  @@index([categoryId])
  @@index([currentAssigneeId])
  @@map("custody_items")
}

model CustodyAssignment {
  id                String                  @id @default(uuid())
  companyId         String                  @map("company_id")
  custodyItemId     String                  @map("custody_item_id")
  employeeId        String                  @map("employee_id")
  assignedAt        DateTime                @default(now()) @map("assigned_at")
  expectedReturn    DateTime?               @map("expected_return")
  actualReturn      DateTime?               @map("actual_return")
  status            CustodyAssignmentStatus @default(PENDING)
  conditionOnAssign CustodyCondition?       @map("condition_on_assign")
  conditionOnReturn CustodyCondition?       @map("condition_on_return")
  assignedById      String                  @map("assigned_by_id")
  approvedById      String?                 @map("approved_by_id")
  approvedAt        DateTime?               @map("approved_at")
  notes             String?
  employeeSignature String?                 @map("employee_signature")
  signatureDate     DateTime?               @map("signature_date")
  attachments       Json?                   @default("[]")
  approvalChain     Json?                   @map("approval_chain")
  createdAt         DateTime                @default(now()) @map("created_at")
  updatedAt         DateTime                @updatedAt @map("updated_at")
  approvedBy        User?                   @relation("CustodyApprover", fields: [approvedById], references: [id])
  assignedBy        User                    @relation("CustodyAssigner", fields: [assignedById], references: [id])
  company           Company                 @relation(fields: [companyId], references: [id])
  custodyItem       CustodyItem             @relation(fields: [custodyItemId], references: [id])
  employee          User                    @relation("EmployeeCustody", fields: [employeeId], references: [id])
  returns           CustodyReturn[]

  @@index([companyId, status])
  @@index([employeeId])
  @@index([custodyItemId])
  @@map("custody_assignments")
}

model CustodyReturn {
  id                 String              @id @default(uuid())
  companyId          String              @map("company_id")
  custodyItemId      String              @map("custody_item_id")
  assignmentId       String              @map("assignment_id")
  returnedById       String              @map("returned_by_id")
  returnDate         DateTime            @default(now()) @map("return_date")
  returnReason       String?             @map("return_reason")
  conditionOnReturn  CustodyCondition    @map("condition_on_return")
  status             CustodyReturnStatus @default(PENDING)
  reviewedById       String?             @map("reviewed_by_id")
  reviewedAt         DateTime?           @map("reviewed_at")
  reviewNotes        String?             @map("review_notes")
  damageDescription  String?             @map("damage_description")
  estimatedCost      Decimal?            @map("estimated_cost") @db.Decimal(12, 2)
  chargeEmployee     Boolean             @default(false) @map("charge_employee")
  chargedToPayroll   Boolean             @default(false) @map("charged_to_payroll")
  payrollDeductionId String?             @map("payroll_deduction_id")
  attachments        Json?               @default("[]")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  assignment         CustodyAssignment   @relation(fields: [assignmentId], references: [id])
  company            Company             @relation(fields: [companyId], references: [id])
  custodyItem        CustodyItem         @relation(fields: [custodyItemId], references: [id])
  returnedBy         User                @relation("CustodyReturner", fields: [returnedById], references: [id])
  reviewedBy         User?               @relation("CustodyReturnReviewer", fields: [reviewedById], references: [id])

  @@index([companyId, status])
  @@map("custody_returns")
}

model CustodyTransfer {
  id             String                @id @default(uuid())
  companyId      String                @map("company_id")
  custodyItemId  String                @map("custody_item_id")
  fromEmployeeId String                @map("from_employee_id")
  toEmployeeId   String                @map("to_employee_id")
  transferDate   DateTime              @default(now()) @map("transfer_date")
  reason         String?
  status         CustodyTransferStatus @default(PENDING)
  initiatedById  String                @map("initiated_by_id")
  approvedById   String?               @map("approved_by_id")
  approvedAt     DateTime?             @map("approved_at")
  fromSignature  String?               @map("from_signature")
  toSignature    String?               @map("to_signature")
  notes          String?
  attachments    Json?                 @default("[]")
  createdAt      DateTime              @default(now()) @map("created_at")
  updatedAt      DateTime              @updatedAt @map("updated_at")
  approvedBy     User?                 @relation("CustodyTransferApprover", fields: [approvedById], references: [id])
  company        Company               @relation(fields: [companyId], references: [id])
  custodyItem    CustodyItem           @relation(fields: [custodyItemId], references: [id])
  fromEmployee   User                  @relation("CustodyTransferFrom", fields: [fromEmployeeId], references: [id])
  initiatedBy    User                  @relation("CustodyTransferInitiator", fields: [initiatedById], references: [id])
  toEmployee     User                  @relation("CustodyTransferTo", fields: [toEmployeeId], references: [id])

  @@index([companyId, status])
  @@map("custody_transfers")
}

model CustodyMaintenance {
  id             String                   @id @default(uuid())
  companyId      String                   @map("company_id")
  custodyItemId  String                   @map("custody_item_id")
  type           MaintenanceType
  description    String
  reportedAt     DateTime                 @default(now()) @map("reported_at")
  reportedById   String                   @map("reported_by_id")
  startedAt      DateTime?                @map("started_at")
  completedAt    DateTime?                @map("completed_at")
  status         CustodyMaintenanceStatus @default(PENDING)
  estimatedCost  Decimal?                 @map("estimated_cost") @db.Decimal(12, 2)
  actualCost     Decimal?                 @map("actual_cost") @db.Decimal(12, 2)
  vendor         String?
  vendorContact  String?                  @map("vendor_contact")
  vendorEmail    String?                  @map("vendor_email")
  invoiceNumber  String?                  @map("invoice_number")
  result         String?
  conditionAfter CustodyCondition?        @map("condition_after")
  attachments    Json?                    @default("[]")
  createdAt      DateTime                 @default(now()) @map("created_at")
  updatedAt      DateTime                 @updatedAt @map("updated_at")
  company        Company                  @relation(fields: [companyId], references: [id])
  custodyItem    CustodyItem              @relation(fields: [custodyItemId], references: [id])
  reportedBy     User                     @relation("MaintenanceReporter", fields: [reportedById], references: [id])

  @@index([companyId, status])
  @@map("custody_maintenances")
}

model EmployeeDocument {
  id               String       @id @default(uuid())
  companyId        String       @map("company_id")
  userId           String       @map("user_id")
  type             DocumentType
  title            String
  titleAr          String?      @map("title_ar")
  description      String?
  filePath         String       @map("file_path")
  fileType         String       @map("file_type")
  fileSize         Int          @map("file_size")
  originalName     String?      @map("original_name")
  documentNumber   String?      @map("document_number")
  issueDate        DateTime?    @map("issue_date") @db.Date
  expiryDate       DateTime?    @map("expiry_date") @db.Date
  issuingAuthority String?      @map("issuing_authority")
  isVerified       Boolean      @default(false) @map("is_verified")
  verifiedById     String?      @map("verified_by_id")
  verifiedAt       DateTime?    @map("verified_at")
  uploadedById     String       @map("uploaded_by_id")
  notes            String?
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")
  user             User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([companyId, type])
  @@index([expiryDate])
  @@map("employee_documents")
}

model EmployeeSkill {
  id               String           @id @default(uuid())
  companyId        String           @map("company_id")
  userId           String           @map("user_id")
  skillName        String           @map("skill_name")
  skillNameAr      String?          @map("skill_name_ar")
  category         String?
  proficiencyLevel ProficiencyLevel @default(BEGINNER) @map("proficiency_level")
  yearsExperience  Int?             @map("years_experience")
  isVerified       Boolean          @default(false) @map("is_verified")
  verifiedById     String?          @map("verified_by_id")
  verifiedAt       DateTime?        @map("verified_at")
  notes            String?
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")
  user             User             @relation("EmployeeSkills", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([companyId, category])
  @@index([skillName])
  @@map("employee_skills")
}

model PayrollLedger {
  id                        String         @id @default(uuid())
  runId                     String         @unique @map("run_id")
  companyId                 String         @map("company_id")
  totalGross                Decimal        @default(0) @map("total_gross") @db.Decimal(12, 2)
  totalDeduction            Decimal        @default(0) @map("total_deduction") @db.Decimal(12, 2)
  totalNet                  Decimal        @default(0) @map("total_net") @db.Decimal(12, 2)
  totalEmployerContribution Decimal        @default(0) @map("total_employer_contribution") @db.Decimal(12, 2)
  status                    String         @default("DRAFT")
  createdAt                 DateTime       @default(now()) @map("created_at")
  updatedAt                 DateTime       @updatedAt @map("updated_at")
  entries                   JournalEntry[]
  run                       PayrollRun     @relation(fields: [runId], references: [id], onDelete: Cascade)

  @@map("payroll_ledgers")
}

model JournalEntry {
  id          String        @id @default(uuid())
  ledgerId    String        @map("ledger_id")
  accountCode String        @map("account_code")
  accountName String        @map("account_name")
  debit       Decimal       @default(0) @db.Decimal(12, 2)
  credit      Decimal       @default(0) @db.Decimal(12, 2)
  description String?
  createdAt   DateTime      @default(now()) @map("created_at")
  ledger      PayrollLedger @relation(fields: [ledgerId], references: [id], onDelete: Cascade)

  @@map("payroll_journal_entries")
}

model EmployeeLocationLog {
  id                 String   @id @default(uuid())
  companyId          String?  @map("company_id")
  userId             String   @map("user_id")
  latitude           Decimal  @db.Decimal(10, 8)
  longitude          Decimal  @db.Decimal(11, 8)
  accuracy           Float?
  isInsideGeofence   Boolean  @default(true) @map("is_inside_geofence")
  distanceFromBranch Int?     @map("distance_from_branch")
  batteryLevel       Float?   @map("battery_level")
  deviceInfo         String?  @map("device_info")
  createdAt          DateTime @default(now()) @map("created_at")
  company            Company? @relation(fields: [companyId], references: [id])
  user               User     @relation(fields: [userId], references: [id])

  @@index([userId, createdAt])
  @@index([companyId, createdAt])
  @@index([userId, isInsideGeofence])
  @@map("employee_location_logs")
}

model GeofenceExitEvent {
  id                 String     @id @default(uuid())
  companyId          String?    @map("company_id")
  userId             String     @map("user_id")
  attendanceId       String     @map("attendance_id")
  exitLatitude       Decimal    @map("exit_latitude") @db.Decimal(10, 8)
  exitLongitude      Decimal    @map("exit_longitude") @db.Decimal(11, 8)
  distanceFromBranch Int        @map("distance_from_branch")
  exitTime           DateTime   @map("exit_time")
  returnTime         DateTime?  @map("return_time")
  returnLatitude     Decimal?   @map("return_latitude") @db.Decimal(10, 8)
  returnLongitude    Decimal?   @map("return_longitude") @db.Decimal(11, 8)
  durationMinutes    Int?       @map("duration_minutes")
  notificationSent   Boolean    @default(false) @map("notification_sent")
  createdAt          DateTime   @default(now()) @map("created_at")
  updatedAt          DateTime   @updatedAt @map("updated_at")
  attendance         Attendance @relation(fields: [attendanceId], references: [id])
  company            Company?   @relation(fields: [companyId], references: [id])
  user               User       @relation(fields: [userId], references: [id])

  @@index([userId, exitTime])
  @@index([attendanceId])
  @@index([companyId, exitTime])
  @@map("geofence_exit_events")
}

model OnboardingTemplate {
  id          String                   @id @default(uuid())
  companyId   String                   @map("company_id")
  name        String
  nameEn      String?                  @map("name_en")
  description String?
  type        OnboardingType           @default(JOINING)
  isActive    Boolean                  @default(true)
  createdAt   DateTime                 @default(now()) @map("created_at")
  updatedAt   DateTime                 @updatedAt @map("updated_at")
  processes   OnboardingProcess[]
  tasks       OnboardingTemplateTask[]
  company     Company                  @relation(fields: [companyId], references: [id])

  @@index([companyId, type])
  @@map("onboarding_templates")
}

model OnboardingTemplateTask {
  id            String             @id @default(uuid())
  templateId    String             @map("template_id")
  title         String
  titleEn       String?            @map("title_en")
  description   String?
  assigneeType  AssigneeType       @default(HR)
  dueDays       Int                @default(1)
  priority      Int                @default(1)
  requiresPhoto Boolean            @default(false) @map("requires_photo")
  createdAt     DateTime           @default(now()) @map("created_at")
  template      OnboardingTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([templateId])
  @@map("onboarding_template_tasks")
}

model OnboardingProcess {
  id          String                  @id @default(uuid())
  companyId   String                  @map("company_id")
  userId      String                  @map("user_id")
  templateId  String                  @map("template_id")
  type        OnboardingType
  status      OnboardingProcessStatus @default(IN_PROGRESS)
  startDate   DateTime                @default(now()) @map("start_date")
  completedAt DateTime?               @map("completed_at")
  createdAt   DateTime                @default(now()) @map("created_at")
  updatedAt   DateTime                @updatedAt @map("updated_at")
  company     Company                 @relation(fields: [companyId], references: [id])
  template    OnboardingTemplate      @relation(fields: [templateId], references: [id])
  user        User                    @relation(fields: [userId], references: [id])
  tasks       OnboardingTask[]

  @@index([companyId, status])
  @@index([userId])
  @@map("onboarding_processes")
}

model OnboardingTask {
  id           String               @id @default(uuid())
  processId    String               @map("process_id")
  title        String
  titleEn      String?              @map("title_en")
  description  String?
  assigneeId   String?              @map("assignee_id")
  assigneeType AssigneeType
  status       OnboardingTaskStatus @default(PENDING)
  dueDate      DateTime             @map("due_date")
  completedAt  DateTime?            @map("completed_at")
  completedBy  String?              @map("completed_by")
  photoUrl     String?              @map("photo_url")
  notes        String?
  createdAt    DateTime             @default(now()) @map("created_at")
  updatedAt    DateTime             @updatedAt @map("updated_at")
  process      OnboardingProcess    @relation(fields: [processId], references: [id], onDelete: Cascade)

  @@index([processId, status])
  @@map("onboarding_tasks")
}

model TaskCategory {
  id          String           @id @default(uuid())
  companyId   String           @map("company_id")
  name        String
  nameEn      String?          @map("name_en")
  color       String           @default("#3B82F6")
  icon        String?
  order       Int              @default(0)
  isActive    Boolean          @default(true) @map("is_active")
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")
  automations TaskAutomation[]
  company     Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  templates   TaskTemplate[]
  tasks       Task[]

  @@unique([companyId, name])
  @@index([companyId, isActive])
  @@map("task_categories")
}

model TaskTemplate {
  id                String        @id @default(uuid())
  companyId         String        @map("company_id")
  name              String
  nameEn            String?       @map("name_en")
  description       String?
  categoryId        String?       @map("category_id")
  defaultPriority   TaskPriority  @default(MEDIUM) @map("default_priority")
  defaultDueDays    Int?          @map("default_due_days")
  checklistTemplate Json?         @map("checklist_template")
  workflowType      String?       @map("workflow_type")
  isActive          Boolean       @default(true) @map("is_active")
  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")
  category          TaskCategory? @relation(fields: [categoryId], references: [id])
  company           Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tasks             Task[]

  @@unique([companyId, name])
  @@index([companyId, isActive])
  @@map("task_templates")
}

model Sprint {
  id              String       @id @default(uuid())
  companyId       String       @map("company_id")
  name            String
  goal            String?
  description     String?
  status          SprintStatus @default(PLANNING)
  startDate       DateTime?    @map("start_date")
  endDate         DateTime?    @map("end_date")
  startedAt       DateTime?    @map("started_at")
  completedAt     DateTime?    @map("completed_at")
  plannedPoints   Int          @default(0) @map("planned_points")
  completedPoints Int          @default(0) @map("completed_points")
  velocity        Float?
  createdById     String       @map("created_by_id")
  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")
  company         Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy       User         @relation("SprintCreator", fields: [createdById], references: [id])
  tasks           Task[]       @relation("SprintTasks")

  @@index([companyId, status])
  @@index([companyId, startDate])
  @@map("sprints")
}

model Task {
  id                String              @id @default(uuid())
  companyId         String              @map("company_id")
  title             String
  description       String?
  status            TaskStatus          @default(TODO)
  priority          TaskPriority        @default(MEDIUM)
  categoryId        String?             @map("category_id")
  templateId        String?             @map("template_id")
  dueDate           DateTime?           @map("due_date")
  startDate         DateTime?           @map("start_date")
  completedAt       DateTime?           @map("completed_at")
  createdById       String              @map("created_by_id")
  assigneeId        String?             @map("assignee_id")
  recurrenceType    TaskRecurrenceType? @map("recurrence_type")
  recurrenceEnd     DateTime?           @map("recurrence_end")
  parentTaskId      String?             @map("parent_task_id")
  progress          Int                 @default(0)
  tags              String[]            @default([])
  customFields      Json?               @map("custom_fields")
  order             Int                 @default(0)
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")
  approvedAt        DateTime?           @map("approved_at")
  approverId        String?             @map("approver_id")
  escalatedAt       DateTime?           @map("escalated_at")
  isEscalated       Boolean             @default(false) @map("is_escalated")
  rejectedAt        DateTime?           @map("rejected_at")
  rejectionReason   String?             @map("rejection_reason")
  reviewRequestedAt DateTime?           @map("review_requested_at")
  reviewedAt        DateTime?           @map("reviewed_at")
  reviewerId        String?             @map("reviewer_id")
  slaHours          Int?                @map("sla_hours")
  estimatedHours    Float?              @map("estimated_hours")
  projectId         String?             @map("project_id")
  sprintId          String?             @map("sprint_id")
  storyPoints       Int?                @map("story_points")
  activities        TaskActivityLog[]
  approvals         TaskApproval[]
  assignments       TaskAssignment[]
  attachments       TaskAttachment[]
  checklists        TaskChecklist[]
  comments          TaskComment[]
  blockedBy         TaskDependency[]    @relation("BlockedTask")
  blocks            TaskDependency[]    @relation("BlockingTask")
  evidences         TaskEvidence[]
  timeLogs          TaskTimeLog[]
  watchers          TaskWatcher[]
  approver          User?               @relation("TaskApprover", fields: [approverId], references: [id])
  assignee          User?               @relation("TaskAssignee", fields: [assigneeId], references: [id])
  category          TaskCategory?       @relation(fields: [categoryId], references: [id])
  company           Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy         User                @relation("TaskCreator", fields: [createdById], references: [id])
  parentTask        Task?               @relation("RecurringTasks", fields: [parentTaskId], references: [id])
  childTasks        Task[]              @relation("RecurringTasks")
  project           Project?            @relation("ProjectTasks", fields: [projectId], references: [id])
  reviewer          User?               @relation("TaskReviewer", fields: [reviewerId], references: [id])
  sprint            Sprint?             @relation("SprintTasks", fields: [sprintId], references: [id])
  template          TaskTemplate?       @relation(fields: [templateId], references: [id])

  @@index([companyId, status])
  @@index([companyId, assigneeId])
  @@index([companyId, dueDate])
  @@index([companyId, categoryId])
  @@index([companyId, createdById])
  @@index([companyId, sprintId])
  @@map("tasks")
}

model TaskAssignment {
  id           String   @id @default(uuid())
  taskId       String   @map("task_id")
  userId       String   @map("user_id")
  assignedAt   DateTime @default(now()) @map("assigned_at")
  assignedById String?  @map("assigned_by_id")
  task         Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user         User     @relation("TaskAssignments", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([taskId, userId])
  @@map("task_assignments")
}

model TaskApproval {
  id        String             @id @default(uuid())
  taskId    String             @map("task_id")
  userId    String             @map("user_id")
  action    TaskApprovalAction
  comment   String?
  createdAt DateTime           @default(now()) @map("created_at")
  task      Task               @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user      User               @relation("TaskApprovalBy", fields: [userId], references: [id])

  @@index([taskId])
  @@index([userId])
  @@map("task_approvals")
}

model TaskEvidence {
  id                  String             @id @default(uuid())
  taskId              String             @map("task_id")
  submittedById       String             @map("submitted_by_id")
  description         String?
  fileUrl             String?            @map("file_url")
  fileName            String?            @map("file_name")
  fileType            String?            @map("file_type")
  fileSize            Int?               @map("file_size")
  latitude            Float?
  longitude           Float?
  locationName        String?            @map("location_name")
  status              TaskEvidenceStatus @default(PENDING)
  verifiedById        String?            @map("verified_by_id")
  verifiedAt          DateTime?          @map("verified_at")
  verificationComment String?            @map("verification_comment")
  createdAt           DateTime           @default(now()) @map("created_at")
  submittedBy         User               @relation("TaskEvidenceSubmitter", fields: [submittedById], references: [id])
  task                Task               @relation(fields: [taskId], references: [id], onDelete: Cascade)
  verifiedBy          User?              @relation("TaskEvidenceVerifier", fields: [verifiedById], references: [id])

  @@index([taskId])
  @@index([submittedById])
  @@map("task_evidences")
}

model TaskWatcher {
  id            String   @id @default(uuid())
  taskId        String   @map("task_id")
  userId        String   @map("user_id")
  watchingSince DateTime @default(now()) @map("watching_since")
  task          Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user          User     @relation("TaskWatchers", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([taskId, userId])
  @@map("task_watchers")
}

model TaskChecklist {
  id        String              @id @default(uuid())
  taskId    String              @map("task_id")
  title     String
  order     Int                 @default(0)
  createdAt DateTime            @default(now()) @map("created_at")
  updatedAt DateTime            @updatedAt @map("updated_at")
  items     TaskChecklistItem[]
  task      Task                @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@map("task_checklists")
}

model TaskChecklistItem {
  id            String        @id @default(uuid())
  checklistId   String        @map("checklist_id")
  content       String
  isCompleted   Boolean       @default(false) @map("is_completed")
  order         Int           @default(0)
  completedAt   DateTime?     @map("completed_at")
  completedById String?       @map("completed_by_id")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  checklist     TaskChecklist @relation(fields: [checklistId], references: [id], onDelete: Cascade)

  @@index([checklistId])
  @@map("task_checklist_items")
}

model TaskComment {
  id        String            @id @default(uuid())
  taskId    String            @map("task_id")
  authorId  String            @map("author_id")
  content   String
  mentions  String[]          @default([])
  isEdited  Boolean           @default(false) @map("is_edited")
  editedAt  DateTime?         @map("edited_at")
  createdAt DateTime          @default(now()) @map("created_at")
  updatedAt DateTime          @updatedAt @map("updated_at")
  parentId  String?           @map("parent_id")
  reactions CommentReaction[]
  author    User              @relation("TaskCommentAuthor", fields: [authorId], references: [id])
  parent    TaskComment?      @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies   TaskComment[]     @relation("CommentReplies")
  task      Task              @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@index([authorId])
  @@index([parentId])
  @@map("task_comments")
}

model CommentReaction {
  id        String      @id @default(uuid())
  commentId String      @map("comment_id")
  userId    String      @map("user_id")
  emoji     String
  createdAt DateTime    @default(now()) @map("created_at")
  comment   TaskComment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  user      User        @relation("CommentReactions", fields: [userId], references: [id])

  @@unique([commentId, userId, emoji])
  @@index([commentId])
  @@map("comment_reactions")
}

model TaskAttachment {
  id           String   @id @default(uuid())
  taskId       String   @map("task_id")
  uploadedById String   @map("uploaded_by_id")
  fileName     String   @map("file_name")
  fileSize     Int      @map("file_size")
  mimeType     String   @map("mime_type")
  storagePath  String   @map("storage_path")
  createdAt    DateTime @default(now()) @map("created_at")
  task         Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  uploadedBy   User     @relation("TaskAttachmentUploader", fields: [uploadedById], references: [id])

  @@index([taskId])
  @@map("task_attachments")
}

model TaskTimeLog {
  id          String    @id @default(uuid())
  taskId      String    @map("task_id")
  userId      String    @map("user_id")
  startTime   DateTime  @map("start_time")
  endTime     DateTime? @map("end_time")
  duration    Int?
  description String?
  isBillable  Boolean   @default(false) @map("is_billable")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  task        Task      @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user        User      @relation("TaskTimeLogs", fields: [userId], references: [id])

  @@index([taskId])
  @@index([userId])
  @@map("task_time_logs")
}

model TaskDependency {
  id             String         @id @default(uuid())
  blockedTaskId  String         @map("blocked_task_id")
  blockingTaskId String         @map("blocking_task_id")
  createdAt      DateTime       @default(now()) @map("created_at")
  type           DependencyType @default(BLOCKS)
  blockedTask    Task           @relation("BlockedTask", fields: [blockedTaskId], references: [id], onDelete: Cascade)
  blockingTask   Task           @relation("BlockingTask", fields: [blockingTaskId], references: [id], onDelete: Cascade)

  @@unique([blockedTaskId, blockingTaskId])
  @@map("task_dependencies")
}

model TaskActivityLog {
  id          String   @id @default(uuid())
  taskId      String   @map("task_id")
  userId      String   @map("user_id")
  action      String
  oldValue    String?  @map("old_value")
  newValue    String?  @map("new_value")
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  task        Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user        User     @relation("TaskActivityLogs", fields: [userId], references: [id])

  @@index([taskId])
  @@index([userId])
  @@map("task_activity_logs")
}

model TaskAutomation {
  id            String            @id @default(uuid())
  companyId     String            @map("company_id")
  createdById   String            @map("created_by_id")
  name          String
  description   String?
  isActive      Boolean           @default(true) @map("is_active")
  trigger       AutomationTrigger
  triggerConfig Json?             @map("trigger_config")
  action        AutomationAction
  actionConfig  Json?             @map("action_config")
  categoryId    String?           @map("category_id")
  priority      TaskPriority?
  lastRunAt     DateTime?         @map("last_run_at")
  runCount      Int               @default(0) @map("run_count")
  createdAt     DateTime          @default(now()) @map("created_at")
  updatedAt     DateTime          @updatedAt @map("updated_at")
  logs          AutomationLog[]
  category      TaskCategory?     @relation(fields: [categoryId], references: [id])
  company       Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy     User              @relation("TaskAutomationCreator", fields: [createdById], references: [id])

  @@index([companyId])
  @@index([isActive])
  @@map("task_automations")
}

model AutomationLog {
  id           String         @id @default(uuid())
  automationId String         @map("automation_id")
  taskId       String         @map("task_id")
  trigger      String
  action       String
  success      Boolean        @default(true)
  error        String?
  executedAt   DateTime       @default(now()) @map("executed_at")
  automation   TaskAutomation @relation(fields: [automationId], references: [id], onDelete: Cascade)

  @@index([automationId])
  @@index([taskId])
  @@map("automation_logs")
}

model PerformanceReviewCycle {
  id                      String                       @id @default(uuid())
  companyId               String                       @map("company_id")
  name                    String
  nameEn                  String?                      @map("name_en")
  type                    PerformanceReviewCycleType   @default(ANNUAL)
  status                  PerformanceReviewCycleStatus @default(DRAFT)
  periodStart             DateTime                     @map("period_start") @db.Date
  periodEnd               DateTime                     @map("period_end") @db.Date
  selfReviewStart         DateTime?                    @map("self_review_start")
  selfReviewEnd           DateTime?                    @map("self_review_end")
  managerReviewStart      DateTime?                    @map("manager_review_start")
  managerReviewEnd        DateTime?                    @map("manager_review_end")
  feedbackStart           DateTime?                    @map("feedback_start")
  feedbackEnd             DateTime?                    @map("feedback_end")
  calibrationStart        DateTime?                    @map("calibration_start")
  calibrationEnd          DateTime?                    @map("calibration_end")
  includeSelfReview       Boolean                      @default(true) @map("include_self_review")
  include360Feedback      Boolean                      @default(false) @map("include_360_feedback")
  includeGoalRating       Boolean                      @default(true) @map("include_goal_rating")
  includeCompetencyRating Boolean                      @default(true) @map("include_competency_rating")
  goalWeight              Int                          @default(40) @map("goal_weight")
  competencyWeight        Int                          @default(40) @map("competency_weight")
  valueWeight             Int                          @default(20) @map("value_weight")
  competencyFrameworkId   String?                      @map("competency_framework_id")
  createdAt               DateTime                     @default(now()) @map("created_at")
  updatedAt               DateTime                     @updatedAt @map("updated_at")
  CalibrationSession      CalibrationSession[]
  ConductFlag             ConductFlag[]
  FinalResult             FinalResult[]
  KPIAssignment           KPIAssignment[]
  company                 Company                      @relation(fields: [companyId], references: [id])
  reviews                 PerformanceReview[]
  UPEE360Request          UPEE360Request[]

  @@index([companyId, status])
  @@map("performance_review_cycles")
}

model PerformanceReview {
  id                     String                  @id @default(uuid())
  companyId              String                  @map("company_id")
  cycleId                String                  @map("cycle_id")
  employeeId             String                  @map("employee_id")
  managerId              String                  @map("manager_id")
  status                 PerformanceReviewStatus @default(NOT_STARTED)
  selfRating             Decimal?                @map("self_rating") @db.Decimal(3, 2)
  selfComments           String?                 @map("self_comments")
  selfAchievements       Json?                   @map("self_achievements")
  selfChallenges         Json?                   @map("self_challenges")
  selfSubmittedAt        DateTime?               @map("self_submitted_at")
  managerRating          Decimal?                @map("manager_rating") @db.Decimal(3, 2)
  managerComments        String?                 @map("manager_comments")
  managerStrengths       Json?                   @map("manager_strengths")
  managerImprovements    Json?                   @map("manager_improvements")
  managerSubmittedAt     DateTime?               @map("manager_submitted_at")
  finalRating            Decimal?                @map("final_rating") @db.Decimal(3, 2)
  finalComments          String?                 @map("final_comments")
  calibrationNotes       String?                 @map("calibration_notes")
  calibratedBy           String?                 @map("calibrated_by")
  calibratedAt           DateTime?               @map("calibrated_at")
  performanceScore       Int?                    @map("performance_score")
  potentialScore         Int?                    @map("potential_score")
  nineBoxPosition        String?                 @map("nine_box_position")
  employeeAcknowledged   Boolean                 @default(false) @map("employee_acknowledged")
  employeeAcknowledgedAt DateTime?               @map("employee_acknowledged_at")
  employeeDisagreed      Boolean                 @default(false) @map("employee_disagreed")
  employeeDisagreeReason String?                 @map("employee_disagree_reason")
  aiSummary              String?                 @map("ai_summary")
  aiBiasFlags            Json?                   @map("ai_bias_flags")
  aiRecommendations      Json?                   @map("ai_recommendations")
  createdAt              DateTime                @default(now()) @map("created_at")
  updatedAt              DateTime                @updatedAt @map("updated_at")
  competencyRatings      CompetencyRating[]
  developmentPlan        DevelopmentPlan?
  feedbackRequests       FeedbackRequest[]
  goalRatings            GoalRating[]
  cycle                  PerformanceReviewCycle  @relation(fields: [cycleId], references: [id])

  @@unique([cycleId, employeeId])
  @@index([companyId, status])
  @@index([employeeId])
  @@index([managerId])
  @@map("performance_reviews")
}

model Goal {
  id                   String          @id @default(uuid())
  companyId            String          @map("company_id")
  ownerId              String          @map("owner_id")
  managerId            String?         @map("manager_id")
  type                 GoalType        @default(INDIVIDUAL)
  status               GoalStatus      @default(DRAFT)
  title                String
  titleEn              String?         @map("title_en")
  description          String?
  startDate            DateTime?       @map("start_date") @db.Date
  dueDate              DateTime?       @map("due_date") @db.Date
  completedAt          DateTime?       @map("completed_at")
  targetValue          Decimal?        @map("target_value") @db.Decimal(10, 2)
  currentValue         Decimal?        @map("current_value") @db.Decimal(10, 2)
  unit                 String?
  progress             Int             @default(0)
  weight               Int             @default(100) @map("weight")
  category             String?
  isStretch            Boolean         @default(false) @map("is_stretch")
  parentGoalId         String?         @map("parent_goal_id")
  alignedCompanyGoalId String?         @map("aligned_company_goal_id")
  approvedBy           String?         @map("approved_by")
  approvedAt           DateTime?       @map("approved_at")
  rejectionReason      String?         @map("rejection_reason")
  aiGenerated          Boolean         @default(false) @map("ai_generated")
  aiPrompt             String?         @map("ai_prompt")
  createdAt            DateTime        @default(now()) @map("created_at")
  updatedAt            DateTime        @updatedAt @map("updated_at")
  autoCalculated       Boolean         @default(false) @map("auto_calculated")
  dataSource           GoalDataSource? @map("data_source")
  dataSourceConfig     Json?           @map("data_source_config")
  lastSyncAt           DateTime?       @map("last_sync_at")
  checkIns             GoalCheckIn[]
  ratings              GoalRating[]
  company              Company         @relation(fields: [companyId], references: [id])
  parentGoal           Goal?           @relation("GoalHierarchy", fields: [parentGoalId], references: [id])
  childGoals           Goal[]          @relation("GoalHierarchy")
  keyResults           KeyResult[]

  @@index([companyId, ownerId])
  @@index([companyId, status])
  @@index([type])
  @@index([dataSource])
  @@map("goals")
}

model KeyResult {
  id           String             @id @default(uuid())
  goalId       String             @map("goal_id")
  title        String
  description  String?
  targetValue  Decimal            @map("target_value") @db.Decimal(10, 2)
  currentValue Decimal            @default(0) @map("current_value") @db.Decimal(10, 2)
  unit         String             @default("%")
  progress     Int                @default(0)
  dueDate      DateTime?          @map("due_date") @db.Date
  createdAt    DateTime           @default(now()) @map("created_at")
  updatedAt    DateTime           @updatedAt @map("updated_at")
  checkIns     KeyResultCheckIn[]
  goal         Goal               @relation(fields: [goalId], references: [id], onDelete: Cascade)

  @@index([goalId])
  @@map("key_results")
}

model GoalCheckIn {
  id            String   @id @default(uuid())
  goalId        String   @map("goal_id")
  userId        String   @map("user_id")
  previousValue Decimal  @map("previous_value") @db.Decimal(10, 2)
  newValue      Decimal  @map("new_value") @db.Decimal(10, 2)
  statusUpdate  String?  @map("status_update")
  blockers      String?
  nextSteps     String?  @map("next_steps")
  confidence    Int?
  createdAt     DateTime @default(now()) @map("created_at")
  goal          Goal     @relation(fields: [goalId], references: [id], onDelete: Cascade)

  @@index([goalId])
  @@map("goal_check_ins")
}

model KeyResultCheckIn {
  id            String    @id @default(uuid())
  keyResultId   String    @map("key_result_id")
  userId        String    @map("user_id")
  previousValue Decimal   @map("previous_value") @db.Decimal(10, 2)
  newValue      Decimal   @map("new_value") @db.Decimal(10, 2)
  notes         String?
  createdAt     DateTime  @default(now()) @map("created_at")
  keyResult     KeyResult @relation(fields: [keyResultId], references: [id], onDelete: Cascade)

  @@index([keyResultId])
  @@map("key_result_check_ins")
}

model GoalRating {
  id              String            @id @default(uuid())
  reviewId        String            @map("review_id")
  goalId          String            @map("goal_id")
  selfRating      Decimal?          @map("self_rating") @db.Decimal(3, 2)
  selfComments    String?           @map("self_comments")
  managerRating   Decimal?          @map("manager_rating") @db.Decimal(3, 2)
  managerComments String?           @map("manager_comments")
  finalRating     Decimal?          @map("final_rating") @db.Decimal(3, 2)
  weight          Int               @default(100)
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  goal            Goal              @relation(fields: [goalId], references: [id])
  review          PerformanceReview @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@unique([reviewId, goalId])
  @@map("goal_ratings")
}

model CompetencyFramework {
  id           String       @id @default(uuid())
  companyId    String       @map("company_id")
  name         String
  nameEn       String?      @map("name_en")
  description  String?
  isActive     Boolean      @default(true) @map("is_active")
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")
  competencies Competency[]
  company      Company      @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("competency_frameworks")
}

model Competency {
  id               String              @id @default(uuid())
  frameworkId      String              @map("framework_id")
  name             String
  nameEn           String?             @map("name_en")
  description      String?
  category         CompetencyCategory  @default(CORE)
  level1Desc       String?             @map("level_1_desc")
  level2Desc       String?             @map("level_2_desc")
  level3Desc       String?             @map("level_3_desc")
  level4Desc       String?             @map("level_4_desc")
  level5Desc       String?             @map("level_5_desc")
  behaviorExamples Json?               @map("behavior_examples")
  isActive         Boolean             @default(true) @map("is_active")
  sortOrder        Int                 @default(0) @map("sort_order")
  createdAt        DateTime            @default(now()) @map("created_at")
  updatedAt        DateTime            @updatedAt @map("updated_at")
  framework        CompetencyFramework @relation(fields: [frameworkId], references: [id], onDelete: Cascade)
  ratings          CompetencyRating[]

  @@index([frameworkId, category])
  @@map("competencies")
}

model CompetencyRating {
  id              String            @id @default(uuid())
  reviewId        String            @map("review_id")
  competencyId    String            @map("competency_id")
  selfRating      Int?              @map("self_rating")
  selfComments    String?           @map("self_comments")
  selfEvidence    Json?             @map("self_evidence")
  managerRating   Int?              @map("manager_rating")
  managerComments String?           @map("manager_comments")
  finalRating     Int?              @map("final_rating")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  competency      Competency        @relation(fields: [competencyId], references: [id])
  review          PerformanceReview @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@unique([reviewId, competencyId])
  @@map("competency_ratings")
}

model FeedbackRequest {
  id               String                @id @default(uuid())
  reviewId         String                @map("review_id")
  requestorId      String                @map("requestor_id")
  providerId       String                @map("provider_id")
  relationshipType String                @map("relationship_type")
  status           FeedbackRequestStatus @default(PENDING)
  isAnonymous      Boolean               @default(true) @map("is_anonymous")
  dueDate          DateTime?             @map("due_date")
  submittedAt      DateTime?             @map("submitted_at")
  createdAt        DateTime              @default(now()) @map("created_at")
  updatedAt        DateTime              @updatedAt @map("updated_at")
  review           PerformanceReview     @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  responses        FeedbackResponse[]

  @@index([reviewId])
  @@index([providerId, status])
  @@map("feedback_requests")
}

model FeedbackResponse {
  id             String          @id @default(uuid())
  requestId      String          @map("request_id")
  questionId     String?         @map("question_id")
  questionText   String          @map("question_text")
  rating         Int?
  comment        String?
  sentimentScore Decimal?        @map("sentiment_score") @db.Decimal(3, 2)
  themes         Json?
  createdAt      DateTime        @default(now()) @map("created_at")
  request        FeedbackRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)

  @@index([requestId])
  @@map("feedback_responses")
}

model Recognition {
  id            String                @id @default(uuid())
  companyId     String                @map("company_id")
  giverId       String                @map("giver_id")
  receiverId    String                @map("receiver_id")
  type          RecognitionType       @default(KUDOS)
  message       String
  coreValueId   String?               @map("core_value_id")
  pointsAwarded Int                   @default(0) @map("points_awarded")
  monetaryValue Decimal?              @map("monetary_value") @db.Decimal(10, 2)
  isPublic      Boolean               @default(true) @map("is_public")
  createdAt     DateTime              @default(now()) @map("created_at")
  reactions     RecognitionReaction[]
  company       Company               @relation(fields: [companyId], references: [id])

  @@index([companyId, createdAt])
  @@index([receiverId])
  @@index([giverId])
  @@map("recognitions")
}

model CoreValue {
  id          String   @id @default(uuid())
  companyId   String   @map("company_id")
  name        String
  nameEn      String?  @map("name_en")
  description String?
  icon        String?
  color       String?
  isActive    Boolean  @default(true) @map("is_active")
  sortOrder   Int      @default(0) @map("sort_order")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  company     Company  @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("core_values")
}

model RecognitionReaction {
  id            String      @id @default(uuid())
  recognitionId String      @map("recognition_id")
  userId        String      @map("user_id")
  emoji         String
  createdAt     DateTime    @default(now()) @map("created_at")
  recognition   Recognition @relation(fields: [recognitionId], references: [id], onDelete: Cascade)

  @@unique([recognitionId, userId, emoji])
  @@map("recognition_reactions")
}

model DevelopmentPlan {
  id                 String             @id @default(uuid())
  companyId          String             @map("company_id")
  employeeId         String             @map("employee_id")
  reviewId           String?            @unique @map("review_id")
  year               Int
  aiStrengthsSummary String?            @map("ai_strengths_summary")
  aiGapAnalysis      String?            @map("ai_gap_analysis")
  aiRecommendations  Json?              @map("ai_recommendations")
  createdAt          DateTime           @default(now()) @map("created_at")
  updatedAt          DateTime           @updatedAt @map("updated_at")
  goals              DevelopmentGoal[]
  company            Company            @relation(fields: [companyId], references: [id])
  review             PerformanceReview? @relation(fields: [reviewId], references: [id])

  @@unique([employeeId, year])
  @@index([companyId, employeeId])
  @@map("development_plans")
}

model DevelopmentGoal {
  id          String                @id @default(uuid())
  planId      String                @map("plan_id")
  category    String
  description String
  targetDate  DateTime?             @map("target_date") @db.Date
  status      DevelopmentGoalStatus @default(NOT_STARTED)
  actions     Json?
  progress    Int                   @default(0)
  completedAt DateTime?             @map("completed_at")
  notes       String?
  createdAt   DateTime              @default(now()) @map("created_at")
  updatedAt   DateTime              @updatedAt @map("updated_at")
  plan        DevelopmentPlan       @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@index([planId])
  @@map("development_goals")
}

model CareerPath {
  id          String            @id @default(uuid())
  companyId   String            @map("company_id")
  name        String
  nameEn      String?           @map("name_en")
  description String?
  isActive    Boolean           @default(true) @map("is_active")
  createdAt   DateTime          @default(now()) @map("created_at")
  updatedAt   DateTime          @updatedAt @map("updated_at")
  levels      CareerPathLevel[]
  company     Company           @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("career_paths")
}

model CareerPathLevel {
  id                   String     @id @default(uuid())
  pathId               String     @map("path_id")
  level                Int
  title                String
  titleEn              String?    @map("title_en")
  minExperienceYears   Int?       @map("min_experience_years")
  requiredSkills       Json?      @map("required_skills")
  requiredCompetencies Json?      @map("required_competencies")
  salaryRangeMin       Decimal?   @map("salary_range_min") @db.Decimal(10, 2)
  salaryRangeMax       Decimal?   @map("salary_range_max") @db.Decimal(10, 2)
  createdAt            DateTime   @default(now()) @map("created_at")
  updatedAt            DateTime   @updatedAt @map("updated_at")
  path                 CareerPath @relation(fields: [pathId], references: [id], onDelete: Cascade)

  @@unique([pathId, level])
  @@map("career_path_levels")
}

model SuccessionPlan {
  id         String                @id @default(uuid())
  companyId  String                @map("company_id")
  positionId String                @map("position_id")
  targetYear Int                   @map("target_year")
  createdAt  DateTime              @default(now()) @map("created_at")
  updatedAt  DateTime              @updatedAt @map("updated_at")
  candidates SuccessionCandidate[]
  company    Company               @relation(fields: [companyId], references: [id])

  @@unique([positionId, targetYear])
  @@map("succession_plans")
}

model SuccessionCandidate {
  id                 String         @id @default(uuid())
  planId             String         @map("plan_id")
  employeeId         String         @map("employee_id")
  readinessLevel     String         @map("readiness_level")
  riskOfLeaving      String?        @map("risk_of_leaving")
  developmentActions Json?          @map("development_actions")
  notes              String?
  createdAt          DateTime       @default(now()) @map("created_at")
  updatedAt          DateTime       @updatedAt @map("updated_at")
  plan               SuccessionPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@unique([planId, employeeId])
  @@map("succession_candidates")
}

model CompanyConfig {
  id             String         @id @default(uuid())
  companyId      String         @unique @map("company_id")
  companyType    CompanyType    @default(HYBRID) @map("company_type")
  philosophy     EvalPhilosophy @default(BALANCED)
  enabledModules Json           @default("{}") @map("enabled_modules")
  defaultWeights Json           @default("{}") @map("default_weights")
  policies       Json           @default("{}") @map("policies")
  uiConfig       Json           @default("{}") @map("ui_config")
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt @map("updated_at")
  company        Company        @relation(fields: [companyId], references: [id])

  @@map("company_configs")
}

model JobFamily {
  id                String          @id @default(uuid())
  companyId         String          @map("company_id")
  code              String
  name              String
  nameAr            String?         @map("name_ar")
  moduleOverrides   Json?           @map("module_overrides")
  evidenceTypes     Json?           @map("evidence_types")
  competencyModelId String?         @map("competency_model_id")
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @updatedAt @map("updated_at")
  company           Company         @relation(fields: [companyId], references: [id])
  kpiDefinitions    KPIDefinition[]
  roleLevels        RoleLevel[]
  users             User[]

  @@unique([companyId, code])
  @@index([companyId])
  @@map("job_families")
}

model RoleLevel {
  id                  String    @id @default(uuid())
  jobFamilyId         String    @map("job_family_id")
  code                String
  name                String
  nameAr              String?   @map("name_ar")
  rank                Int
  isManager           Boolean   @default(false) @map("is_manager")
  weightOverrides     Json?     @map("weight_overrides")
  minEvidenceRequired Int?      @map("min_evidence_required")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  jobFamily           JobFamily @relation(fields: [jobFamilyId], references: [id], onDelete: Cascade)
  users               User[]

  @@unique([jobFamilyId, code])
  @@map("role_levels")
}

model EvaluationTemplate {
  id          String      @id @default(uuid())
  companyId   String?     @map("company_id")
  code        String      @unique
  companyType CompanyType @map("company_type")
  name        String
  nameAr      String?     @map("name_ar")
  version     Int         @default(1)
  modules     Json
  weights     Json
  policies    Json
  uiConfig    Json        @map("ui_config")
  isActive    Boolean     @default(true) @map("is_active")
  isDefault   Boolean     @default(false) @map("is_default")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  @@map("evaluation_templates")
}

model KPIDefinition {
  id          String          @id @default(uuid())
  companyId   String          @map("company_id")
  jobFamilyId String?         @map("job_family_id")
  code        String
  name        String
  nameAr      String?         @map("name_ar")
  description String?
  unit        String
  formula     Json?
  thresholds  Json
  sourceType  KPISourceType   @default(MANUAL) @map("source_type")
  frequency   KPIFrequency    @default(MONTHLY)
  isActive    Boolean         @default(true) @map("is_active")
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")
  assignments KPIAssignment[]
  company     Company         @relation(fields: [companyId], references: [id])
  jobFamily   JobFamily?      @relation(fields: [jobFamilyId], references: [id])

  @@unique([companyId, code])
  @@index([companyId])
  @@index([jobFamilyId])
  @@map("kpi_definitions")
}

model KPIAssignment {
  id              String                 @id @default(uuid())
  cycleId         String                 @map("cycle_id")
  employeeId      String                 @map("employee_id")
  kpiDefinitionId String                 @map("kpi_definition_id")
  target          Decimal                @db.Decimal(15, 2)
  weight          Int                    @default(100)
  createdAt       DateTime               @default(now()) @map("created_at")
  updatedAt       DateTime               @updatedAt @map("updated_at")
  actualValue     Decimal?               @map("actual_value") @db.Decimal(10, 2)
  notes           String?
  score           Decimal?               @db.Decimal(5, 2)
  cycle           PerformanceReviewCycle @relation(fields: [cycleId], references: [id])
  employee        User                   @relation("KPIAssignmentEmployee", fields: [employeeId], references: [id])
  kpiDefinition   KPIDefinition          @relation(fields: [kpiDefinitionId], references: [id])
  entries         KPIEntry[]

  @@unique([cycleId, employeeId, kpiDefinitionId])
  @@index([cycleId, employeeId])
  @@index([employeeId])
  @@map("kpi_assignments")
}

model KPIEntry {
  id           String        @id @default(uuid())
  assignmentId String        @map("assignment_id")
  periodStart  DateTime      @map("period_start")
  periodEnd    DateTime      @map("period_end")
  value        Decimal       @db.Decimal(15, 2)
  source       String?
  createdBy    String        @map("created_by")
  createdAt    DateTime      @default(now()) @map("created_at")
  notes        String?
  assignment   KPIAssignment @relation(fields: [assignmentId], references: [id], onDelete: Cascade)

  @@index([assignmentId])
  @@map("kpi_entries")
}

model PerformanceCompetencyModel {
  id           String                  @id @default(uuid())
  companyId    String                  @map("company_id")
  name         String
  nameAr       String?                 @map("name_ar")
  version      Int                     @default(1)
  isActive     Boolean                 @default(true) @map("is_active")
  createdAt    DateTime                @default(now()) @map("created_at")
  updatedAt    DateTime                @updatedAt @map("updated_at")
  competencies PerformanceCompetency[]
  company      Company                 @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@map("performance_competency_models")
}

model PerformanceCompetency {
  id          String                        @id @default(uuid())
  modelId     String                        @map("model_id")
  category    UPEECompetencyCategory
  name        String
  nameAr      String?                       @map("name_ar")
  description String?
  createdAt   DateTime                      @default(now()) @map("created_at")
  updatedAt   DateTime                      @updatedAt @map("updated_at")
  model       PerformanceCompetencyModel    @relation(fields: [modelId], references: [id], onDelete: Cascade)
  rubrics     PerformanceCompetencyRubric[]
  scores      PerformanceCompetencyScore[]

  @@index([modelId])
  @@map("performance_competencies")
}

model PerformanceCompetencyRubric {
  id           String                @id @default(uuid())
  competencyId String                @map("competency_id")
  level        Int
  behavior     String
  behaviorAr   String?               @map("behavior_ar")
  competency   PerformanceCompetency @relation(fields: [competencyId], references: [id], onDelete: Cascade)

  @@unique([competencyId, level])
  @@map("performance_competency_rubrics")
}

model PerformanceCompetencyScore {
  id            String                @id @default(uuid())
  cycleId       String                @map("cycle_id")
  employeeId    String                @map("employee_id")
  competencyId  String                @map("competency_id")
  rating        Int
  justification String?
  evidenceIds   Json?                 @map("evidence_ids")
  scoredBy      String
  createdAt     DateTime              @default(now()) @map("created_at")
  competency    PerformanceCompetency @relation(fields: [competencyId], references: [id])

  @@index([cycleId, employeeId])
  @@map("performance_competency_scores")
}

model FeedbackQuestionSet {
  id        String             @id @default(uuid())
  companyId String             @map("company_id")
  name      String
  nameAr    String?            @map("name_ar")
  version   Int                @default(1)
  isActive  Boolean            @default(true) @map("is_active")
  createdAt DateTime           @default(now()) @map("created_at")
  updatedAt DateTime           @updatedAt @map("updated_at")
  company   Company            @relation(fields: [companyId], references: [id])
  questions FeedbackQuestion[]

  @@index([companyId])
  @@map("feedback_question_sets")
}

model FeedbackQuestion {
  id       String               @id @default(uuid())
  setId    String               @map("set_id")
  text     String
  textAr   String?              @map("text_ar")
  type     FeedbackQuestionType
  required Boolean              @default(true)
  order    Int                  @default(0)
  set      FeedbackQuestionSet  @relation(fields: [setId], references: [id], onDelete: Cascade)
  answers  UPEEFeedbackAnswer[]

  @@index([setId])
  @@map("feedback_questions")
}

model UPEE360Request {
  id          String                 @id @default(uuid())
  cycleId     String                 @map("cycle_id")
  employeeId  String                 @map("employee_id")
  raterId     String                 @map("rater_id")
  raterType   FeedbackRaterType
  status      UPEE360Status          @default(UPEE_PENDING)
  anonymous   Boolean                @default(true)
  sentAt      DateTime?              @map("sent_at")
  completedAt DateTime?              @map("completed_at")
  createdAt   DateTime               @default(now()) @map("created_at")
  cycle       PerformanceReviewCycle @relation(fields: [cycleId], references: [id])
  answers     UPEEFeedbackAnswer[]

  @@unique([cycleId, employeeId, raterId])
  @@index([cycleId, employeeId])
  @@map("upee_360_requests")
}

model UPEEFeedbackAnswer {
  id         String           @id @default(uuid())
  requestId  String           @map("request_id")
  questionId String           @map("question_id")
  rating     Int?
  comment    String?
  createdAt  DateTime         @default(now()) @map("created_at")
  question   FeedbackQuestion @relation(fields: [questionId], references: [id])
  request    UPEE360Request   @relation(fields: [requestId], references: [id], onDelete: Cascade)

  @@unique([requestId, questionId])
  @@map("upee_feedback_answers")
}

model ConductFlag {
  id         String                 @id @default(uuid())
  cycleId    String                 @map("cycle_id")
  employeeId String                 @map("employee_id")
  type       String
  severity   ConductSeverity
  notes      String?
  createdBy  String                 @map("created_by")
  createdAt  DateTime               @default(now()) @map("created_at")
  cycle      PerformanceReviewCycle @relation(fields: [cycleId], references: [id])

  @@index([cycleId, employeeId])
  @@map("conduct_flags")
}

model PerformanceEvidence {
  id         String       @id @default(uuid())
  cycleId    String       @map("cycle_id")
  employeeId String       @map("employee_id")
  module     String
  entityId   String       @map("entity_id")
  type       EvidenceType
  url        String?
  fileId     String?      @map("file_id")
  notes      String?
  createdAt  DateTime     @default(now()) @map("created_at")

  @@index([cycleId, employeeId])
  @@map("performance_evidences")
}

model ModuleScore {
  id           String   @id @default(uuid())
  cycleId      String   @map("cycle_id")
  employeeId   String   @map("employee_id")
  module       String
  score        Decimal  @db.Decimal(5, 2)
  computedData Json     @map("computed_data")
  createdAt    DateTime @default(now()) @map("created_at")

  @@unique([cycleId, employeeId, module])
  @@index([cycleId, employeeId])
  @@map("module_scores")
}

model FinalResult {
  id                     String                  @id @default(uuid())
  cycleId                String                  @map("cycle_id")
  employeeId             String                  @map("employee_id")
  finalScore             Decimal                 @map("final_score") @db.Decimal(5, 2)
  ratingBand             RatingBand              @map("rating_band")
  status                 ResultStatus            @default(DRAFT)
  blueprintSnapshot      Json                    @map("blueprint_snapshot")
  createdAt              DateTime                @default(now()) @map("created_at")
  updatedAt              DateTime                @updatedAt @map("updated_at")
  calibrationAdjustments CalibrationAdjustment[]
  cycle                  PerformanceReviewCycle  @relation(fields: [cycleId], references: [id])

  @@unique([cycleId, employeeId])
  @@map("final_results")
}

model CalibrationSession {
  id          String                  @id @default(uuid())
  cycleId     String                  @map("cycle_id")
  name        String
  status      CalibrationStatus       @default(DRAFT)
  scheduledAt DateTime?               @map("scheduled_at")
  completedAt DateTime?               @map("completed_at")
  createdAt   DateTime                @default(now()) @map("created_at")
  updatedAt   DateTime                @updatedAt @map("updated_at")
  adjustments CalibrationAdjustment[]
  cycle       PerformanceReviewCycle  @relation(fields: [cycleId], references: [id])

  @@index([cycleId])
  @@map("calibration_sessions")
}

model CalibrationAdjustment {
  id         String             @id @default(uuid())
  sessionId  String             @map("session_id")
  resultId   String             @map("result_id")
  oldScore   Decimal            @map("old_score") @db.Decimal(5, 2)
  newScore   Decimal            @map("new_score") @db.Decimal(5, 2)
  oldBand    RatingBand         @map("old_band")
  newBand    RatingBand         @map("new_band")
  reason     String
  adjustedBy String             @map("adjusted_by")
  adjustedAt DateTime           @default(now()) @map("adjusted_at")
  result     FinalResult        @relation(fields: [resultId], references: [id])
  session    CalibrationSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@map("calibration_adjustments")
}

model IDPPlan {
  id            String    @id @default(uuid())
  cycleId       String    @map("cycle_id")
  employeeId    String    @map("employee_id")
  strengths     Json
  improvements  Json
  goals90Days   Json      @map("goals_90_days")
  learningTasks Json      @map("learning_tasks")
  mentorId      String?   @map("mentor_id")
  status        IDPStatus @default(ACTIVE)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@unique([cycleId, employeeId])
  @@map("idp_plans")
}

model PIPPlan {
  id            String      @id @default(uuid())
  cycleId       String      @map("cycle_id")
  employeeId    String      @map("employee_id")
  durationDays  Int         @map("duration_days")
  startDate     DateTime    @map("start_date")
  endDate       DateTime    @map("end_date")
  expectations  Json
  weeklyReviews Json        @map("weekly_reviews")
  status        PIPStatus   @default(ACTIVE)
  outcome       PIPOutcome?
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")

  @@unique([cycleId, employeeId])
  @@map("pip_plans")
}

model PerformanceAuditLog {
  id         String   @id @default(uuid())
  companyId  String   @map("company_id")
  actorId    String   @map("actor_id")
  action     String
  entity     String
  entityId   String   @map("entity_id")
  beforeData Json?    @map("before_data")
  afterData  Json?    @map("after_data")
  createdAt  DateTime @default(now()) @map("created_at")

  @@index([companyId, entity])
  @@index([actorId])
  @@map("performance_audit_logs")
}

model AiConversation {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  companyId String   @map("company_id")
  messages  Json     @default("[]")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  expiresAt DateTime @map("expires_at")
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, companyId])
  @@index([expiresAt])
  @@map("ai_conversations")
}

model Trip {
  id              String     @id @default(uuid())
  companyId       String     @map("company_id")
  driverId        String     @map("driver_id")
  tripDate        DateTime   @map("trip_date") @db.Date
  scheduledStart  DateTime   @map("scheduled_start")
  actualStart     DateTime?  @map("actual_start")
  scheduledEnd    DateTime?  @map("scheduled_end")
  actualEnd       DateTime?  @map("actual_end")
  distanceKm      Decimal    @default(0) @map("distance_km") @db.Decimal(10, 2)
  fuelConsumption Decimal    @default(0) @map("fuel_consumption") @db.Decimal(10, 2)
  delayMinutes    Int        @default(0) @map("delay_minutes")
  delayReason     String?    @map("delay_reason")
  status          TripStatus @default(PENDING)
  createdAt       DateTime   @default(now()) @map("created_at")
  updatedAt       DateTime   @updatedAt @map("updated_at")

  @@index([companyId, driverId])
  @@index([tripDate])
  @@map("logistics_trips")
}

model Delivery {
  id             String         @id @default(uuid())
  companyId      String         @map("company_id")
  driverId       String         @map("driver_id")
  deliveryDate   DateTime       @map("delivery_date") @db.Date
  scheduledTime  DateTime       @map("scheduled_time")
  actualTime     DateTime?      @map("actual_time")
  minutesEarly   Int            @default(0) @map("minutes_early")
  minutesLate    Int            @default(0) @map("minutes_late")
  customerRating Decimal?       @map("customer_rating") @db.Decimal(2, 1)
  status         DeliveryStatus @default(PENDING)
  failureReason  String?        @map("failure_reason")
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt @map("updated_at")

  @@index([companyId, driverId])
  @@index([deliveryDate])
  @@map("logistics_deliveries")
}

model InventoryCount {
  id            String   @id @default(uuid())
  companyId     String   @map("company_id")
  warehouseId   String?  @map("warehouse_id")
  conductedBy   String   @map("conducted_by")
  countDate     DateTime @map("count_date") @db.Date
  expectedItems Int      @map("expected_items")
  actualItems   Int      @map("actual_items")
  accuracyRate  Decimal  @map("accuracy_rate") @db.Decimal(5, 2)
  variance      Int      @default(0)
  damagedItems  Int      @default(0) @map("damaged_items")
  damageValue   Decimal  @default(0) @map("damage_value") @db.Decimal(10, 2)
  damageReason  String?  @map("damage_reason")
  notes         String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@index([companyId, countDate])
  @@map("logistics_inventory_counts")
}

model DriverPerformance {
  id                  String   @id @default(uuid())
  companyId           String   @map("company_id")
  driverId            String   @map("driver_id")
  month               Int
  year                Int
  totalTrips          Int      @default(0) @map("total_trips")
  onTimeTrips         Int      @default(0) @map("on_time_trips")
  onTimePercentage    Decimal  @default(0) @map("on_time_percentage") @db.Decimal(5, 2)
  completedDeliveries Int      @default(0) @map("completed_deliveries")
  failedDeliveries    Int      @default(0) @map("failed_deliveries")
  returnRate          Decimal  @default(0) @map("return_rate") @db.Decimal(5, 2)
  totalDistanceKm     Decimal  @default(0) @map("total_distance_km") @db.Decimal(10, 2)
  fuelEfficiency      Decimal  @default(0) @map("fuel_efficiency") @db.Decimal(5, 2)
  averageRating       Decimal  @default(0) @map("average_rating") @db.Decimal(2, 1)
  safetyScore         Int      @default(100) @map("safety_score")
  violationsCount     Int      @default(0) @map("violations_count")
  accidentFree        Boolean  @default(true) @map("accident_free")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  @@unique([companyId, driverId, month, year])
  @@index([companyId, month, year])
  @@map("logistics_driver_performance")
}

model SaudizationConfig {
  id                      String                  @id @default(uuid())
  companyId               String                  @unique @map("company_id")
  activityCode            String                  @map("activity_code")
  activityName            String                  @map("activity_name")
  activityNameAr          String                  @map("activity_name_ar")
  companySizeRange        String                  @map("company_size_range")
  requiredSaudiPercentage Decimal                 @map("required_saudi_percentage") @db.Decimal(5, 2)
  currentSaudiPercentage  Decimal                 @default(0) @map("current_saudi_percentage") @db.Decimal(5, 2)
  targetSaudiPercentage   Decimal                 @map("target_saudi_percentage") @db.Decimal(5, 2)
  platinumThreshold       Decimal                 @map("platinum_threshold") @db.Decimal(5, 2)
  greenHighThreshold      Decimal                 @map("green_high_threshold") @db.Decimal(5, 2)
  greenMidThreshold       Decimal                 @map("green_mid_threshold") @db.Decimal(5, 2)
  greenLowThreshold       Decimal                 @map("green_low_threshold") @db.Decimal(5, 2)
  yellowThreshold         Decimal                 @map("yellow_threshold") @db.Decimal(5, 2)
  currentZone             NitaqatZone             @default(YELLOW) @map("current_zone")
  previousZone            NitaqatZone?            @map("previous_zone")
  zoneChangedAt           DateTime?               @map("zone_changed_at")
  alertThreshold          Decimal                 @default(5) @map("alert_threshold") @db.Decimal(5, 2)
  autoCalculate           Boolean                 @default(true) @map("auto_calculate")
  calculationFrequency    String                  @default("DAILY") @map("calculation_frequency")
  lastCalculatedAt        DateTime?               @map("last_calculated_at")
  notes                   String?
  createdAt               DateTime                @default(now()) @map("created_at")
  updatedAt               DateTime                @updatedAt @map("updated_at")
  departmentSaudization   DepartmentSaudization[]
  nitaqatAlerts           NitaqatAlert[]
  company                 Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  saudizationRecords      SaudizationRecord[]
  saudizationTargets      SaudizationTarget[]

  @@map("saudization_configs")
}

model SaudizationRecord {
  id                   String            @id @default(uuid())
  companyId            String            @map("company_id")
  configId             String            @map("config_id")
  recordDate           DateTime          @map("record_date") @db.Date
  month                Int
  year                 Int
  totalEmployees       Int               @map("total_employees")
  saudiEmployees       Int               @map("saudi_employees")
  nonSaudiEmployees    Int               @map("non_saudi_employees")
  saudiMales           Int               @default(0) @map("saudi_males")
  saudiFemales         Int               @default(0) @map("saudi_females")
  nonSaudiMales        Int               @default(0) @map("non_saudi_males")
  nonSaudiFemales      Int               @default(0) @map("non_saudi_females")
  partTimeSaudis       Int               @default(0) @map("part_time_saudis")
  partTimeNonSaudis    Int               @default(0) @map("part_time_non_saudis")
  saudiStudents        Int               @default(0) @map("saudi_students")
  saudiTrainees        Int               @default(0) @map("saudi_trainees")
  disabledSaudis       Int               @default(0) @map("disabled_saudis")
  calculatedPercentage Decimal           @map("calculated_percentage") @db.Decimal(5, 2)
  weightedPercentage   Decimal           @map("weighted_percentage") @db.Decimal(5, 2)
  zone                 NitaqatZone       @map("zone")
  previousZone         NitaqatZone?      @map("previous_zone")
  zoneChanged          Boolean           @default(false) @map("zone_changed")
  status               SaudizationStatus @map("status")
  gapToTarget          Decimal           @map("gap_to_target") @db.Decimal(5, 2)
  gapToNextZone        Decimal           @map("gap_to_next_zone") @db.Decimal(5, 2)
  requiredHires        Int               @default(0) @map("required_hires")
  allowedExits         Int               @default(0) @map("allowed_exits")
  notes                String?
  createdAt            DateTime          @default(now()) @map("created_at")
  config               SaudizationConfig @relation(fields: [configId], references: [id], onDelete: Cascade)

  @@unique([companyId, recordDate])
  @@index([companyId, year, month])
  @@map("saudization_records")
}

model SaudizationTarget {
  id                   String            @id @default(uuid())
  companyId            String            @map("company_id")
  configId             String            @map("config_id")
  targetYear           Int               @map("target_year")
  targetQuarter        Int?              @map("target_quarter")
  targetMonth          Int?              @map("target_month")
  targetPercentage     Decimal           @map("target_percentage") @db.Decimal(5, 2)
  targetZone           NitaqatZone       @map("target_zone")
  plannedSaudiHires    Int               @default(0) @map("planned_saudi_hires")
  plannedNonSaudiExits Int               @default(0) @map("planned_non_saudi_exits")
  actualSaudiHires     Int               @default(0) @map("actual_saudi_hires")
  actualNonSaudiExits  Int               @default(0) @map("actual_non_saudi_exits")
  achievedPercentage   Decimal?          @map("achieved_percentage") @db.Decimal(5, 2)
  isAchieved           Boolean           @default(false) @map("is_achieved")
  achievedAt           DateTime?         @map("achieved_at")
  notes                String?
  createdAt            DateTime          @default(now()) @map("created_at")
  updatedAt            DateTime          @updatedAt @map("updated_at")
  config               SaudizationConfig @relation(fields: [configId], references: [id], onDelete: Cascade)

  @@unique([configId, targetYear, targetQuarter, targetMonth])
  @@index([companyId, targetYear])
  @@map("saudization_targets")
}

model DepartmentSaudization {
  id               String            @id @default(uuid())
  companyId        String            @map("company_id")
  configId         String            @map("config_id")
  departmentId     String            @map("department_id")
  totalEmployees   Int               @map("total_employees")
  saudiEmployees   Int               @map("saudi_employees")
  saudiPercentage  Decimal           @map("saudi_percentage") @db.Decimal(5, 2)
  targetPercentage Decimal           @map("target_percentage") @db.Decimal(5, 2)
  gapToTarget      Decimal           @map("gap_to_target") @db.Decimal(5, 2)
  recommendedHires Int               @default(0) @map("recommended_hires")
  priority         String            @default("MEDIUM") @map("priority")
  lastCalculatedAt DateTime          @map("last_calculated_at")
  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")
  config           SaudizationConfig @relation(fields: [configId], references: [id], onDelete: Cascade)
  department       Department        @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  @@unique([configId, departmentId])
  @@index([companyId, departmentId])
  @@map("department_saudization")
}

model NitaqatAlert {
  id               String            @id @default(uuid())
  companyId        String            @map("company_id")
  configId         String            @map("config_id")
  alertType        String            @map("alert_type")
  severity         String            @map("severity")
  title            String
  titleAr          String            @map("title_ar")
  message          String
  messageAr        String            @map("message_ar")
  currentValue     Decimal?          @map("current_value") @db.Decimal(5, 2)
  thresholdValue   Decimal?          @map("threshold_value") @db.Decimal(5, 2)
  fromZone         NitaqatZone?      @map("from_zone")
  toZone           NitaqatZone?      @map("to_zone")
  actionRequired   String?           @map("action_required")
  actionRequiredAr String?           @map("action_required_ar")
  deadline         DateTime?         @map("deadline")
  isRead           Boolean           @default(false) @map("is_read")
  readAt           DateTime?         @map("read_at")
  isResolved       Boolean           @default(false) @map("is_resolved")
  resolvedAt       DateTime?         @map("resolved_at")
  resolvedBy       String?           @map("resolved_by")
  resolutionNote   String?           @map("resolution_note")
  createdAt        DateTime          @default(now()) @map("created_at")
  config           SaudizationConfig @relation(fields: [configId], references: [id], onDelete: Cascade)

  @@index([companyId, isRead])
  @@index([companyId, severity])
  @@map("nitaqat_alerts")
}

model SaudizationRecommendation {
  id                 String       @id @default(uuid())
  companyId          String       @map("company_id")
  recommendationType String       @map("recommendation_type")
  title              String
  titleAr            String       @map("title_ar")
  description        String
  descriptionAr      String       @map("description_ar")
  impactOnPercentage Decimal      @map("impact_on_percentage") @db.Decimal(5, 2)
  impactOnZone       NitaqatZone? @map("impact_on_zone")
  estimatedCost      Decimal?     @map("estimated_cost") @db.Decimal(12, 2)
  estimatedTimeWeeks Int?         @map("estimated_time_weeks")
  priority           String       @map("priority")
  priorityScore      Int          @map("priority_score")
  targetDepartmentId String?      @map("target_department_id")
  suggestedJobTitles Json?        @map("suggested_job_titles")
  status             String       @default("PENDING") @map("status")
  implementedAt      DateTime?    @map("implemented_at")
  rejectedAt         DateTime?    @map("rejected_at")
  rejectionReason    String?      @map("rejection_reason")
  source             String       @default("AI") @map("source")
  createdAt          DateTime     @default(now()) @map("created_at")
  updatedAt          DateTime     @updatedAt @map("updated_at")

  @@index([companyId, status])
  @@index([companyId, priority])
  @@map("saudization_recommendations")
}

model ShiftTemplate {
  id                   String      @id @default(uuid())
  companyId            String      @map("company_id")
  name                 String
  nameAr               String      @map("name_ar")
  description          String?
  color                String?
  code                 String?
  shiftType            ShiftType   @default(REGULAR) @map("shift_type")
  defaultStartTime     String      @map("default_start_time")
  defaultEndTime       String      @map("default_end_time")
  defaultBreakMinutes  Int         @default(60) @map("default_break_minutes")
  workHours            Decimal     @map("work_hours") @db.Decimal(4, 2)
  isOvernight          Boolean     @default(false) @map("is_overnight")
  crossesMidnight      Boolean     @default(false) @map("crosses_midnight")
  payMultiplier        Decimal     @default(1) @map("pay_multiplier") @db.Decimal(3, 2)
  isOvertimeEligible   Boolean     @default(true) @map("is_overtime_eligible")
  minRestBetweenShifts Int         @default(11) @map("min_rest_between_shifts")
  maxConsecutiveDays   Int         @default(6) @map("max_consecutive_days")
  isActive             Boolean     @default(true) @map("is_active")
  createdAt            DateTime    @default(now()) @map("created_at")
  updatedAt            DateTime    @updatedAt @map("updated_at")
  shiftRules           ShiftRule[]
  company              Company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  shifts               Shift[]

  @@unique([companyId, name])
  @@index([companyId, isActive])
  @@map("shift_templates")
}

model ShiftSchedule {
  id                String      @id @default(uuid())
  companyId         String      @map("company_id")
  name              String
  nameAr            String      @map("name_ar")
  description       String?
  startDate         DateTime    @map("start_date") @db.Date
  endDate           DateTime    @map("end_date") @db.Date
  weekNumber        Int?        @map("week_number")
  branchId          String?     @map("branch_id")
  departmentId      String?     @map("department_id")
  status            ShiftStatus @default(DRAFT) @map("status")
  publishedAt       DateTime?   @map("published_at")
  publishedBy       String?     @map("published_by")
  totalShifts       Int         @default(0) @map("total_shifts")
  assignedShifts    Int         @default(0) @map("assigned_shifts")
  openShifts        Int         @default(0) @map("open_shifts")
  coveragePercent   Decimal     @default(0) @map("coverage_percent") @db.Decimal(5, 2)
  isAiOptimized     Boolean     @default(false) @map("is_ai_optimized")
  optimizationScore Decimal?    @map("optimization_score") @db.Decimal(5, 2)
  lastOptimizedAt   DateTime?   @map("last_optimized_at")
  createdBy         String      @map("created_by")
  createdAt         DateTime    @default(now()) @map("created_at")
  updatedAt         DateTime    @updatedAt @map("updated_at")
  branch            Branch?     @relation(fields: [branchId], references: [id])
  company           Company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  department        Department? @relation(fields: [departmentId], references: [id])
  shifts            Shift[]

  @@index([companyId, startDate, endDate])
  @@index([companyId, status])
  @@map("shift_schedules")
}

model Shift {
  id                 String             @id @default(uuid())
  companyId          String             @map("company_id")
  scheduleId         String             @map("schedule_id")
  templateId         String?            @map("template_id")
  shiftDate          DateTime           @map("shift_date") @db.Date
  startTime          DateTime           @map("start_time")
  endTime            DateTime           @map("end_time")
  breakMinutes       Int                @default(60) @map("break_minutes")
  assignedUserId     String?            @map("assigned_user_id")
  requiredSkills     Json?              @map("required_skills")
  requiredRole       String?            @map("required_role")
  minExperienceYears Int?               @map("min_experience_years")
  branchId           String?            @map("branch_id")
  departmentId       String?            @map("department_id")
  locationNote       String?            @map("location_note")
  status             ShiftStatus        @default(DRAFT) @map("status")
  isOpen             Boolean            @default(true) @map("is_open")
  actualStartTime    DateTime?          @map("actual_start_time")
  actualEndTime      DateTime?          @map("actual_end_time")
  attendanceId       String?            @map("attendance_id")
  notes              String?
  notesAr            String?            @map("notes_ar")
  createdAt          DateTime           @default(now()) @map("created_at")
  updatedAt          DateTime           @updatedAt @map("updated_at")
  bids               ShiftBid[]
  swapRequests       ShiftSwapRequest[] @relation("ShiftSwapOriginal")
  swapTargets        ShiftSwapRequest[] @relation("ShiftSwapTarget")
  assignedUser       User?              @relation("UserShifts", fields: [assignedUserId], references: [id])
  company            Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  schedule           ShiftSchedule      @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
  template           ShiftTemplate?     @relation(fields: [templateId], references: [id])

  @@index([companyId, shiftDate])
  @@index([scheduleId, shiftDate])
  @@index([assignedUserId, shiftDate])
  @@map("shifts")
}

model ShiftSwapRequest {
  id                String    @id @default(uuid())
  companyId         String    @map("company_id")
  originalShiftId   String    @map("original_shift_id")
  requesterId       String    @map("requester_id")
  targetShiftId     String?   @map("target_shift_id")
  targetUserId      String?   @map("target_user_id")
  reason            String?
  reasonAr          String?   @map("reason_ar")
  status            String    @default("PENDING") @map("status")
  targetAcceptedAt  DateTime? @map("target_accepted_at")
  managerApprovedAt DateTime? @map("manager_approved_at")
  managerId         String?   @map("manager_id")
  rejectionReason   String?   @map("rejection_reason")
  expiresAt         DateTime  @map("expires_at")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  manager           User?     @relation("ShiftSwapManager", fields: [managerId], references: [id])
  originalShift     Shift     @relation("ShiftSwapOriginal", fields: [originalShiftId], references: [id], onDelete: Cascade)
  requester         User      @relation("ShiftSwapRequester", fields: [requesterId], references: [id])
  targetShift       Shift?    @relation("ShiftSwapTarget", fields: [targetShiftId], references: [id])
  targetUser        User?     @relation("ShiftSwapTarget", fields: [targetUserId], references: [id])

  @@index([companyId, status])
  @@index([requesterId])
  @@map("shift_swap_requests")
}

model ShiftBid {
  id         String    @id @default(uuid())
  companyId  String    @map("company_id")
  shiftId    String    @map("shift_id")
  userId     String    @map("user_id")
  bidNote    String?   @map("bid_note")
  priority   Int       @default(0) @map("priority")
  status     String    @default("PENDING") @map("status")
  reviewedAt DateTime? @map("reviewed_at")
  reviewedBy String?   @map("reviewed_by")
  createdAt  DateTime  @default(now()) @map("created_at")
  shift      Shift     @relation(fields: [shiftId], references: [id], onDelete: Cascade)
  user       User      @relation("ShiftBidUser", fields: [userId], references: [id])

  @@unique([shiftId, userId])
  @@index([companyId, status])
  @@map("shift_bids")
}

model ShiftRule {
  id            String         @id @default(uuid())
  companyId     String         @map("company_id")
  templateId    String?        @map("template_id")
  ruleType      String         @map("rule_type")
  name          String
  nameAr        String         @map("name_ar")
  description   String?
  condition     Json           @map("condition")
  value         String         @map("value")
  severity      String         @default("WARNING") @map("severity")
  isActive      Boolean        @default(true) @map("is_active")
  appliesToAll  Boolean        @default(true) @map("applies_to_all")
  departmentIds Json?          @map("department_ids")
  roleIds       Json?          @map("role_ids")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  company       Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  template      ShiftTemplate? @relation(fields: [templateId], references: [id])

  @@index([companyId, isActive])
  @@map("shift_rules")
}

model ShiftOptimizationRun {
  id                  String    @id @default(uuid())
  companyId           String    @map("company_id")
  scheduleId          String    @map("schedule_id")
  optimizationGoals   Json      @map("optimization_goals")
  constraints         Json      @map("constraints")
  status              String    @default("RUNNING") @map("status")
  totalChanges        Int       @default(0) @map("total_changes")
  costSavings         Decimal?  @map("cost_savings") @db.Decimal(12, 2)
  coverageImprovement Decimal?  @map("coverage_improvement") @db.Decimal(5, 2)
  fairnessScore       Decimal?  @map("fairness_score") @db.Decimal(5, 2)
  changesApplied      Json?     @map("changes_applied")
  suggestions         Json?     @map("suggestions")
  warnings            Json?     @map("warnings")
  startedAt           DateTime  @default(now()) @map("started_at")
  completedAt         DateTime? @map("completed_at")
  appliedAt           DateTime? @map("applied_at")
  appliedBy           String?   @map("applied_by")
  createdAt           DateTime  @default(now()) @map("created_at")
  company             Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, status])
  @@map("shift_optimization_runs")
}

model PolicyViolationPrediction {
  id                    String    @id @default(uuid())
  companyId             String    @map("company_id")
  policyId              String    @map("policy_id")
  userId                String    @map("user_id")
  predictionDate        DateTime  @map("prediction_date") @db.Date
  predictedDate         DateTime  @map("predicted_date") @db.Date
  violationType         String    @map("violation_type")
  probability           Decimal   @map("probability") @db.Decimal(5, 4)
  confidenceLevel       String    @map("confidence_level")
  riskFactors           Json      @map("risk_factors")
  historicalPattern     Json?     @map("historical_pattern")
  recommendedAction     String    @map("recommended_action")
  recommendedActionAr   String    @map("recommended_action_ar")
  preventionSuggestions Json?     @map("prevention_suggestions")
  status                String    @default("ACTIVE") @map("status")
  actuallyOccurred      Boolean   @default(false) @map("actually_occurred")
  preventedAt           DateTime? @map("prevented_at")
  preventedBy           String?   @map("prevented_by")
  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")
  user                  User      @relation("PolicyPredictionUser", fields: [userId], references: [id])

  @@index([companyId, status])
  @@index([userId, predictionDate])
  @@map("policy_violation_predictions")
}

model PolicySuggestion {
  id                String    @id @default(uuid())
  companyId         String    @map("company_id")
  suggestionType    String    @map("suggestion_type")
  title             String
  titleAr           String    @map("title_ar")
  description       String
  descriptionAr     String    @map("description_ar")
  relatedPolicyId   String?   @map("related_policy_id")
  proposedRules     Json      @map("proposed_rules")
  proposedConfig    Json?     @map("proposed_config")
  analysisReason    String    @map("analysis_reason")
  dataPoints        Json      @map("data_points")
  impactAnalysis    Json      @map("impact_analysis")
  industryBenchmark Json?     @map("industry_benchmark")
  complianceCheck   Json?     @map("compliance_check")
  priority          String    @map("priority")
  priorityScore     Int       @map("priority_score")
  urgency           String?   @map("urgency")
  status            String    @default("PENDING") @map("status")
  reviewedAt        DateTime? @map("reviewed_at")
  reviewedBy        String?   @map("reviewed_by")
  reviewNotes       String?   @map("review_notes")
  implementedAt     DateTime? @map("implemented_at")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  @@index([companyId, status])
  @@index([companyId, priority])
  @@map("policy_suggestions")
}

model PolicyChangeSimulation {
  id                   String    @id @default(uuid())
  companyId            String    @map("company_id")
  policyId             String    @map("policy_id")
  scenarioName         String    @map("scenario_name")
  scenarioNameAr       String    @map("scenario_name_ar")
  proposedChanges      Json      @map("proposed_changes")
  simulationPeriod     String    @map("simulation_period")
  employeeScope        String    @map("employee_scope")
  scopeFilter          Json?     @map("scope_filter")
  status               String    @default("PENDING") @map("status")
  affectedEmployees    Int?      @map("affected_employees")
  estimatedViolations  Int?      @map("estimated_violations")
  financialImpact      Decimal?  @map("financial_impact") @db.Decimal(12, 2)
  productivityImpact   Decimal?  @map("productivity_impact") @db.Decimal(5, 2)
  complianceRiskChange Decimal?  @map("compliance_risk_change") @db.Decimal(5, 2)
  detailedResults      Json?     @map("detailed_results")
  employeeBreakdown    Json?     @map("employee_breakdown")
  timelineImpact       Json?     @map("timeline_impact")
  recommendations      Json?     @map("recommendations")
  beforeMetrics        Json?     @map("before_metrics")
  afterMetrics         Json?     @map("after_metrics")
  comparisonSummary    String?   @map("comparison_summary")
  runAt                DateTime? @map("run_at")
  completedAt          DateTime? @map("completed_at")
  runBy                String    @map("run_by")
  createdAt            DateTime  @default(now()) @map("created_at")

  @@index([companyId, policyId])
  @@index([companyId, status])
  @@map("policy_change_simulations")
}

model PolicyBenchmark {
  id                 String   @id @default(uuid())
  companyId          String   @map("company_id")
  benchmarkDate      DateTime @map("benchmark_date") @db.Date
  industry           String   @map("industry")
  companySize        String   @map("company_size")
  region             String   @map("region")
  policyMetrics      Json     @map("policy_metrics")
  industryAverage    Json     @map("industry_average")
  percentileRanking  Json     @map("percentile_ranking")
  gapAnalysis        Json     @map("gap_analysis")
  recommendations    Json     @map("recommendations")
  priorityAreas      Json     @map("priority_areas")
  overallScore       Decimal  @map("overall_score") @db.Decimal(5, 2)
  complianceScore    Decimal  @map("compliance_score") @db.Decimal(5, 2)
  fairnessScore      Decimal  @map("fairness_score") @db.Decimal(5, 2)
  effectivenessScore Decimal  @map("effectiveness_score") @db.Decimal(5, 2)
  createdAt          DateTime @default(now()) @map("created_at")

  @@index([companyId, benchmarkDate])
  @@map("policy_benchmarks")
}

model ProfileUpdateRequest {
  id                  String    @id @default(uuid())
  companyId           String    @map("company_id")
  userId              String    @map("user_id")
  updateType          String    @map("update_type")
  fieldName           String    @map("field_name")
  currentValue        String?   @map("current_value")
  requestedValue      String    @map("requested_value")
  supportingDocuments Json?     @map("supporting_documents")
  reason              String?
  reasonAr            String?   @map("reason_ar")
  status              String    @default("PENDING") @map("status")
  reviewedAt          DateTime? @map("reviewed_at")
  reviewedBy          String?   @map("reviewed_by")
  reviewNote          String?   @map("review_note")
  rejectionReason     String?   @map("rejection_reason")
  appliedAt           DateTime? @map("applied_at")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  reviewer            User?     @relation("ProfileUpdateReviewer", fields: [reviewedBy], references: [id])
  user                User      @relation("ProfileUpdateRequests", fields: [userId], references: [id])

  @@index([companyId, status])
  @@index([userId])
  @@map("profile_update_requests")
}

model EmergencyContact {
  id             String   @id @default(uuid())
  userId         String   @map("user_id")
  name           String
  nameAr         String?  @map("name_ar")
  relationship   String
  phone          String
  alternatePhone String?  @map("alternate_phone")
  email          String?
  priority       Int      @default(1) @map("priority")
  address        String?
  city           String?
  country        String?
  isActive       Boolean  @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  user           User     @relation("EmergencyContacts", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("emergency_contacts")
}

model TrainingRequest {
  id                    String    @id @default(uuid())
  companyId             String    @map("company_id")
  userId                String    @map("user_id")
  trainingType          String    @map("training_type")
  trainingName          String    @map("training_name")
  trainingNameAr        String?   @map("training_name_ar")
  provider              String?   @map("provider")
  description           String?
  startDate             DateTime? @map("start_date") @db.Date
  endDate               DateTime? @map("end_date") @db.Date
  durationHours         Int?      @map("duration_hours")
  location              String?   @map("location")
  isOnline              Boolean   @default(false) @map("is_online")
  estimatedCost         Decimal?  @map("estimated_cost") @db.Decimal(10, 2)
  currency              String    @default("SAR") @map("currency")
  isCostApproved        Boolean   @default(false) @map("is_cost_approved")
  businessJustification String    @map("business_justification")
  expectedOutcome       String?   @map("expected_outcome")
  skillsToGain          Json?     @map("skills_to_gain")
  status                String    @default("PENDING") @map("status")
  managerApprovedAt     DateTime? @map("manager_approved_at")
  managerApprovedBy     String?   @map("manager_approved_by")
  hrApprovedAt          DateTime? @map("hr_approved_at")
  hrApprovedBy          String?   @map("hr_approved_by")
  rejectionReason       String?   @map("rejection_reason")
  completedAt           DateTime? @map("completed_at")
  certificateUrl        String?   @map("certificate_url")
  feedbackScore         Int?      @map("feedback_score")
  feedbackNotes         String?   @map("feedback_notes")
  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")
  user                  User      @relation("TrainingRequests", fields: [userId], references: [id])

  @@index([companyId, status])
  @@index([userId])
  @@map("training_requests")
}

model EmployeeSurvey {
  id                String           @id @default(uuid())
  companyId         String           @map("company_id")
  title             String
  titleAr           String           @map("title_ar")
  description       String?
  descriptionAr     String?          @map("description_ar")
  surveyType        String           @map("survey_type")
  startDate         DateTime         @map("start_date")
  endDate           DateTime         @map("end_date")
  questions         Json             @map("questions")
  targetAll         Boolean          @default(true) @map("target_all")
  targetBranches    Json?            @map("target_branches")
  targetDepartments Json?            @map("target_departments")
  targetRoles       Json?            @map("target_roles")
  isAnonymous       Boolean          @default(true) @map("is_anonymous")
  isRequired        Boolean          @default(false) @map("is_required")
  allowMultiple     Boolean          @default(false) @map("allow_multiple")
  showResults       Boolean          @default(false) @map("show_results")
  status            String           @default("DRAFT") @map("status")
  totalInvited      Int              @default(0) @map("total_invited")
  totalResponses    Int              @default(0) @map("total_responses")
  responseRate      Decimal          @default(0) @map("response_rate") @db.Decimal(5, 2)
  createdBy         String           @map("created_by")
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")
  company           Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  responses         SurveyResponse[]

  @@index([companyId, status])
  @@map("employee_surveys")
}

model SurveyResponse {
  id               String         @id @default(uuid())
  surveyId         String         @map("survey_id")
  userId           String?        @map("user_id")
  answers          Json           @map("answers")
  departmentId     String?        @map("department_id")
  branchId         String?        @map("branch_id")
  startedAt        DateTime       @map("started_at")
  completedAt      DateTime?      @map("completed_at")
  timeSpentSeconds Int?           @map("time_spent_seconds")
  isComplete       Boolean        @default(false) @map("is_complete")
  createdAt        DateTime       @default(now()) @map("created_at")
  survey           EmployeeSurvey @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  user             User?          @relation("SurveyResponses", fields: [userId], references: [id])

  @@index([surveyId])
  @@index([userId])
  @@map("survey_responses")
}

model KnowledgeBaseArticle {
  id              String            @id @default(uuid())
  companyId       String            @map("company_id")
  title           String
  titleAr         String            @map("title_ar")
  content         String
  contentAr       String            @map("content_ar")
  summary         String?
  summaryAr       String?           @map("summary_ar")
  category        String            @map("category")
  subcategory     String?           @map("subcategory")
  tags            Json?             @map("tags")
  visibility      String            @default("ALL") @map("visibility")
  customAccess    Json?             @map("custom_access")
  status          String            @default("DRAFT") @map("status")
  publishedAt     DateTime?         @map("published_at")
  publishedBy     String?           @map("published_by")
  viewCount       Int               @default(0) @map("view_count")
  helpfulCount    Int               @default(0) @map("helpful_count")
  notHelpfulCount Int               @default(0) @map("not_helpful_count")
  slug            String?           @map("slug")
  lastReviewedAt  DateTime?         @map("last_reviewed_at")
  nextReviewDate  DateTime?         @map("next_review_date")
  createdBy       String            @map("created_by")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  feedback        ArticleFeedback[]
  company         Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, slug])
  @@index([companyId, category, status])
  @@map("knowledge_base_articles")
}

model ArticleFeedback {
  id        String               @id @default(uuid())
  articleId String               @map("article_id")
  userId    String               @map("user_id")
  isHelpful Boolean              @map("is_helpful")
  comment   String?
  createdAt DateTime             @default(now()) @map("created_at")
  article   KnowledgeBaseArticle @relation(fields: [articleId], references: [id], onDelete: Cascade)
  user      User                 @relation("ArticleFeedback", fields: [userId], references: [id])

  @@unique([articleId, userId])
  @@map("article_feedback")
}

model OfflineSyncQueue {
  id            String    @id @default(uuid())
  companyId     String    @map("company_id")
  userId        String    @map("user_id")
  deviceId      String    @map("device_id")
  operationType String    @map("operation_type")
  entityType    String    @map("entity_type")
  entityId      String?   @map("entity_id")
  payload       Json      @map("payload")
  timestamp     DateTime  @map("timestamp")
  latitude      Decimal?  @map("latitude") @db.Decimal(10, 7)
  longitude     Decimal?  @map("longitude") @db.Decimal(10, 7)
  syncStatus    String    @default("PENDING") @map("sync_status")
  syncAttempts  Int       @default(0) @map("sync_attempts")
  lastSyncAt    DateTime? @map("last_sync_at")
  syncedAt      DateTime? @map("synced_at")
  errorMessage  String?   @map("error_message")
  checksum      String?   @map("checksum")
  isValidated   Boolean   @default(false) @map("is_validated")
  createdAt     DateTime  @default(now()) @map("created_at")
  user          User      @relation("OfflineSyncQueue", fields: [userId], references: [id])

  @@index([userId, syncStatus])
  @@index([deviceId, syncStatus])
  @@map("offline_sync_queue")
}

model UserNotificationPreferences {
  id                String   @id @default(uuid())
  userId            String   @unique @map("user_id")
  pushEnabled       Boolean  @default(true) @map("push_enabled")
  emailEnabled      Boolean  @default(true) @map("email_enabled")
  smsEnabled        Boolean  @default(false) @map("sms_enabled")
  whatsappEnabled   Boolean  @default(false) @map("whatsapp_enabled")
  leaveApprovals    Boolean  @default(true) @map("leave_approvals")
  attendanceAlerts  Boolean  @default(true) @map("attendance_alerts")
  payslipAvailable  Boolean  @default(true) @map("payslip_available")
  taskAssignments   Boolean  @default(true) @map("task_assignments")
  policyUpdates     Boolean  @default(true) @map("policy_updates")
  shiftReminders    Boolean  @default(true) @map("shift_reminders")
  trainingReminders Boolean  @default(true) @map("training_reminders")
  surveyInvites     Boolean  @default(true) @map("survey_invites")
  announcements     Boolean  @default(true) @map("announcements")
  quietHoursEnabled Boolean  @default(false) @map("quiet_hours_enabled")
  quietHoursStart   String?  @map("quiet_hours_start")
  quietHoursEnd     String?  @map("quiet_hours_end")
  quietDays         Json?    @map("quiet_days")
  preferredLanguage String   @default("ar") @map("preferred_language")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  user              User     @relation("NotificationPreferences", fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_notification_preferences")
}

model LocationProof {
  id             String    @id @default(uuid())
  companyId      String    @map("company_id")
  userId         String    @map("user_id")
  proofType      String    @map("proof_type")
  latitude       Decimal   @map("latitude") @db.Decimal(10, 7)
  longitude      Decimal   @map("longitude") @db.Decimal(10, 7)
  accuracy       Decimal?  @map("accuracy") @db.Decimal(10, 2)
  altitude       Decimal?  @map("altitude") @db.Decimal(10, 2)
  address        String?   @map("address")
  branchId       String?   @map("branch_id")
  photoUrl       String    @map("photo_url")
  photoHash      String?   @map("photo_hash")
  photoTakenAt   DateTime  @map("photo_taken_at")
  deviceId       String    @map("device_id")
  deviceModel    String?   @map("device_model")
  osVersion      String?   @map("os_version")
  appVersion     String?   @map("app_version")
  isMockLocation Boolean   @default(false) @map("is_mock_location")
  isRooted       Boolean   @default(false) @map("is_rooted")
  isVerified     Boolean   @default(false) @map("is_verified")
  verifiedAt     DateTime? @map("verified_at")
  verifiedBy     String?   @map("verified_by")
  attendanceId   String?   @map("attendance_id")
  createdAt      DateTime  @default(now()) @map("created_at")
  user           User      @relation("LocationProofs", fields: [userId], references: [id])

  @@index([userId, createdAt])
  @@index([companyId, proofType])
  @@map("location_proofs")
}

model TeamCalendarEvent {
  id             String   @id @default(uuid())
  companyId      String   @map("company_id")
  title          String
  titleAr        String?  @map("title_ar")
  description    String?
  eventType      String   @map("event_type")
  startDate      DateTime @map("start_date")
  endDate        DateTime @map("end_date")
  isAllDay       Boolean  @default(false) @map("is_all_day")
  timezone       String   @default("Asia/Riyadh") @map("timezone")
  userId         String?  @map("user_id")
  departmentId   String?  @map("department_id")
  branchId       String?  @map("branch_id")
  teamId         String?  @map("team_id")
  color          String?  @map("color")
  icon           String?  @map("icon")
  visibility     String   @default("TEAM") @map("visibility")
  sourceType     String?  @map("source_type")
  sourceId       String?  @map("source_id")
  isRecurring    Boolean  @default(false) @map("is_recurring")
  recurrenceRule String?  @map("recurrence_rule")
  createdBy      String   @map("created_by")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  company        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user           User?    @relation("TeamCalendarEvents", fields: [userId], references: [id])

  @@index([companyId, startDate, endDate])
  @@index([userId, startDate])
  @@index([departmentId, startDate])
  @@map("team_calendar_events")
}

model Program {
  id             String        @id @default(uuid())
  companyId      String        @map("company_id")
  name           String
  nameEn         String?       @map("name_en")
  description    String?
  code           String?
  color          String?       @default("#3B82F6")
  icon           String?       @default("folder")
  ownerId        String?       @map("owner_id")
  managerId      String?       @map("manager_id")
  startDate      DateTime?     @map("start_date")
  endDate        DateTime?     @map("end_date")
  totalBudget    Decimal?      @map("total_budget") @db.Decimal(15, 2)
  budgetCurrency String?       @default("SAR") @map("budget_currency")
  status         ProgramStatus @default(PLANNING)
  healthStatus   HealthStatus  @default(ON_TRACK) @map("health_status")
  progress       Int           @default(0)
  isArchived     Boolean       @default(false) @map("is_archived")
  archivedAt     DateTime?     @map("archived_at")
  createdById    String        @map("created_by_id")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  company        Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy      User          @relation("ProgramCreator", fields: [createdById], references: [id])
  manager        User?         @relation("ProgramManager", fields: [managerId], references: [id])
  owner          User?         @relation("ProgramOwner", fields: [ownerId], references: [id])
  projects       Project[]

  @@index([companyId, status])
  @@index([companyId, ownerId])
  @@map("programs")
}

model Project {
  id                String             @id @default(uuid())
  companyId         String             @map("company_id")
  programId         String?            @map("program_id")
  name              String
  nameEn            String?            @map("name_en")
  description       String?
  code              String?            @unique
  color             String?            @default("#10B981")
  icon              String?            @default("briefcase")
  templateId        String?            @map("template_id")
  ownerId           String?            @map("owner_id")
  managerId         String?            @map("manager_id")
  sponsorId         String?            @map("sponsor_id")
  startDate         DateTime?          @map("start_date")
  plannedEndDate    DateTime?          @map("planned_end_date")
  actualEndDate     DateTime?          @map("actual_end_date")
  baselineStartDate DateTime?          @map("baseline_start_date")
  baselineEndDate   DateTime?          @map("baseline_end_date")
  plannedBudget     Decimal?           @map("planned_budget") @db.Decimal(15, 2)
  actualBudget      Decimal?           @map("actual_budget") @db.Decimal(15, 2)
  budgetCurrency    String?            @default("SAR") @map("budget_currency")
  status            ProjectStatus      @default(INITIATION)
  phase             ProjectPhaseType   @default(INITIATION) @map("phase")
  healthStatus      HealthStatus       @default(ON_TRACK) @map("health_status")
  progress          Int                @default(0)
  priority          ProjectPriority    @default(MEDIUM)
  isPublic          Boolean            @default(false) @map("is_public")
  allowTimeLogging  Boolean            @default(true) @map("allow_time_logging")
  requireApproval   Boolean            @default(false) @map("require_approval")
  isArchived        Boolean            @default(false) @map("is_archived")
  archivedAt        DateTime?          @map("archived_at")
  archivedBy        String?            @map("archived_by")
  tags              String[]           @default([])
  customFields      Json?              @map("custom_fields")
  createdById       String             @map("created_by_id")
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")
  activities        ProjectActivity[]
  budgets           ProjectBudget[]
  members           ProjectMember[]
  milestones        ProjectMilestone[]
  phases            ProjectPhase[]
  risks             ProjectRisk[]
  company           Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy         User               @relation("ProjectCreator", fields: [createdById], references: [id])
  manager           User?              @relation("ProjectManager", fields: [managerId], references: [id])
  owner             User?              @relation("ProjectOwner", fields: [ownerId], references: [id])
  program           Program?           @relation(fields: [programId], references: [id])
  sponsor           User?              @relation("ProjectSponsor", fields: [sponsorId], references: [id])
  template          ProjectTemplate?   @relation(fields: [templateId], references: [id])
  tasks             Task[]             @relation("ProjectTasks")

  @@index([companyId, status])
  @@index([companyId, managerId])
  @@index([companyId, programId])
  @@index([code])
  @@map("projects")
}

model ProjectTemplate {
  id                  String    @id @default(uuid())
  companyId           String?   @map("company_id")
  name                String
  nameEn              String?   @map("name_en")
  description         String?
  category            String?
  icon                String?
  color               String?
  defaultDurationDays Int?      @map("default_duration_days")
  defaultBudget       Decimal?  @map("default_budget") @db.Decimal(15, 2)
  phases              Json?
  milestones          Json?
  risks               Json?
  checklist           Json?
  isSystem            Boolean   @default(false) @map("is_system")
  isPublic            Boolean   @default(true) @map("is_public")
  createdById         String?   @map("created_by_id")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  company             Company?  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  projects            Project[]

  @@index([companyId])
  @@map("project_templates")
}

model ProjectMember {
  id            String            @id @default(uuid())
  projectId     String            @map("project_id")
  userId        String            @map("user_id")
  role          ProjectMemberRole @default(MEMBER)
  allocationPct Int?              @map("allocation_pct")
  hourlyRate    Decimal?          @map("hourly_rate") @db.Decimal(10, 2)
  startDate     DateTime?         @map("start_date")
  endDate       DateTime?         @map("end_date")
  canEdit       Boolean           @default(true) @map("can_edit")
  canDelete     Boolean           @default(false) @map("can_delete")
  canManageTeam Boolean           @default(false) @map("can_manage_team")
  canViewBudget Boolean           @default(false) @map("can_view_budget")
  canApprove    Boolean           @default(false) @map("can_approve")
  joinedAt      DateTime          @default(now()) @map("joined_at")
  project       Project           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user          User              @relation("ProjectMembers", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
  @@index([userId])
  @@map("project_members")
}

model ProjectPhase {
  id               String      @id @default(uuid())
  projectId        String      @map("project_id")
  name             String
  nameEn           String?     @map("name_en")
  description      String?
  order            Int         @default(0)
  color            String?     @default("#6366F1")
  plannedStartDate DateTime?   @map("planned_start_date")
  plannedEndDate   DateTime?   @map("planned_end_date")
  actualStartDate  DateTime?   @map("actual_start_date")
  actualEndDate    DateTime?   @map("actual_end_date")
  status           PhaseStatus @default(NOT_STARTED)
  progress         Int         @default(0)
  plannedBudget    Decimal?    @map("planned_budget") @db.Decimal(15, 2)
  actualBudget     Decimal?    @map("actual_budget") @db.Decimal(15, 2)
  deliverables     String[]    @default([])
  dependencies     String[]    @default([])
  createdAt        DateTime    @default(now()) @map("created_at")
  updatedAt        DateTime    @updatedAt @map("updated_at")
  project          Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, order])
  @@map("project_phases")
}

model ProjectMilestone {
  id              String          @id @default(uuid())
  projectId       String          @map("project_id")
  name            String
  nameEn          String?         @map("name_en")
  description     String?
  dueDate         DateTime        @map("due_date")
  completedDate   DateTime?       @map("completed_date")
  status          MilestoneStatus @default(PENDING)
  progress        Int             @default(0)
  ownerId         String?         @map("owner_id")
  deliverables    Json?
  isCritical      Boolean         @default(false) @map("is_critical")
  isPayment       Boolean         @default(false) @map("is_payment")
  paymentAmount   Decimal?        @map("payment_amount") @db.Decimal(15, 2)
  paymentCurrency String?         @default("SAR") @map("payment_currency")
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  owner           User?           @relation("MilestoneOwner", fields: [ownerId], references: [id])
  project         Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, dueDate])
  @@index([projectId, status])
  @@map("project_milestones")
}

model ProjectRisk {
  id              String          @id @default(uuid())
  projectId       String          @map("project_id")
  title           String
  description     String?
  category        RiskCategory
  probability     RiskProbability @default(MEDIUM)
  impact          RiskImpact      @default(MODERATE)
  riskScore       Int             @default(0) @map("risk_score")
  response        RiskResponse    @default(MONITOR)
  mitigationPlan  String?         @map("mitigation_plan")
  contingencyPlan String?         @map("contingency_plan")
  ownerId         String?         @map("owner_id")
  status          RiskStatus      @default(OPEN)
  identifiedAt    DateTime        @default(now()) @map("identified_at")
  resolvedAt      DateTime?       @map("resolved_at")
  potentialCost   Decimal?        @map("potential_cost") @db.Decimal(15, 2)
  actualCost      Decimal?        @map("actual_cost") @db.Decimal(15, 2)
  expectedDate    DateTime?       @map("expected_date")
  createdById     String          @map("created_by_id")
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  createdBy       User            @relation("RiskCreator", fields: [createdById], references: [id])
  owner           User?           @relation("RiskOwner", fields: [ownerId], references: [id])
  project         Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, status])
  @@index([projectId, riskScore])
  @@map("project_risks")
}

model ProjectBudget {
  id              String         @id @default(uuid())
  projectId       String         @map("project_id")
  category        BudgetCategory
  name            String
  description     String?
  plannedAmount   Decimal        @map("planned_amount") @db.Decimal(15, 2)
  actualAmount    Decimal        @default(0) @map("actual_amount") @db.Decimal(15, 2)
  committedAmount Decimal        @default(0) @map("committed_amount") @db.Decimal(15, 2)
  currency        String         @default("SAR")
  periodStart     DateTime?      @map("period_start")
  periodEnd       DateTime?      @map("period_end")
  status          BudgetStatus   @default(ACTIVE)
  approvedById    String?        @map("approved_by_id")
  approvedAt      DateTime?      @map("approved_at")
  createdById     String         @map("created_by_id")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  approvedBy      User?          @relation("BudgetApprover", fields: [approvedById], references: [id])
  createdBy       User           @relation("BudgetCreator", fields: [createdById], references: [id])
  project         Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, category])
  @@map("project_budgets")
}

model ProjectActivity {
  id          String   @id @default(uuid())
  projectId   String   @map("project_id")
  action      String
  description String?
  entityType  String?  @map("entity_type")
  entityId    String?  @map("entity_id")
  oldValue    Json?    @map("old_value")
  newValue    Json?    @map("new_value")
  userId      String   @map("user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user        User     @relation("ProjectActivityUser", fields: [userId], references: [id])

  @@index([projectId, createdAt])
  @@index([userId])
  @@map("project_activities")
}

enum WorkDayCalculationBase {
  CALENDAR_DAYS
  ACTUAL_WORKING_DAYS
  FIXED_30_DAYS
}

enum HireTerminationMethod {
  EXCLUDE_WEEKENDS
  INCLUDE_ALL_DAYS
  PRORATE_BY_CALENDAR
}

enum UnpaidLeaveMethod {
  BASED_ON_SHIFTS
  BASED_ON_CALENDAR
  BASED_ON_WORKING_DAYS
}

enum OvertimeCalculationMethod {
  BASED_ON_SHIFTS
  BASED_ON_BASIC_ONLY
  BASED_ON_TOTAL
  BASED_ON_ELIGIBLE_COMPONENTS
}

enum LeaveAllowanceMethod {
  BASIC_SALARY
  BASIC_PLUS_HOUSING
  TOTAL_SALARY
}

enum Role {
  ADMIN
  MANAGER
  EMPLOYEE
  HR
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum ContractType {
  PERMANENT
  FIXED_TERM
  PART_TIME
  SEASONAL
  PROBATION
}

enum ContractStatus {
  ACTIVE
  EXPIRED
  TERMINATED
  RENEWED
  SUSPENDED
  DRAFT
  PENDING_EMPLOYEE
  PENDING_EMPLOYER
  PENDING_QIWA
  REJECTED
}

enum QiwaAuthStatus {
  NOT_SUBMITTED
  PENDING
  AUTHENTICATED
  REJECTED
  EXPIRED
}

enum DeviceStatus {
  ACTIVE
  PENDING
  BLOCKED
  INACTIVE
}

enum DevicePlatform {
  ANDROID
  IOS
  WEB
  UNKNOWN
}

enum UpdateRequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum UpdateRequestType {
  FACE_UPDATE
  DEVICE_UPDATE
  BOTH
  DEVICE_CHANGE
  PROFILE_UPDATE
}

enum AttendanceStatus {
  PRESENT
  LATE
  EARLY_LEAVE
  ABSENT
  ON_LEAVE
  WORK_FROM_HOME
  LATE_AND_EARLY
  HOLIDAY
}

enum CheckType {
  CHECK_IN
  CHECK_OUT
}

enum LeaveCategory {
  BALANCED
  CASUAL
  SICK
  UNPAID
}

enum LeaveType {
  ANNUAL
  SICK
  PERSONAL
  EMERGENCY
  NEW_BABY
  MARRIAGE
  BEREAVEMENT
  HAJJ
  EXAM
  WORK_MISSION
  UNPAID
  EARLY_LEAVE
  OTHER
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  MODIFIED
  MGR_APPROVED
  MGR_REJECTED
  DELAYED
}

enum ApprovalStep {
  MANAGER
  HR
  COMPLETED
  FINANCE
  CEO
}

enum ApprovalDecision {
  PENDING
  APPROVED
  REJECTED
  DELAYED
}

enum LetterType {
  SALARY_DEFINITION
  SERVICE_CONFIRMATION
  SALARY_ADJUSTMENT
  PROMOTION
  TRANSFER_ASSIGNMENT
  RESIGNATION
  TERMINATION
  CLEARANCE
  EXPERIENCE
  SALARY_DEFINITION_DIRECTED
  NOC
  DELEGATION
}

enum LetterStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  MGR_APPROVED
  MGR_REJECTED
  DELAYED
}

enum NotificationType {
  LATE_CHECK_IN
  EARLY_CHECK_OUT
  EARLY_CHECK_IN
  LEAVE_APPROVED
  LEAVE_REJECTED
  SUSPICIOUS_ACTIVITY
  GENERAL
  LETTER_APPROVED
  LETTER_REJECTED
  DISC_CASE_SUBMITTED
  DISC_HR_REJECTED
  DISC_INFORMAL_SENT
  DISC_EMP_REJECTED_INFORMAL
  DISC_HEARING_SCHEDULED
  DISC_DECISION_ISSUED
  DISC_EMP_OBJECTED
  DISC_FINALIZED
  EMP_EXIT_GEOFENCE
  EMP_RETURN_GEOFENCE
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  SETTINGS_CHANGE
  EXPORT
  IMPORT
}

enum HolidayApplicationType {
  ALL
  BRANCH
  DEPARTMENT
  SPECIFIC_EMPLOYEES
  EXCLUDE_EMPLOYEES
}

enum PermissionScope {
  SELF
  TEAM
  BRANCH
  DEPARTMENT
  ALL
  CUSTOM
}

enum PermissionAuditAction {
  ADDED
  REMOVED
  MODIFIED
}

enum RaiseType {
  SALARY_INCREASE
  ANNUAL_LEAVE_BONUS
  BUSINESS_TRIP
  BONUS
  ALLOWANCE
  OTHER
}

enum RaiseStatus {
  PENDING
  MGR_APPROVED
  MGR_REJECTED
  APPROVED
  REJECTED
  DELAYED
  CANCELLED
}

enum AdvanceType {
  BANK_TRANSFER
  CASH
}

enum SalaryComponentType {
  EARNING
  DEDUCTION
}

enum SalaryComponentNature {
  FIXED
  VARIABLE
  FORMULA
}

enum PayrollFrequency {
  WEEKLY
  BI_WEEKLY
  MONTHLY
  OTHER
}

enum PayrollStatus {
  DRAFT
  INPUTS_COLLECTED
  CALCULATED
  HR_REVIEWED
  FINANCE_APPROVED
  LOCKED
  PAID
  CANCELLED
  ARCHIVED
}

enum PayslipLineSource {
  STRUCTURE
  POLICY
  MANUAL
  ADJUSTMENT
  STATUTORY
  SMART
  SYSTEM
}

enum RetroPayStatus {
  PENDING
  APPROVED
  PAID
  CANCELLED
}

enum PolicyType {
  OVERTIME
  LEAVE
  DEDUCTION
  ALLOWANCE
  ATTENDANCE
  GENERAL
}

enum PolicyScope {
  COMPANY
  BRANCH
  DEPARTMENT
  JOB_TITLE
  EMPLOYEE
}

enum OutputSign {
  EARNING
  DEDUCTION
}

enum SmartPolicyTrigger {
  ATTENDANCE
  LEAVE
  CUSTODY
  PAYROLL
  ANNIVERSARY
  CONTRACT
  DISCIPLINARY
  PERFORMANCE
  CUSTOM
}

enum SmartPolicyStatus {
  DRAFT
  PENDING
  ACTIVE
  PAUSED
  ARCHIVED
}

enum SmartPolicyActionType {
  ADD_TO_PAYROLL
  DEDUCT_FROM_PAYROLL
  SEND_NOTIFICATION
  ALERT_HR
  CREATE_RECORD
}

enum PolicyApprovalAction {
  SUBMITTED
  APPROVED
  REJECTED
  CHANGES_REQUESTED
}

enum OccurrenceResetPeriod {
  MONTHLY
  QUARTERLY
  YEARLY
  NEVER
}

enum RetroApplicationStatus {
  PENDING
  CALCULATING
  REVIEWED
  APPROVED
  APPLIED
  CANCELLED
}

enum MudadStatus {
  PENDING
  PREPARED
  SUBMITTED
  ACCEPTED
  REJECTED
  RESUBMITTED
  RESUBMIT_REQUIRED
}

enum WpsStatus {
  GENERATED
  DOWNLOADED
  SUBMITTED
  PROCESSING
  PROCESSED
  FAILED
}

enum AuditModule {
  AUTH
  USER
  PAYROLL
  PAYSLIP
  BANK_ACCOUNT
  SALARY
  LEAVE
  ATTENDANCE
  ADVANCE
  GOSI
  EOS
  PERMISSION
  POLICY
  RETRO_PAY
  LETTER
  SETTINGS
  MUDAD
  WPS
  CONTRACT
  DISCIPLINARY
}

enum DisciplinaryStage {
  MANAGER_REQUEST
  HR_INITIAL_REVIEW
  EMPLOYEE_INFORMAL_RESPONSE
  OFFICIAL_INVESTIGATION
  DECISION
  OBJECTION
  FINAL
}

enum DisciplinaryStatus {
  SUBMITTED_TO_HR
  HR_REJECTED
  HR_INFORMAL_SENT
  AWAITING_EMPLOYEE_INFORMAL
  EMPLOYEE_REJECTED_INFORMAL
  OFFICIAL_INVESTIGATION_OPENED
  HEARING_SCHEDULED
  INVESTIGATION_IN_PROGRESS
  AWAITING_HR_DECISION
  DECISION_ISSUED
  AWAITING_EMPLOYEE_ACK
  EMPLOYEE_OBJECTED
  HR_REVIEWING_OBJECTION
  FINALIZED_APPROVED
  FINALIZED_CANCELLED
  FINALIZED_CONTINUE_INVESTIGATION
}

enum DecisionType {
  NO_VIOLATION
  NOTICE
  WARNING
  FIRST_WARNING
  SECOND_WARNING
  FINAL_WARNING_TERMINATION
  FINAL_TERMINATION_ART80
  PROMOTION_DELAY
  SALARY_DEDUCTION
  SUSPENSION_WITH_PAY
  SUSPENSION_WITHOUT_PAY
}

enum PayrollAdjustmentStatus {
  PENDING
  POSTED
  REVERSED
  CANCELLED
}

enum AdjustmentUnit {
  DAYS
  HOURS
  AMOUNT
}

enum CaseEventType {
  CASE_CREATED
  HR_INITIAL_REVIEW
  INFORMAL_ACTION_SENT
  EMPLOYEE_INFORMAL_RESPONSE
  OFFICIAL_INVESTIGATION_OPENED
  HEARING_SCHEDULED
  MINUTES_UPLOADED
  DECISION_ISSUED
  EMPLOYEE_ACKNOWLEDGED
  EMPLOYEE_OBJECTED
  OBJECTION_REVIEWED
  FINALIZED
  CANCELLED
}

enum DeductionBasePolicy {
  BASIC_ONLY
  BASIC_FIXED
  GROSS
}

enum SubmissionEntityType {
  MUDAD
  WPS
  QIWA
}

enum ApprovalRequestType {
  LEAVE
  ADVANCE
  RAISE
  PAYROLL
  WPS
}

enum CustodyItemStatus {
  AVAILABLE
  ASSIGNED
  IN_MAINTENANCE
  LOST
  DAMAGED
  DISPOSED
  RESERVED
}

enum CustodyCondition {
  NEW
  EXCELLENT
  GOOD
  FAIR
  POOR
}

enum CustodyAssignmentStatus {
  PENDING
  APPROVED
  REJECTED
  DELIVERED
  RETURNED
  TRANSFERRED
}

enum CustodyReturnStatus {
  PENDING
  INSPECTING
  APPROVED
  REJECTED
  COMPLETED
}

enum CustodyTransferStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
}

enum CustodyMaintenanceStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANNOT_REPAIR
}

enum MaintenanceType {
  PREVENTIVE
  CORRECTIVE
  EMERGENCY
}

enum DocumentType {
  ID_CARD
  IQAMA
  PASSPORT
  CONTRACT
  CERTIFICATE
  MEDICAL
  BANK_LETTER
  DRIVING_LICENSE
  QUALIFICATION
  OTHER
}

enum ProficiencyLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum OnboardingType {
  JOINING
  OFFBOARDING
  RETURN
}

enum AssigneeType {
  HR
  IT
  MANAGER
  FINANCE
  EMPLOYEE
}

enum OnboardingProcessStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum OnboardingTaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  SKIPPED
}

enum TaskStatus {
  BACKLOG
  TODO
  IN_PROGRESS
  IN_REVIEW
  BLOCKED
  COMPLETED
  CANCELLED
  PENDING_REVIEW
  APPROVED
  REJECTED
}

enum TaskPriority {
  URGENT
  HIGH
  MEDIUM
  LOW
}

enum TaskRecurrenceType {
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum SprintStatus {
  PLANNING
  ACTIVE
  COMPLETED
  CANCELLED
}

enum TaskApprovalAction {
  SUBMITTED_FOR_REVIEW
  REVIEWED
  APPROVED
  REJECTED
  CHANGES_REQUESTED
}

enum TaskEvidenceStatus {
  PENDING
  APPROVED
  REJECTED
}

enum DependencyType {
  BLOCKS
  BLOCKED_BY
  RELATED
  DUPLICATES
}

enum AutomationTrigger {
  STATUS_CHANGED
  DUE_DATE_NEAR
  DUE_DATE_PASSED
  TASK_CREATED
  TASK_ASSIGNED
  TASK_COMPLETED
  PRIORITY_CHANGED
  COMMENT_ADDED
  EVIDENCE_SUBMITTED
}

enum AutomationAction {
  SEND_NOTIFICATION
  CHANGE_STATUS
  ASSIGN_USER
  SET_PRIORITY
  ADD_WATCHER
  SEND_EMAIL
  CREATE_SUBTASK
}

enum PerformanceReviewCycleType {
  ANNUAL
  SEMI_ANNUAL
  QUARTERLY
  MONTHLY
  PROJECT_BASED
  CONTINUOUS
}

enum PerformanceReviewCycleStatus {
  DRAFT
  PLANNING
  ACTIVE
  CALIBRATION
  COMPLETED
  ARCHIVED
}

enum PerformanceReviewStatus {
  NOT_STARTED
  SELF_REVIEW
  MANAGER_REVIEW
  FEEDBACK_COLLECTION
  CALIBRATION
  ACKNOWLEDGED
  COMPLETED
}

enum GoalType {
  INDIVIDUAL
  TEAM
  DEPARTMENT
  COMPANY
  OKR
}

enum GoalStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  IN_PROGRESS
  AT_RISK
  BEHIND
  ON_TRACK
  EXCEEDED
  COMPLETED
  CANCELLED
}

enum GoalDataSource {
  ATTENDANCE
  LEAVES
  TASKS
  OVERTIME
  POLICIES
  TRAINING
  CUSTODY
  PERFORMANCE_REVIEWS
  RECOGNITION
  SALES
  CUSTOM
}

enum CompetencyCategory {
  CORE
  LEADERSHIP
  FUNCTIONAL
  TECHNICAL
  VALUE
}

enum FeedbackRequestStatus {
  PENDING
  IN_PROGRESS
  SUBMITTED
  DECLINED
  EXPIRED
}

enum RecognitionType {
  KUDOS
  BADGE
  AWARD
  ACHIEVEMENT
  SPOT_BONUS
}

enum DevelopmentGoalStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum CompanyType {
  OPERATIONAL
  TECH
  SALES
  CREATIVE
  ADMIN
  HYBRID
}

enum EvalPhilosophy {
  RESULTS_FIRST
  BALANCED
  CULTURE_FIRST
}

enum KPISourceType {
  MANUAL
  SYSTEM_SYNC
  API_IMPORT
  CSV_IMPORT
}

enum KPIFrequency {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum UPEECompetencyCategory {
  UPEE_CORE
  UPEE_FUNCTIONAL
  UPEE_LEADERSHIP
}

enum FeedbackQuestionType {
  RATING_1_5
  RATING_1_10
  TEXT
  MULTIPLE_CHOICE
}

enum FeedbackRaterType {
  SELF
  MANAGER
  PEER
  STAKEHOLDER
  CUSTOMER
}

enum UPEE360Status {
  UPEE_PENDING
  UPEE_SENT
  UPEE_IN_PROGRESS
  UPEE_COMPLETED
  UPEE_EXPIRED
}

enum ConductSeverity {
  MINOR
  MAJOR
  CRITICAL
}

enum EvidenceType {
  URL_LINK
  FILE_UPLOAD
  DASHBOARD_SNAPSHOT
  TICKET_REFERENCE
  PR_COMMIT
  CUSTOMER_FEEDBACK
}

enum RatingBand {
  EXCEPTIONAL
  EXCEEDS
  MEETS
  PARTIALLY_MEETS
  NEEDS_IMPROVEMENT
}

enum ResultStatus {
  DRAFT
  SUBMITTED
  CALIBRATED
  FINALIZED
  ARCHIVED
}

enum CalibrationStatus {
  DRAFT
  IN_PROGRESS
  COMPLETED
  LOCKED
}

enum IDPStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

enum PIPStatus {
  ACTIVE
  EXTENDED
  COMPLETED
  ESCALATED
}

enum PIPOutcome {
  PASSED
  EXTENDED
  TERMINATED
}

enum TripStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum DeliveryStatus {
  PENDING
  PICKED_UP
  IN_TRANSIT
  DELIVERED
  FAILED
  RETURNED
}

enum NitaqatZone {
  PLATINUM
  GREEN_HIGH
  GREEN_MID
  GREEN_LOW
  YELLOW
  RED
}

enum SaudizationStatus {
  COMPLIANT
  AT_RISK
  NON_COMPLIANT
  EXEMPT
}

enum ShiftType {
  REGULAR
  ROTATING
  SPLIT
  FLEXIBLE
  ON_CALL
}

enum ShiftStatus {
  DRAFT
  PUBLISHED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ProgramStatus {
  PLANNING
  ACTIVE
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum HealthStatus {
  ON_TRACK
  AT_RISK
  OFF_TRACK
  COMPLETED
}

enum ProjectStatus {
  INITIATION
  PLANNING
  EXECUTION
  MONITORING
  CLOSING
  COMPLETED
  ON_HOLD
  CANCELLED
}

enum ProjectPhaseType {
  INITIATION
  PLANNING
  EXECUTION
  MONITORING
  CLOSING
}

enum ProjectPriority {
  CRITICAL
  HIGH
  MEDIUM
  LOW
}

enum ProjectMemberRole {
  OWNER
  MANAGER
  LEAD
  MEMBER
  STAKEHOLDER
  VIEWER
}

enum PhaseStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  ON_HOLD
  CANCELLED
}

enum MilestoneStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  MISSED
  CANCELLED
}

enum RiskCategory {
  TECHNICAL
  SCHEDULE
  COST
  RESOURCE
  SCOPE
  QUALITY
  EXTERNAL
  ORGANIZATIONAL
  OTHER
}

enum RiskProbability {
  VERY_LOW
  LOW
  MEDIUM
  HIGH
  VERY_HIGH
}

enum RiskImpact {
  NEGLIGIBLE
  MINOR
  MODERATE
  MAJOR
  SEVERE
}

enum RiskResponse {
  AVOID
  MITIGATE
  TRANSFER
  ACCEPT
  MONITOR
}

enum RiskStatus {
  OPEN
  MITIGATING
  RESOLVED
  OCCURRED
  CLOSED
}

enum BudgetCategory {
  LABOR
  MATERIALS
  EQUIPMENT
  TRAVEL
  TRAINING
  SOFTWARE
  CONSULTING
  CONTINGENCY
  OTHER
}

enum BudgetStatus {
  DRAFT
  ACTIVE
  FROZEN
  CLOSED
}

// ============ INTEGRATIONS & WEBHOOKS ============

model Webhook {
  id              String    @id @default(cuid())
  name            String
  url             String
  secret          String?
  events          String[] // ['task.created', 'task.updated', 'task.completed']
  isActive        Boolean   @default(true) @map("is_active")
  companyId       String    @map("company_id")
  createdById     String?   @map("created_by_id")
  lastTriggeredAt DateTime? @map("last_triggered_at")
  failureCount    Int       @default(0) @map("failure_count")
  lastError       String?   @map("last_error")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  logs WebhookLog[]

  @@index([companyId, isActive])
  @@map("webhooks")
}

model WebhookLog {
  id           String   @id @default(cuid())
  webhookId    String   @map("webhook_id")
  event        String
  payload      Json
  statusCode   Int?     @map("status_code")
  response     String?
  duration     Int? // ms
  isSuccess    Boolean  @map("is_success")
  errorMessage String?  @map("error_message")
  createdAt    DateTime @default(now()) @map("created_at")

  webhook Webhook @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId, createdAt])
  @@map("webhook_logs")
}

model Integration {
  id          String    @id @default(cuid())
  type        String // 'slack', 'teams', 'github', 'gitlab', 'jira', 'trello', 'google', 'zapier'
  name        String
  companyId   String    @map("company_id")
  isActive    Boolean   @default(true) @map("is_active")
  config      Json      @default("{}") // OAuth tokens, settings, etc.
  metadata    Json? // Additional data
  connectedAt DateTime  @default(now()) @map("connected_at")
  lastSyncAt  DateTime? @map("last_sync_at")
  createdById String?   @map("created_by_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  @@unique([companyId, type])
  @@index([companyId, isActive])
  @@map("integrations")
}

// ============================================
// Employee Debt Ledger (دفتر ديون الموظفين)
// لتتبع الأرصدة السالبة عندما تتجاوز الخصومات الراتب
// ============================================

model EmployeeDebtLedger {
  id                String              @id @default(uuid())
  companyId         String              @map("company_id")
  employeeId        String              @map("employee_id")

  // المبالغ
  originalAmount    Decimal             @map("original_amount") @db.Decimal(10, 2)
  remainingBalance  Decimal             @map("remaining_balance") @db.Decimal(10, 2)

  // مصدر الدين
  sourceType        DebtSourceType      @map("source_type")
  sourceId          String?             @map("source_id") // payrollRunId, payslipId, etc.
  periodId          String?             @map("period_id")

  // التفاصيل
  reason            String?
  notes             String?

  // الحالة
  status            DebtStatus          @default(ACTIVE)

  // التواريخ
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")
  settledAt         DateTime?           @map("settled_at")

  // العلاقات
  company           Company?            @relation(fields: [companyId], references: [id])
  employee          User                @relation("EmployeeDebts", fields: [employeeId], references: [id])
  period            PayrollPeriod?      @relation(fields: [periodId], references: [id])
  transactions      DebtTransaction[]

  @@index([companyId, employeeId, status])
  @@index([employeeId, status])
  @@index([companyId, status, createdAt])
  @@map("employee_debt_ledger")
}

model DebtTransaction {
  id                String                @id @default(uuid())
  debtId            String                @map("debt_id")

  // المبلغ
  amount            Decimal               @db.Decimal(10, 2)
  balanceBefore     Decimal               @map("balance_before") @db.Decimal(10, 2)
  balanceAfter      Decimal               @map("balance_after") @db.Decimal(10, 2)

  // نوع العملية
  transactionType   DebtTransactionType   @map("transaction_type")

  // المصدر (من أين تم الخصم/السداد)
  sourceType        String?               @map("source_type") // PAYROLL, MANUAL, ADVANCE, etc.
  sourceId          String?               @map("source_id")

  // التفاصيل
  description       String?
  processedBy       String?               @map("processed_by")

  // التواريخ
  createdAt         DateTime              @default(now()) @map("created_at")

  // العلاقات
  debt              EmployeeDebtLedger    @relation(fields: [debtId], references: [id], onDelete: Cascade)

  @@index([debtId, createdAt])
  @@map("debt_transactions")
}

enum DebtStatus {
  ACTIVE           // دين نشط - لم يتم سداده بالكامل
  PARTIALLY_PAID   // تم سداد جزء منه
  SETTLED          // تم تسويته بالكامل
  WRITTEN_OFF      // تم شطبه
  SUSPENDED        // معلق مؤقتاً
}

enum DebtSourceType {
  PAYROLL_NEGATIVE_BALANCE  // رصيد سالب من الرواتب
  ADVANCE_OVERPAYMENT       // سلفة زائدة
  LOAN                      // قرض
  PENALTY                   // غرامة
  OVERPAYMENT_CORRECTION    // تصحيح دفع زائد
  OTHER                     // أخرى
}

enum DebtTransactionType {
  INITIAL_DEBT        // تسجيل الدين الأولي
  PAYROLL_DEDUCTION   // خصم من الراتب
  MANUAL_PAYMENT      // سداد يدوي
  ADJUSTMENT          // تعديل
  WRITE_OFF           // شطب
  REVERSAL            // عكس عملية سابقة
}
