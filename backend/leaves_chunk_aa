import {
  Injectable,
  NotFoundException,
  BadRequestException,
  ForbiddenException,
} from '@nestjs/common';
import { PrismaService } from '../../common/prisma/prisma.service';
import { NotificationsService } from '../notifications/notifications.service';
import { CreateLeaveRequestDto } from './dto/create-leave-request.dto';
import { LeaveQueryDto } from './dto/leave-query.dto';
import { NotificationType } from '@prisma/client';

@Injectable()
export class LeavesService {
  constructor(
    private prisma: PrismaService,
    private notificationsService: NotificationsService,
  ) { }

  async createLeaveRequest(userId: string, createLeaveDto: CreateLeaveRequestDto) {
    const { type, startDate, endDate, reason, notes } = createLeaveDto;
    const leaveNotes = reason || notes || '';

    // Validate dates
    const start = new Date(startDate);
    const end = new Date(endDate);

    if (end < start) {
      throw new BadRequestException('تاريخ النهاية يجب أن يكون بعد تاريخ البداية');
    }

    // Calculate requested days
    const diffTime = Math.abs(end.getTime() - start.getTime());
    const requestedDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;

    // Check user's remaining leave balance
    const user = await this.prisma.user.findUnique({ where: { id: userId } });
    if (user && user.remainingLeaveDays < requestedDays) {
      throw new BadRequestException(`رصيد الإجازات غير كافي. المتبقي: ${