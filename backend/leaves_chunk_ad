  });

    if (!leaveRequest) {
      throw new NotFoundException('طلب الإجازة غير موجود');
    }

    if (leaveRequest.userId !== userId) {
      throw new ForbiddenException('لا يمكنك إلغاء طلب إجازة شخص آخر');
    }

    if (leaveRequest.status !== 'PENDING') {
      throw new BadRequestException('لا يمكن إلغاء طلب تم البت فيه');
    }

    return this.prisma.leaveRequest.update({
      where: { id },
      data: { status: 'CANCELLED' },
    });
  }

  // ============ Manager/Admin Methods ============

  async getPendingRequests(managerId?: string, query?: LeaveQueryDto) {
    const { page = 1, limit = 20 } = query || {};

    let where: any = { status: 'PENDING' };

    // If manager, only get their team's requests
    if (managerId) {
      const manager = await this.prisma.user.findUnique({
        where: { id: managerId },
      });

      if (manager?.role === 'MANAGER') {
        where.user = { managerId };
      }
    }

    const [requests, total] = await Promise.all([
      this.prisma.leaveRequest.findMany({
        where,
        orderBy: { createdAt: 'asc' },
        skip: (page - 1) * limit,
        take: limit,
        include: {
          user: {
            select: {
              id: true,
              firstName: true,
              lastName: true,
              employeeCode: true,
              jobTitle: true,
              department: { select: { name: true } },
            },
         