generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id                              String                            @id @default(uuid())
  name                            String                            @unique
  nameEn                          String?                           @map("name_en")
  crNumber                        String?                           @unique @map("cr_number")
  taxId                           String?                           @unique @map("tax_id")
  logo                            String?
  address                         String?
  phone                           String?
  email                           String?
  website                         String?
  createdAt                       DateTime                          @default(now()) @map("created_at")
  updatedAt                       DateTime                          @updatedAt @map("updated_at")
  advanceRequests                 AdvanceRequest[]
  ai_conversations                ai_conversations[]
  approvalChainConfigs            ApprovalChainConfig[]
  approvalLogs                    ApprovalLog[]
  attendances                     Attendance[]
  auditLogs                       AuditLog[]
  branches                        Branch[]
  career_paths                    career_paths[]
  companyBankAccounts             CompanyBankAccount[]
  company_configs                 company_configs?
  disciplinaryPolicy              CompanyDisciplinaryPolicy?
  competency_frameworks           competency_frameworks[]
  core_values                     core_values[]
  cost_center_allocations         cost_center_allocations[]
  cost_center_budgets             cost_center_budgets[]
  costCenters                     CostCenter[]
  custodyAssignments              CustodyAssignment[]
  custodyCategories               CustodyCategory[]
  custodyItems                    CustodyItem[]
  custodyMaintenances             CustodyMaintenance[]
  custodyReturns                  CustodyReturn[]
  custodyTransfers                CustodyTransfer[]
  departments                     Department[]
  development_plans               development_plans[]
  disciplinaryCases               DisciplinaryCase[]
  employeeLocationLogs            EmployeeLocationLog[]
  employee_surveys                employee_surveys[]
  feedback_question_sets          feedback_question_sets[]
  geofenceExitEvents              GeofenceExitEvent[]
  goals                           goals[]
  gosiConfigs                     GosiConfig[]
  holidays                        Holiday[]
  job_families                    job_families[]
  jobTitles                       JobTitle[]
  knowledge_base_articles         knowledge_base_articles[]
  kpi_definitions                 kpi_definitions[]
  leaveBalances                   LeaveBalance[]
  leaveRequests                   LeaveRequest[]
  leaveTypeConfigs                LeaveTypeConfig[]
  letterRequests                  LetterRequest[]
  mudadSubmissions                MudadSubmission[]
  notifications                   Notification[]
  onboardingProcesses             OnboardingProcess[]
  onboardingTemplates             OnboardingTemplate[]
  payrollAdjustments              PayrollAdjustment[]
  payrollPeriods                  PayrollPeriod[]
  payrollRuns                     PayrollRun[]
  payrollSettings                 PayrollSettings?
  payslips                        Payslip[]
  performance_competency_models   performance_competency_models[]
  performance_review_cycles       performance_review_cycles[]
  permissionAuditLogs             PermissionAuditLog[]
  policies                        Policy[]
  predictionAccuracies            PredictionAccuracy[]
  programs                        programs[]
  project_templates               project_templates[]
  projects                        projects[]
  raiseRequests                   RaiseRequest[]
  recognitions                    recognitions[]
  retroPays                       RetroPay[]
  salaryComponents                SalaryComponent[]
  salaryStructures                SalaryStructure[]
  saudization_configs             saudization_configs?
  shift_optimization_runs         shift_optimization_runs[]
  shift_rules                     shift_rules[]
  shift_schedules                 shift_schedules[]
  shift_templates                 shift_templates[]
  shifts                          shifts[]
  smartPolicies                   SmartPolicy[]
  smart_policy_analytics          smart_policy_analytics[]
  smart_policy_exceptions         smart_policy_exceptions[]
  smart_policy_retro_applications smart_policy_retro_applications[]
  sprints                         sprints[]
  submissionStatusLogs            SubmissionStatusLog[]
  succession_plans                succession_plans[]
  suspiciousAttempts              SuspiciousAttempt[]
  systemSettings                  SystemSetting[]
  task_automations                task_automations[]
  task_categories                 task_categories[]
  task_templates                  task_templates[]
  tasks                           tasks[]
  team_calendar_events            team_calendar_events[]
  userPermissions                 UserPermission[]
  users                           User[]
  workFromHomes                   WorkFromHome[]
  workSchedules                   WorkSchedule[]
  wpsSubmissions                  WpsSubmission[]

  @@map("companies")
}

model PayrollSettings {
  id                                String                    @id @default(uuid())
  companyId                         String                    @unique @map("company_id")
  payrollClosingDay                 Int                       @default(25) @map("payroll_closing_day")
  hireTerminationCalcBase           WorkDayCalculationBase    @default(CALENDAR_DAYS) @map("hire_termination_calc_base")
  hireTerminationMethod             HireTerminationMethod     @default(EXCLUDE_WEEKENDS) @map("hire_termination_method")
  unpaidLeaveCalcBase               WorkDayCalculationBase    @default(ACTUAL_WORKING_DAYS) @map("unpaid_leave_calc_base")
  unpaidLeaveMethod                 UnpaidLeaveMethod         @default(BASED_ON_SHIFTS) @map("unpaid_leave_method")
  splitUnpaidByClosingDate          Boolean                   @default(false) @map("split_unpaid_by_closing_date")
  overtimeCalcBase                  WorkDayCalculationBase    @default(ACTUAL_WORKING_DAYS) @map("overtime_calc_base")
  overtimeMethod                    OvertimeCalculationMethod @default(BASED_ON_SHIFTS) @map("overtime_method")
  leaveAllowanceCalcBase            WorkDayCalculationBase    @default(CALENDAR_DAYS) @map("leave_allowance_calc_base")
  leaveAllowanceMethod              LeaveAllowanceMethod      @default(BASIC_PLUS_HOUSING) @map("leave_allowance_method")
  showCompanyContributions          Boolean                   @default(true) @map("show_company_contributions")
  showClosingDateOnPayslip          Boolean                   @default(true) @map("show_closing_date_on_payslip")
  deductAbsenceFromBasic            Boolean                   @default(true) @map("deduct_absence_from_basic")
  showActualAbsenceDays             Boolean                   @default(false) @map("show_actual_absence_days")
  enableNegativeBalanceCarryover    Boolean                   @default(false) @map("enable_negative_balance_carryover")
  settleNegativeAsTransaction       Boolean                   @default(false) @map("settle_negative_as_transaction")
  roundSalaryToNearest              Int                       @default(0) @map("round_salary_to_nearest")
  defaultWorkingDaysPerMonth        Int                       @default(30) @map("default_working_days_per_month")
  createdAt                         DateTime                  @default(now()) @map("created_at")
  updatedAt                         DateTime                  @updatedAt @map("updated_at")
  leaveDailyRateDivisor             Int                       @default(30) @map("leave_daily_rate_divisor")
  overtime_multiplier               Float                     @default(1.5)
  grace_period_minutes              Int                       @default(15)
  weekend_overtime_multiplier       Float                     @default(2.0)
  holiday_overtime_multiplier       Float                     @default(2.0)
  night_shift_allowance_percent     Float                     @default(0)
  max_deduction_percent             Float                     @default(50)
  min_net_salary                    Float                     @default(0)
  auto_lock_day                     Int                       @default(0)
  default_currency                  String                    @default("SAR")
  enable_multi_currency             Boolean                   @default(false)
  enable_bonus_tracking             Boolean                   @default(true)
  bonus_calculation_method          String                    @default("FIXED")
  enable_commission                 Boolean                   @default(false)
  commission_calculation_base       String                    @default("SALES")
  enable_allowance_categories       Boolean                   @default(true)
  max_allowance_percent             Float                     @default(100)
  enable_tax_calculation            Boolean                   @default(false)
  tax_calculation_method            String                    @default("EXEMPT")
  enable_salary_advance             Boolean                   @default(true)
  max_advance_percent               Float                     @default(50)
  enable_loan_deduction             Boolean                   @default(true)
  max_loan_deduction_percent        Float                     @default(30)
  enable_approval_workflow          Boolean                   @default(false)
  approval_levels                   Int                       @default(1)
  enable_bank_transfer              Boolean                   @default(true)
  default_bank_code                 String                    @default("")
  enable_retroactive_pay            Boolean                   @default(true)
  retroactive_months_limit          Int                       @default(3)
  enable_eos_calculation            Boolean                   @default(true)
  eos_calculation_method            String                    @default("SAUDI_LABOR_LAW")
  enable_gosi_calculation           Boolean                   @default(true)
  gosi_employee_percent             Float                     @default(9.75)
  gosi_employer_percent             Float                     @default(11.75)
  enable_vacation_encashment        Boolean                   @default(true)
  vacation_encashment_method        String                    @default("ON_TERMINATION")
  enable_attendance_penalty         Boolean                   @default(true)
  late_deduction_method             String                    @default("PER_MINUTE")
  late_threshold_minutes            Int                       @default(120)
  absence_deduction_method          String                    @default("DAILY_RATE")
  absence_progressive_rate          Float                     @default(1.0)
  enable_early_departure_penalty    Boolean                   @default(false)
  early_departure_deduction_method  String                    @default("PER_MINUTE")
  early_departure_threshold_minutes Int                       @default(120)
  enable_cumulative_late_deduction  Boolean                   @default(false)
  late_count_for_day_deduction      Int                       @default(3)
  gosi_max_salary                   Float                     @default(45000)
  enable_saned_calculation          Boolean                   @default(true)
  saned_employee_percent            Float                     @default(0.75)
  saned_employer_percent            Float                     @default(0.75)
  hazard_rate_percent               Float                     @default(2.0)
  enable_payslip_email              Boolean                   @default(true)
  payslip_language                  String                    @default("AR")
  enable_overtime_cap               Boolean                   @default(false)
  max_overtime_hours_per_month      Int                       @default(50)
  enable_auto_payroll_generation    Boolean                   @default(false)
  auto_payroll_generation_day       Int                       @default(25)
  enable_payroll_audit_trail        Boolean                   @default(true)
  enable_salary_rounding            Boolean                   @default(false)
  salary_rounding_method            String                    @default("NEAREST")
  enable_department_budget          Boolean                   @default(false)
  enable_cost_center_tracking       Boolean                   @default(false)
  default_payroll_export_format     String                    @default("EXCEL")
  enable_sick_leave_deduction       Boolean?                  @default(true)
  sick_leave_partial_pay_percent    Float?                    @default(75)
  sick_leave_full_pay_days          Int?                      @default(30)
  sick_leave_partial_pay_days       Int?                      @default(60)
  sick_leave_unpaid_days            Int?                      @default(30)
  calculation_method                String?                   @default("STANDARD") @db.VarChar
  payslip_template                  String?                   @default("DEFAULT") @db.VarChar
  show_salary_breakdown             Boolean?                  @default(true)
  show_ytd_totals                   Boolean?                  @default(true)
  auto_calculate_eos                Boolean?                  @default(true)
  eos_first_years_rate              Float?                    @default(0.5)
  eos_later_years_rate              Float?                    @default(1.0)
  eos_threshold_years               Int?                      @default(5)
  eos_contractual_rate              Float?                    @default(1.0)
  daily_working_hours               Float?                    @default(8)
  weekly_working_days               Int?                      @default(5)
  overtime_rate                     Float?                    @default(1.5)
  weekend_overtime_rate             Float?                    @default(2.0)
  holiday_overtime_rate             Float?                    @default(2.0)
  late_deduction_rate               Float?                    @default(1.0)
  absence_deduction_rate            Float?                    @default(1.0)
  include_housing_in_gosi           Boolean?                  @default(true)
  include_transport_in_gosi         Boolean?                  @default(false)
  default_leave_days                Int?                      @default(21)
  leave_carry_over_days             Int?                      @default(5)
  probation_leave_enabled           Boolean?                  @default(false)
  auto_approve_leave                Boolean?                  @default(false)
  enable_overtime_approval          Boolean?                  @default(true)
  working_days_per_week             Int?                      @default(5)
  company                           Company                   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@map("payroll_settings")
}

model User {
  id                                                                 String                         @id @default(uuid())
  email                                                              String                         @unique
  phone                                                              String?                        @unique
  password                                                           String
  firstName                                                          String                         @map("first_name")
  lastName                                                           String                         @map("last_name")
  avatar                                                             String?
  employeeCode                                                       String?                        @map("employee_code")
  jobTitle                                                           String?                        @map("job_title")
  role                                                               Role                           @default(EMPLOYEE)
  status                                                             UserStatus                     @default(ACTIVE)
  salary                                                             Decimal?                       @db.Decimal(10, 2)
  hireDate                                                           DateTime?                      @map("hire_date")
  fcmToken                                                           String?                        @map("fcm_token")
  branchId                                                           String?                        @map("branch_id")
  departmentId                                                       String?                        @map("department_id")
  managerId                                                          String?                        @map("manager_id")
  createdAt                                                          DateTime                       @default(now()) @map("created_at")
  updatedAt                                                          DateTime                       @updatedAt @map("updated_at")
  faceRegistered                                                     Boolean                        @default(false) @map("face_registered")
  annualLeaveDays                                                    Int                            @default(21) @map("annual_leave_days")
  usedLeaveDays                                                      Int                            @default(0) @map("used_leave_days")
  remainingLeaveDays                                                 Int                            @default(21) @map("remaining_leave_days")
  isSuperAdmin                                                       Boolean                        @default(false) @map("is_super_admin")
  jobTitleId                                                         String?                        @map("job_title_id")
  costCenterId                                                       String?                        @map("cost_center_id")
  isSaudi                                                            Boolean                        @default(true) @map("is_saudi")
  nationality                                                        String?                        @map("nationality")
  nationalId                                                         String?                        @unique @map("national_id")
  companyId                                                          String?                        @map("company_id")
  borderNumber                                                       String?                        @map("border_number")
  iqamaExpiryDate                                                    DateTime?                      @map("iqama_expiry_date") @db.Date
  iqamaNumber                                                        String?                        @map("iqama_number")
  passportExpiryDate                                                 DateTime?                      @map("passport_expiry_date") @db.Date
  passportNumber                                                     String?                        @map("passport_number")
  profession                                                         String?                        @map("profession")
  professionCode                                                     String?                        @map("profession_code")
  dateOfBirth                                                        DateTime?                      @map("date_of_birth") @db.Date
  gender                                                             String?
  gosiNumber                                                         String?                        @unique @map("gosi_number")
  maritalStatus                                                      String?                        @map("marital_status")
  jobFamilyId                                                        String?
  roleLevelId                                                        String?
  job_family_id                                                      String?                        @db.VarChar(255)
  role_level_id                                                      String?                        @db.VarChar(255)
  ceoApprovedAdvances                                                AdvanceRequest[]               @relation("CEOApproverAdvanceRequests")
  financeApprovedAdvances                                            AdvanceRequest[]               @relation("FinanceApproverAdvanceRequests")
  hrApprovedAdvances                                                 AdvanceRequest[]               @relation("HRApproverAdvanceRequests")
  managerApprovedAdvances                                            AdvanceRequest[]               @relation("ManagerApproverAdvanceRequests")
  advanceRequests                                                    AdvanceRequest[]               @relation("EmployeeAdvanceRequests")
  ai_conversations                                                   ai_conversations[]
  approvalLogs                                                       ApprovalLog[]
  article_feedback                                                   article_feedback[]
  attendances                                                        Attendance[]
  auditLogs                                                          AuditLog[]
  comment_reactions                                                  comment_reactions[]
  contracts                                                          Contract[]
  cost_center_audit_logs                                             cost_center_audit_logs[]
  custodyApproved                                                    CustodyAssignment[]            @relation("CustodyApprover")
  custodyAssignedBy                                                  CustodyAssignment[]            @relation("CustodyAssigner")
  custodyAssignments                                                 CustodyAssignment[]            @relation("EmployeeCustody")
  custodyMaintenanceReports                                          CustodyMaintenance[]           @relation("MaintenanceReporter")
  custodyReturns                                                     CustodyReturn[]                @relation("CustodyReturner")
  custodyReturnReviews                                               CustodyReturn[]                @relation("CustodyReturnReviewer")
  custodyTransferApproved                                            CustodyTransfer[]              @relation("CustodyTransferApprover")
  custodyTransfersFrom                                               CustodyTransfer[]              @relation("CustodyTransferFrom")
  custodyTransferInitiated                                           CustodyTransfer[]              @relation("CustodyTransferInitiator")
  custodyTransfersTo                                                 CustodyTransfer[]              @relation("CustodyTransferTo")
  disciplinaryCases                                                  DisciplinaryCase[]             @relation("EmployeeDisciplinaryCases")
  createdDisciplinaryCases                                           DisciplinaryCase[]             @relation("ManagerCreatedCases")
  emergency_contacts                                                 emergency_contacts[]
  bankAccounts                                                       EmployeeBankAccount[]
  disciplinaryRecords                                                EmployeeDisciplinaryRecord[]
  employeeDocuments                                                  EmployeeDocument[]
  locationLogs                                                       EmployeeLocationLog[]
  salaryAssignments                                                  EmployeeSalaryAssignment[]     @relation("EmployeeSalaryAssignments")
  faceData                                                           FaceData?
  geofenceExitEvents                                                 GeofenceExitEvent[]
  kpi_assignments                                                    kpi_assignments[]
  leaveBalances                                                      LeaveBalance[]
  approvedLeaves                                                     LeaveRequest[]                 @relation("ApproverLeaveRequests")
  hrApprovedLeaves                                                   LeaveRequest[]                 @relation("HRApproverLeaveRequests")
  managerApprovedLeaves                                              LeaveRequest[]                 @relation("ManagerApproverLeaveRequests")
  leaveRequests                                                      LeaveRequest[]                 @relation("EmployeeLeaveRequests")
  approvedLetters                                                    LetterRequest[]                @relation("ApproverLetterRequests")
  hrApprovedLetters                                                  LetterRequest[]                @relation("HRApproverLetterRequests")
  managerApprovedLetters                                             LetterRequest[]                @relation("ManagerApproverLetterRequests")
  letterRequests                                                     LetterRequest[]                @relation("EmployeeLetterRequests")
  location_proofs                                                    location_proofs[]
  notifications                                                      Notification[]
  offline_sync_queue                                                 offline_sync_queue[]
  onboardingProcesses                                                OnboardingProcess[]
  payrollAdjustments                                                 PayrollAdjustment[]
  payslips                                                           Payslip[]
  policyTargets                                                      Policy[]                       @relation("PolicyTargetEmployee")
  policy_violation_predictions                                       policy_violation_predictions[]
  profile_update_requests_profile_update_requests_reviewed_byTousers profile_update_requests[]      @relation("profile_update_requests_reviewed_byTousers")
  profile_update_requests_profile_update_requests_user_idTousers     profile_update_requests[]      @relation("profile_update_requests_user_idTousers")
  programs_programs_created_by_idTousers                             programs[]                     @relation("programs_created_by_idTousers")
  programs_programs_manager_idTousers                                programs[]                     @relation("programs_manager_idTousers")
  programs_programs_owner_idTousers                                  programs[]                     @relation("programs_owner_idTousers")
  project_activities                                                 project_activities[]
  project_budgets_project_budgets_approved_by_idTousers              project_budgets[]              @relation("project_budgets_approved_by_idTousers")
  project_budgets_project_budgets_created_by_idTousers               project_budgets[]              @relation("project_budgets_created_by_idTousers")
  project_members                                                    project_members[]
  project_milestones                                                 project_milestones[]
  project_risks_project_risks_created_by_idTousers                   project_risks[]                @relation("project_risks_created_by_idTousers")
  project_risks_project_risks_owner_idTousers                        project_risks[]                @relation("project_risks_owner_idTousers")
  projects_projects_created_by_idTousers                             projects[]                     @relation("projects_created_by_idTousers")
  projects_projects_manager_idTousers                                projects[]                     @relation("projects_manager_idTousers")
  projects_projects_owner_idTousers                                  projects[]                     @relation("projects_owner_idTousers")
  projects_projects_sponsor_idTousers                                projects[]                     @relation("projects_sponsor_idTousers")
  ceoApprovedRaises                                                  RaiseRequest[]                 @relation("CEOApproverRaiseRequests")
  financeApprovedRaises                                              RaiseRequest[]                 @relation("FinanceApproverRaiseRequests")
  hrApprovedRaises                                                   RaiseRequest[]                 @relation("HRApproverRaiseRequests")
  managerApprovedRaises                                              RaiseRequest[]                 @relation("ManagerApproverRaiseRequests")
  raiseRequests                                                      RaiseRequest[]                 @relation("EmployeeRaiseRequests")
  refreshTokens                                                      RefreshToken[]
  registeredDevices                                                  RegisteredDevice[]
  retroPays                                                          RetroPay[]
  shift_bids                                                         shift_bids[]
  shift_swap_requests_shift_swap_requests_manager_idTousers          shift_swap_requests[]          @relation("shift_swap_requests_manager_idTousers")
  shift_swap_requests_shift_swap_requests_requester_idTousers        shift_swap_requests[]          @relation("shift_swap_requests_requester_idTousers")
  shift_swap_requests_shift_swap_requests_target_user_idTousers      shift_swap_requests[]          @relation("shift_swap_requests_target_user_idTousers")
  shifts                                                             shifts[]
  sprints                                                            sprints[]
  survey_responses                                                   survey_responses[]
  suspiciousAttempts                                                 SuspiciousAttempt[]
  task_activity_logs                                                 task_activity_logs[]
  task_approvals                                                     task_approvals[]
  task_assignments                                                   task_assignments[]
  task_attachments                                                   task_attachments[]
  task_automations                                                   task_automations[]
  task_comments                                                      task_comments[]
  task_evidences_task_evidences_submitted_by_idTousers               task_evidences[]               @relation("task_evidences_submitted_by_idTousers")
  task_evidences_task_evidences_verified_by_idTousers                task_evidences[]               @relation("task_evidences_verified_by_idTousers")
  task_time_logs                                                     task_time_logs[]
  task_watchers                                                      task_watchers[]
  tasks_tasks_approver_idTousers                                     tasks[]                        @relation("tasks_approver_idTousers")
  tasks_tasks_assignee_idTousers                                     tasks[]                        @relation("tasks_assignee_idTousers")
  tasks_tasks_created_by_idTousers                                   tasks[]                        @relation("tasks_created_by_idTousers")
  tasks_tasks_reviewer_idTousers                                     tasks[]                        @relation("tasks_reviewer_idTousers")
  team_calendar_events                                               team_calendar_events[]
  training_requests                                                  training_requests[]
  customFields                                                       UserCustomField[]
  user_notification_preferences                                      user_notification_preferences?
  userPermissions                                                    UserPermission[]
  branch                                                             Branch?                        @relation(fields: [branchId], references: [id])
  company                                                            Company?                       @relation(fields: [companyId], references: [id])
  costCenter                                                         CostCenter?                    @relation(fields: [costCenterId], references: [id])
  department                                                         Department?                    @relation(fields: [departmentId], references: [id])
  job_families                                                       job_families?                  @relation(fields: [jobFamilyId], references: [id])
  jobTitleRef                                                        JobTitle?                      @relation(fields: [jobTitleId], references: [id])
  manager                                                            User?                          @relation("ManagerEmployees", fields: [managerId], references: [id])
  employees                                                          User[]                         @relation("ManagerEmployees")
  role_levels                                                        role_levels?                   @relation(fields: [roleLevelId], references: [id])
  workFromHome                                                       WorkFromHome[]

  @@unique([companyId, employeeCode])
  @@index([companyId, status])
  @@map("users")
}

model UserCustomField {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  fieldName    String   @map("field_name")
  fieldValue   String   @map("field_value")
  fieldType    String   @default("text") @map("field_type")
  sourceHeader String?  @map("source_header")
  importedAt   DateTime @default(now()) @map("imported_at")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, fieldName])
  @@index([userId])
  @@index([fieldName])
  @@map("user_custom_fields")
}

model JobTitle {
  id                 String               @id @default(uuid())
  name               String
  nameEn             String?              @map("name_en")
  isDirectManager    Boolean              @default(false) @map("is_direct_manager")
  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  level              Role                 @default(EMPLOYEE)
  companyId          String?              @map("company_id")
  isActive           Boolean              @default(true) @map("is_active")
  defaultPermissions JobTitlePermission[]
  company            Company?             @relation(fields: [companyId], references: [id])
  policies           Policy[]
  users              User[]

  @@unique([companyId, name])
  @@index([companyId, isActive])
  @@map("job_titles")
}

model RegisteredDevice {
  id                String            @id @default(uuid())
  userId            String            @map("user_id")
  deviceId          String            @map("device_id")
  deviceFingerprint String?           @map("device_fingerprint")
  deviceName        String?           @map("device_name")
  deviceModel       String?           @map("device_model")
  deviceBrand       String?           @map("device_brand")
  platform          DevicePlatform    @default(UNKNOWN)
  osVersion         String?           @map("os_version")
  appVersion        String?           @map("app_version")
  status            DeviceStatus      @default(PENDING)
  isMainDevice      Boolean           @default(false) @map("is_main_device")
  approvedBy        String?           @map("approved_by")
  approvedAt        DateTime?         @map("approved_at")
  blockedReason     String?           @map("blocked_reason")
  lastUsedAt        DateTime?         @map("last_used_at")
  usageCount        Int               @default(0) @map("usage_count")
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  deviceLogs        DeviceAccessLog[]
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, deviceId])
  @@index([deviceId])
  @@index([userId, status])
  @@map("registered_devices")
}

model DeviceAccessLog {
  id                String            @id @default(uuid())
  deviceId          String?           @map("device_id")
  userId            String            @map("user_id")
  attemptedDeviceId String            @map("attempted_device_id")
  actionType        String            @map("action_type")
  isSuccess         Boolean           @map("is_success")
  isKnownDevice     Boolean           @map("is_known_device")
  deviceInfo        String?           @map("device_info")
  ipAddress         String?           @map("ip_address")
  location          String?
  failureReason     String?           @map("failure_reason")
  createdAt         DateTime          @default(now()) @map("created_at")
  device            RegisteredDevice? @relation(fields: [deviceId], references: [id])

  @@index([userId, createdAt])
  @@index([attemptedDeviceId])
  @@map("device_access_logs")
}

model DataUpdateRequest {
  id                   String              @id @default(uuid())
  userId               String              @map("user_id")
  requestType          UpdateRequestType   @map("request_type")
  status               UpdateRequestStatus @default(PENDING)
  reason               String?
  newFaceEmbedding     String?             @map("new_face_embedding")
  newFaceImage         String?             @map("new_face_image")
  faceImageQuality     Float?              @map("face_image_quality")
  newDeviceId          String?             @map("new_device_id")
  newDeviceFingerprint String?             @map("new_device_fingerprint")
  newDeviceName        String?             @map("new_device_name")
  newDeviceModel       String?             @map("new_device_model")
  newDeviceBrand       String?             @map("new_device_brand")
  newDevicePlatform    DevicePlatform?     @map("new_device_platform")
  newDeviceOsVersion   String?             @map("new_device_os_version")
  newDeviceAppVersion  String?             @map("new_device_app_version")
  reviewedBy           String?             @map("reviewed_by")
  reviewedAt           DateTime?           @map("reviewed_at")
  reviewNote           String?             @map("review_note")
  rejectionReason      String?             @map("rejection_reason")
  oldDeviceId          String?             @map("old_device_id")
  createdAt            DateTime            @default(now()) @map("created_at")
  updatedAt            DateTime            @updatedAt @map("updated_at")
  newData              Json?               @map("new_data")

  @@index([userId, status])
  @@index([status, createdAt])
  @@map("data_update_requests")
}

model FaceData {
  id                String    @id @default(uuid())
  userId            String    @unique @map("user_id")
  faceEmbedding     String    @map("face_embedding")
  faceImage         String?   @map("face_image")
  registeredAt      DateTime  @default(now()) @map("registered_at")
  lastVerifiedAt    DateTime? @map("last_verified_at")
  verificationCount Int       @default(0) @map("verification_count")
  imageQuality      Float?    @map("image_quality")
  confidence        Float?
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("face_data")
}

model RefreshToken {
  id         String   @id @default(uuid())
  token      String   @unique
  userId     String   @map("user_id")
  deviceInfo String?  @map("device_info")
  ipAddress  String?  @map("ip_address")
  expiresAt  DateTime @map("expires_at")
  createdAt  DateTime @default(now()) @map("created_at")
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("refresh_tokens")
}

model Branch {
  id                  String            @id @default(uuid())
  name                String
  nameEn              String?           @map("name_en")
  address             String?
  latitude            Decimal           @db.Decimal(10, 8)
  longitude           Decimal           @db.Decimal(11, 8)
  geofenceRadius      Int               @default(100) @map("geofence_radius")
  timezone            String            @default("Asia/Riyadh")
  isActive            Boolean           @default(true) @map("is_active")
  workStartTime       String            @default("09:00") @map("work_start_time")
  workEndTime         String            @default("17:00") @map("work_end_time")
  lateGracePeriod     Int               @default(10) @map("late_grace_period")
  earlyCheckInPeriod  Int               @default(15) @map("early_check_in_period")
  earlyCheckOutPeriod Int               @default(0) @map("early_check_out_period")
  workingDays         String            @default("1,2,3,4,5") @map("working_days")
  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")
  companyId           String?           @map("company_id")
  attendances         Attendance[]
  company             Company?          @relation(fields: [companyId], references: [id])
  custodyItems        CustodyItem[]
  departments         Department[]
  policies            Policy[]
  shift_schedules     shift_schedules[]
  users               User[]
  schedules           WorkSchedule[]

  @@unique([companyId, name])
  @@map("branches")
}

model Department {
  id                     String                   @id @default(uuid())
  name                   String
  nameEn                 String?                  @map("name_en")
  branchId               String                   @map("branch_id")
  workStartTime          String?                  @map("work_start_time")
  workEndTime            String?                  @map("work_end_time")
  createdAt              DateTime                 @default(now()) @map("created_at")
  updatedAt              DateTime                 @updatedAt @map("updated_at")
  companyId              String?                  @map("company_id")
  cost_centers           CostCenter[]
  department_saudization department_saudization[]
  branch                 Branch                   @relation(fields: [branchId], references: [id])
  company                Company?                 @relation(fields: [companyId], references: [id])
  policies               Policy[]
  shift_schedules        shift_schedules[]
  users                  User[]

  @@unique([companyId, name])
  @@map("departments")
}

model WorkSchedule {
  id            String   @id @default(uuid())
  branchId      String   @map("branch_id")
  dayOfWeek     Int      @map("day_of_week")
  workStartTime String   @map("work_start_time")
  workEndTime   String   @map("work_end_time")
  isWorkingDay  Boolean  @default(true) @map("is_working_day")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  companyId     String?  @map("company_id")
  branch        Branch   @relation(fields: [branchId], references: [id])
  company       Company? @relation(fields: [companyId], references: [id])

  @@unique([branchId, dayOfWeek])
  @@map("work_schedules")
}

model Attendance {
  id                     String              @id @default(uuid())
  userId                 String              @map("user_id")
  branchId               String              @map("branch_id")
  date                   DateTime            @db.Date
  checkInTime            DateTime?           @map("check_in_time")
  checkOutTime           DateTime?           @map("check_out_time")
  checkInLatitude        Decimal?            @map("check_in_latitude") @db.Decimal(10, 8)
  checkInLongitude       Decimal?            @map("check_in_longitude") @db.Decimal(11, 8)
  checkInDistance        Int?                @map("check_in_distance")
  checkOutLatitude       Decimal?            @map("check_out_latitude") @db.Decimal(10, 8)
  checkOutLongitude      Decimal?            @map("check_out_longitude") @db.Decimal(11, 8)
  checkOutDistance       Int?                @map("check_out_distance")
  status                 AttendanceStatus    @default(ABSENT)
  lateMinutes            Int                 @default(0) @map("late_minutes")
  earlyLeaveMinutes      Int                 @default(0) @map("early_leave_minutes")
  workingMinutes         Int                 @default(0) @map("working_minutes")
  overtimeMinutes        Int                 @default(0) @map("overtime_minutes")
  notes                  String?
  isWorkFromHome         Boolean             @default(false) @map("is_work_from_home")
  isMockLocation         Boolean             @default(false) @map("is_mock_location")
  deviceInfo             String?             @map("device_info")
  createdAt              DateTime            @default(now()) @map("created_at")
  updatedAt              DateTime            @updatedAt @map("updated_at")
  checkInFaceConfidence  Float?              @map("check_in_face_confidence")
  checkInFaceVerified    Boolean             @default(false) @map("check_in_face_verified")
  checkOutFaceConfidence Float?              @map("check_out_face_confidence")
  checkOutFaceVerified   Boolean             @default(false) @map("check_out_face_verified")
  companyId              String?             @map("company_id")
  branch                 Branch              @relation(fields: [branchId], references: [id])
  company                Company?            @relation(fields: [companyId], references: [id])
  user                   User                @relation(fields: [userId], references: [id])
  geofenceExitEvents     GeofenceExitEvent[]

  @@unique([userId, date])
  @@index([companyId, date])
  @@index([userId, date])
  @@index([branchId, date])
  @@map("attendances")
}

model FaceVerificationLog {
  id               String   @id @default(uuid())
  userId           String   @map("user_id")
  verificationType String   @map("verification_type")
  isSuccess        Boolean  @map("is_success")
  confidence       Float?
  threshold        Float?
  deviceInfo       String?  @map("device_info")
  ipAddress        String?  @map("ip_address")
  attemptImage     String?  @map("attempt_image")
  errorMessage     String?  @map("error_message")
  createdAt        DateTime @default(now()) @map("created_at")

  @@index([userId, createdAt])
  @@map("face_verification_logs")
}

model SuspiciousAttempt {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  attemptType String   @map("attempt_type")
  latitude    Decimal? @db.Decimal(10, 8)
  longitude   Decimal? @db.Decimal(11, 8)
  distance    Int?
  deviceInfo  String?  @map("device_info")
  ipAddress   String?  @map("ip_address")
  notes       String?
  createdAt   DateTime @default(now()) @map("created_at")
  companyId   String?  @map("company_id")
  company     Company? @relation(fields: [companyId], references: [id])
  user        User     @relation(fields: [userId], references: [id])

  @@map("suspicious_attempts")
}

model LeaveTypeConfig {
  id                          String                 @id @default(uuid())
  companyId                   String?                @map("company_id")
  code                        String
  nameAr                      String                 @map("name_ar")
  nameEn                      String?                @map("name_en")
  description                 String?
  category                    LeaveCategory          @default(BALANCED)
  isEntitlementBased          Boolean                @default(true) @map("is_entitlement_based")
  defaultEntitlement          Int                    @default(0) @map("default_entitlement")
  maxBalanceCap               Int?                   @map("max_balance_cap")
  allowCarryForward           Boolean                @default(true) @map("allow_carry_forward")
  maxCarryForwardDays         Int?                   @map("max_carry_forward_days")
  carryForwardExpiryMonths    Int?                   @map("carry_forward_expiry_months")
  isPaid                      Boolean                @default(true) @map("is_paid")
  paymentPercentage           Int                    @default(100) @map("payment_percentage")
  requiresAttachment          Boolean                @default(false) @map("requires_attachment")
  attachmentRequiredAfterDays Int?                   @map("attachment_required_after_days")
  minNoticeDays               Int                    @default(0) @map("min_notice_days")
  minRequestDays              Int                    @default(1) @map("min_request_days")
  maxRequestDays              Int?                   @map("max_request_days")
  allowNegativeBalance        Boolean                @default(false) @map("allow_negative_balance")
  deductFromAnnual            Boolean                @default(false) @map("deduct_from_annual")
  isOneTimeOnly               Boolean                @default(false) @map("is_one_time_only")
  isActive                    Boolean                @default(true) @map("is_active")
  sortOrder                   Int                    @default(0) @map("sort_order")
  createdAt                   DateTime               @default(now()) @map("created_at")
  updatedAt                   DateTime               @updatedAt @map("updated_at")
  leaveBalances               LeaveBalance[]
  entitlementTiers            LeaveEntitlementTier[]
  leaveRequests               LeaveRequest[]         @relation("LeaveTypeConfigRequests")
  company                     Company?               @relation(fields: [companyId], references: [id])
  sickPayTiers                SickPayTier[]

  @@unique([companyId, code])
  @@index([companyId, isActive])
  @@map("leave_type_configs")
}

model LeaveEntitlementTier {
  id              String          @id @default(uuid())
  leaveTypeId     String          @map("leave_type_id")
  minServiceYears Int             @map("min_service_years")
  maxServiceYears Int             @map("max_service_years")
  entitlementDays Int             @map("entitlement_days")
  createdAt       DateTime        @default(now()) @map("created_at")
  leaveType       LeaveTypeConfig @relation(fields: [leaveTypeId], references: [id], onDelete: Cascade)

  @@unique([leaveTypeId, minServiceYears])
  @@index([leaveTypeId])
  @@map("leave_entitlement_tiers")
}

model SickPayTier {
  id             String          @id @default(uuid())
  leaveTypeId    String          @map("leave_type_id")
  fromDay        Int             @map("from_day")
  toDay          Int             @map("to_day")
  paymentPercent Int             @map("payment_percent")
  createdAt      DateTime        @default(now()) @map("created_at")
  leaveType      LeaveTypeConfig @relation(fields: [leaveTypeId], references: [id], onDelete: Cascade)

  @@unique([leaveTypeId, fromDay])
  @@index([leaveTypeId])
  @@map("sick_pay_tiers")
}

model LeaveBalance {
  id                    String          @id @default(uuid())
  companyId             String?         @map("company_id")
  userId                String          @map("user_id")
  leaveTypeId           String          @map("leave_type_id")
  year                  Int
  entitled              Decimal         @default(0) @db.Decimal(5, 2)
  carriedForward        Decimal         @default(0) @map("carried_forward") @db.Decimal(5, 2)
  used                  Decimal         @default(0) @db.Decimal(5, 2)
  pending               Decimal         @default(0) @db.Decimal(5, 2)
  timesUsed             Int             @default(0) @map("times_used")
  carryForwardExpiresAt DateTime?       @map("carry_forward_expires_at")
  createdAt             DateTime        @default(now()) @map("created_at")
  updatedAt             DateTime        @updatedAt @map("updated_at")
  company               Company?        @relation(fields: [companyId], references: [id])
  leaveType             LeaveTypeConfig @relation(fields: [leaveTypeId], references: [id])
  user                  User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, leaveTypeId, year])
  @@index([userId, year])
  @@index([leaveTypeId])
  @@index([companyId])
  @@map("leave_balances")
}

model LeaveRequest {
  id                 String           @id @default(uuid())
  userId             String           @map("user_id")
  type               LeaveType
  startDate          DateTime         @map("start_date") @db.Date
  endDate            DateTime         @map("end_date") @db.Date
  reason             String
  status             LeaveStatus      @default(PENDING)
  approverId         String?          @map("approver_id")
  approverNotes      String?          @map("approver_notes")
  approvedAt         DateTime?        @map("approved_at")
  createdAt          DateTime         @default(now()) @map("created_at")
  updatedAt          DateTime         @updatedAt @map("updated_at")
  requestedDays      Int              @default(1) @map("requested_days")
  approvedDays       Int?             @map("approved_days")
  attachments        Json?
  notes              String?          @db.VarChar(500)
  currentStep        ApprovalStep     @default(MANAGER) @map("current_step")
  managerApproverId  String?          @map("manager_approver_id")
  managerDecision    ApprovalDecision @default(PENDING) @map("manager_decision")
  managerDecisionAt  DateTime?        @map("manager_decision_at")
  managerNotes       String?          @map("manager_notes") @db.VarChar(500)
  hrApproverId       String?          @map("hr_approver_id")
  hrDecision         ApprovalDecision @default(PENDING) @map("hr_decision")
  hrDecisionAt       DateTime?        @map("hr_decision_at")
  hrDecisionNotes    String?          @map("hr_decision_notes") @db.VarChar(500)
  managerAttachments Json?            @map("manager_attachments")
  hrAttachments      Json?            @map("hr_attachments")
  companyId          String?          @map("company_id")
  fullPayDays        Int?             @map("full_pay_days")
  leaveTypeConfigId  String?          @map("leave_type_config_id")
  noticeDaysProvided Int?             @map("notice_days_provided")
  partialPayDays     Int?             @map("partial_pay_days")
  salaryImpact       Decimal?         @map("salary_impact") @db.Decimal(10, 2)
  unpaidDays         Int?             @map("unpaid_days")
  approver           User?            @relation("ApproverLeaveRequests", fields: [approverId], references: [id])
  company            Company?         @relation(fields: [companyId], references: [id])
  hrApprover         User?            @relation("HRApproverLeaveRequests", fields: [hrApproverId], references: [id])
  leaveTypeConfig    LeaveTypeConfig? @relation("LeaveTypeConfigRequests", fields: [leaveTypeConfigId], references: [id])
  managerApprover    User?            @relation("ManagerApproverLeaveRequests", fields: [managerApproverId], references: [id])
  user               User             @relation("EmployeeLeaveRequests", fields: [userId], references: [id])

  @@index([companyId, status])
  @@index([userId, status])
  @@index([leaveTypeConfigId])
  @@map("leave_requests")
}

model LetterRequest {
  id                 String           @id @default(uuid())
  userId             String           @map("user_id")
  type               LetterType
  notes              String?          @db.VarChar(200)
  attachments        Json?
  status             LetterStatus     @default(PENDING)
  approverId         String?          @map("approver_id")
  approverNotes      String?          @map("approver_notes")
  approvedAt         DateTime?        @map("approved_at")
  createdAt          DateTime         @default(now()) @map("created_at")
  updatedAt          DateTime         @updatedAt @map("updated_at")
  currentStep        ApprovalStep     @default(MANAGER) @map("current_step")
  managerApproverId  String?          @map("manager_approver_id")
  managerDecision    ApprovalDecision @default(PENDING) @map("manager_decision")
  managerDecisionAt  DateTime?        @map("manager_decision_at")
  managerNotes       String?          @map("manager_notes") @db.VarChar(500)
  managerAttachments Json?            @map("manager_attachments")
  hrApproverId       String?          @map("hr_approver_id")
  hrDecision         ApprovalDecision @default(PENDING) @map("hr_decision")
  hrDecisionAt       DateTime?        @map("hr_decision_at")
  hrDecisionNotes    String?          @map("hr_decision_notes") @db.VarChar(500)
  hrAttachments      Json?            @map("hr_attachments")
  companyId          String?          @map("company_id")
  approver           User?            @relation("ApproverLetterRequests", fields: [approverId], references: [id])
  company            Company?         @relation(fields: [companyId], references: [id])
  hrApprover         User?            @relation("HRApproverLetterRequests", fields: [hrApproverId], references: [id])
  managerApprover    User?            @relation("ManagerApproverLetterRequests", fields: [managerApproverId], references: [id])
  user               User             @relation("EmployeeLetterRequests", fields: [userId], references: [id])

  @@index([companyId, status])
  @@map("letter_requests")
}

model WorkFromHome {
  id         String   @id @default(uuid())
  userId     String   @map("user_id")
  date       DateTime @db.Date
  reason     String?
  approvedBy String?  @map("approved_by")
  createdAt  DateTime @default(now()) @map("created_at")
  companyId  String?  @map("company_id")
  company    Company? @relation(fields: [companyId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@unique([userId, date])
  @@map("work_from_home")
}

model Notification {
  id         String           @id @default(uuid())
  userId     String           @map("user_id")
  type       NotificationType
  title      String
  titleEn    String?          @map("title_en")
  body       String
  bodyEn     String?          @map("body_en")
  data       Json?
  isRead     Boolean          @default(false) @map("is_read")
  readAt     DateTime?        @map("read_at")
  createdAt  DateTime         @default(now()) @map("created_at")
  companyId  String?          @map("company_id")
  entityId   String?          @map("entity_id")
  entityType String?          @map("entity_type")
  company    Company?         @relation(fields: [companyId], references: [id])
  user       User             @relation(fields: [userId], references: [id])

  @@index([companyId])
  @@index([userId, isRead])
  @@index([userId, isRead, createdAt])
  @@map("notifications")
}

model AuditLog {
  id          String      @id @default(uuid())
  userId      String?     @map("user_id")
  action      AuditAction
  entity      String
  entityId    String?     @map("entity_id")
  oldValue    Json?       @map("old_value")
  newValue    Json?       @map("new_value")
  description String?
  ipAddress   String?     @map("ip_address")
  userAgent   String?     @map("user_agent")
  createdAt   DateTime    @default(now()) @map("created_at")
  companyId   String?     @map("company_id")
  company     Company?    @relation(fields: [companyId], references: [id])
  user        User?       @relation(fields: [userId], references: [id])

  @@index([companyId, createdAt])
  @@index([userId])
  @@index([entity, entityId])
  @@index([createdAt])
  @@map("audit_logs")
}

model Holiday {
  id                  String                 @id @default(uuid())
  name                String
  nameEn              String?                @map("name_en")
  date                DateTime               @db.Date
  isRecurring         Boolean                @default(false) @map("is_recurring")
  createdAt           DateTime               @default(now()) @map("created_at")
  updatedAt           DateTime               @updatedAt @map("updated_at")
  companyId           String?                @map("company_id")
  is_paid             Boolean                @default(true)
  application_type    HolidayApplicationType @default(ALL)
  count_as_work_day   Boolean                @default(false)
  overtime_multiplier Decimal                @default(2.0) @db.Decimal(3, 2)
  notes               String?
  holiday_assignments holiday_assignments[]
  company             Company?               @relation(fields: [companyId], references: [id])

  @@index([companyId, date])
  @@index([date])
  @@map("holidays")
}

model SystemSetting {
  id          String   @id @default(uuid())
  key         String
  value       String
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  companyId   String?  @map("company_id")
  company     Company? @relation(fields: [companyId], references: [id])

  @@unique([key, companyId])
  @@map("system_settings")
}

model Permission {
  id                  String               @id @default(uuid())
  code                String               @unique
  name                String
  nameEn              String?              @map("name_en")
  category            String
  description         String?
  requiresPermission  String?              @map("requires_permission")
  isActive            Boolean              @default(true) @map("is_active")
  sortOrder           Int                  @default(0) @map("sort_order")
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  jobTitlePermissions JobTitlePermission[]
  userPermissions     UserPermission[]

  @@index([category])
  @@index([code])
  @@map("permissions")
}

model UserPermission {
  id                String                   @id @default(uuid())
  userId            String                   @map("user_id")
  permissionId      String                   @map("permission_id")
  scope             PermissionScope          @default(SELF)
  branchId          String?                  @map("branch_id")
  departmentId      String?                  @map("department_id")
  createdAt         DateTime                 @default(now()) @map("created_at")
  companyId         String?                  @map("company_id")
  assignedEmployees UserPermissionEmployee[]
  company           Company?                 @relation(fields: [companyId], references: [id])
  permission        Permission               @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  user              User                     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, permissionId, scope, branchId, departmentId])
  @@index([userId])
  @@index([permissionId])
  @@index([userId, permissionId])
  @@index([scope, branchId])
  @@index([scope, departmentId])
  @@index([companyId])
  @@map("user_permissions")
}

model UserPermissionEmployee {
  id               String         @id @default(uuid())
  userPermissionId String         @map("user_permission_id")
  employeeId       String         @map("employee_id")
  createdAt        DateTime       @default(now()) @map("created_at")
  userPermission   UserPermission @relation(fields: [userPermissionId], references: [id], onDelete: Cascade)

  @@unique([userPermissionId, employeeId])
  @@index([userPermissionId])
  @@index([employeeId])
  @@map("user_permission_employees")
}

model JobTitlePermission {
  id           String          @id @default(uuid())
  jobTitleId   String          @map("job_title_id")
  permissionId String          @map("permission_id")
  createdAt    DateTime        @default(now()) @map("created_at")
  scope        PermissionScope @default(TEAM)
  jobTitle     JobTitle        @relation(fields: [jobTitleId], references: [id], onDelete: Cascade)
  permission   Permission      @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([jobTitleId, permissionId])
  @@index([jobTitleId])
  @@index([permissionId])
  @@map("job_title_permissions")
}

model PermissionAuditLog {
  id             String                @id @default(uuid())
  performedById  String                @map("performed_by_id")
  targetUserId   String                @map("target_user_id")
  targetUserName String                @map("target_user_name")
  action         PermissionAuditAction
  permissionCode String                @map("permission_code")
  permissionName String                @map("permission_name")
  scopeDetails   String?               @map("scope_details")
  ipAddress      String?               @map("ip_address")
  userAgent      String?               @map("user_agent")
  createdAt      DateTime              @default(now()) @map("created_at")
  scope          PermissionScope?
  companyId      String?               @map("company_id")
  company        Company?              @relation(fields: [companyId], references: [id])

  @@index([performedById])
  @@index([targetUserId])
  @@index([createdAt])
  @@index([permissionCode])
  @@map("permission_audit_logs")
}

model ApprovalLog {
  id          String   @id @default(uuid())
  requestType String   @map("request_type")
  requestId   String   @map("request_id")
  step        String
  decision    String
  notes       String?  @db.VarChar(500)
  byUserId    String   @map("by_user_id")
  createdAt   DateTime @default(now()) @map("created_at")
  companyId   String?  @map("company_id")
  byUser      User     @relation(fields: [byUserId], references: [id])
  company     Company? @relation(fields: [companyId], references: [id])

  @@index([requestType, requestId])
  @@index([byUserId])
  @@map("approval_logs")
}

model RaiseRequest {
  id                   String           @id @default(uuid())
  userId               String           @map("user_id")
  type                 RaiseType
  amount               Decimal          @db.Decimal(10, 2)
  effectiveMonth       DateTime         @map("effective_month") @db.Date
  notes                String?          @db.VarChar(200)
  attachments          Json?
  status               RaiseStatus      @default(PENDING)
  currentStep          ApprovalStep     @default(MANAGER) @map("current_step")
  managerApproverId    String?          @map("manager_approver_id")
  managerDecision      ApprovalDecision @default(PENDING) @map("manager_decision")
  managerDecisionAt    DateTime?        @map("manager_decision_at")
  managerNotes         String?          @map("manager_notes") @db.VarChar(500)
  managerAttachments   Json?            @map("manager_attachments")
  hrApproverId         String?          @map("hr_approver_id")
  hrDecision           ApprovalDecision @default(PENDING) @map("hr_decision")
  hrDecisionAt         DateTime?        @map("hr_decision_at")
  hrDecisionNotes      String?          @map("hr_decision_notes") @db.VarChar(500)
  hrAttachments        Json?            @map("hr_attachments")
  createdAt            DateTime         @default(now()) @map("created_at")
  updatedAt            DateTime         @updatedAt @map("updated_at")
  companyId            String?          @map("company_id")
  appliedToSalary      Boolean          @default(false) @map("applied_to_salary")
  approvalChain        Json?            @map("approval_chain")
  ceoApproverId        String?          @map("ceo_approver_id")
  ceoDecision          ApprovalDecision @default(PENDING) @map("ceo_decision")
  ceoDecisionAt        DateTime?        @map("ceo_decision_at")
  ceoDecisionNotes     String?          @map("ceo_decision_notes") @db.VarChar(500)
  financeApproverId    String?          @map("finance_approver_id")
  financeDecision      ApprovalDecision @default(PENDING) @map("finance_decision")
  financeDecisionAt    DateTime?        @map("finance_decision_at")
  financeDecisionNotes String?          @map("finance_decision_notes") @db.VarChar(500)
  ceoApprover          User?            @relation("CEOApproverRaiseRequests", fields: [ceoApproverId], references: [id])
  company              Company?         @relation(fields: [companyId], references: [id])
  financeApprover      User?            @relation("FinanceApproverRaiseRequests", fields: [financeApproverId], references: [id])
  hrApprover           User?            @relation("HRApproverRaiseRequests", fields: [hrApproverId], references: [id])
  managerApprover      User?            @relation("ManagerApproverRaiseRequests", fields: [managerApproverId], references: [id])
  user                 User             @relation("EmployeeRaiseRequests", fields: [userId], references: [id])

  @@index([userId, status])
  @@index([status, createdAt])
  @@map("raise_requests")
}

model AdvanceRequest {
  id                       String           @id @default(uuid())
  userId                   String           @map("user_id")
  type                     AdvanceType
  amount                   Decimal          @db.Decimal(10, 2)
  startDate                DateTime         @map("start_date") @db.Date
  endDate                  DateTime         @map("end_date") @db.Date
  periodMonths             Int              @map("period_months")
  monthlyDeduction         Decimal          @map("monthly_deduction") @db.Decimal(10, 2)
  notes                    String?          @db.VarChar(500)
  attachments              Json?
  status                   String           @default("PENDING")
  currentStep              ApprovalStep     @default(MANAGER) @map("current_step")
  managerApproverId        String?          @map("manager_approver_id")
  managerDecision          ApprovalDecision @default(PENDING) @map("manager_decision")
  managerDecisionAt        DateTime?        @map("manager_decision_at")
  managerNotes             String?          @map("manager_notes") @db.VarChar(500)
  hrApproverId             String?          @map("hr_approver_id")
  hrDecision               ApprovalDecision @default(PENDING) @map("hr_decision")
  hrDecisionAt             DateTime?        @map("hr_decision_at")
  hrDecisionNotes          String?          @map("hr_decision_notes") @db.VarChar(500)
  approvedAmount           Decimal?         @map("approved_amount") @db.Decimal(10, 2)
  approvedMonthlyDeduction Decimal?         @map("approved_monthly_deduction") @db.Decimal(10, 2)
  createdAt                DateTime         @default(now()) @map("created_at")
  updatedAt                DateTime         @updatedAt @map("updated_at")
  companyId                String?          @map("company_id")
  approvalChain            Json?            @map("approval_chain")
  ceoApproverId            String?          @map("ceo_approver_id")
  ceoDecision              ApprovalDecision @default(PENDING) @map("ceo_decision")
  ceoDecisionAt            DateTime?        @map("ceo_decision_at")
  ceoDecisionNotes         String?          @map("ceo_decision_notes") @db.VarChar(500)
  financeApproverId        String?          @map("finance_approver_id")
  financeDecision          ApprovalDecision @default(PENDING) @map("finance_decision")
  financeDecisionAt        DateTime?        @map("finance_decision_at")
  financeDecisionNotes     String?          @map("finance_decision_notes") @db.VarChar(500)
  ceoApprover              User?            @relation("CEOApproverAdvanceRequests", fields: [ceoApproverId], references: [id])
  company                  Company?         @relation(fields: [companyId], references: [id])
  financeApprover          User?            @relation("FinanceApproverAdvanceRequests", fields: [financeApproverId], references: [id])
  hrApprover               User?            @relation("HRApproverAdvanceRequests", fields: [hrApproverId], references: [id])
  managerApprover          User?            @relation("ManagerApproverAdvanceRequests", fields: [managerApproverId], references: [id])
  user                     User             @relation("EmployeeAdvanceRequests", fields: [userId], references: [id])
  payments                 LoanPayment[]

  @@index([userId, status])
  @@index([status, createdAt])
  @@map("advance_requests")
}

model LoanPayment {
  id           String         @id @default(uuid())
  advanceId    String         @map("advance_id")
  amount       Decimal        @db.Decimal(10, 2)
  paymentDate  DateTime       @map("payment_date") @db.Date
  paymentType  String         @default("SALARY_DEDUCTION") @map("payment_type")
  payrollRunId String?        @map("payroll_run_id")
  payslipId    String?        @map("payslip_id")
  notes        String?        @db.VarChar(500)
  createdById  String?        @map("created_by_id")
  createdAt    DateTime       @default(now()) @map("created_at")
  advance      AdvanceRequest @relation(fields: [advanceId], references: [id], onDelete: Cascade)

  @@index([advanceId])
  @@index([paymentDate])
  @@map("loan_payments")
}

model EmployeeBankAccount {
  id                String    @id @default(uuid())
  userId            String    @map("user_id")
  iban              String
  bankName          String    @map("bank_name")
  bankCode          String?   @map("bank_code")
  isPrimary         Boolean   @default(false) @map("is_primary")
  verifiedAt        DateTime? @map("verified_at")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  accountHolderName String?   @map("account_holder_name")
  isVerified        Boolean   @default(false) @map("is_verified")
  swiftCode         String?   @map("swift_code")
  verifiedBy        String?   @map("verified_by")
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, iban])
  @@index([userId, isPrimary])
  @@map("employee_bank_accounts")
}

model CompanyBankAccount {
  id             String   @id @default(uuid())
  companyId      String   @map("company_id")
  bankName       String   @map("bank_name")
  bankCode       String   @map("bank_code")
  iban           String
  accountName    String   @map("account_name")
  swiftCode      String?  @map("swift_code")
  isPrimary      Boolean  @default(false) @map("is_primary")
  isActive       Boolean  @default(true) @map("is_active")
  molId          String?  @map("mol_id")
  wpsParticipant String?  @map("wps_participant")
  accountType    String   @default("CURRENT") @map("account_type")
  currency       String   @default("SAR")
  notes          String?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  company        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, iban])
  @@index([companyId, isPrimary])
  @@index([companyId, isActive])
  @@map("company_bank_accounts")
}

model Contract {
  id                  String           @id @default(uuid())
  userId              String           @map("user_id")
  startDate           DateTime         @map("start_date") @db.Date
  endDate             DateTime?        @map("end_date") @db.Date
  createdAt           DateTime         @default(now()) @map("created_at")
  updatedAt           DateTime         @updatedAt @map("updated_at")
  contractNumber      String?          @unique @map("contract_number")
  documentUrl         String?          @map("document_url")
  previousContractId  String?          @map("previous_contract_id")
  probationEndDate    DateTime?        @map("probation_end_date") @db.Date
  renewalCount        Int              @default(0) @map("renewal_count")
  terminatedAt        DateTime?        @map("terminated_at")
  terminatedBy        String?          @map("terminated_by")
  terminationReason   String?          @map("termination_reason")
  type                ContractType     @default(PERMANENT)
  status              ContractStatus   @default(DRAFT)
  additionalTerms     String?          @map("additional_terms")
  annualLeaveDays     Int              @default(21) @map("annual_leave_days")
  basicSalary         Decimal?         @map("basic_salary") @db.Decimal(10, 2)
  contractJobTitle    String?          @map("contract_job_title")
  employeeSignature   Boolean          @default(false) @map("employee_signature")
  employeeSignedAt    DateTime?        @map("employee_signed_at")
  employerSignature   Boolean          @default(false) @map("employer_signature")
  employerSignedAt    DateTime?        @map("employer_signed_at")
  housingAllowance    Decimal?         @map("housing_allowance") @db.Decimal(10, 2)
  notes               String?          @map("notes")
  noticePeriodDays    Int              @default(30) @map("notice_period_days")
  otherAllowances     Decimal?         @map("other_allowances") @db.Decimal(10, 2)
  qiwaAuthDate        DateTime?        @map("qiwa_auth_date")
  qiwaContractId      String?          @unique @map("qiwa_contract_id")
  qiwaLastSync        DateTime?        @map("qiwa_last_sync")
  qiwaRejectReason    String?          @map("qiwa_reject_reason")
  qiwaStatus          QiwaAuthStatus   @default(NOT_SUBMITTED) @map("qiwa_status")
  signedByUserId      String?          @map("signed_by_user_id")
  totalSalary         Decimal?         @map("total_salary") @db.Decimal(10, 2)
  transportAllowance  Decimal?         @map("transport_allowance") @db.Decimal(10, 2)
  workLocation        String?          @map("work_location")
  workingHoursPerWeek Int              @default(48) @map("working_hours_per_week")
  salaryCycle         PayrollFrequency @default(MONTHLY) @map("salary_cycle")
  user                User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([endDate])
  @@index([qiwaStatus])
  @@map("contracts")
}

model CostCenter {
  id                                                                                   String                    @id @default(uuid())
  code                                                                                 String
  description                                                                          String?
  createdAt                                                                            DateTime                  @default(now()) @map("created_at")
  updatedAt                                                                            DateTime                  @updatedAt @map("updated_at")
  companyId                                                                            String?                   @map("company_id")
  effective_from                                                                       DateTime                  @default(now())
  effective_to                                                                         DateTime?
  is_allow_overbudget                                                                  Boolean                   @default(false)
  level                                                                                Int                       @default(1)
  manager_id                                                                           String?
  name_ar                                                                              String
  name_en                                                                              String?
  parent_id                                                                            String?
  path                                                                                 String?
  status                                                                               String                    @default("ACTIVE")
  type                                                                                 String                    @default("OPERATING")
  version                                                                              Int                       @default(1)
  department_id                                                                        String?
  max_headcount                                                                        Int?
  budget_alert_threshold                                                               Decimal?                  @default(80) @db.Decimal(5, 2)
  name                                                                                 String?                   @db.VarChar(255)
  cost_center_allocations_cost_center_allocations_cost_center_idTocost_centers         cost_center_allocations[] @relation("cost_center_allocations_cost_center_idTocost_centers")
  cost_center_allocations_cost_center_allocations_primary_cost_center_idTocost_centers cost_center_allocations[] @relation("cost_center_allocations_primary_cost_center_idTocost_centers")
  cost_center_audit_logs                                                               cost_center_audit_logs[]
  cost_center_budgets                                                                  cost_center_budgets[]
  company                                                                              Company?                  @relation(fields: [companyId], references: [id])
  departments                                                                          Department?               @relation(fields: [department_id], references: [id])
  cost_centers                                                                         CostCenter?               @relation("cost_centersTocost_centers", fields: [parent_id], references: [id])
  other_cost_centers                                                                   CostCenter[]              @relation("cost_centersTocost_centers")
  payslip_lines                                                                        PayslipLine[]
  users                                                                                User[]

  @@unique([companyId, code, version])
  @@index([companyId, status])
  @@index([effective_from, effective_to])
  @@index([parent_id])
  @@map("cost_centers")
}

model SalaryComponent {
  id             String                @id @default(uuid())
  code           String
  nameAr         String                @map("name_ar")
  nameEn         String?               @map("name_en")
  type           SalaryComponentType
  nature         SalaryComponentNature @default(FIXED)
  description    String?
  gosiEligible   Boolean               @default(false) @map("gosi_eligible")
  otEligible     Boolean               @default(false) @map("ot_eligible")
  formula        String?
  createdAt      DateTime              @default(now()) @map("created_at")
  updatedAt      DateTime              @updatedAt @map("updated_at")
  companyId      String?               @map("company_id")
  decimals       Int                   @default(2)
  effectiveDate  DateTime              @default(now()) @map("effective_date")
  endDate        DateTime?             @map("end_date")
  isActive       Boolean               @default(true) @map("is_active")
  priority       Int                   @default(100)
  roundingMode   String                @default("ROUND") @map("rounding_mode")
  taxable        Boolean               @default(false)
  version        Int                   @default(1)
  eosEligible    Boolean               @default(false) @map("eos_eligible")
  isProrated     Boolean               @default(true) @map("is_prorated")
  PayslipLine    PayslipLine[]
  policyRules    PolicyRule[]          @relation("PolicyOutputComponent")
  company        Company?              @relation(fields: [companyId], references: [id])
  structureLines SalaryStructureLine[]

  @@unique([companyId, type, code, version])
  @@index([companyId, isActive])
  @@index([effectiveDate, endDate])
  @@map("salary_components")
}

model SalaryStructure {
  id            String                     @id @default(uuid())
  name          String
  description   String?
  isActive      Boolean                    @default(true) @map("is_active")
  createdAt     DateTime                   @default(now()) @map("created_at")
  updatedAt     DateTime                   @updatedAt @map("updated_at")
  companyId     String?                    @map("company_id")
  effectiveDate DateTime                   @default(now()) @map("effective_date")
  endDate       DateTime?                  @map("end_date")
  version       Int                        @default(1)
  assignments   EmployeeSalaryAssignment[]
  lines         SalaryStructureLine[]
  company       Company?                   @relation(fields: [companyId], references: [id])

  @@unique([companyId, name, version])
  @@index([companyId, isActive])
  @@index([effectiveDate, endDate])
  @@map("salary_structures")
}

model SalaryStructureLine {
  id          String          @id @default(uuid())
  structureId String          @map("structure_id")
  componentId String          @map("component_id")
  amount      Decimal         @default(0) @db.Decimal(10, 2)
  percentage  Decimal?        @db.Decimal(5, 2)
  priority    Int             @default(0)
  component   SalaryComponent @relation(fields: [componentId], references: [id])
  structure   SalaryStructure @relation(fields: [structureId], references: [id], onDelete: Cascade)

  @@map("salary_structure_lines")
}

model EmployeeSalaryAssignment {
  id            String          @id @default(uuid())
  employeeId    String          @map("employee_id")
  structureId   String          @map("structure_id")
  baseSalary    Decimal         @map("base_salary") @db.Decimal(10, 2)
  effectiveDate DateTime        @map("effective_date") @db.Date
  endDate       DateTime?       @map("end_date") @db.Date
  isActive      Boolean         @default(true) @map("is_active")
  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")
  employee      User            @relation("EmployeeSalaryAssignments", fields: [employeeId], references: [id])
  structure     SalaryStructure @relation(fields: [structureId], references: [id])

  @@map("employee_salary_assignments")
}

model PayslipLine {
  id             String            @id @default(uuid())
  payslipId      String            @map("payslip_id")
  componentId    String            @map("component_id")
  amount         Decimal           @db.Decimal(10, 2)
  createdAt      DateTime          @default(now()) @map("created_at")
  descriptionAr  String?           @map("description_ar")
  rate           Decimal?          @db.Decimal(10, 4)
  sign           String            @default("EARNING")
  sourceRef      String?           @map("source_ref")
  sourceType     PayslipLineSource @default(STRUCTURE) @map("source_type")
  units          Decimal?          @db.Decimal(10, 2)
  cost_center_id String?
  component      SalaryComponent   @relation(fields: [componentId], references: [id])
  cost_centers   CostCenter?       @relation(fields: [cost_center_id], references: [id])
  payslip        Payslip           @relation(fields: [payslipId], references: [id], onDelete: Cascade)

  @@index([payslipId, sourceType])
  @@index([payslipId, componentId])
  @@index([cost_center_id])
  @@map("payslip_lines")
}

model PayrollPeriod {
  id                 String              @id @default(uuid())
  month              Int
  year               Int
  startDate          DateTime            @map("start_date") @db.Date
  endDate            DateTime            @map("end_date") @db.Date
  status             PayrollStatus       @default(DRAFT)
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  companyId          String?             @map("company_id")
  cutOffDate         DateTime?           @map("cut_off_date") @db.Date
  inputsLockedAt     DateTime?           @map("inputs_locked_at")
  lockedAt           DateTime?           @map("locked_at")
  lockedBy           String?             @map("locked_by")
  frequency          PayrollFrequency    @default(MONTHLY)
  disciplinaryCases  DisciplinaryCase[]
  payrollAdjustments PayrollAdjustment[]
  company            Company?            @relation(fields: [companyId], references: [id])
  runs               PayrollRun[]
  payslips           Payslip[]

  @@index([companyId, status])
  @@index([companyId, startDate, endDate])
  @@map("payroll_periods")
}

model PayrollRun {
  id                String            @id @default(uuid())
  periodId          String            @map("period_id")
  runDate           DateTime          @default(now()) @map("run_date")
  status            PayrollStatus     @default(DRAFT)
  processedBy       String?           @map("processed_by")
  companyId         String?           @map("company_id")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  createdAt         DateTime          @default(now()) @map("created_at")
  calculatedAt      DateTime?         @map("calculated_at")
  calculatedBy      String?           @map("calculated_by")
  financeApprovedAt DateTime?         @map("finance_approved_at")
  financeApprovedBy String?           @map("finance_approved_by")
  hrApprovedAt      DateTime?         @map("hr_approved_at")
  hrApprovedBy      String?           @map("hr_approved_by")
  lockedAt          DateTime?         @map("locked_at")
  lockedBy          String?           @map("locked_by")
  paidAt            DateTime?         @map("paid_at")
  adjustmentReason  String?           @map("adjustment_reason")
  isAdjustment      Boolean           @default(false) @map("is_adjustment")
  originalRunId     String?           @map("original_run_id")
  mudadSubmissions  MudadSubmission[]
  ledger            PayrollLedger?
  company           Company?          @relation(fields: [companyId], references: [id])
  originalRun       PayrollRun?       @relation("AdjustmentRuns", fields: [originalRunId], references: [id])
  adjustmentRuns    PayrollRun[]      @relation("AdjustmentRuns")
  period            PayrollPeriod     @relation(fields: [periodId], references: [id])
  payslips          Payslip[]
  wpsSubmissions    WpsSubmission[]

  @@index([companyId, status])
  @@index([periodId])
  @@index([originalRunId])
  @@map("payroll_runs")
}

model Payslip {
  id               String        @id @default(uuid())
  employeeId       String        @map("employee_id")
  periodId         String        @map("period_id")
  runId            String?       @map("run_id")
  baseSalary       Decimal       @map("base_salary") @db.Decimal(10, 2)
  grossSalary      Decimal       @map("gross_salary") @db.Decimal(10, 2)
  totalDeductions  Decimal       @map("total_deductions") @db.Decimal(10, 2)
  netSalary        Decimal       @map("net_salary") @db.Decimal(10, 2)
  status           PayrollStatus @default(DRAFT)
  createdAt        DateTime      @default(now()) @map("created_at")
  updatedAt        DateTime      @updatedAt @map("updated_at")
  calculationTrace Json?         @map("calculation_trace")
  companyId        String?       @map("company_id")
  lines            PayslipLine[]
  company          Company?      @relation(fields: [companyId], references: [id])
  employee         User          @relation(fields: [employeeId], references: [id])
  period           PayrollPeriod @relation(fields: [periodId], references: [id])
  run              PayrollRun?   @relation(fields: [runId], references: [id])

  @@map("payslips")
}

model GosiConfig {
  id                String    @id @default(uuid())
  employeeRate      Decimal   @map("employee_rate") @db.Decimal(5, 2)
  employerRate      Decimal   @map("employer_rate") @db.Decimal(5, 2)
  sanedRate         Decimal   @map("saned_rate") @db.Decimal(5, 2)
  hazardRate        Decimal   @map("hazard_rate") @db.Decimal(5, 2)
  maxCapAmount      Decimal   @default(45000) @map("max_cap_amount") @db.Decimal(10, 2)
  isSaudiOnly       Boolean   @default(true) @map("is_saudi_only")
  isActive          Boolean   @default(true) @map("is_active")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  companyId         String?   @map("company_id")
  effectiveDate     DateTime  @default(now()) @map("effective_date") @db.Date
  endDate           DateTime? @map("end_date") @db.Date
  includeAllowances Boolean   @default(false) @map("include_allowances")
  minBaseSalary     Decimal   @default(0) @map("min_base_salary") @db.Decimal(10, 2)
  notes             String?
  version           Int       @default(1)
  company           Company?  @relation(fields: [companyId], references: [id])

  @@unique([companyId, version])
  @@index([companyId, isActive])
  @@index([effectiveDate, endDate])
  @@map("gosi_configs")
}

model RetroPay {
  id            String         @id @default(uuid())
  employeeId    String         @map("employee_id")
  reason        String
  effectiveFrom DateTime       @map("effective_from")
  effectiveTo   DateTime       @map("effective_to")
  oldAmount     Decimal        @map("old_amount") @db.Decimal(10, 2)
  newAmount     Decimal        @map("new_amount") @db.Decimal(10, 2)
  difference    Decimal        @db.Decimal(10, 2)
  monthsCount   Int            @map("months_count")
  totalAmount   Decimal        @map("total_amount") @db.Decimal(10, 2)
  status        RetroPayStatus @default(PENDING)
  notes         String?
  createdById   String?        @map("created_by_id")
  approvedById  String?        @map("approved_by_id")
  approvedAt    DateTime?      @map("approved_at")
  paidAt        DateTime?      @map("paid_at")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  companyId     String?        @map("company_id")
  company       Company?       @relation(fields: [companyId], references: [id])
  employee      User           @relation(fields: [employeeId], references: [id])

  @@map("retro_pays")
}

model Policy {
  id             String       @id @default(uuid())
  code           String
  nameAr         String       @map("name_ar")
  nameEn         String?      @map("name_en")
  description    String?
  type           PolicyType
  scope          PolicyScope  @default(COMPANY)
  effectiveFrom  DateTime     @map("effective_from")
  effectiveTo    DateTime?    @map("effective_to")
  branchId       String?      @map("branch_id")
  departmentId   String?      @map("department_id")
  jobTitleId     String?      @map("job_title_id")
  employeeId     String?      @map("employee_id")
  settings       Json         @default("{}")
  isActive       Boolean      @default(true) @map("is_active")
  priority       Int          @default(0)
  createdById    String?      @map("created_by_id")
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  companyId      String?      @map("company_id")
  scopeRank      Int          @default(1) @map("scope_rank")
  branch         Branch?      @relation(fields: [branchId], references: [id])
  company        Company?     @relation(fields: [companyId], references: [id])
  department     Department?  @relation(fields: [departmentId], references: [id])
  targetEmployee User?        @relation("PolicyTargetEmployee", fields: [employeeId], references: [id])
  jobTitle       JobTitle?    @relation(fields: [jobTitleId], references: [id])
  rules          PolicyRule[]

  @@unique([companyId, code])
  @@index([companyId, type, scope, effectiveFrom])
  @@index([type, scope, isActive])
  @@index([effectiveFrom, effectiveTo])
  @@index([branchId])
  @@index([departmentId])
  @@index([jobTitleId])
  @@index([employeeId])
  @@map("policies")
}

model PolicyRule {
  id                String           @id @default(uuid())
  policyId          String           @map("policy_id")
  code              String
  nameAr            String           @map("name_ar")
  conditions        Json             @default("{}")
  valueType         String           @map("value_type")
  value             String
  isActive          Boolean          @default(true) @map("is_active")
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")
  outputComponentId String?          @map("output_component_id")
  outputSign        OutputSign       @default(EARNING) @map("output_sign")
  ruleOrder         Int              @default(0) @map("rule_order")
  outputComponent   SalaryComponent? @relation("PolicyOutputComponent", fields: [outputComponentId], references: [id])
  policy            Policy           @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@unique([policyId, code])
  @@index([policyId, isActive, ruleOrder])
  @@index([outputComponentId])
  @@map("policy_rules")
}

model SmartPolicy {
  id                               String                             @id @default(uuid())
  companyId                        String                             @map("company_id")
  originalText                     String                             @map("original_text")
  name                             String?
  description                      String?
  triggerEvent                     SmartPolicyTrigger                 @map("trigger_event")
  triggerSubEvent                  String?                            @map("trigger_sub_event")
  parsedRule                       Json                               @map("parsed_rule")
  conditions                       Json                               @default("[]")
  actions                          Json                               @default("[]")
  scopeType                        String                             @default("ALL") @map("scope_type")
  scopeId                          String?                            @map("scope_id")
  scopeName                        String?                            @map("scope_name")
  status                           SmartPolicyStatus                  @default(DRAFT)
  isActive                         Boolean                            @default(false) @map("is_active")
  priority                         Int                                @default(0)
  effectiveFrom                    DateTime?                          @map("effective_from")
  effectiveTo                      DateTime?                          @map("effective_to")
  aiExplanation                    String?                            @map("ai_explanation")
  clarificationNeeded              String?                            @map("clarification_needed")
  executionCount                   Int                                @default(0) @map("execution_count")
  lastExecutedAt                   DateTime?                          @map("last_executed_at")
  totalAmountPaid                  Decimal                            @default(0) @map("total_amount_paid") @db.Decimal(12, 2)
  totalAmountDeduct                Decimal                            @default(0) @map("total_amount_deduct") @db.Decimal(12, 2)
  createdById                      String?                            @map("created_by_id")
  approvedById                     String?                            @map("approved_by_id")
  approvedAt                       DateTime?                          @map("approved_at")
  createdAt                        DateTime                           @default(now()) @map("created_at")
  updatedAt                        DateTime                           @updatedAt @map("updated_at")
  current_version                  Int                                @default(1)
  requires_approval                Boolean                            @default(true)
  block_lower_priority             Boolean                            @default(false)
  depends_on_policies              String[]
  execution_group                  String?
  execution_order                  Int                                @default(100)
  condition_logic                  String                             @default("ALL")
  lookback_months                  Int?
  policy_simulation_runs           policy_simulation_runs[]
  company                          Company                            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  smart_policy_analytics           smart_policy_analytics[]
  smart_policy_approvals           smart_policy_approvals[]
  smart_policy_exceptions          smart_policy_exceptions[]
  executions                       SmartPolicyExecution[]
  smart_policy_occurrence_trackers smart_policy_occurrence_trackers[]
  smart_policy_retro_applications  smart_policy_retro_applications[]
  smart_policy_versions            smart_policy_versions[]

  @@index([companyId, status, isActive])
  @@index([companyId, triggerEvent])
  @@index([status, isActive])
  @@map("smart_policies")
}

model SmartPolicyExecution {
  id              String      @id @default(uuid())
  policyId        String      @map("policy_id")
  employeeId      String      @map("employee_id")
  employeeName    String      @map("employee_name")
  triggerEvent    String      @map("trigger_event")
  triggerSubEvent String?     @map("trigger_sub_event")
  triggerData     Json?       @map("trigger_data")
  conditionsMet   Boolean     @map("conditions_met")
  conditionsLog   Json?       @map("conditions_log")
  actionType      String?     @map("action_type")
  actionValue     Decimal?    @map("action_value") @db.Decimal(10, 2)
  actionResult    Json?       @map("action_result")
  isSuccess       Boolean     @map("is_success")
  errorMessage    String?     @map("error_message")
  payrollPeriod   String?     @map("payroll_period")
  executedAt      DateTime    @default(now()) @map("executed_at")
  policy          SmartPolicy @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@index([policyId, executedAt])
  @@index([employeeId, executedAt])
  @@index([triggerEvent])
  @@map("smart_policy_executions")
}

model MudadSubmission {
  id               String      @id @default(uuid())
  companyId        String      @map("company_id")
  payrollRunId     String      @map("payroll_run_id")
  period           String
  submissionType   String      @default("SALARY") @map("submission_type")
  status           MudadStatus @default(PENDING)
  wpsFileUrl       String?     @map("wps_file_url")
  mudadRef         String?     @map("mudad_ref")
  totalAmount      Decimal     @map("total_amount") @db.Decimal(12, 2)
  employeeCount    Int         @map("employee_count")
  preparedAt       DateTime?   @map("prepared_at")
  preparedBy       String?     @map("prepared_by")
  submittedAt      DateTime?   @map("submitted_at")
  submittedBy      String?     @map("submitted_by")
  acceptedAt       DateTime?   @map("accepted_at")
  rejectedAt       DateTime?   @map("rejected_at")
  rejectionNote    String?     @map("rejection_note")
  fileHashSha256   String?     @map("file_hash_sha256") @db.VarChar(64)
  fileSize         Int?        @map("file_size")
  generatorVersion String?     @map("generator_version")
  notes            String?
  createdAt        DateTime    @default(now()) @map("created_at")
  updatedAt        DateTime    @updatedAt @map("updated_at")
  company          Company     @relation(fields: [companyId], references: [id])
  payrollRun       PayrollRun  @relation(fields: [payrollRunId], references: [id])

  @@unique([payrollRunId, submissionType])
  @@index([companyId, period])
  @@index([status])
  @@map("mudad_submissions")
}

model WpsSubmission {
  id               String     @id @default(uuid())
  companyId        String     @map("company_id")
  payrollRunId     String     @map("payroll_run_id")
  filename         String
  fileFormat       String     @default("WPS") @map("file_format")
  fileUrl          String?    @map("file_url")
  totalAmount      Decimal    @map("total_amount") @db.Decimal(12, 2)
  employeeCount    Int        @map("employee_count")
  status           WpsStatus  @default(GENERATED)
  bankName         String?    @map("bank_name")
  bankRef          String?    @map("bank_ref")
  generatedAt      DateTime   @default(now()) @map("generated_at")
  generatedBy      String?    @map("generated_by")
  downloadedAt     DateTime?  @map("downloaded_at")
  submittedAt      DateTime?  @map("submitted_at")
  processedAt      DateTime?  @map("processed_at")
  fileHashSha256   String?    @map("file_hash_sha256") @db.VarChar(64)
  generatorVersion String?    @map("generator_version")
  notes            String?
  errors           Json?
  createdAt        DateTime   @default(now()) @map("created_at")
  updatedAt        DateTime   @updatedAt @map("updated_at")
  attachmentUrl    String?    @map("attachment_url")
  downloadedBy     String?    @map("downloaded_by")
  submittedBy      String?    @map("submitted_by")
  company          Company    @relation(fields: [companyId], references: [id])
  payrollRun       PayrollRun @relation(fields: [payrollRunId], references: [id])

  @@index([companyId, status])
  @@index([payrollRunId])
  @@map("wps_submissions")
}

model CompanyDisciplinaryPolicy {
  id                           String              @id @default(uuid())
  companyId                    String              @unique @map("company_id")
  incidentMaxAgeDays           Int                 @default(30) @map("incident_max_age_days")
  decisionDeadlineDays         Int                 @default(30) @map("decision_deadline_days")
  objectionWindowDays          Int                 @default(15) @map("objection_window_days")
  allowRetrospectiveIncidents  Boolean             @default(false) @map("allow_retrospective_incidents")
  autoApplyToOpenPayrollPeriod Boolean             @default(true) @map("auto_apply_to_open_payroll_period")
  deductionBasePolicy          DeductionBasePolicy @default(BASIC_FIXED) @map("deduction_base_policy")
  createdAt                    DateTime            @default(now()) @map("created_at")
  updatedAt                    DateTime            @updatedAt @map("updated_at")
  company                      Company             @relation(fields: [companyId], references: [id])

  @@map("company_disciplinary_policies")
}

model DisciplinaryCase {
  id                            String                       @id @default(uuid())
  companyId                     String                       @map("company_id")
  caseCode                      String                       @map("case_code")
  employeeId                    String                       @map("employee_id")
  managerId                     String                       @map("manager_id")
  title                         String
  incidentDate                  DateTime                     @map("incident_date")
  incidentLocation              String                       @map("incident_location")
  involvedParties               Json?                        @map("involved_parties")
  description                   String
  status                        DisciplinaryStatus           @default(SUBMITTED_TO_HR)
  stage                         DisciplinaryStage            @default(MANAGER_REQUEST)
  incidentMaxAgeDaysSnapshot    Int                          @map("incident_max_age_days_snapshot")
  decisionDeadlineDaysSnapshot  Int                          @map("decision_deadline_days_snapshot")
  objectionWindowDaysSnapshot   Int                          @map("objection_window_days_snapshot")
  allowRetrospectiveSnapshot    Boolean                      @map("allow_retrospective_snapshot")
  deductionBasePolicySnapshot   DeductionBasePolicy          @map("deduction_base_policy_snapshot")
  isRetrospective               Boolean                      @default(false) @map("is_retrospective")
  retrospectiveReason           String?                      @map("retrospective_reason")
  hrInitialAction               String?                      @map("hr_initial_action")
  hrInitialReason               String?                      @map("hr_initial_reason")
  officialInvestigationOpenedAt DateTime?                    @map("official_investigation_opened_at")
  hearingDatetime               DateTime?                    @map("hearing_datetime")
  hearingLocation               String?                      @map("hearing_location")
  decisionType                  DecisionType?                @map("decision_type")
  decisionReason                String?                      @map("decision_reason")
  decisionCreatedAt             DateTime?                    @map("decision_created_at")
  penaltyUnit                   AdjustmentUnit?              @map("penalty_unit")
  penaltyValue                  Decimal?                     @map("penalty_value") @db.Decimal(10, 2)
  penaltyEffectiveDate          DateTime?                    @map("penalty_effective_date") @db.Date
  payrollPeriodId               String?                      @map("payroll_period_id")
  employeeAckStatus             String?                      @map("employee_ack_status")
  employeeAckAt                 DateTime?                    @map("employee_ack_at")
  objectionText                 String?                      @map("objection_text")
  objectionSubmittedAt          DateTime?                    @map("objection_submitted_at")
  hrAfterObjectionAction        String?                      @map("hr_after_objection_action")
  hrAfterObjectionReason        String?                      @map("hr_after_objection_reason")
  finalizedAt                   DateTime?                    @map("finalized_at")
  legalHold                     Boolean                      @default(false) @map("legal_hold")
  createdAt                     DateTime                     @default(now()) @map("created_at")
  updatedAt                     DateTime                     @updatedAt @map("updated_at")
  violationType                 String?                      @map("violation_type")
  attachments                   CaseAttachment[]
  events                        CaseEvent[]
  minutes                       CaseMinute[]
  company                       Company                      @relation(fields: [companyId], references: [id])
  employee                      User                         @relation("EmployeeDisciplinaryCases", fields: [employeeId], references: [id])
  manager                       User                         @relation("ManagerCreatedCases", fields: [managerId], references: [id])
  payrollPeriod                 PayrollPeriod?               @relation(fields: [payrollPeriodId], references: [id])
  records                       EmployeeDisciplinaryRecord[]
  adjustments                   PayrollAdjustment[]

  @@unique([companyId, caseCode])
  @@index([companyId, status])
  @@index([employeeId])
  @@index([companyId, employeeId])
  @@map("disciplinary_cases")
}

model CaseEvent {
  id          String           @id @default(uuid())
  caseId      String           @map("case_id")
  actorUserId String?          @map("actor_user_id")
  eventType   CaseEventType    @map("event_type")
  message     String?
  metadata    Json?
  createdAt   DateTime         @default(now()) @map("created_at")
  case        DisciplinaryCase @relation(fields: [caseId], references: [id])

  @@index([caseId, createdAt])
  @@map("case_events")
}

model CaseAttachment {
  id             String           @id @default(uuid())
  caseId         String           @map("case_id")
  uploaderUserId String           @map("uploader_user_id")
  fileUrl        String           @map("file_url")
  fileName       String           @map("file_name")
  fileType       String           @map("file_type")
  createdAt      DateTime         @default(now()) @map("created_at")
  case           DisciplinaryCase @relation(fields: [caseId], references: [id])

  @@map("case_attachments")
}

model CaseMinute {
  id             String           @id @default(uuid())
  caseId         String           @map("case_id")
  sessionNo      Int              @map("session_no")
  minutesText    String?          @map("minutes_text")
  minutesFileUrl String?          @map("minutes_file_url")
  createdByHrId  String           @map("created_by_hr_id")
  createdAt      DateTime         @default(now()) @map("created_at")
  case           DisciplinaryCase @relation(fields: [caseId], references: [id])

  @@map("case_minutes")
}

model EmployeeDisciplinaryRecord {
  id              String           @id @default(uuid())
  employeeId      String           @map("employee_id")
  caseId          String           @map("case_id")
  decisionType    DecisionType     @map("decision_type")
  reason          String?
  effectiveDate   DateTime         @map("effective_date")
  penaltyMetadata Json?            @map("penalty_metadata")
  createdAt       DateTime         @default(now()) @map("created_at")
  case            DisciplinaryCase @relation(fields: [caseId], references: [id])
  employee        User             @relation(fields: [employeeId], references: [id])

  @@map("employee_disciplinary_records")
}

model PayrollAdjustment {
  id              String                  @id @default(uuid())
  companyId       String                  @map("company_id")
  employeeId      String                  @map("employee_id")
  caseId          String                  @map("case_id")
  payrollPeriodId String                  @map("payroll_period_id")
  adjustmentType  String                  @map("adjustment_type")
  unit            AdjustmentUnit
  value           Decimal                 @db.Decimal(10, 2)
  amount          Decimal?                @db.Decimal(10, 2)
  status          PayrollAdjustmentStatus @default(PENDING)
  description     String?
  effectiveDate   DateTime?               @map("effective_date") @db.Date
  postedAt        DateTime?               @map("posted_at")
  reversedAt      DateTime?               @map("reversed_at")
  createdAt       DateTime                @default(now()) @map("created_at")
  updatedAt       DateTime                @updatedAt @map("updated_at")
  case            DisciplinaryCase        @relation(fields: [caseId], references: [id])
  company         Company                 @relation(fields: [companyId], references: [id])
  employee        User                    @relation(fields: [employeeId], references: [id])
  payrollPeriod   PayrollPeriod           @relation(fields: [payrollPeriodId], references: [id])

  @@unique([companyId, caseId])
  @@index([companyId, employeeId, payrollPeriodId, status])
  @@index([employeeId, payrollPeriodId])
  @@index([payrollPeriodId, status])
  @@map("payroll_adjustments")
}

model SubmissionStatusLog {
  id              String               @id @default(uuid())
  companyId       String               @map("company_id")
  entityType      SubmissionEntityType @map("entity_type")
  entityId        String               @map("entity_id")
  fromStatus      String?              @map("from_status")
  toStatus        String               @map("to_status")
  changedByUserId String               @map("changed_by_user_id")
  changedAt       DateTime             @default(now()) @map("changed_at")
  reason          String?
  externalRef     String?              @map("external_ref")
  meta            Json?
  createdAt       DateTime             @default(now()) @map("created_at")
  company         Company              @relation(fields: [companyId], references: [id])

  @@index([companyId, entityType, entityId])
  @@index([changedAt])
  @@map("submission_status_logs")
}

model ApprovalChainConfig {
  id          String              @id @default(uuid())
  companyId   String              @map("company_id")
  requestType ApprovalRequestType @map("request_type")
  minAmount   Decimal?            @map("min_amount") @db.Decimal(12, 2)
  maxAmount   Decimal?            @map("max_amount") @db.Decimal(12, 2)
  minDays     Int?                @map("min_days")
  maxDays     Int?                @map("max_days")
  chain       Json
  name        String              @db.VarChar(100)
  description String?             @db.VarChar(500)
  priority    Int                 @default(0)
  isActive    Boolean             @default(true) @map("is_active")
  createdAt   DateTime            @default(now()) @map("created_at")
  updatedAt   DateTime            @updatedAt @map("updated_at")
  company     Company             @relation(fields: [companyId], references: [id])

  @@index([companyId, requestType, isActive])
  @@map("approval_chain_configs")
}

model CustodyCategory {
  id                   String        @id @default(uuid())
  companyId            String        @map("company_id")
  name                 String
  nameEn               String?       @map("name_en")
  description          String?
  icon                 String?
  requiresApproval     Boolean       @default(true) @map("requires_approval")
  requiresSerialNumber Boolean       @default(true) @map("requires_serial_number")
  depreciationYears    Int?          @map("depreciation_years")
  isActive             Boolean       @default(true) @map("is_active")
  createdAt            DateTime      @default(now()) @map("created_at")
  updatedAt            DateTime      @updatedAt @map("updated_at")
  company              Company       @relation(fields: [companyId], references: [id])
  items                CustodyItem[]

  @@unique([companyId, name])
  @@map("custody_categories")
}

model CustodyItem {
  id                String               @id @default(uuid())
  companyId         String               @map("company_id")
  categoryId        String               @map("category_id")
  code              String
  name              String
  nameEn            String?              @map("name_en")
  description       String?
  serialNumber      String?              @map("serial_number")
  model             String?
  brand             String?
  barcode           String?
  qrCode            String?              @map("qr_code")
  purchaseDate      DateTime?            @map("purchase_date")
  purchasePrice     Decimal?             @map("purchase_price") @db.Decimal(12, 2)
  warrantyExpiry    DateTime?            @map("warranty_expiry")
  vendor            String?
  invoiceNumber     String?              @map("invoice_number")
  status            CustodyItemStatus    @default(AVAILABLE)
  condition         CustodyCondition     @default(NEW)
  currentLocation   String?              @map("current_location")
  notes             String?
  imageUrl          String?              @map("image_url")
  attachments       Json?                @default("[]")
  branchId          String?              @map("branch_id")
  currentAssigneeId String?              @map("current_assignee_id")
  createdAt         DateTime             @default(now()) @map("created_at")
  updatedAt         DateTime             @updatedAt @map("updated_at")
  assignments       CustodyAssignment[]
  branch            Branch?              @relation(fields: [branchId], references: [id])
  category          CustodyCategory      @relation(fields: [categoryId], references: [id])
  company           Company              @relation(fields: [companyId], references: [id])
  maintenances      CustodyMaintenance[]
  returns           CustodyReturn[]
  transfers         CustodyTransfer[]

  @@unique([companyId, code])
  @@index([companyId, status])
  @@index([categoryId])
  @@index([currentAssigneeId])
  @@map("custody_items")
}

model CustodyAssignment {
  id                String                  @id @default(uuid())
  companyId         String                  @map("company_id")
  custodyItemId     String                  @map("custody_item_id")
  employeeId        String                  @map("employee_id")
  assignedAt        DateTime                @default(now()) @map("assigned_at")
  expectedReturn    DateTime?               @map("expected_return")
  actualReturn      DateTime?               @map("actual_return")
  status            CustodyAssignmentStatus @default(PENDING)
  conditionOnAssign CustodyCondition?       @map("condition_on_assign")
  conditionOnReturn CustodyCondition?       @map("condition_on_return")
  assignedById      String                  @map("assigned_by_id")
  approvedById      String?                 @map("approved_by_id")
  approvedAt        DateTime?               @map("approved_at")
  notes             String?
  employeeSignature String?                 @map("employee_signature")
  signatureDate     DateTime?               @map("signature_date")
  attachments       Json?                   @default("[]")
  approvalChain     Json?                   @map("approval_chain")
  createdAt         DateTime                @default(now()) @map("created_at")
  updatedAt         DateTime                @updatedAt @map("updated_at")
  approvedBy        User?                   @relation("CustodyApprover", fields: [approvedById], references: [id])
  assignedBy        User                    @relation("CustodyAssigner", fields: [assignedById], references: [id])
  company           Company                 @relation(fields: [companyId], references: [id])
  custodyItem       CustodyItem             @relation(fields: [custodyItemId], references: [id])
  employee          User                    @relation("EmployeeCustody", fields: [employeeId], references: [id])
  returns           CustodyReturn[]

  @@index([companyId, status])
  @@index([employeeId])
  @@index([custodyItemId])
  @@map("custody_assignments")
}

model CustodyReturn {
  id                 String              @id @default(uuid())
  companyId          String              @map("company_id")
  custodyItemId      String              @map("custody_item_id")
  assignmentId       String              @map("assignment_id")
  returnedById       String              @map("returned_by_id")
  returnDate         DateTime            @default(now()) @map("return_date")
  returnReason       String?             @map("return_reason")
  conditionOnReturn  CustodyCondition    @map("condition_on_return")
  status             CustodyReturnStatus @default(PENDING)
  reviewedById       String?             @map("reviewed_by_id")
  reviewedAt         DateTime?           @map("reviewed_at")
  reviewNotes        String?             @map("review_notes")
  damageDescription  String?             @map("damage_description")
  estimatedCost      Decimal?            @map("estimated_cost") @db.Decimal(12, 2)
  chargeEmployee     Boolean             @default(false) @map("charge_employee")
  chargedToPayroll   Boolean             @default(false) @map("charged_to_payroll")
  payrollDeductionId String?             @map("payroll_deduction_id")
  attachments        Json?               @default("[]")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  assignment         CustodyAssignment   @relation(fields: [assignmentId], references: [id])
  company            Company             @relation(fields: [companyId], references: [id])
  custodyItem        CustodyItem         @relation(fields: [custodyItemId], references: [id])
  returnedBy         User                @relation("CustodyReturner", fields: [returnedById], references: [id])
  reviewedBy         User?               @relation("CustodyReturnReviewer", fields: [reviewedById], references: [id])

  @@index([companyId, status])
  @@map("custody_returns")
}

model CustodyTransfer {
  id             String                @id @default(uuid())
  companyId      String                @map("company_id")
  custodyItemId  String                @map("custody_item_id")
  fromEmployeeId String                @map("from_employee_id")
  toEmployeeId   String                @map("to_employee_id")
  transferDate   DateTime              @default(now()) @map("transfer_date")
  reason         String?
  status         CustodyTransferStatus @default(PENDING)
  initiatedById  String                @map("initiated_by_id")
  approvedById   String?               @map("approved_by_id")
  approvedAt     DateTime?             @map("approved_at")
  fromSignature  String?               @map("from_signature")
  toSignature    String?               @map("to_signature")
  notes          String?
  attachments    Json?                 @default("[]")
  createdAt      DateTime              @default(now()) @map("created_at")
  updatedAt      DateTime              @updatedAt @map("updated_at")
  approvedBy     User?                 @relation("CustodyTransferApprover", fields: [approvedById], references: [id])
  company        Company               @relation(fields: [companyId], references: [id])
  custodyItem    CustodyItem           @relation(fields: [custodyItemId], references: [id])
  fromEmployee   User                  @relation("CustodyTransferFrom", fields: [fromEmployeeId], references: [id])
  initiatedBy    User                  @relation("CustodyTransferInitiator", fields: [initiatedById], references: [id])
  toEmployee     User                  @relation("CustodyTransferTo", fields: [toEmployeeId], references: [id])

  @@index([companyId, status])
  @@map("custody_transfers")
}

model CustodyMaintenance {
  id             String                   @id @default(uuid())
  companyId      String                   @map("company_id")
  custodyItemId  String                   @map("custody_item_id")
  type           MaintenanceType
  description    String
  reportedAt     DateTime                 @default(now()) @map("reported_at")
  reportedById   String                   @map("reported_by_id")
  startedAt      DateTime?                @map("started_at")
  completedAt    DateTime?                @map("completed_at")
  status         CustodyMaintenanceStatus @default(PENDING)
  estimatedCost  Decimal?                 @map("estimated_cost") @db.Decimal(12, 2)
  actualCost     Decimal?                 @map("actual_cost") @db.Decimal(12, 2)
  vendor         String?
  vendorContact  String?                  @map("vendor_contact")
  vendorEmail    String?                  @map("vendor_email")
  invoiceNumber  String?                  @map("invoice_number")
  result         String?
  conditionAfter CustodyCondition?        @map("condition_after")
  attachments    Json?                    @default("[]")
  createdAt      DateTime                 @default(now()) @map("created_at")
  updatedAt      DateTime                 @updatedAt @map("updated_at")
  company        Company                  @relation(fields: [companyId], references: [id])
  custodyItem    CustodyItem              @relation(fields: [custodyItemId], references: [id])
  reportedBy     User                     @relation("MaintenanceReporter", fields: [reportedById], references: [id])

  @@index([companyId, status])
  @@map("custody_maintenances")
}

model EmployeeDocument {
  id               String       @id @default(uuid())
  companyId        String       @map("company_id")
  userId           String       @map("user_id")
  type             DocumentType
  title            String
  titleAr          String?      @map("title_ar")
  description      String?
  filePath         String       @map("file_path")
  fileType         String       @map("file_type")
  fileSize         Int          @map("file_size")
  originalName     String?      @map("original_name")
  documentNumber   String?      @map("document_number")
  issueDate        DateTime?    @map("issue_date") @db.Date
  expiryDate       DateTime?    @map("expiry_date") @db.Date
  issuingAuthority String?      @map("issuing_authority")
  isVerified       Boolean      @default(false) @map("is_verified")
  verifiedById     String?      @map("verified_by_id")
  verifiedAt       DateTime?    @map("verified_at")
  uploadedById     String       @map("uploaded_by_id")
  notes            String?
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")
  user             User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([companyId, type])
  @@index([expiryDate])
  @@map("employee_documents")
}

model PayrollLedger {
  id                        String         @id @default(uuid())
  runId                     String         @unique @map("run_id")
  companyId                 String         @map("company_id")
  totalGross                Decimal        @default(0) @map("total_gross") @db.Decimal(12, 2)
  totalDeduction            Decimal        @default(0) @map("total_deduction") @db.Decimal(12, 2)
  totalNet                  Decimal        @default(0) @map("total_net") @db.Decimal(12, 2)
  totalEmployerContribution Decimal        @default(0) @map("total_employer_contribution") @db.Decimal(12, 2)
  status                    String         @default("DRAFT")
  createdAt                 DateTime       @default(now()) @map("created_at")
  updatedAt                 DateTime       @updatedAt @map("updated_at")
  entries                   JournalEntry[]
  run                       PayrollRun     @relation(fields: [runId], references: [id], onDelete: Cascade)

  @@map("payroll_ledgers")
}

model JournalEntry {
  id          String        @id @default(uuid())
  ledgerId    String        @map("ledger_id")
  accountCode String        @map("account_code")
  accountName String        @map("account_name")
  debit       Decimal       @default(0) @db.Decimal(12, 2)
  credit      Decimal       @default(0) @db.Decimal(12, 2)
  description String?
  createdAt   DateTime      @default(now()) @map("created_at")
  ledger      PayrollLedger @relation(fields: [ledgerId], references: [id], onDelete: Cascade)

  @@map("payroll_journal_entries")
}

model EmployeeLocationLog {
  id                 String   @id @default(uuid())
  companyId          String?  @map("company_id")
  userId             String   @map("user_id")
  latitude           Decimal  @db.Decimal(10, 8)
  longitude          Decimal  @db.Decimal(11, 8)
  accuracy           Float?
  isInsideGeofence   Boolean  @default(true) @map("is_inside_geofence")
  distanceFromBranch Int?     @map("distance_from_branch")
  batteryLevel       Float?   @map("battery_level")
  deviceInfo         String?  @map("device_info")
  createdAt          DateTime @default(now()) @map("created_at")
  company            Company? @relation(fields: [companyId], references: [id])
  user               User     @relation(fields: [userId], references: [id])

  @@index([userId, createdAt])
  @@index([companyId, createdAt])
  @@index([userId, isInsideGeofence])
  @@map("employee_location_logs")
}

model GeofenceExitEvent {
  id                 String     @id @default(uuid())
  companyId          String?    @map("company_id")
  userId             String     @map("user_id")
  attendanceId       String     @map("attendance_id")
  exitLatitude       Decimal    @map("exit_latitude") @db.Decimal(10, 8)
  exitLongitude      Decimal    @map("exit_longitude") @db.Decimal(11, 8)
  distanceFromBranch Int        @map("distance_from_branch")
  exitTime           DateTime   @map("exit_time")
  returnTime         DateTime?  @map("return_time")
  returnLatitude     Decimal?   @map("return_latitude") @db.Decimal(10, 8)
  returnLongitude    Decimal?   @map("return_longitude") @db.Decimal(11, 8)
  durationMinutes    Int?       @map("duration_minutes")
  notificationSent   Boolean    @default(false) @map("notification_sent")
  createdAt          DateTime   @default(now()) @map("created_at")
  updatedAt          DateTime   @updatedAt @map("updated_at")
  attendance         Attendance @relation(fields: [attendanceId], references: [id])
  company            Company?   @relation(fields: [companyId], references: [id])
  user               User       @relation(fields: [userId], references: [id])

  @@index([userId, exitTime])
  @@index([attendanceId])
  @@index([companyId, exitTime])
  @@map("geofence_exit_events")
}

model OnboardingTemplate {
  id          String                   @id @default(uuid())
  companyId   String                   @map("company_id")
  name        String
  nameEn      String?                  @map("name_en")
  description String?
  type        OnboardingType           @default(JOINING)
  isActive    Boolean                  @default(true)
  createdAt   DateTime                 @default(now()) @map("created_at")
  updatedAt   DateTime                 @updatedAt @map("updated_at")
  processes   OnboardingProcess[]
  tasks       OnboardingTemplateTask[]
  company     Company                  @relation(fields: [companyId], references: [id])

  @@index([companyId, type])
  @@map("onboarding_templates")
}

model OnboardingTemplateTask {
  id            String             @id @default(uuid())
  templateId    String             @map("template_id")
  title         String
  titleEn       String?            @map("title_en")
  description   String?
  assigneeType  AssigneeType       @default(HR)
  dueDays       Int                @default(1)
  priority      Int                @default(1)
  requiresPhoto Boolean            @default(false) @map("requires_photo")
  createdAt     DateTime           @default(now()) @map("created_at")
  template      OnboardingTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([templateId])
  @@map("onboarding_template_tasks")
}

model OnboardingProcess {
  id          String                  @id @default(uuid())
  companyId   String                  @map("company_id")
  userId      String                  @map("user_id")
  templateId  String                  @map("template_id")
  type        OnboardingType
  status      OnboardingProcessStatus @default(IN_PROGRESS)
  startDate   DateTime                @default(now()) @map("start_date")
  completedAt DateTime?               @map("completed_at")
  createdAt   DateTime                @default(now()) @map("created_at")
  updatedAt   DateTime                @updatedAt @map("updated_at")
  company     Company                 @relation(fields: [companyId], references: [id])
  template    OnboardingTemplate      @relation(fields: [templateId], references: [id])
  user        User                    @relation(fields: [userId], references: [id])
  tasks       OnboardingTask[]

  @@index([companyId, status])
  @@index([userId])
  @@map("onboarding_processes")
}

model OnboardingTask {
  id           String               @id @default(uuid())
  processId    String               @map("process_id")
  title        String
  titleEn      String?              @map("title_en")
  description  String?
  assigneeId   String?              @map("assignee_id")
  assigneeType AssigneeType
  status       OnboardingTaskStatus @default(PENDING)
  dueDate      DateTime             @map("due_date")
  completedAt  DateTime?            @map("completed_at")
  completedBy  String?              @map("completed_by")
  photoUrl     String?              @map("photo_url")
  notes        String?
  createdAt    DateTime             @default(now()) @map("created_at")
  updatedAt    DateTime             @updatedAt @map("updated_at")
  process      OnboardingProcess    @relation(fields: [processId], references: [id], onDelete: Cascade)

  @@index([processId, status])
  @@map("onboarding_tasks")
}

model AbsencePrediction {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId           String    @map("company_id") @db.VarChar
  userId              String    @map("user_id") @db.VarChar
  predictionDate      DateTime  @map("prediction_date") @db.Date
  absence_probability Decimal?  @db.Decimal
  riskLevel           String?   @map("risk_level") @db.VarChar
  contributingFactors Json?     @map("contributing_factors")
  predicted_days      Int?
  confidence_score    Decimal?  @db.Decimal
  model_version       String?   @db.VarChar
  createdAt           DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt           DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  @@map("absence_predictions")
}

model PredictionAccuracy {
  id              String   @id @default(uuid())
  companyId       String   @map("company_id")
  modelVersion    String   @map("model_version")
  accuracy        Decimal  @db.Decimal(5, 4)
  precision       Decimal  @db.Decimal(5, 4)
  recall          Decimal  @db.Decimal(5, 4)
  f1Score         Decimal  @map("f1_score") @db.Decimal(5, 4)
  evaluatedAt     DateTime @map("evaluated_at")
  predictionCount Int      @map("prediction_count")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, evaluatedAt])
  @@index([modelVersion])
  @@map("prediction_accuracies")
}

model AbsencePattern {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  companyId           String    @map("company_id") @db.VarChar
  patternType         String?   @map("pattern_type") @db.VarChar
  pattern_name        String?   @db.VarChar
  pattern_description String?
  affectedEmployees   Int?      @map("affected_employees")
  frequency           String?   @db.VarChar
  severity            String?   @db.VarChar
  detectedAt          DateTime? @map("detected_at") @db.Timestamp(6)
  is_active           Boolean?  @default(true)
  createdAt           DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  @@map("absence_patterns")
}

model ai_conversations {
  id         String   @id
  user_id    String
  company_id String
  messages   Json     @default("[]")
  created_at DateTime @default(now())
  updated_at DateTime
  expires_at DateTime
  companies  Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)
  users      User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([expires_at])
  @@index([user_id, company_id])
}

model article_feedback {
  id                      String                  @id
  article_id              String
  user_id                 String
  is_helpful              Boolean
  comment                 String?
  created_at              DateTime                @default(now())
  knowledge_base_articles knowledge_base_articles @relation(fields: [article_id], references: [id], onDelete: Cascade)
  users                   User                    @relation(fields: [user_id], references: [id])

  @@unique([article_id, user_id])
}

model automation_logs {
  id               String           @id
  automation_id    String
  task_id          String
  trigger          String
  action           String
  success          Boolean          @default(true)
  error            String?
  executed_at      DateTime         @default(now())
  task_automations task_automations @relation(fields: [automation_id], references: [id], onDelete: Cascade)

  @@index([automation_id])
  @@index([task_id])
}

model calibration_adjustments {
  id                   String               @id
  session_id           String
  result_id            String
  old_score            Decimal              @db.Decimal(5, 2)
  new_score            Decimal              @db.Decimal(5, 2)
  old_band             RatingBand
  new_band             RatingBand
  reason               String
  adjusted_by          String
  adjusted_at          DateTime             @default(now())
  final_results        final_results        @relation(fields: [result_id], references: [id])
  calibration_sessions calibration_sessions @relation(fields: [session_id], references: [id], onDelete: Cascade)
}

model calibration_sessions {
  id                        String                    @id
  cycle_id                  String
  name                      String
  status                    CalibrationStatus         @default(DRAFT)
  scheduled_at              DateTime?
  completed_at              DateTime?
  created_at                DateTime                  @default(now())
  updated_at                DateTime
  calibration_adjustments   calibration_adjustments[]
  performance_review_cycles performance_review_cycles @relation(fields: [cycle_id], references: [id])

  @@index([cycle_id])
}

model career_path_levels {
  id                    String       @id
  path_id               String
  level                 Int
  title                 String
  title_en              String?
  min_experience_years  Int?
  required_skills       Json?
  required_competencies Json?
  salary_range_min      Decimal?     @db.Decimal(10, 2)
  salary_range_max      Decimal?     @db.Decimal(10, 2)
  created_at            DateTime     @default(now())
  updated_at            DateTime
  career_paths          career_paths @relation(fields: [path_id], references: [id], onDelete: Cascade)

  @@unique([path_id, level])
}

model career_paths {
  id                 String               @id
  company_id         String
  name               String
  name_en            String?
  description        String?
  is_active          Boolean              @default(true)
  created_at         DateTime             @default(now())
  updated_at         DateTime
  career_path_levels career_path_levels[]
  companies          Company              @relation(fields: [company_id], references: [id])

  @@index([company_id])
}

model comment_reactions {
  id            String        @id
  comment_id    String
  user_id       String
  emoji         String
  created_at    DateTime      @default(now())
  task_comments task_comments @relation(fields: [comment_id], references: [id], onDelete: Cascade)
  users         User          @relation(fields: [user_id], references: [id])

  @@unique([comment_id, user_id, emoji])
  @@index([comment_id])
}

model company_configs {
  id              String         @id
  company_id      String         @unique
  company_type    CompanyType    @default(HYBRID)
  philosophy      EvalPhilosophy @default(BALANCED)
  enabled_modules Json           @default("{}")
  default_weights Json           @default("{}")
  policies        Json           @default("{}")
  ui_config       Json           @default("{}")
  created_at      DateTime       @default(now())
  updated_at      DateTime
  companies       Company        @relation(fields: [company_id], references: [id])
}

model competencies {
  id                    String                @id
  framework_id          String
  name                  String
  name_en               String?
  description           String?
  category              CompetencyCategory    @default(CORE)
  level_1_desc          String?
  level_2_desc          String?
  level_3_desc          String?
  level_4_desc          String?
  level_5_desc          String?
  behavior_examples     Json?
  is_active             Boolean               @default(true)
  sort_order            Int                   @default(0)
  created_at            DateTime              @default(now())
  updated_at            DateTime
  competency_frameworks competency_frameworks @relation(fields: [framework_id], references: [id], onDelete: Cascade)
  competency_ratings    competency_ratings[]

  @@index([framework_id, category])
}

model competency_frameworks {
  id           String         @id
  company_id   String
  name         String
  name_en      String?
  description  String?
  is_active    Boolean        @default(true)
  created_at   DateTime       @default(now())
  updated_at   DateTime
  competencies competencies[]
  companies    Company        @relation(fields: [company_id], references: [id])

  @@index([company_id])
}

model competency_ratings {
  id                  String              @id
  review_id           String
  competency_id       String
  self_rating         Int?
  self_comments       String?
  self_evidence       Json?
  manager_rating      Int?
  manager_comments    String?
  final_rating        Int?
  created_at          DateTime            @default(now())
  updated_at          DateTime
  competencies        competencies        @relation(fields: [competency_id], references: [id])
  performance_reviews performance_reviews @relation(fields: [review_id], references: [id], onDelete: Cascade)

  @@unique([review_id, competency_id])
}

model conduct_flags {
  id                        String                    @id
  cycle_id                  String
  employee_id               String
  type                      String
  severity                  ConductSeverity
  notes                     String?
  created_by                String
  created_at                DateTime                  @default(now())
  performance_review_cycles performance_review_cycles @relation(fields: [cycle_id], references: [id])

  @@index([cycle_id, employee_id])
}

model core_values {
  id          String   @id
  company_id  String
  name        String
  name_en     String?
  description String?
  icon        String?
  color       String?
  is_active   Boolean  @default(true)
  sort_order  Int      @default(0)
  created_at  DateTime @default(now())
  updated_at  DateTime
  companies   Company  @relation(fields: [company_id], references: [id])

  @@index([company_id])
}

model cost_center_allocations {
  id                                                                        String      @id
  company_id                                                                String?
  user_id                                                                   String
  cost_center_id                                                            String
  primary_cost_center_id                                                    String?
  percentage                                                                Decimal     @db.Decimal(5, 2)
  effective_from                                                            DateTime    @default(now())
  effective_to                                                              DateTime?
  allocation_type                                                           String      @default("POSITION")
  reason                                                                    String?
  is_active                                                                 Boolean     @default(true)
  created_at                                                                DateTime    @default(now())
  updated_at                                                                DateTime
  companies                                                                 Company?    @relation(fields: [company_id], references: [id])
  cost_centers_cost_center_allocations_cost_center_idTocost_centers         CostCenter  @relation("cost_center_allocations_cost_center_idTocost_centers", fields: [cost_center_id], references: [id])
  cost_centers_cost_center_allocations_primary_cost_center_idTocost_centers CostCenter? @relation("cost_center_allocations_primary_cost_center_idTocost_centers", fields: [primary_cost_center_id], references: [id])

  @@unique([user_id, cost_center_id, effective_from])
  @@index([cost_center_id])
  @@index([effective_from, effective_to])
  @@index([user_id, is_active])
}

model cost_center_audit_logs {
  id             String     @id
  cost_center_id String
  user_id        String
  action         String
  entity_type    String     @default("COST_CENTER")
  entity_id      String?
  old_value      Json?
  new_value      Json?
  description    String?
  ip_address     String?
  created_at     DateTime   @default(now())
  performed_by   String?    @default("SYSTEM") @db.VarChar(255)
  cost_centers   CostCenter @relation(fields: [cost_center_id], references: [id])
  users          User       @relation(fields: [user_id], references: [id])

  @@index([action])
  @@index([cost_center_id])
  @@index([created_at])
  @@index([user_id])
}

model cost_center_budgets {
  id             String     @id
  company_id     String?
  cost_center_id String
  year           Int
  month          Int?
  quarter        Int?
  budget_amount  Decimal    @db.Decimal(12, 2)
  actual_amount  Decimal    @default(0) @db.Decimal(12, 2)
  variance       Decimal    @default(0) @db.Decimal(12, 2)
  notes          String?
  is_locked      Boolean    @default(false)
  locked_at      DateTime?
  locked_by      String?
  created_at     DateTime   @default(now())
  updated_at     DateTime
  fiscal_year    Int?       @default(2026)
  total_budget   Decimal?   @default(0) @db.Decimal
  companies      Company?   @relation(fields: [company_id], references: [id])
  cost_centers   CostCenter @relation(fields: [cost_center_id], references: [id])

  @@unique([cost_center_id, year, month])
  @@index([cost_center_id, year])
}

model department_saudization {
  id                  String              @id
  company_id          String
  config_id           String
  department_id       String
  total_employees     Int
  saudi_employees     Int
  saudi_percentage    Decimal             @db.Decimal(5, 2)
  target_percentage   Decimal             @db.Decimal(5, 2)
  gap_to_target       Decimal             @db.Decimal(5, 2)
  recommended_hires   Int                 @default(0)
  priority            String              @default("MEDIUM")
  last_calculated_at  DateTime
  created_at          DateTime            @default(now())
  updated_at          DateTime
  saudization_configs saudization_configs @relation(fields: [config_id], references: [id], onDelete: Cascade)
  departments         Department          @relation(fields: [department_id], references: [id], onDelete: Cascade)

  @@unique([config_id, department_id])
  @@index([company_id, department_id])
}

model development_goals {
  id                String                @id
  plan_id           String
  category          String
  description       String
  target_date       DateTime?             @db.Date
  status            DevelopmentGoalStatus @default(NOT_STARTED)
  actions           Json?
  progress          Int                   @default(0)
  completed_at      DateTime?
  notes             String?
  created_at        DateTime              @default(now())
  updated_at        DateTime
  development_plans development_plans     @relation(fields: [plan_id], references: [id], onDelete: Cascade)

  @@index([plan_id])
}

model development_plans {
  id                   String               @id
  company_id           String
  employee_id          String
  review_id            String?              @unique
  year                 Int
  ai_strengths_summary String?
  ai_gap_analysis      String?
  ai_recommendations   Json?
  created_at           DateTime             @default(now())
  updated_at           DateTime
  development_goals    development_goals[]
  companies            Company              @relation(fields: [company_id], references: [id])
  performance_reviews  performance_reviews? @relation(fields: [review_id], references: [id])

  @@unique([employee_id, year])
  @@index([company_id, employee_id])
}

model emergency_contacts {
  id              String   @id
  user_id         String
  name            String
  name_ar         String?
  relationship    String
  phone           String
  alternate_phone String?
  email           String?
  priority        Int      @default(1)
  address         String?
  city            String?
  country         String?
  is_active       Boolean  @default(true)
  created_at      DateTime @default(now())
  updated_at      DateTime
  users           User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model employee_skills {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  company_id        String    @db.VarChar
  user_id           String    @db.VarChar
  skill_name        String    @db.VarChar
  skill_name_ar     String?   @db.VarChar
  category          String?   @db.VarChar
  proficiency_level String?   @db.VarChar
  years_experience  Int?
  is_verified       Boolean?  @default(false)
  verified_by_id    String?   @db.VarChar
  verified_at       DateTime? @db.Timestamp(6)
  notes             String?
  created_at        DateTime? @default(now()) @db.Timestamp(6)
  updated_at        DateTime? @default(now()) @db.Timestamp(6)
}

model employee_surveys {
  id                 String             @id
  company_id         String
  title              String
  title_ar           String
  description        String?
  description_ar     String?
  survey_type        String
  start_date         DateTime
  end_date           DateTime
  questions          Json
  target_all         Boolean            @default(true)
  target_branches    Json?
  target_departments Json?
  target_roles       Json?
  is_anonymous       Boolean            @default(true)
  is_required        Boolean            @default(false)
  allow_multiple     Boolean            @default(false)
  show_results       Boolean            @default(false)
  status             String             @default("DRAFT")
  total_invited      Int                @default(0)
  total_responses    Int                @default(0)
  response_rate      Decimal            @default(0) @db.Decimal(5, 2)
  created_by         String
  created_at         DateTime           @default(now())
  updated_at         DateTime
  companies          Company            @relation(fields: [company_id], references: [id], onDelete: Cascade)
  survey_responses   survey_responses[]

  @@index([company_id, status])
}

model evaluation_templates {
  id           String      @id
  company_id   String?
  code         String      @unique
  company_type CompanyType
  name         String
  name_ar      String?
  version      Int         @default(1)
  modules      Json
  weights      Json
  policies     Json
  ui_config    Json
  is_active    Boolean     @default(true)
  is_default   Boolean     @default(false)
  created_at   DateTime    @default(now())
  updated_at   DateTime
}

model feedback_question_sets {
  id                 String               @id
  company_id         String
  name               String
  name_ar            String?
  version            Int                  @default(1)
  is_active          Boolean              @default(true)
  created_at         DateTime             @default(now())
  updated_at         DateTime
  companies          Company              @relation(fields: [company_id], references: [id])
  feedback_questions feedback_questions[]

  @@index([company_id])
}

model feedback_questions {
  id                     String                  @id
  set_id                 String
  text                   String
  text_ar                String?
  type                   FeedbackQuestionType
  required               Boolean                 @default(true)
  order                  Int                     @default(0)
  feedback_question_sets feedback_question_sets  @relation(fields: [set_id], references: [id], onDelete: Cascade)
  upee_feedback_answers  upee_feedback_answers[]

  @@index([set_id])
}

model feedback_requests {
  id                  String                @id
  review_id           String
  requestor_id        String
  provider_id         String
  relationship_type   String
  status              FeedbackRequestStatus @default(PENDING)
  is_anonymous        Boolean               @default(true)
  due_date            DateTime?
  submitted_at        DateTime?
  created_at          DateTime              @default(now())
  updated_at          DateTime
  performance_reviews performance_reviews   @relation(fields: [review_id], references: [id], onDelete: Cascade)
  feedback_responses  feedback_responses[]

  @@index([provider_id, status])
  @@index([review_id])
}

model feedback_responses {
  id                String            @id
  request_id        String
  question_id       String?
  question_text     String
  rating            Int?
  comment           String?
  sentiment_score   Decimal?          @db.Decimal(3, 2)
  themes            Json?
  created_at        DateTime          @default(now())
  feedback_requests feedback_requests @relation(fields: [request_id], references: [id], onDelete: Cascade)

  @@index([request_id])
}

model final_results {
  id                        String                    @id
  cycle_id                  String
  employee_id               String
  final_score               Decimal                   @db.Decimal(5, 2)
  rating_band               RatingBand
  status                    ResultStatus              @default(DRAFT)
  blueprint_snapshot        Json
  created_at                DateTime                  @default(now())
  updated_at                DateTime
  calibration_adjustments   calibration_adjustments[]
  performance_review_cycles performance_review_cycles @relation(fields: [cycle_id], references: [id])

  @@unique([cycle_id, employee_id])
}

model goal_check_ins {
  id             String   @id
  goal_id        String
  user_id        String
  previous_value Decimal  @db.Decimal(10, 2)
  new_value      Decimal  @db.Decimal(10, 2)
  status_update  String?
  blockers       String?
  next_steps     String?
  confidence     Int?
  created_at     DateTime @default(now())
  goals          goals    @relation(fields: [goal_id], references: [id], onDelete: Cascade)

  @@index([goal_id])
}

model goal_ratings {
  id                  String              @id
  review_id           String
  goal_id             String
  self_rating         Decimal?            @db.Decimal(3, 2)
  self_comments       String?
  manager_rating      Decimal?            @db.Decimal(3, 2)
  manager_comments    String?
  final_rating        Decimal?            @db.Decimal(3, 2)
  weight              Int                 @default(100)
  created_at          DateTime            @default(now())
  updated_at          DateTime
  goals               goals               @relation(fields: [goal_id], references: [id])
  performance_reviews performance_reviews @relation(fields: [review_id], references: [id], onDelete: Cascade)

  @@unique([review_id, goal_id])
}

model goals {
  id                      String           @id
  company_id              String
  owner_id                String
  manager_id              String?
  type                    GoalType         @default(INDIVIDUAL)
  status                  GoalStatus       @default(DRAFT)
  title                   String
  title_en                String?
  description             String?
  start_date              DateTime?        @db.Date
  due_date                DateTime?        @db.Date
  completed_at            DateTime?
  target_value            Decimal?         @db.Decimal(10, 2)
  current_value           Decimal?         @db.Decimal(10, 2)
  unit                    String?
  progress                Int              @default(0)
  weight                  Int              @default(100)
  category                String?
  is_stretch              Boolean          @default(false)
  parent_goal_id          String?
  aligned_company_goal_id String?
  approved_by             String?
  approved_at             DateTime?
  rejection_reason        String?
  ai_generated            Boolean          @default(false)
  ai_prompt               String?
  created_at              DateTime         @default(now())
  updated_at              DateTime
  auto_calculated         Boolean          @default(false)
  data_source             GoalDataSource?
  data_source_config      Json?
  last_sync_at            DateTime?
  employee_id             String?          @db.VarChar(255)
  goal_check_ins          goal_check_ins[]
  goal_ratings            goal_ratings[]
  companies               Company          @relation(fields: [company_id], references: [id])
  goals                   goals?           @relation("goalsTogoals", fields: [parent_goal_id], references: [id])
  other_goals             goals[]          @relation("goalsTogoals")
  key_results             key_results[]

  @@index([company_id, owner_id])
  @@index([company_id, status])
  @@index([data_source])
  @@index([type])
}

model holiday_assignments {
  id              String   @id
  holiday_id      String
  assignment_type String
  branch_id       String?
  department_id   String?
  employee_id     String?
  created_at      DateTime @default(now())
  holidays        Holiday  @relation(fields: [holiday_id], references: [id], onDelete: Cascade)

  @@unique([holiday_id, assignment_type, branch_id, department_id, employee_id])
  @@index([branch_id])
  @@index([department_id])
  @@index([employee_id])
  @@index([holiday_id])
}

model idp_plans {
  id             String    @id
  cycle_id       String
  employee_id    String
  strengths      Json
  improvements   Json
  goals_90_days  Json
  learning_tasks Json
  mentor_id      String?
  status         IDPStatus @default(ACTIVE)
  created_at     DateTime  @default(now())
  updated_at     DateTime

  @@unique([cycle_id, employee_id])
}

model job_families {
  id                  String            @id
  company_id          String
  code                String
  name                String
  name_ar             String?
  module_overrides    Json?
  evidence_types      Json?
  competency_model_id String?
  created_at          DateTime          @default(now())
  updated_at          DateTime
  companies           Company           @relation(fields: [company_id], references: [id])
  kpi_definitions     kpi_definitions[]
  role_levels         role_levels[]
  users               User[]

  @@unique([company_id, code])
  @@index([company_id])
}

model key_result_check_ins {
  id             String      @id
  key_result_id  String
  user_id        String
  previous_value Decimal     @db.Decimal(10, 2)
  new_value      Decimal     @db.Decimal(10, 2)
  notes          String?
  created_at     DateTime    @default(now())
  key_results    key_results @relation(fields: [key_result_id], references: [id], onDelete: Cascade)

  @@index([key_result_id])
}

model key_results {
  id                   String                 @id
  goal_id              String
  title                String
  description          String?
  target_value         Decimal                @db.Decimal(10, 2)
  current_value        Decimal                @default(0) @db.Decimal(10, 2)
  unit                 String                 @default("%")
  progress             Int                    @default(0)
  due_date             DateTime?              @db.Date
  created_at           DateTime               @default(now())
  updated_at           DateTime
  key_result_check_ins key_result_check_ins[]
  goals                goals                  @relation(fields: [goal_id], references: [id], onDelete: Cascade)

  @@index([goal_id])
}

model knowledge_base_articles {
  id                String             @id
  company_id        String
  title             String
  title_ar          String
  content           String
  content_ar        String
  summary           String?
  summary_ar        String?
  category          String
  subcategory       String?
  tags              Json?
  visibility        String             @default("ALL")
  custom_access     Json?
  status            String             @default("DRAFT")
  published_at      DateTime?
  published_by      String?
  view_count        Int                @default(0)
  helpful_count     Int                @default(0)
  not_helpful_count Int                @default(0)
  slug              String?
  last_reviewed_at  DateTime?
  next_review_date  DateTime?
  created_by        String
  created_at        DateTime           @default(now())
  updated_at        DateTime
  article_feedback  article_feedback[]
  companies         Company            @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@unique([company_id, slug])
  @@index([company_id, category, status])
}

model kpi_assignments {
  id                        String                    @id
  cycle_id                  String
  employee_id               String
  kpi_definition_id         String
  target                    Decimal                   @db.Decimal(15, 2)
  weight                    Int                       @default(100)
  created_at                DateTime                  @default(now())
  updated_at                DateTime
  actual_value              Decimal?                  @db.Decimal(10, 2)
  notes                     String?
  score                     Decimal?                  @db.Decimal(5, 2)
  performance_review_cycles performance_review_cycles @relation(fields: [cycle_id], references: [id])
  users                     User                      @relation(fields: [employee_id], references: [id])
  kpi_definitions           kpi_definitions           @relation(fields: [kpi_definition_id], references: [id])
  kpi_entries               kpi_entries[]

  @@unique([cycle_id, employee_id, kpi_definition_id])
  @@index([cycle_id, employee_id])
  @@index([employee_id])
}

model kpi_definitions {
  id              String            @id
  company_id      String
  job_family_id   String?
  code            String
  name            String
  name_ar         String?
  description     String?
  unit            String
  formula         Json?
  thresholds      Json
  source_type     KPISourceType     @default(MANUAL)
  frequency       KPIFrequency      @default(MONTHLY)
  is_active       Boolean           @default(true)
  created_at      DateTime          @default(now())
  updated_at      DateTime
  kpi_assignments kpi_assignments[]
  companies       Company           @relation(fields: [company_id], references: [id])
  job_families    job_families?     @relation(fields: [job_family_id], references: [id])

  @@unique([company_id, code])
  @@index([company_id])
  @@index([job_family_id])
}

model kpi_entries {
  id              String          @id
  assignment_id   String
  period_start    DateTime
  period_end      DateTime
  value           Decimal         @db.Decimal(15, 2)
  source          String?
  created_by      String
  created_at      DateTime        @default(now())
  notes           String?
  kpi_assignments kpi_assignments @relation(fields: [assignment_id], references: [id], onDelete: Cascade)

  @@index([assignment_id])
}

model location_proofs {
  id               String    @id
  company_id       String
  user_id          String
  proof_type       String
  latitude         Decimal   @db.Decimal(10, 7)
  longitude        Decimal   @db.Decimal(10, 7)
  accuracy         Decimal?  @db.Decimal(10, 2)
  altitude         Decimal?  @db.Decimal(10, 2)
  address          String?
  branch_id        String?
  photo_url        String
  photo_hash       String?
  photo_taken_at   DateTime
  device_id        String
  device_model     String?
  os_version       String?
  app_version      String?
  is_mock_location Boolean   @default(false)
  is_rooted        Boolean   @default(false)
  is_verified      Boolean   @default(false)
  verified_at      DateTime?
  verified_by      String?
  attendance_id    String?
  created_at       DateTime  @default(now())
  users            User      @relation(fields: [user_id], references: [id])

  @@index([company_id, proof_type])
  @@index([user_id, created_at])
}

model logistics_deliveries {
  id              String         @id
  company_id      String
  driver_id       String
  delivery_date   DateTime       @db.Date
  scheduled_time  DateTime
  actual_time     DateTime?
  minutes_early   Int            @default(0)
  minutes_late    Int            @default(0)
  customer_rating Decimal?       @db.Decimal(2, 1)
  status          DeliveryStatus @default(PENDING)
  failure_reason  String?
  created_at      DateTime       @default(now())
  updated_at      DateTime

  @@index([company_id, driver_id])
  @@index([delivery_date])
}

model logistics_driver_performance {
  id                   String   @id
  company_id           String
  driver_id            String
  month                Int
  year                 Int
  total_trips          Int      @default(0)
  on_time_trips        Int      @default(0)
  on_time_percentage   Decimal  @default(0) @db.Decimal(5, 2)
  completed_deliveries Int      @default(0)
  failed_deliveries    Int      @default(0)
  return_rate          Decimal  @default(0) @db.Decimal(5, 2)
  total_distance_km    Decimal  @default(0) @db.Decimal(10, 2)
  fuel_efficiency      Decimal  @default(0) @db.Decimal(5, 2)
  average_rating       Decimal  @default(0) @db.Decimal(2, 1)
  safety_score         Int      @default(100)
  violations_count     Int      @default(0)
  accident_free        Boolean  @default(true)
  created_at           DateTime @default(now())
  updated_at           DateTime

  @@unique([company_id, driver_id, month, year])
  @@index([company_id, month, year])
}

model logistics_inventory_counts {
  id             String   @id
  company_id     String
  warehouse_id   String?
  conducted_by   String
  count_date     DateTime @db.Date
  expected_items Int
  actual_items   Int
  accuracy_rate  Decimal  @db.Decimal(5, 2)
  variance       Int      @default(0)
  damaged_items  Int      @default(0)
  damage_value   Decimal  @default(0) @db.Decimal(10, 2)
  damage_reason  String?
  notes          String?
  created_at     DateTime @default(now())
  updated_at     DateTime

  @@index([company_id, count_date])
}

model logistics_trips {
  id               String     @id
  company_id       String
  driver_id        String
  trip_date        DateTime   @db.Date
  scheduled_start  DateTime
  actual_start     DateTime?
  scheduled_end    DateTime?
  actual_end       DateTime?
  distance_km      Decimal    @default(0) @db.Decimal(10, 2)
  fuel_consumption Decimal    @default(0) @db.Decimal(10, 2)
  delay_minutes    Int        @default(0)
  delay_reason     String?
  status           TripStatus @default(PENDING)
  created_at       DateTime   @default(now())
  updated_at       DateTime

  @@index([company_id, driver_id])
  @@index([trip_date])
}

model module_scores {
  id            String   @id
  cycle_id      String
  employee_id   String
  module        String
  score         Decimal  @db.Decimal(5, 2)
  computed_data Json
  created_at    DateTime @default(now())

  @@unique([cycle_id, employee_id, module])
  @@index([cycle_id, employee_id])
}

model nitaqat_alerts {
  id                  String              @id
  company_id          String
  config_id           String
  alert_type          String
  severity            String
  title               String
  title_ar            String
  message             String
  message_ar          String
  current_value       Decimal?            @db.Decimal(5, 2)
  threshold_value     Decimal?            @db.Decimal(5, 2)
  from_zone           NitaqatZone?
  to_zone             NitaqatZone?
  action_required     String?
  action_required_ar  String?
  deadline            DateTime?
  is_read             Boolean             @default(false)
  read_at             DateTime?
  is_resolved         Boolean             @default(false)
  resolved_at         DateTime?
  resolved_by         String?
  resolution_note     String?
  created_at          DateTime            @default(now())
  saudization_configs saudization_configs @relation(fields: [config_id], references: [id], onDelete: Cascade)

  @@index([company_id, is_read])
  @@index([company_id, severity])
}

model offline_sync_queue {
  id             String    @id
  company_id     String
  user_id        String
  device_id      String
  operation_type String
  entity_type    String
  entity_id      String?
  payload        Json
  timestamp      DateTime
  latitude       Decimal?  @db.Decimal(10, 7)
  longitude      Decimal?  @db.Decimal(10, 7)
  sync_status    String    @default("PENDING")
  sync_attempts  Int       @default(0)
  last_sync_at   DateTime?
  synced_at      DateTime?
  error_message  String?
  checksum       String?
  is_validated   Boolean   @default(false)
  created_at     DateTime  @default(now())
  users          User      @relation(fields: [user_id], references: [id])

  @@index([device_id, sync_status])
  @@index([user_id, sync_status])
}

model performance_audit_logs {
  id          String   @id
  company_id  String
  actor_id    String
  action      String
  entity      String
  entity_id   String
  before_data Json?
  after_data  Json?
  created_at  DateTime @default(now())

  @@index([actor_id])
  @@index([company_id, entity])
}

model performance_competencies {
  id                             String                           @id
  model_id                       String
  category                       UPEECompetencyCategory
  name                           String
  name_ar                        String?
  description                    String?
  created_at                     DateTime                         @default(now())
  updated_at                     DateTime
  performance_competency_models  performance_competency_models    @relation(fields: [model_id], references: [id], onDelete: Cascade)
  performance_competency_rubrics performance_competency_rubrics[]
  performance_competency_scores  performance_competency_scores[]

  @@index([model_id])
}

model performance_competency_models {
  id                       String                     @id
  company_id               String
  name                     String
  name_ar                  String?
  version                  Int                        @default(1)
  is_active                Boolean                    @default(true)
  created_at               DateTime                   @default(now())
  updated_at               DateTime
  performance_competencies performance_competencies[]
  companies                Company                    @relation(fields: [company_id], references: [id])

  @@index([company_id])
}

model performance_competency_rubrics {
  id                       String                   @id
  competency_id            String
  level                    Int
  behavior                 String
  behavior_ar              String?
  performance_competencies performance_competencies @relation(fields: [competency_id], references: [id], onDelete: Cascade)

  @@unique([competency_id, level])
}

model performance_competency_scores {
  id                       String                   @id
  cycle_id                 String
  employee_id              String
  competency_id            String
  rating                   Int
  justification            String?
  evidence_ids             Json?
  scoredBy                 String
  created_at               DateTime                 @default(now())
  performance_competencies performance_competencies @relation(fields: [competency_id], references: [id])

  @@index([cycle_id, employee_id])
}

model performance_evidences {
  id          String       @id
  cycle_id    String
  employee_id String
  module      String
  entity_id   String
  type        EvidenceType
  url         String?
  file_id     String?
  notes       String?
  created_at  DateTime     @default(now())

  @@index([cycle_id, employee_id])
}

model performance_review_cycles {
  id                        String                       @id
  company_id                String
  name                      String
  name_en                   String?
  type                      PerformanceReviewCycleType   @default(ANNUAL)
  status                    PerformanceReviewCycleStatus @default(DRAFT)
  period_start              DateTime                     @db.Date
  period_end                DateTime                     @db.Date
  self_review_start         DateTime?
  self_review_end           DateTime?
  manager_review_start      DateTime?
  manager_review_end        DateTime?
  feedback_start            DateTime?
  feedback_end              DateTime?
  calibration_start         DateTime?
  calibration_end           DateTime?
  include_self_review       Boolean                      @default(true)
  include_360_feedback      Boolean                      @default(false)
  include_goal_rating       Boolean                      @default(true)
  include_competency_rating Boolean                      @default(true)
  goal_weight               Int                          @default(40)
  competency_weight         Int                          @default(40)
  value_weight              Int                          @default(20)
  competency_framework_id   String?
  created_at                DateTime                     @default(now())
  updated_at                DateTime
  calibration_sessions      calibration_sessions[]
  conduct_flags             conduct_flags[]
  final_results             final_results[]
  kpi_assignments           kpi_assignments[]
  companies                 Company                      @relation(fields: [company_id], references: [id])
  performance_reviews       performance_reviews[]
  upee_360_requests         upee_360_requests[]

  @@index([company_id, status])
}

model performance_reviews {
  id                        String                    @id
  company_id                String
  cycle_id                  String
  employee_id               String
  manager_id                String
  status                    PerformanceReviewStatus   @default(PENDING)
  self_rating               Decimal?                  @db.Decimal(3, 2)
  self_comments             String?
  self_achievements         Json?
  self_challenges           Json?
  self_submitted_at         DateTime?
  manager_rating            Decimal?                  @db.Decimal(3, 2)
  manager_comments          String?
  manager_strengths         Json?
  manager_improvements      Json?
  manager_submitted_at      DateTime?
  final_rating              Decimal?                  @db.Decimal(3, 2)
  final_comments            String?
  calibration_notes         String?
  calibrated_by             String?
  calibrated_at             DateTime?
  performance_score         Int?
  potential_score           Int?
  nine_box_position         String?
  employee_acknowledged     Boolean                   @default(false)
  employee_acknowledged_at  DateTime?
  employee_disagreed        Boolean                   @default(false)
  employee_disagree_reason  String?
  ai_summary                String?
  ai_bias_flags             Json?
  ai_recommendations        Json?
  created_at                DateTime                  @default(now())
  updated_at                DateTime
  competency_ratings        competency_ratings[]
  development_plans         development_plans?
  feedback_requests         feedback_requests[]
  goal_ratings              goal_ratings[]
  performance_review_cycles performance_review_cycles @relation(fields: [cycle_id], references: [id])

  @@unique([cycle_id, employee_id])
  @@index([company_id, status])
  @@index([employee_id])
  @@index([manager_id])
}

model pip_plans {
  id             String      @id
  cycle_id       String
  employee_id    String
  duration_days  Int
  start_date     DateTime
  end_date       DateTime
  expectations   Json
  weekly_reviews Json
  status         PIPStatus   @default(ACTIVE)
  outcome        PIPOutcome?
  created_at     DateTime    @default(now())
  updated_at     DateTime

  @@unique([cycle_id, employee_id])
}

model policy_benchmarks {
  id                  String   @id
  company_id          String
  benchmark_date      DateTime @db.Date
  industry            String
  company_size        String
  region              String
  policy_metrics      Json
  industry_average    Json
  percentile_ranking  Json
  gap_analysis        Json
  recommendations     Json
  priority_areas      Json
  overall_score       Decimal  @db.Decimal(5, 2)
  compliance_score    Decimal  @db.Decimal(5, 2)
  fairness_score      Decimal  @db.Decimal(5, 2)
  effectiveness_score Decimal  @db.Decimal(5, 2)
  created_at          DateTime @default(now())

  @@index([company_id, benchmark_date])
}

model policy_change_simulations {
  id                     String    @id
  company_id             String
  policy_id              String
  scenario_name          String
  scenario_name_ar       String
  proposed_changes       Json
  simulation_period      String
  employee_scope         String
  scope_filter           Json?
  status                 String    @default("PENDING")
  affected_employees     Int?
  estimated_violations   Int?
  financial_impact       Decimal?  @db.Decimal(12, 2)
  productivity_impact    Decimal?  @db.Decimal(5, 2)
  compliance_risk_change Decimal?  @db.Decimal(5, 2)
  detailed_results       Json?
  employee_breakdown     Json?
  timeline_impact        Json?
  recommendations        Json?
  before_metrics         Json?
  after_metrics          Json?
  comparison_summary     String?
  run_at                 DateTime?
  completed_at           DateTime?
  run_by                 String
  created_at             DateTime  @default(now())

  @@index([company_id, policy_id])
  @@index([company_id, status])
}

model policy_simulation_runs {
  id                       String      @id
  policy_id                String
  simulated_by             String
  simulated_by_name        String
  simulation_period        String
  total_employees_affected Int
  total_additions          Decimal     @default(0) @db.Decimal(12, 2)
  total_deductions         Decimal     @default(0) @db.Decimal(12, 2)
  results                  Json        @default("[]")
  execution_time_ms        Int?
  warnings_count           Int         @default(0)
  warnings                 Json?       @default("[]")
  created_at               DateTime    @default(now())
  end_date                 DateTime?   @default(now()) @db.Timestamp(6)
  start_date               DateTime?   @default(now()) @db.Timestamp(6)
  smart_policies           SmartPolicy @relation(fields: [policy_id], references: [id], onDelete: Cascade)

  @@index([policy_id, created_at])
}

model policy_suggestions {
  id                 String    @id
  company_id         String
  suggestion_type    String
  title              String
  title_ar           String
  description        String
  description_ar     String
  related_policy_id  String?
  proposed_rules     Json
  proposed_config    Json?
  analysis_reason    String
  data_points        Json
  impact_analysis    Json
  industry_benchmark Json?
  compliance_check   Json?
  priority           String
  priority_score     Int
  urgency            String?
  status             String    @default("PENDING")
  reviewed_at        DateTime?
  reviewed_by        String?
  review_notes       String?
  implemented_at     DateTime?
  created_at         DateTime  @default(now())
  updated_at         DateTime

  @@index([company_id, priority])
  @@index([company_id, status])
}

model policy_violation_predictions {
  id                     String    @id
  company_id             String
  policy_id              String
  user_id                String
  prediction_date        DateTime  @db.Date
  predicted_date         DateTime  @db.Date
  violation_type         String
  probability            Decimal   @db.Decimal(5, 4)
  confidence_level       String
  risk_factors           Json
  historical_pattern     Json?
  recommended_action     String
  recommended_action_ar  String
  prevention_suggestions Json?
  status                 String    @default("ACTIVE")
  actually_occurred      Boolean   @default(false)
  prevented_at           DateTime?
  prevented_by           String?
  created_at             DateTime  @default(now())
  updated_at             DateTime
  users                  User      @relation(fields: [user_id], references: [id])

  @@index([company_id, status])
  @@index([user_id, prediction_date])
}

model prediction_accuracy {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  company_id      String    @db.VarChar
  model_version   String?   @db.VarChar
  accuracy_score  Decimal?  @db.Decimal
  precision_score Decimal?  @db.Decimal
  recall_score    Decimal?  @db.Decimal
  f1_score        Decimal?  @db.Decimal
  evaluation_date DateTime? @db.Date
  sample_size     Int?
  created_at      DateTime? @default(now()) @db.Timestamp(6)
}

model profile_update_requests {
  id                                               String    @id
  company_id                                       String
  user_id                                          String
  update_type                                      String
  field_name                                       String
  current_value                                    String?
  requested_value                                  String
  supporting_documents                             Json?
  reason                                           String?
  reason_ar                                        String?
  status                                           String    @default("PENDING")
  reviewed_at                                      DateTime?
  reviewed_by                                      String?
  review_note                                      String?
  rejection_reason                                 String?
  applied_at                                       DateTime?
  created_at                                       DateTime  @default(now())
  updated_at                                       DateTime
  users_profile_update_requests_reviewed_byTousers User?     @relation("profile_update_requests_reviewed_byTousers", fields: [reviewed_by], references: [id])
  users_profile_update_requests_user_idTousers     User      @relation("profile_update_requests_user_idTousers", fields: [user_id], references: [id])

  @@index([company_id, status])
  @@index([user_id])
}

model programs {
  id                                  String        @id
  company_id                          String
  name                                String
  name_en                             String?
  description                         String?
  code                                String?
  color                               String?       @default("#3B82F6")
  icon                                String?       @default("folder")
  owner_id                            String?
  manager_id                          String?
  start_date                          DateTime?
  end_date                            DateTime?
  total_budget                        Decimal?      @db.Decimal(15, 2)
  budget_currency                     String?       @default("SAR")
  status                              ProgramStatus @default(PLANNING)
  health_status                       HealthStatus  @default(ON_TRACK)
  progress                            Int           @default(0)
  is_archived                         Boolean       @default(false)
  archived_at                         DateTime?
  created_by_id                       String
  created_at                          DateTime      @default(now())
  updated_at                          DateTime
  companies                           Company       @relation(fields: [company_id], references: [id], onDelete: Cascade)
  users_programs_created_by_idTousers User          @relation("programs_created_by_idTousers", fields: [created_by_id], references: [id])
  users_programs_manager_idTousers    User?         @relation("programs_manager_idTousers", fields: [manager_id], references: [id])
  users_programs_owner_idTousers      User?         @relation("programs_owner_idTousers", fields: [owner_id], references: [id])
  projects                            projects[]

  @@index([company_id, owner_id])
  @@index([company_id, status])
}

model project_activities {
  id          String   @id
  project_id  String
  action      String
  description String?
  entity_type String?
  entity_id   String?
  old_value   Json?
  new_value   Json?
  user_id     String
  created_at  DateTime @default(now())
  projects    projects @relation(fields: [project_id], references: [id], onDelete: Cascade)
  users       User     @relation(fields: [user_id], references: [id])

  @@index([project_id, created_at])
  @@index([user_id])
}

model project_budgets {
  id                                          String         @id
  project_id                                  String
  category                                    BudgetCategory
  name                                        String
  description                                 String?
  planned_amount                              Decimal        @db.Decimal(15, 2)
  actual_amount                               Decimal        @default(0) @db.Decimal(15, 2)
  committed_amount                            Decimal        @default(0) @db.Decimal(15, 2)
  currency                                    String         @default("SAR")
  period_start                                DateTime?
  period_end                                  DateTime?
  status                                      BudgetStatus   @default(ACTIVE)
  approved_by_id                              String?
  approved_at                                 DateTime?
  created_by_id                               String
  created_at                                  DateTime       @default(now())
  updated_at                                  DateTime
  users_project_budgets_approved_by_idTousers User?          @relation("project_budgets_approved_by_idTousers", fields: [approved_by_id], references: [id])
  users_project_budgets_created_by_idTousers  User           @relation("project_budgets_created_by_idTousers", fields: [created_by_id], references: [id])
  projects                                    projects       @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@index([project_id, category])
}

model project_members {
  id              String            @id
  project_id      String
  user_id         String
  role            ProjectMemberRole @default(MEMBER)
  allocation_pct  Int?
  hourly_rate     Decimal?          @db.Decimal(10, 2)
  start_date      DateTime?
  end_date        DateTime?
  can_edit        Boolean           @default(true)
  can_delete      Boolean           @default(false)
  can_manage_team Boolean           @default(false)
  can_view_budget Boolean           @default(false)
  can_approve     Boolean           @default(false)
  joined_at       DateTime          @default(now())
  projects        projects          @relation(fields: [project_id], references: [id], onDelete: Cascade)
  users           User              @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([project_id, user_id])
  @@index([user_id])
}

model project_milestones {
  id               String          @id
  project_id       String
  name             String
  name_en          String?
  description      String?
  due_date         DateTime
  completed_date   DateTime?
  status           MilestoneStatus @default(PENDING)
  progress         Int             @default(0)
  owner_id         String?
  deliverables     Json?
  is_critical      Boolean         @default(false)
  is_payment       Boolean         @default(false)
  payment_amount   Decimal?        @db.Decimal(15, 2)
  payment_currency String?         @default("SAR")
  created_at       DateTime        @default(now())
  updated_at       DateTime
  users            User?           @relation(fields: [owner_id], references: [id])
  projects         projects        @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@index([project_id, due_date])
  @@index([project_id, status])
}

model project_phases {
  id                 String      @id
  project_id         String
  name               String
  name_en            String?
  description        String?
  order              Int         @default(0)
  color              String?     @default("#6366F1")
  planned_start_date DateTime?
  planned_end_date   DateTime?
  actual_start_date  DateTime?
  actual_end_date    DateTime?
  status             PhaseStatus @default(NOT_STARTED)
  progress           Int         @default(0)
  planned_budget     Decimal?    @db.Decimal(15, 2)
  actual_budget      Decimal?    @db.Decimal(15, 2)
  deliverables       String[]    @default([])
  dependencies       String[]    @default([])
  created_at         DateTime    @default(now())
  updated_at         DateTime
  projects           projects    @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@index([project_id, order])
}

model project_risks {
  id                                       String          @id
  project_id                               String
  title                                    String
  description                              String?
  category                                 RiskCategory
  probability                              RiskProbability @default(MEDIUM)
  impact                                   RiskImpact      @default(MODERATE)
  risk_score                               Int             @default(0)
  response                                 RiskResponse    @default(MONITOR)
  mitigation_plan                          String?
  contingency_plan                         String?
  owner_id                                 String?
  status                                   RiskStatus      @default(OPEN)
  identified_at                            DateTime        @default(now())
  resolved_at                              DateTime?
  potential_cost                           Decimal?        @db.Decimal(15, 2)
  actual_cost                              Decimal?        @db.Decimal(15, 2)
  expected_date                            DateTime?
  created_by_id                            String
  created_at                               DateTime        @default(now())
  updated_at                               DateTime
  users_project_risks_created_by_idTousers User            @relation("project_risks_created_by_idTousers", fields: [created_by_id], references: [id])
  users_project_risks_owner_idTousers      User?           @relation("project_risks_owner_idTousers", fields: [owner_id], references: [id])
  projects                                 projects        @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@index([project_id, risk_score])
  @@index([project_id, status])
}

model project_templates {
  id                    String     @id
  company_id            String?
  name                  String
  name_en               String?
  description           String?
  category              String?
  icon                  String?
  color                 String?
  default_duration_days Int?
  default_budget        Decimal?   @db.Decimal(15, 2)
  phases                Json?
  milestones            Json?
  risks                 Json?
  checklist             Json?
  is_system             Boolean    @default(false)
  is_public             Boolean    @default(true)
  created_by_id         String?
  created_at            DateTime   @default(now())
  updated_at            DateTime
  companies             Company?   @relation(fields: [company_id], references: [id], onDelete: Cascade)
  projects              projects[]

  @@index([company_id])
}

model projects {
  id                                  String               @id
  company_id                          String
  program_id                          String?
  name                                String
  name_en                             String?
  description                         String?
  code                                String?              @unique
  color                               String?              @default("#10B981")
  icon                                String?              @default("briefcase")
  template_id                         String?
  owner_id                            String?
  manager_id                          String?
  sponsor_id                          String?
  start_date                          DateTime?
  planned_end_date                    DateTime?
  actual_end_date                     DateTime?
  baseline_start_date                 DateTime?
  baseline_end_date                   DateTime?
  planned_budget                      Decimal?             @db.Decimal(15, 2)
  actual_budget                       Decimal?             @db.Decimal(15, 2)
  budget_currency                     String?              @default("SAR")
  status                              ProjectStatus        @default(INITIATION)
  phase                               ProjectPhaseType     @default(INITIATION)
  health_status                       HealthStatus         @default(ON_TRACK)
  progress                            Int                  @default(0)
  priority                            ProjectPriority      @default(MEDIUM)
  is_public                           Boolean              @default(false)
  allow_time_logging                  Boolean              @default(true)
  require_approval                    Boolean              @default(false)
  is_archived                         Boolean              @default(false)
  archived_at                         DateTime?
  archived_by                         String?
  tags                                String[]             @default([])
  custom_fields                       Json?
  created_by_id                       String
  created_at                          DateTime             @default(now())
  updated_at                          DateTime
  project_activities                  project_activities[]
  project_budgets                     project_budgets[]
  project_members                     project_members[]
  project_milestones                  project_milestones[]
  project_phases                      project_phases[]
  project_risks                       project_risks[]
  companies                           Company              @relation(fields: [company_id], references: [id], onDelete: Cascade)
  users_projects_created_by_idTousers User                 @relation("projects_created_by_idTousers", fields: [created_by_id], references: [id])
  users_projects_manager_idTousers    User?                @relation("projects_manager_idTousers", fields: [manager_id], references: [id])
  users_projects_owner_idTousers      User?                @relation("projects_owner_idTousers", fields: [owner_id], references: [id])
  programs                            programs?            @relation(fields: [program_id], references: [id])
  users_projects_sponsor_idTousers    User?                @relation("projects_sponsor_idTousers", fields: [sponsor_id], references: [id])
  project_templates                   project_templates?   @relation(fields: [template_id], references: [id])
  tasks                               tasks[]

  @@index([code])
  @@index([company_id, manager_id])
  @@index([company_id, program_id])
  @@index([company_id, status])
}

model recognition_reactions {
  id             String       @id
  recognition_id String
  user_id        String
  emoji          String
  created_at     DateTime     @default(now())
  recognitions   recognitions @relation(fields: [recognition_id], references: [id], onDelete: Cascade)

  @@unique([recognition_id, user_id, emoji])
}

model recognitions {
  id                    String                  @id
  company_id            String
  giver_id              String
  receiver_id           String
  type                  RecognitionType         @default(KUDOS)
  message               String
  core_value_id         String?
  points_awarded        Int                     @default(0)
  monetary_value        Decimal?                @db.Decimal(10, 2)
  is_public             Boolean                 @default(true)
  created_at            DateTime                @default(now())
  recognition_reactions recognition_reactions[]
  companies             Company                 @relation(fields: [company_id], references: [id])

  @@index([company_id, created_at])
  @@index([giver_id])
  @@index([receiver_id])
}

model role_levels {
  id                    String       @id
  job_family_id         String
  code                  String
  name                  String
  name_ar               String?
  rank                  Int
  is_manager            Boolean      @default(false)
  weight_overrides      Json?
  min_evidence_required Int?
  created_at            DateTime     @default(now())
  updated_at            DateTime
  job_families          job_families @relation(fields: [job_family_id], references: [id], onDelete: Cascade)
  users                 User[]

  @@unique([job_family_id, code])
}

model saudization_configs {
  id                        String                   @id
  company_id                String                   @unique
  activity_code             String
  activity_name             String
  activity_name_ar          String
  company_size_range        String
  required_saudi_percentage Decimal                  @db.Decimal(5, 2)
  current_saudi_percentage  Decimal                  @default(0) @db.Decimal(5, 2)
  target_saudi_percentage   Decimal                  @db.Decimal(5, 2)
  platinum_threshold        Decimal                  @db.Decimal(5, 2)
  green_high_threshold      Decimal                  @db.Decimal(5, 2)
  green_mid_threshold       Decimal                  @db.Decimal(5, 2)
  green_low_threshold       Decimal                  @db.Decimal(5, 2)
  yellow_threshold          Decimal                  @db.Decimal(5, 2)
  current_zone              NitaqatZone              @default(YELLOW)
  previous_zone             NitaqatZone?
  zone_changed_at           DateTime?
  alert_threshold           Decimal                  @default(5) @db.Decimal(5, 2)
  auto_calculate            Boolean                  @default(true)
  calculation_frequency     String                   @default("DAILY")
  last_calculated_at        DateTime?
  notes                     String?
  created_at                DateTime                 @default(now())
  updated_at                DateTime
  department_saudization    department_saudization[]
  nitaqat_alerts            nitaqat_alerts[]
  companies                 Company                  @relation(fields: [company_id], references: [id], onDelete: Cascade)
  saudization_records       saudization_records[]
  saudization_targets       saudization_targets[]
}

model saudization_recommendations {
  id                   String       @id
  company_id           String
  recommendation_type  String
  title                String
  title_ar             String
  description          String
  description_ar       String
  impact_on_percentage Decimal      @db.Decimal(5, 2)
  impact_on_zone       NitaqatZone?
  estimated_cost       Decimal?     @db.Decimal(12, 2)
  estimated_time_weeks Int?
  priority             String
  priority_score       Int
  target_department_id String?
  suggested_job_titles Json?
  status               String       @default("PENDING")
  implemented_at       DateTime?
  rejected_at          DateTime?
  rejection_reason     String?
  source               String       @default("AI")
  created_at           DateTime     @default(now())
  updated_at           DateTime

  @@index([company_id, priority])
  @@index([company_id, status])
}

model saudization_records {
  id                    String              @id
  company_id            String
  config_id             String
  record_date           DateTime            @db.Date
  month                 Int
  year                  Int
  total_employees       Int
  saudi_employees       Int
  non_saudi_employees   Int
  saudi_males           Int                 @default(0)
  saudi_females         Int                 @default(0)
  non_saudi_males       Int                 @default(0)
  non_saudi_females     Int                 @default(0)
  part_time_saudis      Int                 @default(0)
  part_time_non_saudis  Int                 @default(0)
  saudi_students        Int                 @default(0)
  saudi_trainees        Int                 @default(0)
  disabled_saudis       Int                 @default(0)
  calculated_percentage Decimal             @db.Decimal(5, 2)
  weighted_percentage   Decimal             @db.Decimal(5, 2)
  zone                  NitaqatZone
  previous_zone         NitaqatZone?
  zone_changed          Boolean             @default(false)
  status                SaudizationStatus
  gap_to_target         Decimal             @db.Decimal(5, 2)
  gap_to_next_zone      Decimal             @db.Decimal(5, 2)
  required_hires        Int                 @default(0)
  allowed_exits         Int                 @default(0)
  notes                 String?
  created_at            DateTime            @default(now())
  saudization_configs   saudization_configs @relation(fields: [config_id], references: [id], onDelete: Cascade)

  @@unique([company_id, record_date])
  @@index([company_id, year, month])
}

model saudization_targets {
  id                      String              @id
  company_id              String
  config_id               String
  target_year             Int
  target_quarter          Int?
  target_month            Int?
  target_percentage       Decimal             @db.Decimal(5, 2)
  target_zone             NitaqatZone
  planned_saudi_hires     Int                 @default(0)
  planned_non_saudi_exits Int                 @default(0)
  actual_saudi_hires      Int                 @default(0)
  actual_non_saudi_exits  Int                 @default(0)
  achieved_percentage     Decimal?            @db.Decimal(5, 2)
  is_achieved             Boolean             @default(false)
  achieved_at             DateTime?
  notes                   String?
  created_at              DateTime            @default(now())
  updated_at              DateTime
  saudization_configs     saudization_configs @relation(fields: [config_id], references: [id], onDelete: Cascade)

  @@unique([config_id, target_year, target_quarter, target_month])
  @@index([company_id, target_year])
}

model shift_bids {
  id          String    @id
  company_id  String
  shift_id    String
  user_id     String
  bid_note    String?
  priority    Int       @default(0)
  status      String    @default("PENDING")
  reviewed_at DateTime?
  reviewed_by String?
  created_at  DateTime  @default(now())
  shifts      shifts    @relation(fields: [shift_id], references: [id], onDelete: Cascade)
  users       User      @relation(fields: [user_id], references: [id])

  @@unique([shift_id, user_id])
  @@index([company_id, status])
}

model shift_optimization_runs {
  id                   String    @id
  company_id           String
  schedule_id          String
  optimization_goals   Json
  constraints          Json
  status               String    @default("RUNNING")
  total_changes        Int       @default(0)
  cost_savings         Decimal?  @db.Decimal(12, 2)
  coverage_improvement Decimal?  @db.Decimal(5, 2)
  fairness_score       Decimal?  @db.Decimal(5, 2)
  changes_applied      Json?
  suggestions          Json?
  warnings             Json?
  started_at           DateTime  @default(now())
  completed_at         DateTime?
  applied_at           DateTime?
  applied_by           String?
  created_at           DateTime  @default(now())
  companies            Company   @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@index([company_id, status])
}

model shift_rules {
  id              String           @id
  company_id      String
  template_id     String?
  rule_type       String
  name            String
  name_ar         String
  description     String?
  condition       Json
  value           String
  severity        String           @default("WARNING")
  is_active       Boolean          @default(true)
  applies_to_all  Boolean          @default(true)
  department_ids  Json?
  role_ids        Json?
  created_at      DateTime         @default(now())
  updated_at      DateTime
  companies       Company          @relation(fields: [company_id], references: [id], onDelete: Cascade)
  shift_templates shift_templates? @relation(fields: [template_id], references: [id])

  @@index([company_id, is_active])
}

model shift_schedules {
  id                 String      @id
  company_id         String
  name               String
  name_ar            String
  description        String?
  start_date         DateTime    @db.Date
  end_date           DateTime    @db.Date
  week_number        Int?
  branch_id          String?
  department_id      String?
  status             ShiftStatus @default(DRAFT)
  published_at       DateTime?
  published_by       String?
  total_shifts       Int         @default(0)
  assigned_shifts    Int         @default(0)
  open_shifts        Int         @default(0)
  coverage_percent   Decimal     @default(0) @db.Decimal(5, 2)
  is_ai_optimized    Boolean     @default(false)
  optimization_score Decimal?    @db.Decimal(5, 2)
  last_optimized_at  DateTime?
  created_by         String
  created_at         DateTime    @default(now())
  updated_at         DateTime
  branches           Branch?     @relation(fields: [branch_id], references: [id])
  companies          Company     @relation(fields: [company_id], references: [id], onDelete: Cascade)
  departments        Department? @relation(fields: [department_id], references: [id])
  shifts             shifts[]

  @@index([company_id, start_date, end_date])
  @@index([company_id, status])
}

model shift_swap_requests {
  id                                                   String    @id
  company_id                                           String
  original_shift_id                                    String
  requester_id                                         String
  target_shift_id                                      String?
  target_user_id                                       String?
  reason                                               String?
  reason_ar                                            String?
  status                                               String    @default("PENDING")
  target_accepted_at                                   DateTime?
  manager_approved_at                                  DateTime?
  manager_id                                           String?
  rejection_reason                                     String?
  expires_at                                           DateTime
  created_at                                           DateTime  @default(now())
  updated_at                                           DateTime
  users_shift_swap_requests_manager_idTousers          User?     @relation("shift_swap_requests_manager_idTousers", fields: [manager_id], references: [id])
  shifts_shift_swap_requests_original_shift_idToshifts shifts    @relation("shift_swap_requests_original_shift_idToshifts", fields: [original_shift_id], references: [id], onDelete: Cascade)
  users_shift_swap_requests_requester_idTousers        User      @relation("shift_swap_requests_requester_idTousers", fields: [requester_id], references: [id])
  shifts_shift_swap_requests_target_shift_idToshifts   shifts?   @relation("shift_swap_requests_target_shift_idToshifts", fields: [target_shift_id], references: [id])
  users_shift_swap_requests_target_user_idTousers      User?     @relation("shift_swap_requests_target_user_idTousers", fields: [target_user_id], references: [id])

  @@index([company_id, status])
  @@index([requester_id])
}

model shift_templates {
  id                      String        @id
  company_id              String
  name                    String
  name_ar                 String
  description             String?
  color                   String?
  code                    String?
  shift_type              ShiftType     @default(REGULAR)
  default_start_time      String
  default_end_time        String
  default_break_minutes   Int           @default(60)
  work_hours              Decimal       @db.Decimal(4, 2)
  is_overnight            Boolean       @default(false)
  crosses_midnight        Boolean       @default(false)
  pay_multiplier          Decimal       @default(1) @db.Decimal(3, 2)
  is_overtime_eligible    Boolean       @default(true)
  min_rest_between_shifts Int           @default(11)
  max_consecutive_days    Int           @default(6)
  is_active               Boolean       @default(true)
  created_at              DateTime      @default(now())
  updated_at              DateTime
  shift_rules             shift_rules[]
  companies               Company       @relation(fields: [company_id], references: [id], onDelete: Cascade)
  shifts                  shifts[]

  @@unique([company_id, name])
  @@index([company_id, is_active])
}

model shifts {
  id                                                                String                @id
  company_id                                                        String
  schedule_id                                                       String
  template_id                                                       String?
  shift_date                                                        DateTime              @db.Date
  start_time                                                        DateTime
  end_time                                                          DateTime
  break_minutes                                                     Int                   @default(60)
  assigned_user_id                                                  String?
  required_skills                                                   Json?
  required_role                                                     String?
  min_experience_years                                              Int?
  branch_id                                                         String?
  department_id                                                     String?
  location_note                                                     String?
  status                                                            ShiftStatus           @default(DRAFT)
  is_open                                                           Boolean               @default(true)
  actual_start_time                                                 DateTime?
  actual_end_time                                                   DateTime?
  attendance_id                                                     String?
  notes                                                             String?
  notes_ar                                                          String?
  created_at                                                        DateTime              @default(now())
  updated_at                                                        DateTime
  shift_bids                                                        shift_bids[]
  shift_swap_requests_shift_swap_requests_original_shift_idToshifts shift_swap_requests[] @relation("shift_swap_requests_original_shift_idToshifts")
  shift_swap_requests_shift_swap_requests_target_shift_idToshifts   shift_swap_requests[] @relation("shift_swap_requests_target_shift_idToshifts")
  users                                                             User?                 @relation(fields: [assigned_user_id], references: [id])
  companies                                                         Company               @relation(fields: [company_id], references: [id], onDelete: Cascade)
  shift_schedules                                                   shift_schedules       @relation(fields: [schedule_id], references: [id], onDelete: Cascade)
  shift_templates                                                   shift_templates?      @relation(fields: [template_id], references: [id])

  @@index([assigned_user_id, shift_date])
  @@index([company_id, shift_date])
  @@index([schedule_id, shift_date])
}

model smart_policy_analytics {
  id                      String      @id
  policy_id               String
  company_id              String
  period                  String
  employees_affected      Int
  total_additions         Decimal     @db.Decimal(12, 2)
  total_deductions        Decimal     @db.Decimal(12, 2)
  avg_amount_per_employee Decimal     @db.Decimal(12, 2)
  execution_count         Int
  by_department           Json        @default("{}")
  by_branch               Json        @default("{}")
  by_job_title            Json        @default("{}")
  previous_period_change  Decimal?    @db.Decimal(5, 2)
  calculated_at           DateTime    @default(now())
  companies               Company     @relation(fields: [company_id], references: [id])
  smart_policies          SmartPolicy @relation(fields: [policy_id], references: [id], onDelete: Cascade)

  @@unique([policy_id, period])
  @@index([company_id, period])
}

model smart_policy_approvals {
  id                String               @id
  policy_id         String
  submitted_by      String
  submitted_by_name String
  submitted_at      DateTime             @default(now())
  required_level    String               @default("HR")
  action            PolicyApprovalAction @default(SUBMITTED)
  action_by         String?
  action_by_name    String?
  action_at         DateTime?
  action_notes      String?
  rejection_reason  String?
  policy_version    Int
  created_at        DateTime             @default(now())
  updated_at        DateTime?            @default(now()) @db.Timestamp(6)
  smart_policies    SmartPolicy          @relation(fields: [policy_id], references: [id], onDelete: Cascade)

  @@index([action, submitted_at])
  @@index([policy_id, action])
}

model smart_policy_exceptions {
  id              String      @id
  policy_id       String
  company_id      String
  exception_type  String
  target_id       String
  target_name     String
  reason          String?
  exception_from  DateTime?
  exception_to    DateTime?
  is_active       Boolean     @default(true)
  created_by      String
  created_by_name String
  created_at      DateTime    @default(now())
  updated_at      DateTime
  companies       Company     @relation(fields: [company_id], references: [id])
  smart_policies  SmartPolicy @relation(fields: [policy_id], references: [id], onDelete: Cascade)

  @@unique([policy_id, exception_type, target_id])
  @@index([company_id])
  @@index([policy_id, is_active])
}

model smart_policy_occurrence_trackers {
  id               String                @id
  policy_id        String
  employee_id      String
  occurrence_type  String
  count            Int                   @default(0)
  reset_period     OccurrenceResetPeriod @default(MONTHLY)
  last_reset_at    DateTime              @default(now())
  last_occurred_at DateTime?
  last_event_data  Json?
  created_at       DateTime              @default(now())
  updated_at       DateTime
  smart_policies   SmartPolicy           @relation(fields: [policy_id], references: [id], onDelete: Cascade)

  @@unique([policy_id, employee_id, occurrence_type])
  @@index([employee_id])
  @@index([policy_id])
}

model smart_policy_retro_applications {
  id                        String                 @id
  policy_id                 String
  company_id                String
  start_period              String
  end_period                String
  periods                   String[]
  total_employees_affected  Int                    @default(0)
  total_additions           Decimal                @default(0) @db.Decimal(12, 2)
  total_deductions          Decimal                @default(0) @db.Decimal(12, 2)
  net_amount                Decimal                @default(0) @db.Decimal(12, 2)
  results                   Json                   @default("[]")
  status                    RetroApplicationStatus @default(PENDING)
  requested_by              String
  requested_by_name         String
  requested_at              DateTime               @default(now())
  reviewed_by               String?
  reviewed_by_name          String?
  reviewed_at               DateTime?
  approved_by               String?
  approved_by_name          String?
  approved_at               DateTime?
  applied_at                DateTime?
  applied_to_payroll_period String?
  notes                     String?
  created_at                DateTime               @default(now())
  updated_at                DateTime
  companies                 Company                @relation(fields: [company_id], references: [id])
  smart_policies            SmartPolicy            @relation(fields: [policy_id], references: [id], onDelete: Cascade)

  @@index([company_id, status])
  @@index([policy_id, status])
}

model smart_policy_templates {
  id                 String   @id
  category           String
  name               String
  name_en            String?
  description        String
  original_text      String
  parsed_rule        Json
  legal_compliance   Json     @default("{}")
  labor_law_articles String[]
  usage_count        Int      @default(0)
  rating             Decimal? @db.Decimal(2, 1)
  rating_count       Int      @default(0)
  is_public          Boolean  @default(true)
  is_system_template Boolean  @default(false)
  created_by         String?
  created_at         DateTime @default(now())
  updated_at         DateTime
  base_config        Json?
  code               String?  @db.VarChar(255)
  name_ar            String?  @db.VarChar(255)
  default_params     Json?
  is_active          Boolean? @default(true)

  @@index([category, is_public])
}

model smart_policy_versions {
  id              String      @id
  policy_id       String
  version         Int
  original_text   String
  parsed_rule     Json
  conditions      Json        @default("[]")
  actions         Json        @default("[]")
  change_reason   String?
  changed_by      String
  changed_by_name String
  created_at      DateTime    @default(now())
  smart_policies  SmartPolicy @relation(fields: [policy_id], references: [id], onDelete: Cascade)

  @@unique([policy_id, version])
  @@index([policy_id])
}

model sprints {
  id               String       @id
  company_id       String
  name             String
  goal             String?
  description      String?
  status           SprintStatus @default(PLANNING)
  start_date       DateTime?
  end_date         DateTime?
  started_at       DateTime?
  completed_at     DateTime?
  planned_points   Int          @default(0)
  completed_points Int          @default(0)
  velocity         Float?
  created_by_id    String
  created_at       DateTime     @default(now())
  updated_at       DateTime
  companies        Company      @relation(fields: [company_id], references: [id], onDelete: Cascade)
  users            User         @relation(fields: [created_by_id], references: [id])
  tasks            tasks[]

  @@index([company_id, start_date])
  @@index([company_id, status])
}

model succession_candidates {
  id                  String           @id
  plan_id             String
  employee_id         String
  readiness_level     String
  risk_of_leaving     String?
  development_actions Json?
  notes               String?
  created_at          DateTime         @default(now())
  updated_at          DateTime
  succession_plans    succession_plans @relation(fields: [plan_id], references: [id], onDelete: Cascade)

  @@unique([plan_id, employee_id])
}

model succession_plans {
  id                    String                  @id
  company_id            String
  position_id           String
  target_year           Int
  created_at            DateTime                @default(now())
  updated_at            DateTime
  succession_candidates succession_candidates[]
  companies             Company                 @relation(fields: [company_id], references: [id])

  @@unique([position_id, target_year])
}

model survey_responses {
  id                 String           @id
  survey_id          String
  user_id            String?
  answers            Json
  department_id      String?
  branch_id          String?
  started_at         DateTime
  completed_at       DateTime?
  time_spent_seconds Int?
  is_complete        Boolean          @default(false)
  created_at         DateTime         @default(now())
  employee_surveys   employee_surveys @relation(fields: [survey_id], references: [id], onDelete: Cascade)
  users              User?            @relation(fields: [user_id], references: [id])

  @@index([survey_id])
  @@index([user_id])
}

model task_activity_logs {
  id          String   @id
  task_id     String
  user_id     String
  action      String
  old_value   String?
  new_value   String?
  description String?
  created_at  DateTime @default(now())
  tasks       tasks    @relation(fields: [task_id], references: [id], onDelete: Cascade)
  users       User     @relation(fields: [user_id], references: [id])

  @@index([task_id])
  @@index([user_id])
}

model task_approvals {
  id         String             @id
  task_id    String
  user_id    String
  action     TaskApprovalAction
  comment    String?
  created_at DateTime           @default(now())
  tasks      tasks              @relation(fields: [task_id], references: [id], onDelete: Cascade)
  users      User               @relation(fields: [user_id], references: [id])

  @@index([task_id])
  @@index([user_id])
}

model task_assignments {
  id             String   @id
  task_id        String
  user_id        String
  assigned_at    DateTime @default(now())
  assigned_by_id String?
  tasks          tasks    @relation(fields: [task_id], references: [id], onDelete: Cascade)
  users          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([task_id, user_id])
}

model task_attachments {
  id             String   @id
  task_id        String
  uploaded_by_id String
  file_name      String
  file_size      Int
  mime_type      String
  storage_path   String
  created_at     DateTime @default(now())
  tasks          tasks    @relation(fields: [task_id], references: [id], onDelete: Cascade)
  users          User     @relation(fields: [uploaded_by_id], references: [id])

  @@index([task_id])
}

model task_automations {
  id              String            @id
  company_id      String
  created_by_id   String
  name            String
  description     String?
  is_active       Boolean           @default(true)
  trigger         AutomationTrigger
  trigger_config  Json?
  action          AutomationAction
  action_config   Json?
  category_id     String?
  priority        TaskPriority?
  last_run_at     DateTime?
  run_count       Int               @default(0)
  created_at      DateTime          @default(now())
  updated_at      DateTime
  automation_logs automation_logs[]
  task_categories task_categories?  @relation(fields: [category_id], references: [id])
  companies       Company           @relation(fields: [company_id], references: [id], onDelete: Cascade)
  users           User              @relation(fields: [created_by_id], references: [id])

  @@index([company_id])
  @@index([is_active])
}

model task_categories {
  id               String             @id
  company_id       String
  name             String
  name_en          String?
  color            String             @default("#3B82F6")
  icon             String?
  order            Int                @default(0)
  is_active        Boolean            @default(true)
  created_at       DateTime           @default(now())
  updated_at       DateTime
  task_automations task_automations[]
  companies        Company            @relation(fields: [company_id], references: [id], onDelete: Cascade)
  task_templates   task_templates[]
  tasks            tasks[]

  @@unique([company_id, name])
  @@index([company_id, is_active])
}

model task_checklist_items {
  id              String          @id
  checklist_id    String
  content         String
  is_completed    Boolean         @default(false)
  order           Int             @default(0)
  completed_at    DateTime?
  completed_by_id String?
  created_at      DateTime        @default(now())
  updated_at      DateTime
  task_checklists task_checklists @relation(fields: [checklist_id], references: [id], onDelete: Cascade)

  @@index([checklist_id])
}

model task_checklists {
  id                   String                 @id
  task_id              String
  title                String
  order                Int                    @default(0)
  created_at           DateTime               @default(now())
  updated_at           DateTime
  task_checklist_items task_checklist_items[]
  tasks                tasks                  @relation(fields: [task_id], references: [id], onDelete: Cascade)

  @@index([task_id])
}

model task_comments {
  id                  String              @id
  task_id             String
  author_id           String
  content             String
  mentions            String[]            @default([])
  is_edited           Boolean             @default(false)
  edited_at           DateTime?
  created_at          DateTime            @default(now())
  updated_at          DateTime
  parent_id           String?
  comment_reactions   comment_reactions[]
  users               User                @relation(fields: [author_id], references: [id])
  task_comments       task_comments?      @relation("task_commentsTotask_comments", fields: [parent_id], references: [id], onDelete: Cascade)
  other_task_comments task_comments[]     @relation("task_commentsTotask_comments")
  tasks               tasks               @relation(fields: [task_id], references: [id], onDelete: Cascade)

  @@index([author_id])
  @@index([parent_id])
  @@index([task_id])
}

model task_dependencies {
  id                                              String         @id
  blocked_task_id                                 String
  blocking_task_id                                String
  created_at                                      DateTime       @default(now())
  type                                            DependencyType @default(BLOCKS)
  tasks_task_dependencies_blocked_task_idTotasks  tasks          @relation("task_dependencies_blocked_task_idTotasks", fields: [blocked_task_id], references: [id], onDelete: Cascade)
  tasks_task_dependencies_blocking_task_idTotasks tasks          @relation("task_dependencies_blocking_task_idTotasks", fields: [blocking_task_id], references: [id], onDelete: Cascade)

  @@unique([blocked_task_id, blocking_task_id])
}

model task_evidences {
  id                                          String             @id
  task_id                                     String
  submitted_by_id                             String
  description                                 String?
  file_url                                    String?
  file_name                                   String?
  file_type                                   String?
  file_size                                   Int?
  latitude                                    Float?
  longitude                                   Float?
  location_name                               String?
  status                                      TaskEvidenceStatus @default(PENDING)
  verified_by_id                              String?
  verified_at                                 DateTime?
  verification_comment                        String?
  created_at                                  DateTime           @default(now())
  users_task_evidences_submitted_by_idTousers User               @relation("task_evidences_submitted_by_idTousers", fields: [submitted_by_id], references: [id])
  tasks                                       tasks              @relation(fields: [task_id], references: [id], onDelete: Cascade)
  users_task_evidences_verified_by_idTousers  User?              @relation("task_evidences_verified_by_idTousers", fields: [verified_by_id], references: [id])

  @@index([submitted_by_id])
  @@index([task_id])
}

model task_templates {
  id                 String           @id
  company_id         String
  name               String
  name_en            String?
  description        String?
  category_id        String?
  default_priority   TaskPriority     @default(MEDIUM)
  default_due_days   Int?
  checklist_template Json?
  workflow_type      String?
  is_active          Boolean          @default(true)
  created_at         DateTime         @default(now())
  updated_at         DateTime
  task_categories    task_categories? @relation(fields: [category_id], references: [id])
  companies          Company          @relation(fields: [company_id], references: [id], onDelete: Cascade)
  tasks              tasks[]

  @@unique([company_id, name])
  @@index([company_id, is_active])
}

model task_time_logs {
  id          String    @id
  task_id     String
  user_id     String
  start_time  DateTime
  end_time    DateTime?
  duration    Int?
  description String?
  is_billable Boolean   @default(false)
  created_at  DateTime  @default(now())
  updated_at  DateTime
  tasks       tasks     @relation(fields: [task_id], references: [id], onDelete: Cascade)
  users       User      @relation(fields: [user_id], references: [id])

  @@index([task_id])
  @@index([user_id])
}

model task_watchers {
  id             String   @id
  task_id        String
  user_id        String
  watching_since DateTime @default(now())
  tasks          tasks    @relation(fields: [task_id], references: [id], onDelete: Cascade)
  users          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([task_id, user_id])
}

model tasks {
  id                                                          String               @id
  company_id                                                  String
  title                                                       String
  description                                                 String?
  status                                                      TaskStatus           @default(TODO)
  priority                                                    TaskPriority         @default(MEDIUM)
  category_id                                                 String?
  template_id                                                 String?
  due_date                                                    DateTime?
  start_date                                                  DateTime?
  completed_at                                                DateTime?
  created_by_id                                               String
  assignee_id                                                 String?
  recurrence_type                                             TaskRecurrenceType?
  recurrence_end                                              DateTime?
  parent_task_id                                              String?
  progress                                                    Int                  @default(0)
  custom_fields                                               Json?
  order                                                       Int                  @default(0)
  created_at                                                  DateTime             @default(now())
  updated_at                                                  DateTime
  approved_at                                                 DateTime?
  approver_id                                                 String?
  escalated_at                                                DateTime?
  is_escalated                                                Boolean              @default(false)
  rejected_at                                                 DateTime?
  rejection_reason                                            String?
  review_requested_at                                         DateTime?
  reviewed_at                                                 DateTime?
  reviewer_id                                                 String?
  sla_hours                                                   Int?
  estimated_hours                                             Float?
  project_id                                                  String?
  sprint_id                                                   String?
  story_points                                                Int?
  category_type                                               String?              @db.VarChar(255)
  assigned_to                                                 String?              @db.VarChar(255)
  assigned_by                                                 String?              @db.VarChar(255)
  entity_type                                                 String?              @db.VarChar(255)
  entity_id                                                   String?              @db.VarChar(255)
  created_by                                                  String?              @db.VarChar(255)
  metadata                                                    Json?
  tags                                                        Json?
  task_activity_logs                                          task_activity_logs[]
  task_approvals                                              task_approvals[]
  task_assignments                                            task_assignments[]
  task_attachments                                            task_attachments[]
  task_checklists                                             task_checklists[]
  task_comments                                               task_comments[]
  task_dependencies_task_dependencies_blocked_task_idTotasks  task_dependencies[]  @relation("task_dependencies_blocked_task_idTotasks")
  task_dependencies_task_dependencies_blocking_task_idTotasks task_dependencies[]  @relation("task_dependencies_blocking_task_idTotasks")
  task_evidences                                              task_evidences[]
  task_time_logs                                              task_time_logs[]
  task_watchers                                               task_watchers[]
  users_tasks_approver_idTousers                              User?                @relation("tasks_approver_idTousers", fields: [approver_id], references: [id])
  users_tasks_assignee_idTousers                              User?                @relation("tasks_assignee_idTousers", fields: [assignee_id], references: [id])
  task_categories                                             task_categories?     @relation(fields: [category_id], references: [id])
  companies                                                   Company              @relation(fields: [company_id], references: [id], onDelete: Cascade)
  users_tasks_created_by_idTousers                            User                 @relation("tasks_created_by_idTousers", fields: [created_by_id], references: [id])
  tasks                                                       tasks?               @relation("tasksTotasks", fields: [parent_task_id], references: [id])
  other_tasks                                                 tasks[]              @relation("tasksTotasks")
  projects                                                    projects?            @relation(fields: [project_id], references: [id])
  users_tasks_reviewer_idTousers                              User?                @relation("tasks_reviewer_idTousers", fields: [reviewer_id], references: [id])
  sprints                                                     sprints?             @relation(fields: [sprint_id], references: [id])
  task_templates                                              task_templates?      @relation(fields: [template_id], references: [id])

  @@index([company_id, assignee_id])
  @@index([company_id, category_id])
  @@index([company_id, created_by_id])
  @@index([company_id, due_date])
  @@index([company_id, sprint_id])
  @@index([company_id, status])
}

model team_calendar_events {
  id              String   @id
  company_id      String
  title           String
  title_ar        String?
  description     String?
  event_type      String
  start_date      DateTime
  end_date        DateTime
  is_all_day      Boolean  @default(false)
  timezone        String   @default("Asia/Riyadh")
  user_id         String?
  department_id   String?
  branch_id       String?
  team_id         String?
  color           String?
  icon            String?
  visibility      String   @default("TEAM")
  source_type     String?
  source_id       String?
  is_recurring    Boolean  @default(false)
  recurrence_rule String?
  created_by      String
  created_at      DateTime @default(now())
  updated_at      DateTime
  companies       Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)
  users           User?    @relation(fields: [user_id], references: [id])

  @@index([company_id, start_date, end_date])
  @@index([department_id, start_date])
  @@index([user_id, start_date])
}

model training_requests {
  id                     String    @id
  company_id             String
  user_id                String
  training_type          String
  training_name          String
  training_name_ar       String?
  provider               String?
  description            String?
  start_date             DateTime? @db.Date
  end_date               DateTime? @db.Date
  duration_hours         Int?
  location               String?
  is_online              Boolean   @default(false)
  estimated_cost         Decimal?  @db.Decimal(10, 2)
  currency               String    @default("SAR")
  is_cost_approved       Boolean   @default(false)
  business_justification String
  expected_outcome       String?
  skills_to_gain         Json?
  status                 String    @default("PENDING")
  manager_approved_at    DateTime?
  manager_approved_by    String?
  hr_approved_at         DateTime?
  hr_approved_by         String?
  rejection_reason       String?
  completed_at           DateTime?
  certificate_url        String?
  feedback_score         Int?
  feedback_notes         String?
  created_at             DateTime  @default(now())
  updated_at             DateTime
  users                  User      @relation(fields: [user_id], references: [id])

  @@index([company_id, status])
  @@index([user_id])
}

model upee_360_requests {
  id                        String                    @id
  cycle_id                  String
  employee_id               String
  rater_id                  String
  raterType                 FeedbackRaterType
  status                    UPEE360Status             @default(UPEE_PENDING)
  anonymous                 Boolean                   @default(true)
  sent_at                   DateTime?
  completed_at              DateTime?
  created_at                DateTime                  @default(now())
  performance_review_cycles performance_review_cycles @relation(fields: [cycle_id], references: [id])
  upee_feedback_answers     upee_feedback_answers[]

  @@unique([cycle_id, employee_id, rater_id])
  @@index([cycle_id, employee_id])
}

model upee_feedback_answers {
  id                 String             @id
  request_id         String
  question_id        String
  rating             Int?
  comment            String?
  created_at         DateTime           @default(now())
  feedback_questions feedback_questions @relation(fields: [question_id], references: [id])
  upee_360_requests  upee_360_requests  @relation(fields: [request_id], references: [id], onDelete: Cascade)

  @@unique([request_id, question_id])
}

model user_notification_preferences {
  id                  String   @id
  user_id             String   @unique
  push_enabled        Boolean  @default(true)
  email_enabled       Boolean  @default(true)
  sms_enabled         Boolean  @default(false)
  whatsapp_enabled    Boolean  @default(false)
  leave_approvals     Boolean  @default(true)
  attendance_alerts   Boolean  @default(true)
  payslip_available   Boolean  @default(true)
  task_assignments    Boolean  @default(true)
  policy_updates      Boolean  @default(true)
  shift_reminders     Boolean  @default(true)
  training_reminders  Boolean  @default(true)
  survey_invites      Boolean  @default(true)
  announcements       Boolean  @default(true)
  quiet_hours_enabled Boolean  @default(false)
  quiet_hours_start   String?
  quiet_hours_end     String?
  quiet_days          Json?
  preferred_language  String   @default("ar")
  created_at          DateTime @default(now())
  updated_at          DateTime
  users               User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

enum WorkDayCalculationBase {
  CALENDAR_DAYS
  ACTUAL_WORKING_DAYS
  FIXED_30_DAYS
}

enum HireTerminationMethod {
  EXCLUDE_WEEKENDS
  INCLUDE_ALL_DAYS
  PRORATE_BY_CALENDAR
}

enum UnpaidLeaveMethod {
  BASED_ON_SHIFTS
  BASED_ON_CALENDAR
  BASED_ON_WORKING_DAYS
}

enum OvertimeCalculationMethod {
  BASED_ON_SHIFTS
  BASED_ON_BASIC_ONLY
  BASED_ON_TOTAL
  BASED_ON_ELIGIBLE_COMPONENTS
}

enum LeaveAllowanceMethod {
  BASIC_SALARY
  BASIC_PLUS_HOUSING
  TOTAL_SALARY
}

enum Role {
  ADMIN
  MANAGER
  EMPLOYEE
  HR
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum ContractType {
  PERMANENT
  FIXED_TERM
  PART_TIME
  SEASONAL
  PROBATION
}

enum ContractStatus {
  ACTIVE
  EXPIRED
  TERMINATED
  RENEWED
  SUSPENDED
  DRAFT
  PENDING_EMPLOYEE
  PENDING_EMPLOYER
  PENDING_QIWA
  REJECTED
}

enum QiwaAuthStatus {
  NOT_SUBMITTED
  PENDING
  AUTHENTICATED
  REJECTED
  EXPIRED
}

enum DeviceStatus {
  ACTIVE
  PENDING
  BLOCKED
  INACTIVE
}

enum DevicePlatform {
  ANDROID
  IOS
  WEB
  UNKNOWN
}

enum UpdateRequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum UpdateRequestType {
  FACE_UPDATE
  DEVICE_UPDATE
  BOTH
  DEVICE_CHANGE
  PROFILE_UPDATE
}

enum AttendanceStatus {
  PRESENT
  LATE
  EARLY_LEAVE
  ABSENT
  ON_LEAVE
  WORK_FROM_HOME
  LATE_AND_EARLY
  HOLIDAY
}

enum CheckType {
  CHECK_IN
  CHECK_OUT
}

enum LeaveCategory {
  BALANCED
  CASUAL
  SICK
  UNPAID
}

enum LeaveType {
  ANNUAL
  SICK
  PERSONAL
  EMERGENCY
  NEW_BABY
  MARRIAGE
  BEREAVEMENT
  HAJJ
  EXAM
  WORK_MISSION
  UNPAID
  EARLY_LEAVE
  OTHER
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  MODIFIED
  MGR_APPROVED
  MGR_REJECTED
  DELAYED
}

enum ApprovalStep {
  MANAGER
  HR
  COMPLETED
  FINANCE
  CEO
}

enum ApprovalDecision {
  PENDING
  APPROVED
  REJECTED
  DELAYED
}

enum LetterType {
  SALARY_DEFINITION
  SERVICE_CONFIRMATION
  SALARY_ADJUSTMENT
  PROMOTION
  TRANSFER_ASSIGNMENT
  RESIGNATION
  TERMINATION
  CLEARANCE
  EXPERIENCE
  SALARY_DEFINITION_DIRECTED
  NOC
  DELEGATION
}

enum LetterStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  MGR_APPROVED
  MGR_REJECTED
  DELAYED
}

enum NotificationType {
  LATE_CHECK_IN
  EARLY_CHECK_OUT
  EARLY_CHECK_IN
  LEAVE_APPROVED
  LEAVE_REJECTED
  SUSPICIOUS_ACTIVITY
  GENERAL
  LETTER_APPROVED
  LETTER_REJECTED
  DISC_CASE_SUBMITTED
  DISC_HR_REJECTED
  DISC_INFORMAL_SENT
  DISC_EMP_REJECTED_INFORMAL
  DISC_HEARING_SCHEDULED
  DISC_DECISION_ISSUED
  DISC_EMP_OBJECTED
  DISC_FINALIZED
  EMP_EXIT_GEOFENCE
  EMP_RETURN_GEOFENCE
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  SETTINGS_CHANGE
  EXPORT
  IMPORT
}

enum PermissionScope {
  SELF
  TEAM
  BRANCH
  DEPARTMENT
  ALL
  CUSTOM
}

enum PermissionAuditAction {
  ADDED
  REMOVED
  MODIFIED
}

enum RaiseType {
  SALARY_INCREASE
  ANNUAL_LEAVE_BONUS
  BUSINESS_TRIP
  BONUS
  ALLOWANCE
  OTHER
}

enum RaiseStatus {
  PENDING
  MGR_APPROVED
  MGR_REJECTED
  APPROVED
  REJECTED
  DELAYED
  CANCELLED
}

enum AdvanceType {
  BANK_TRANSFER
  CASH
}

enum SalaryComponentType {
  EARNING
  DEDUCTION
}

enum SalaryComponentNature {
  FIXED
  VARIABLE
  FORMULA
}

enum PayrollStatus {
  DRAFT
  INPUTS_COLLECTED
  CALCULATED
  HR_REVIEWED
  FINANCE_APPROVED
  LOCKED
  PAID
  CANCELLED
  ARCHIVED
}

enum PayslipLineSource {
  STRUCTURE
  POLICY
  MANUAL
  ADJUSTMENT
  STATUTORY
  SMART
}

enum RetroPayStatus {
  PENDING
  APPROVED
  PAID
  CANCELLED
}

enum PolicyType {
  OVERTIME
  LEAVE
  DEDUCTION
  ALLOWANCE
  ATTENDANCE
  GENERAL
}

enum PolicyScope {
  COMPANY
  BRANCH
  DEPARTMENT
  JOB_TITLE
  EMPLOYEE
}

enum OutputSign {
  EARNING
  DEDUCTION
}

enum SmartPolicyTrigger {
  ATTENDANCE
  LEAVE
  CUSTODY
  PAYROLL
  ANNIVERSARY
  CONTRACT
  DISCIPLINARY
  PERFORMANCE
  CUSTOM
}

enum SmartPolicyStatus {
  DRAFT
  PENDING
  ACTIVE
  PAUSED
  ARCHIVED
}

enum SmartPolicyActionType {
  ADD_TO_PAYROLL
  DEDUCT_FROM_PAYROLL
  SEND_NOTIFICATION
  ALERT_HR
  CREATE_RECORD
}

enum MudadStatus {
  PENDING
  PREPARED
  SUBMITTED
  ACCEPTED
  REJECTED
  RESUBMITTED
  RESUBMIT_REQUIRED
}

enum WpsStatus {
  GENERATED
  DOWNLOADED
  SUBMITTED
  PROCESSING
  PROCESSED
  FAILED
}

enum AuditModule {
  AUTH
  USER
  PAYROLL
  PAYSLIP
  BANK_ACCOUNT
  SALARY
  LEAVE
  ATTENDANCE
  ADVANCE
  GOSI
  EOS
  PERMISSION
  POLICY
  RETRO_PAY
  LETTER
  SETTINGS
  MUDAD
  WPS
  CONTRACT
  DISCIPLINARY
}

enum DisciplinaryStage {
  MANAGER_REQUEST
  HR_INITIAL_REVIEW
  EMPLOYEE_INFORMAL_RESPONSE
  OFFICIAL_INVESTIGATION
  DECISION
  OBJECTION
  FINAL
}

enum DisciplinaryStatus {
  SUBMITTED_TO_HR
  HR_REJECTED
  HR_INFORMAL_SENT
  AWAITING_EMPLOYEE_INFORMAL
  EMPLOYEE_REJECTED_INFORMAL
  OFFICIAL_INVESTIGATION_OPENED
  HEARING_SCHEDULED
  INVESTIGATION_IN_PROGRESS
  AWAITING_HR_DECISION
  DECISION_ISSUED
  AWAITING_EMPLOYEE_ACK
  EMPLOYEE_OBJECTED
  HR_REVIEWING_OBJECTION
  FINALIZED_APPROVED
  FINALIZED_CANCELLED
  FINALIZED_CONTINUE_INVESTIGATION
}

enum DecisionType {
  NO_VIOLATION
  NOTICE
  WARNING
  FIRST_WARNING
  SECOND_WARNING
  FINAL_WARNING_TERMINATION
  FINAL_TERMINATION_ART80
  PROMOTION_DELAY
  SALARY_DEDUCTION
  SUSPENSION_WITH_PAY
  SUSPENSION_WITHOUT_PAY
}

enum PayrollAdjustmentStatus {
  PENDING
  POSTED
  REVERSED
  CANCELLED
}

enum AdjustmentUnit {
  DAYS
  HOURS
  AMOUNT
}

enum CaseEventType {
  CASE_CREATED
  HR_INITIAL_REVIEW
  INFORMAL_ACTION_SENT
  EMPLOYEE_INFORMAL_RESPONSE
  OFFICIAL_INVESTIGATION_OPENED
  HEARING_SCHEDULED
  MINUTES_UPLOADED
  DECISION_ISSUED
  EMPLOYEE_ACKNOWLEDGED
  EMPLOYEE_OBJECTED
  OBJECTION_REVIEWED
  FINALIZED
  CANCELLED
}

enum DeductionBasePolicy {
  BASIC_ONLY
  BASIC_FIXED
  GROSS
}

enum SubmissionEntityType {
  MUDAD
  WPS
  QIWA
}

enum ApprovalRequestType {
  LEAVE
  ADVANCE
  RAISE
  PAYROLL
  WPS
}

enum CustodyItemStatus {
  AVAILABLE
  ASSIGNED
  IN_MAINTENANCE
  LOST
  DAMAGED
  DISPOSED
  RESERVED
}

enum CustodyCondition {
  NEW
  EXCELLENT
  GOOD
  FAIR
  POOR
}

enum CustodyAssignmentStatus {
  PENDING
  APPROVED
  REJECTED
  DELIVERED
  RETURNED
  TRANSFERRED
}

enum CustodyReturnStatus {
  PENDING
  INSPECTING
  APPROVED
  REJECTED
  COMPLETED
}

enum CustodyTransferStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
}

enum CustodyMaintenanceStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANNOT_REPAIR
}

enum MaintenanceType {
  PREVENTIVE
  CORRECTIVE
  EMERGENCY
}

enum DocumentType {
  ID_CARD
  IQAMA
  PASSPORT
  CONTRACT
  CERTIFICATE
  MEDICAL
  BANK_LETTER
  DRIVING_LICENSE
  QUALIFICATION
  OTHER
}

enum OnboardingType {
  JOINING
  OFFBOARDING
  RETURN
}

enum AssigneeType {
  HR
  IT
  MANAGER
  FINANCE
  EMPLOYEE
}

enum OnboardingProcessStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TaskPriority {
  URGENT
  HIGH
  MEDIUM
  LOW
}

enum TaskStatus {
  BACKLOG
  TODO
  IN_PROGRESS
  IN_REVIEW
  BLOCKED
  COMPLETED
  CANCELLED
  PENDING_REVIEW
  APPROVED
  REJECTED
}

enum OnboardingTaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  SKIPPED
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum AutomationAction {
  SEND_NOTIFICATION
  CHANGE_STATUS
  ASSIGN_USER
  SET_PRIORITY
  ADD_WATCHER
  SEND_EMAIL
  CREATE_SUBTASK
}

enum AutomationTrigger {
  STATUS_CHANGED
  DUE_DATE_NEAR
  DUE_DATE_PASSED
  TASK_CREATED
  TASK_ASSIGNED
  TASK_COMPLETED
  PRIORITY_CHANGED
  COMMENT_ADDED
  EVIDENCE_SUBMITTED
}

enum BudgetCategory {
  LABOR
  MATERIALS
  EQUIPMENT
  TRAVEL
  TRAINING
  SOFTWARE
  CONSULTING
  CONTINGENCY
  OTHER
}

enum BudgetStatus {
  DRAFT
  ACTIVE
  FROZEN
  CLOSED
}

enum CalibrationStatus {
  DRAFT
  IN_PROGRESS
  COMPLETED
  LOCKED
}

enum CompanyType {
  OPERATIONAL
  TECH
  SALES
  CREATIVE
  ADMIN
  HYBRID
}

enum CompetencyCategory {
  CORE
  LEADERSHIP
  FUNCTIONAL
  TECHNICAL
  VALUE
}

enum ConductSeverity {
  MINOR
  MAJOR
  CRITICAL
}

enum DebtSourceType {
  ADVANCE
  LOAN
  CUSTODY
  PAYROLL_OVERPAYMENT
  PAYROLL_NEGATIVE_BALANCE
  OTHER
}

enum DebtStatus {
  PENDING
  ACTIVE
  PARTIALLY_PAID
  PAID
  SETTLED
  SUSPENDED
  CANCELLED
  WRITTEN_OFF
}

enum DebtTransactionType {
  CREATION
  INITIAL_DEBT
  PAYMENT
  PAYROLL_DEDUCTION
  MANUAL_PAYMENT
  ADJUSTMENT
  WRITE_OFF
  CANCELLATION
}

enum DeliveryStatus {
  PENDING
  PICKED_UP
  IN_TRANSIT
  DELIVERED
  FAILED
  RETURNED
}

enum DependencyType {
  BLOCKS
  BLOCKED_BY
  RELATED
  DUPLICATES
}

enum DevelopmentGoalStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum EvalPhilosophy {
  RESULTS_FIRST
  BALANCED
  CULTURE_FIRST
}

enum EvidenceType {
  URL_LINK
  FILE_UPLOAD
  DASHBOARD_SNAPSHOT
  TICKET_REFERENCE
  PR_COMMIT
  CUSTOMER_FEEDBACK
}

enum FeedbackQuestionType {
  RATING_1_5
  RATING_1_10
  TEXT
  MULTIPLE_CHOICE
}

enum FeedbackRaterType {
  SELF
  MANAGER
  PEER
  STAKEHOLDER
  CUSTOMER
}

enum FeedbackRequestStatus {
  PENDING
  IN_PROGRESS
  SUBMITTED
  DECLINED
  EXPIRED
}

enum GoalDataSource {
  ATTENDANCE
  LEAVES
  TASKS
  OVERTIME
  POLICIES
  TRAINING
  CUSTODY
  PERFORMANCE_REVIEWS
  RECOGNITION
  SALES
  CUSTOM
}

enum GoalStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  ACTIVE
  IN_PROGRESS
  ON_TRACK
  AT_RISK
  EXCEEDED
  COMPLETED
  CANCELLED
  ON_HOLD
}

enum GoalType {
  INDIVIDUAL
  TEAM
  DEPARTMENT
  COMPANY
}

enum HealthStatus {
  ON_TRACK
  AT_RISK
  OFF_TRACK
  COMPLETED
}

enum HolidayApplicationType {
  ALL
  BRANCH
  DEPARTMENT
  SPECIFIC_EMPLOYEES
  EXCLUDE_EMPLOYEES
}

enum IDPStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

enum KPIFrequency {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum KPISourceType {
  MANUAL
  SYSTEM_SYNC
  API_IMPORT
  CSV_IMPORT
}

enum MilestoneStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  MISSED
  CANCELLED
}

enum NitaqatZone {
  PLATINUM
  GREEN_HIGH
  GREEN_MID
  GREEN_LOW
  YELLOW
  RED
}

enum OccurrenceResetPeriod {
  MONTHLY
  QUARTERLY
  YEARLY
  NEVER
  DAILY
  WEEKLY
}

enum PIPOutcome {
  PASSED
  EXTENDED
  TERMINATED
}

enum PIPStatus {
  ACTIVE
  EXTENDED
  COMPLETED
  ESCALATED
}

enum PayrollFrequency {
  WEEKLY
  BI_WEEKLY
  MONTHLY
  OTHER
}

enum PerformanceReviewCycleStatus {
  DRAFT
  PLANNING
  ACTIVE
  SELF_REVIEW
  MANAGER_REVIEW
  CALIBRATION
  COMPLETED
  CANCELLED
}

enum PerformanceReviewCycleType {
  ANNUAL
  SEMI_ANNUAL
  QUARTERLY
  MONTHLY
}

enum PerformanceReviewStatus {
  NOT_STARTED
  PENDING
  SELF_REVIEW
  SELF_REVIEW_PENDING
  SELF_REVIEW_COMPLETED
  MANAGER_REVIEW
  MANAGER_REVIEW_PENDING
  MANAGER_REVIEW_COMPLETED
  CALIBRATION
  COMPLETED
  CANCELLED
}

enum PhaseStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  ON_HOLD
  CANCELLED
}

enum PolicyApprovalAction {
  SUBMITTED
  APPROVED
  REJECTED
  CHANGES_REQUESTED
}

enum ProficiencyLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum ProgramStatus {
  PLANNING
  ACTIVE
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum ProjectHealth {
  GREEN
  YELLOW
  RED
}

enum ProjectMemberRole {
  OWNER
  MANAGER
  LEAD
  MEMBER
  STAKEHOLDER
  VIEWER
}

enum ProjectPhaseType {
  INITIATION
  PLANNING
  EXECUTION
  MONITORING
  CLOSING
}

enum ProjectPriority {
  CRITICAL
  HIGH
  MEDIUM
  LOW
}

enum ProjectStatus {
  INITIATION
  PLANNING
  EXECUTION
  MONITORING
  CLOSING
  COMPLETED
  ON_HOLD
  CANCELLED
}

enum RatingBand {
  EXCEPTIONAL
  EXCEEDS
  MEETS
  PARTIALLY_MEETS
  NEEDS_IMPROVEMENT
}

enum RecognitionType {
  KUDOS
  BADGE
  AWARD
  ACHIEVEMENT
  SPOT_BONUS
}

enum ResultStatus {
  DRAFT
  SUBMITTED
  CALIBRATED
  FINALIZED
  ARCHIVED
}

enum RetroApplicationStatus {
  PENDING
  CALCULATING
  REVIEWED
  APPROVED
  APPLIED
  CANCELLED
}

enum RiskCategory {
  TECHNICAL
  SCHEDULE
  COST
  RESOURCE
  SCOPE
  QUALITY
  EXTERNAL
  ORGANIZATIONAL
  OTHER
}

enum RiskImpact {
  NEGLIGIBLE
  MINOR
  MODERATE
  MAJOR
  SEVERE
}

enum RiskProbability {
  VERY_LOW
  LOW
  MEDIUM
  HIGH
  VERY_HIGH
}

enum RiskResponse {
  AVOID
  MITIGATE
  TRANSFER
  ACCEPT
  MONITOR
}

enum RiskStatus {
  OPEN
  MITIGATING
  RESOLVED
  OCCURRED
  CLOSED
}

enum SaudizationStatus {
  COMPLIANT
  AT_RISK
  NON_COMPLIANT
  EXEMPT
}

enum ShiftStatus {
  DRAFT
  PUBLISHED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ShiftType {
  REGULAR
  ROTATING
  SPLIT
  FLEXIBLE
  ON_CALL
}

enum SprintStatus {
  PLANNING
  ACTIVE
  COMPLETED
  CANCELLED
}

enum TaskApprovalAction {
  SUBMITTED_FOR_REVIEW
  REVIEWED
  APPROVED
  REJECTED
  CHANGES_REQUESTED
}

enum TaskEvidenceStatus {
  PENDING
  APPROVED
  REJECTED
}

enum TaskRecurrenceType {
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum TripStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum UPEE360Status {
  UPEE_PENDING
  UPEE_SENT
  UPEE_IN_PROGRESS
  UPEE_COMPLETED
  UPEE_EXPIRED
}

enum UPEECompetencyCategory {
  UPEE_CORE
  UPEE_FUNCTIONAL
  UPEE_LEADERSHIP
}
