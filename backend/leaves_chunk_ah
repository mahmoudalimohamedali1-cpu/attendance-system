 اليوم');
    }

    return this.prisma.workFromHome.create({
      data: {
        userId,
        date: targetDate,
        reason,
        approvedBy: approverId,
      },
    });
  }

  async disableWorkFromHome(userId: string, date: Date) {
    const targetDate = new Date(date);
    targetDate.setHours(0, 0, 0, 0);

    await this.prisma.workFromHome.delete({
      where: {
        userId_date: {
          userId,
          date: targetDate,
        },
      },
    });

    return { message: 'تم إلغاء العمل من المنزل' };
  }

  // ============ Helper Methods ============

  private getLeaveTypeName(type: string): string {
    const types: Record<string, string> = {
      ANNUAL: 'إجازة سنوية',
      SICK: 'إجازة مرضية',
      NEW_BABY: 'مولود جديد',
      MARRIAGE: 'إجازة زواج',
      BEREAVEMENT: 'إجازة وفاة',
      HAJJ: 'إجازة حج',
      EXAM: 'إجازة اختبارات',
      WORK_MISSION: 'مهمة عمل',
      UNPAID: 'إجازة بدون راتب',
    };
    return types[type] || type;
  }

  private async createLeaveAttendanceRecords(leaveRequest: any) {
    const user = await this.prisma.user.findUnique({
      where: { id: leaveRequest.userId },
    });

    if (!user?.branchId) return;

    const start = new Date(leaveRequest.startDate);
    const end = new Date(leaveRequest.endDate);

    for (let date = new Date(start); date <= end; date.setDate(date.getDate() + 1)) {
      